--- CHANGELOG.txt ---
@@ -1,3 +1,23 @@
+OSClass 2.3.5 2012-01-16
+------------------------
+- Escape quotes in attr values of input tags using a new helper: osc_esc_html
+- PHP Warning if the user doesn't have a description in his profile
+- PHP Warning in Search model
+- Modified behavior in add/edit form of custom fields
+- Style of radio buttons in custom fields
+- JS error in add/edit page in oc-admin
+- XSS vulnerabilities in search page
+- SQL injections in search page and AJAX request in oc-admin (need to be logged as an admin)
+
+OSClass 2.3.4 2012-01-03
+------------------------
+- Deleting all admins bug fixed
+- Multiple installs bug fixed
+- Feeds url using permalinks
+- SQL error using picture only items bug fixed
+- Some hooks were added on admin
+- SQL optimized a little more
+
 OSClass 2.3.3 2011-12-17
 ------------------------
 - Removed upgrade and upgrade-plugins files

--- oc-admin/ajax/ajax.php ---
@@ -100,13 +100,15 @@ function doModel()
 
                     foreach ($aIds as $id => $parent) {
                         if ($parent == 'root') {
-                            if (!$catManager->updateOrder($id, $orderParent)) {
+                            $res = $catManager->updateOrder($id, $orderParent);
+                            if (is_bool($res) && !$res) {
                                 $error = 1;
                             }
                             // set parent category 
                             $conditions = array('pk_i_id' => $id);
                             $array['fk_i_parent_id'] = NULL;
-                            if (!$catManager->update($array, $conditions) > 0) {
+                            $res = $catManager->update($array, $conditions);
+                            if (is_bool($res) && !$res) {
                                 $error = 1;
                             }
                             $orderParent++;
@@ -115,31 +117,31 @@ function doModel()
                                 $catParent = $parent;
                                 $orderSub = 0;
                             }
-                            if (!$catManager->updateOrder($id, $orderSub)) {
+                            
+                            $res = $catManager->updateOrder($id, $orderSub);
+                            if (is_bool($res) && !$res ) {
                                 $error = 1;
                             }
 
                             // set parent category 
                             $conditions = array('pk_i_id' => $id);
                             $array['fk_i_parent_id'] = $catParent;
-                            if (!$catManager->update($array, $conditions) > 0) {
+                            
+                            $res = $catManager->update($array, $conditions);
+                            if (is_bool($res) && !$res) {
                                 $error = 1;
                             }
                             $orderSub++;
                         }
                     }
 
-                    $result = "{";
-                    $error = 0;
-
-                    if ($error) {
-                        $result .= '"error" : "' . __("Some error ocurred") . '"';
+                    if($error) {
+                        $result = array( 'error' => __("Some error ocurred") ) ;
                     } else {
-                        $result .= '"ok" : "' . __("Order saved") . '"';
+                        $result = array( 'ok' => __("Order saved") ) ;
                     }
-                    $result .= "}";
-
-                    echo $result;
+                    echo json_encode($result) ;
+                    
                     break;
                 case 'category_edit_iframe':
                     $this->_exportVariableToView( 'category', Category::newInstance()->findByPrimaryKey( Params::getParam("id") ) ) ;
@@ -158,66 +160,73 @@ function doModel()
                     break;
                 case 'field_categories_post':
                     $error = 0;
-                    if (!$error) {
-                        try {
-                            $field = Field::newInstance()->findByName(Params::getParam("s_name"));
-                            if (!isset($field['pk_i_id']) || (isset($field['pk_i_id']) && $field['pk_i_id'] == Params::getParam("id"))) {
-                                Field::newInstance()->cleanCategoriesFromField(Params::getParam("id"));
-                                $slug = Params::getParam("field_slug") != '' ? Params::getParam("field_slug") : Params::getParam("id");
-                                $slug = preg_replace('|([-]+)|', '-', preg_replace('|[^a-z0-9_-]|', '-', strtolower($slug)));
-                                Field::newInstance()->update(array('s_name' => Params::getParam("s_name"), 'e_type' => Params::getParam("field_type"), 's_slug' => $slug, 'b_required' => Params::getParam("field_required") == "1" ? 1 : 0, 's_options' => Params::getParam('s_options')), array('pk_i_id' => Params::getParam("id")));
-                                Field::newInstance()->insertCategories(Params::getParam("id"), Params::getParam("categories"));
-                            } else {
+                    $field = Field::newInstance()->findByName(Params::getParam("s_name"));
+                    
+                    if (!isset($field['pk_i_id']) || (isset($field['pk_i_id']) && $field['pk_i_id'] == Params::getParam("id"))) {
+                        // remove categories from a field
+                        Field::newInstance()->cleanCategoriesFromField(Params::getParam("id"));
+                        // no error... continue updating fields
+                        if($error == 0) {
+                            $slug = Params::getParam("field_slug") != '' ? Params::getParam("field_slug") : Params::getParam("id");
+                            $slug = preg_replace('|([-]+)|', '-', preg_replace('|[^a-z0-9_-]|', '-', strtolower($slug)));
+                            $res = Field::newInstance()->update(array('s_name' => Params::getParam("s_name"), 'e_type' => Params::getParam("field_type"), 's_slug' => $slug, 'b_required' => Params::getParam("field_required") == "1" ? 1 : 0, 's_options' => Params::getParam('s_options')), array('pk_i_id' => Params::getParam("id")));
+                            if(is_bool($res) && !$res) {
                                 $error = 1;
-                                $message = __("Sorry, you already have one field with that name");
                             }
-                        } catch (Exception $e) {
-                            $error = 1;
+                        }
+                        // no error... continue inserting categories-field
+                        if($error == 0) {
+                            $aCategories = Params::getParam("categories");
+                            if( is_array($aCategories) && count($aCategories) > 0) {
+                                $res = Field::newInstance()->insertCategories(Params::getParam("id"), $aCategories);
+                                if(!$res) {
+                                    $error = 1;
+                                }
+                            }
+                        }
+                        // error while updating?
+                        if($error == 1) {
                             $message = __("Error while updating.");
                         }
+                    } else {
+                        $error = 1;
+                        $message = __("Sorry, you already have one field with that name");
                     }
 
-                    $result = "{";
-                    if ($error) {
-                        $result .= '"error" : "';
-                        $result .= $message;
-                        $result .= '"';
+                    if($error) {
+                        $result = array( 'error' => $message) ;
                     } else {
-                        $result .= '"ok" : "' . __("Saved") . '", "text" : "' . Params::getParam("s_name") . '"';
+                        $result = array( 'ok' => __("Saved") , 'text' => Params::getParam("s_name")) ;
                     }
-                    $result .= "}";
-
-                    echo $result;
+                    
+                    echo json_encode($result) ;
+                    
                     break;
                 case 'delete_field':
                     $id = Params::getParam("id");
                     $error = 0;
 
-                    try {
-                        $fieldManager = Field::newInstance();
-                        $fieldManager->deleteByPrimaryKey($id);
-
+                    $fieldManager = Field::newInstance();
+                    $res = $fieldManager->deleteByPrimaryKey($id);
+                    
+                    if($res > 0) {
                         $message = __('The custom field have been deleted');
-                    } catch (Exception $e) {
+                    } else {
                         $error = 1;
                         $message = __('Error while deleting');
                     }
 
-                    $result = "{";
-                    if ($error) {
-                        $result .= '"error" : "';
-                        $result .= $message;
-                        $result .= '"';
+                    if($error) {
+                        $result = array( 'error' => $message) ;
                     } else {
-                        $result .= '"ok" : "Saved." ';
+                        $result = array( 'ok' => __("Saved") ) ;
                     }
-                    $result .= "}";
+                    echo json_encode($result) ;
 
-                    echo $result;
                     break;
                 case 'enable_category':
-                    $id       = Params::getParam("id") ;
-                    $enabled  = (Params::getParam("enabled") != '') ? Params::getParam("enabled") : 0 ;
+                    $id       = strip_tags( Params::getParam('id') ) ;
+                    $enabled  = (Params::getParam('enabled') != '') ? Params::getParam('enabled') : 0 ;
                     $error    = 0 ;
                     $result   = array() ;
                     $aUpdated = array() ;
@@ -277,36 +286,32 @@ function doModel()
                     }
                     $result['affectedIds'] = array( array('id' => $id) ) ;
                     echo json_encode($result) ;
+                    
                     break ;
                 case 'delete_category':
                     $id = Params::getParam("id");
                     $error = 0;
-
-                    try {
-                        $categoryManager = Category::newInstance();
-                        $categoryManager->deleteByPrimaryKey($id);
-
+                    
+                    $categoryManager = Category::newInstance();
+                    $res = $categoryManager->deleteByPrimaryKey($id);
+                    
+                    if($res > 0) {
                         $message = __('The categories have been deleted');
-                    } catch (Exception $e) {
+                    } else {
                         $error = 1;
                         $message = __('Error while deleting');
                     }
 
-                    $result = "{";
-                    if ($error) {
-                        $result .= '"error" : "';
-                        $result .= $message;
-                        $result .= '"';
+                    if($error) {
+                        $result = array( 'error' => $message) ;
                     } else {
-                        $result .= '"ok" : "Saved." ';
+                        $result = array( 'ok' => __("Saved") ) ;
                     }
-                    $result .= "}";
-
-                    echo $result;
+                    echo json_encode($result) ;
+                    
                     break;
                 case 'edit_category_post':
                     $id = Params::getParam("id");
-
                     $fields['i_expiration_days'] = (Params::getParam("i_expiration_days") != '') ? Params::getParam("i_expiration_days") : 0;
 
                     $error = 0;
@@ -331,10 +336,10 @@ function doModel()
 
                     $l = osc_language();
                     if ($error==0 || ($error==1 && $has_one_title==1)) {
-                        try {
-                            $categoryManager = Category::newInstance();
-                            $categoryManager->updateByPrimaryKey(array('fields' => $fields, 'aFieldsDescription' => $aFieldsDescription), $id);
-                        } catch (Exception $e) {
+                        $categoryManager = Category::newInstance();
+                        $res = $categoryManager->updateByPrimaryKey(array('fields' => $fields, 'aFieldsDescription' => $aFieldsDescription), $id);
+                        
+                        if( is_bool($res) ) {
                             $error = 2;
                         }
                     }
@@ -352,6 +357,7 @@ function doModel()
                         $msg = __('Error while updating');
                     }
                     echo json_encode(array('error' => $error, 'msg' => $msg, 'text' => $aFieldsDescription[$l]['s_name']));
+                    
                     break;
                 case 'custom': // Execute via AJAX custom file
                     $ajaxfile = Params::getParam("ajaxfile");
@@ -403,6 +409,7 @@ function doModel()
                                 $new_order = $actual_order+1;
                             }
                         }
+                        
                         if($new_order != $actual_order) {
                             $auxpage = $mPages->findByOrder($new_order);
 
@@ -414,10 +421,8 @@ function doModel()
                             $conditions = array('pk_i_id' => $id);
                             $mPages->update($array, $conditions);
 
-                        } else {
-                            
                         }
-                        
+                        // TO BE IMPROVED
                         // json for datatables
                         $prefLocale = osc_current_admin_locale();
                         $aPages = $mPages->listAll(0);
@@ -434,7 +439,7 @@ function doModel()
                             $p_body =  str_replace("'", "\'", trim(strip_tags($body['s_title']), "\x22\x27"));
 
                             $json .= "[\"<input type='checkbox' name='id[]' value='". $page['pk_i_id'] ."' />\",";
-                            $json .= "\"".$page['s_internal_name']."<div id='datatables_quick_edit'>";
+                            $json .= "\"".osc_esc_html($page['s_internal_name'])."<div id='datatables_quick_edit'>";
                             $json .= "<a href='". osc_static_page_url() ."'>". __('View page') ."</a> | ";
                             $json .= "<a href='". osc_admin_base_url(true) ."?page=pages&action=edit&id=". $page['pk_i_id'] ."'>";
                             $json .= __('Edit') ."</a>";
@@ -454,6 +459,7 @@ function doModel()
                         $json .= "]";
                         echo $json;
                     }
+
                     break;
 
                 /******************************
@@ -475,11 +481,14 @@ function doModel()
                     /***********************
                      **** DOWNLOAD FILE ****
                      ***********************/
-                    if (Params::getParam('file') != '') {
+                    $data = osc_file_get_contents("http://osclass.org/latest_version.php");
+                    $data = json_decode(substr($data, 1, strlen($data)-3), true);
+                    $source_file = $data['url'];
+                    if ($source_file != '') {
 
-                        $tmp = explode("/", Params::getParam('file'));
+                        $tmp = explode("/", $source_file);
                         $filename = end($tmp);
-                        $result = osc_downloadFile(Params::getParam('file'), $filename);
+                        $result = osc_downloadFile($source_file, $filename);
 
                         if ($result) { // Everything is OK, continue
                             /**********************

--- oc-admin/ajax/items_processing.php ---
@@ -250,7 +250,7 @@ private function toDatatablesFormat() {
                     if($title != $aRow['s_title']) {
                         $title .= "...";
                     }
-                    $this->sOutput .= '"'.addslashes(preg_replace('|\s+|',' ',$title)).' <br/>';
+                    $this->sOutput .= '"'.addslashes(osc_esc_html(preg_replace('|\s+|',' ',$title))).' <br/>';
                     $this->sOutput .= '<div id=\'datatable_wrapper\'><div id=\'datatables_quick_edit\' ';
                     if($count % 2) {
                         $this->sOutput .= ' class=\'even\' ';
@@ -293,12 +293,12 @@ private function toDatatablesFormat() {
                         $this->sOutput .= '</div></div>",';
                     }
                     
-                    $this->sOutput .= '"'.addslashes($aRow['s_user_name']).'",';
-                    $this->sOutput .= '"'.addslashes($aRow['s_category_name']).'",';
-                    $this->sOutput .= '"'.$aRow['s_country'].'",';
-                    $this->sOutput .= '"'.$aRow['s_region'].'",';
-                    $this->sOutput .= '"'.$aRow['s_city'].'",';
-                    $this->sOutput .= '"'.addslashes($aRow['dt_pub_date']).'"';
+                    $this->sOutput .= '"'.addslashes(osc_esc_html($aRow['s_user_name'])).'",';
+                    $this->sOutput .= '"'.addslashes(osc_esc_html($aRow['s_category_name'])).'",';
+                    $this->sOutput .= '"'.addslashes(osc_esc_html($aRow['s_country'])).'",';
+                    $this->sOutput .= '"'.addslashes(osc_esc_html($aRow['s_region'])).'",';
+                    $this->sOutput .= '"'.addslashes(osc_esc_html($aRow['s_city'])).'",';
+                    $this->sOutput .= '"'.addslashes(osc_esc_html($aRow['dt_pub_date'])).'"';
                     if($this->extraCols > 0) $this->sOutput .= ',';
 
                     if(isset($aRow['i_num_spam'])) {

--- oc-admin/appearance.php ---
@@ -96,7 +96,7 @@ function doModel() {
                     $res = Widget::newInstance()->update(
                         array(
                             's_description' => Params::getParam('description')
-                            ,'s_content' => Params::getParam('content')
+                            ,'s_content' => Params::getParam('content', false, false)
                         ),
                         array('pk_i_id' => Params::getParam('id') )
                     );
@@ -114,7 +114,7 @@ function doModel() {
                             's_location' => Params::getParam('location')
                             ,'e_kind' => 'html'
                             ,'s_description' => Params::getParam('description')
-                            ,'s_content' => Params::getParam('content')
+                            ,'s_content' => Params::getParam('content', false, false)
                         )
                     );
                     osc_add_flash_ok_message( _m('Widget added correctly'), 'admin');

--- oc-admin/themes/modern/admins/edit.php ---
@@ -53,22 +53,22 @@
                             <div style="float: left; width: 50%;">
                                 <fieldset>
                                     <legend><?php _e('Real name'); ?> (<?php _e('required'); ?>)</legend>
-                                    <input type="text" name="s_name" id="s_name" value="<?php echo htmlentities($adminEdit['s_name'],null, "UTF-8"); ?>" />
+                                    <input type="text" name="s_name" id="s_name" value="<?php echo osc_esc_html($adminEdit['s_name']); ?>" />
                                 </fieldset>
                             </div>
 
                             <div style="float: left; width: 50%;">
                                 <fieldset>
                                     <legend><?php _e('E-mail'); ?></legend>
-                                    <input type="text" name="s_email" id="s_email" value="<?php echo htmlentities($adminEdit['s_email'],null, "UTF-8"); ?>" />
+                                    <input type="text" name="s_email" id="s_email" value="<?php echo osc_esc_html($adminEdit['s_email']); ?>" />
                                 </fieldset>
                             </div>
                             <div style="clear: both;"></div>
 
                             <div style="float: left; width: 50%;">
                                 <fieldset>
                                     <legend><?php _e('User name'); ?> (<?php _e('required'); ?>)</legend>
-                                    <input type="text" name="s_username" id="s_username" value="<?php echo htmlentities($adminEdit['s_username'],null, "UTF-8"); ?>" />
+                                    <input type="text" name="s_username" id="s_username" value="<?php echo osc_esc_html($adminEdit['s_username']); ?>" />
                                 </fieldset>
                             </div>
 
@@ -84,7 +84,7 @@
                                 <div style="margin-left: 10px; width: 95%; padding: 4px; background: #FFD2CF;"><?php _e('Leave it blank if you don\'t want to change your password'); ?>.</div>
                             </div>
                             <div style="clear: both;"></div>
-                            <input id="button_save" type="submit" value="<?php _e('Update'); ?>" />
+                            <input id="button_save" type="submit" value="<?php osc_esc_html(_e('Update')); ?>" />
                         </form>
                     </div>
                 </div>

--- oc-admin/themes/modern/admins/index.php ---
@@ -77,8 +77,8 @@
                                             [
                                                     "<input type='checkbox' name='id[]' value='<?php echo $a['pk_i_id']; ?>' />",
                                                     "<?php echo $a['s_username']; ?>&nbsp;<div id='datatables_quick_edit'><a href='<?php echo osc_admin_base_url(true); ?>?page=admins&action=edit&amp;id=<?php echo $a['pk_i_id']; ?>'><?php _e('Edit'); ?></a> | <a onclick=\"javascript:return confirm('<?php _e('This action can\\\\\'t be undone. Are you sure you want to continue?'); ?>')\" href='<?php echo osc_admin_base_url(true); ?>?page=admins&action=delete&amp;id[]=<?php echo $a['pk_i_id']; ?>'><?php _e('Delete'); ?></a></div>",
-                                                    "<?php echo addcslashes($a['s_name'], '"'); ?>",
-                                                    "<?php echo $a['s_email']; ?>"
+                                                    "<?php echo addslashes(osc_esc_html($a['s_name'])); ?>",
+                                                    "<?php echo addslashes(osc_esc_html($a['s_email'])); ?>"
                                             ] <?php echo $last_id != $a['pk_i_id'] ? ',' : ''; ?>
                                     <?php } ?>
                             ],

--- oc-admin/themes/modern/css/item_list_layout.css ---
@@ -124,6 +124,28 @@
     width: 700px;
 }
 
+.meta {
+    clear: both;
+    margin: 10px 0;
+}
+
+.meta > label {
+    float: left;
+}
+
+.meta ul {
+    margin-left: 130px;
+    list-style: none;
+    padding: 0;
+}
+
+.meta ul li {
+    margin-left: 0;
+}
+
+.meta ul li label {
+    float: none;
+}
 
 /* UNIFORM */
 

--- oc-admin/themes/modern/emails/frm.php ---
@@ -73,7 +73,7 @@
                 <?php osc_show_flash_message('admin') ; ?>
                 <!-- add new page form -->
                 <div id="settings_form">
-                    <form name="emails_form" id="emails_form" action="<?php echo osc_admin_base_url(true); ?>?page=emails" method="post" onSubmit="return checkForm()">
+                    <form name="emails_form" id="emails_form" action="<?php echo osc_admin_base_url(true); ?>?page=emails" method="post">
                         <input type="hidden" name="action" value="<?php echo $action_frm; ?>" />
                         <?php PageForm::primary_input_hidden($email); ?>
                         <div class="FormElement">

--- oc-admin/themes/modern/emails/index.php ---
@@ -38,8 +38,8 @@
                               } ?>
                             [
                                 "<?php echo $email['pk_i_id']; ?>",
-                                '<?php echo $email['s_internal_name']; ?><div><a href="<?php echo osc_admin_base_url(true); ?>?page=emails&action=edit&amp;id=<?php echo $email["pk_i_id"]; ?>"><?php _e("Edit"); ?></a></div>',
-                                "<?php echo addcslashes($title['s_title'], '"'); ?>"
+                                '<?php echo addslashes(osc_esc_html($email['s_internal_name'])); ?><div><a href="<?php echo osc_admin_base_url(true); ?>?page=emails&action=edit&amp;id=<?php echo $email["pk_i_id"]; ?>"><?php _e("Edit"); ?></a></div>',
+                                "<?php echo addslashes(osc_esc_html($title['s_title'])); ?>"
                             ] <?php echo $email != end($emails) ? ',' : ''; ?>
                         <?php } ?>
                     ],

--- oc-admin/themes/modern/fields/iframe.php ---
@@ -15,12 +15,11 @@
      * You should have received a copy of the GNU Affero General Public
      * License along with this program. If not, see <http://www.gnu.org/licenses/>.
      */
-
-    //$categories   = __get("categories");
-    $field        = __get("field");
-    $categories = __get("categories");
-    $selected = __get("selected");
-    $numCols = 1;
+    
+    $field          = __get("field");
+    $categories     = __get("categories");
+    $selected       = __get("selected");
+    $numCols        = 1;
 ?>
 
 <link href="<?php echo osc_current_admin_theme_styles_url('jquery.treeview.css') ; ?>" rel="stylesheet" type="text/css" />
@@ -61,7 +60,7 @@
                         <tr style="vertical-align: top;">
                             <td style="font-weight: bold;" colspan="<?php echo $numCols; ?>">
                                 <label for="categories"><?php _e("Preset categories");?></label><br />
-                                <a style="font-size: x-small; color: gray;" href="#" onclick="checkAll('field_form', true); return false;"><?php _e("Check all");?></a> - <a style="font-size: x-small; color: gray;" href="#" onclick="checkAll('field_form', false); return false;"><?php _e("Uncheck all");?></a>
+                                <a style="font-size: x-small; color: gray;" href="#" onclick="checkAll('cat_tree', true); return false;"><?php _e("Check all");?></a> - <a style="font-size: x-small; color: gray;" href="#" onclick="checkAll('cat_tree', false); return false;"><?php _e("Uncheck all");?></a>
                             </td>
                             <td>
                                 <ul id="cat_tree">
@@ -128,23 +127,21 @@
         }
     });
     
-    function checkAll (frm, check) {
-        var aa = document.getElementById(frm);
-        for (var i = 0 ; i < aa.elements.length ; i++) {
-            aa.elements[i].checked = check;
-        }
+    function checkAll (id, check) {
+        aa = $('#'+id+' input[type=checkbox]').each(
+            function(){
+                $(this).attr('checked', check);
+            }
+        );
     }
 
     function checkCat(id, check) {
-        var lay = document.getElementById("cat" + id);
-        if(lay) {
-        inp = lay.getElementsByTagName("input");
-        for (var i = 0, maxI = inp.length ; i < maxI; ++i) {
-            if(inp[i].type == "checkbox") {
-                inp[i].checked = check;
+        aa = $('#cat'+id+' input[type=checkbox]').each(
+            function(){
+                $(this).attr('checked', check);
             }
-        }}
-    }    
+        );
+    }
     
     $(document).ready(function() {
         $('#settings_form form').submit(function() {

--- oc-admin/themes/modern/fields/index.php ---
@@ -16,11 +16,11 @@
      * License along with this program. If not, see <http://www.gnu.org/licenses/>.
      */
 
-    $fields = __get("fields");
-    $last = end($fields); $last_id = $last['pk_i_id'];
+    $fields     = __get("fields");
+    $last       = end($fields); $last_id = $last['pk_i_id'];
     $categories = __get("categories");
-    $selected = __get("default_selected");
-    $numCols = 1;
+    $selected   = __get("default_selected");
+    $numCols    = 1;
 
 ?>
 
@@ -130,23 +130,21 @@ function delete_field(id){
                 
             });
 
-            function checkAll (frm, check) {
-                var aa = document.getElementById(frm);
-                for (var i = 0 ; i < aa.elements.length ; i++) {
-                    aa.elements[i].checked = check;
-                }
+            function checkAll (id, check) {
+                aa = $('#'+id+' input[type=checkbox]').each(
+                    function(){
+                        $(this).attr('checked', check);
+                    }
+                );
             }
 
             function checkCat(id, check) {
-                var lay = document.getElementById("cat" + id);
-                if(lay) {
-                inp = lay.getElementsByTagName("input");
-                for (var i = 0, maxI = inp.length ; i < maxI; ++i) {
-                    if(inp[i].type == "checkbox") {
-                        inp[i].checked = check;
+                aa = $('#cat'+id+' input[type=checkbox]').each(
+                    function(){
+                        $(this).attr('checked', check);
                     }
-                }}
-            }    
+                );
+            } 
         </script>
         <div id="content">
             <div id="separator"></div>	
@@ -206,7 +204,7 @@ function checkCat(id, check) {
                                                 <tr style="vertical-align: top;">
                                                     <td style="font-weight: bold;" colspan="<?php echo $numCols; ?>">
                                                         <label for="categories"><?php _e("Preset categories");?></label><br />
-                                                        <a style="font-size: x-small; color: gray;" href="#" onclick="checkAll('new_field_form', true); return false;"><?php _e("Check all");?></a> - <a style="font-size: x-small; color: gray;" href="#" onclick="checkAll('new_field_form', false); return false;"><?php _e("Uncheck all");?></a>
+                                                        <a style="font-size: x-small; color: gray;" href="#" onclick="checkAll('cat_tree', true); return false;"><?php _e("Check all");?></a> - <a style="font-size: x-small; color: gray;" href="#" onclick="checkAll('cat_tree', false); return false;"><?php _e("Uncheck all");?></a>
                                                     </td>
                                                     <td>
                                                         <ul id="new_cat_tree">

--- oc-admin/themes/modern/languages/add.php ---
@@ -59,7 +59,7 @@
                                 <label for="package"><?php _e('Language package') ; ?> (.zip)</label>
                                 <input type="file" name="package" id="package" />
                             </p>
-                            <input id="button_save" type="submit" value="<?php _e('Upload') ; ?>" />
+                            <input id="button_save" type="submit" value="<?php osc_esc_html(_e('Upload')) ; ?>" />
                         </form>
 
                     <?php } else { ?>

--- oc-admin/themes/modern/languages/index.php ---
@@ -74,10 +74,10 @@
                     ,"aaData": [
                             <?php foreach ($locales as $l) { ?>
                             [
-                                "<input type='checkbox' name='id[]' value='<?php echo $l['pk_c_code']; ?>' />"
-                                ,"<?php echo str_replace('"', '\"', $l['s_name']); ?> <div id='datatables_quick_edit'> <a href='<?php echo osc_admin_base_url(true); ?>?page=languages&action=edit&amp;id=<?php echo $l['pk_c_code'] ; ?>'><?php _e('Edit') ; ?></a> | <a href='<?php echo osc_admin_base_url(true); ?>?page=languages&action=<?php echo $l['b_enabled'] == 1 ? 'disable_selected' : 'enable_selected'; ?>&amp;id[]=<?php echo $l['pk_c_code']; ?>'><?php _e($l['b_enabled'] == 1 ? 'Disable (website)' : 'Enable (website)'); ?></a> | <a href='<?php echo osc_admin_base_url(true); ?>?page=languages&action=<?php echo $l['b_enabled_bo'] == 1 ? 'disable_bo_selected' : 'enable_bo_selected'; ?>&amp;id[]=<?php echo $l['pk_c_code']; ?>'><?php _e($l['b_enabled_bo'] == 1 ? 'Disable (oc-admin)' : 'Enable (oc-admin)'); ?></a> | <a onclick=\"javascript:return confirm('<?php _e('This action can\\\\\'t be undone. Are you sure you want to continue?'); ?>')\" href='<?php echo osc_admin_base_url(true); ?>?page=languages&action=delete&amp;id[]=<?php echo $l['pk_c_code']; ?>'><?php _e('Delete'); ?></a></div>"
-                                ,"<?php echo str_replace('"', '\"', $l['s_short_name']); ?>"
-                                ,"<?php echo str_replace('"', '\"', $l['s_description']) ; ?>"
+                                "<input type='checkbox' name='id[]' value='<?php echo addslashes(osc_esc_html($l['pk_c_code'])); ?>' />"
+                                ,"<?php echo addslashes(osc_esc_html($l['s_name'])); ?> <div id='datatables_quick_edit'> <a href='<?php echo osc_admin_base_url(true); ?>?page=languages&action=edit&amp;id=<?php echo $l['pk_c_code'] ; ?>'><?php _e('Edit') ; ?></a> | <a href='<?php echo osc_admin_base_url(true); ?>?page=languages&action=<?php echo $l['b_enabled'] == 1 ? 'disable_selected' : 'enable_selected'; ?>&amp;id[]=<?php echo $l['pk_c_code']; ?>'><?php _e($l['b_enabled'] == 1 ? 'Disable (website)' : 'Enable (website)'); ?></a> | <a href='<?php echo osc_admin_base_url(true); ?>?page=languages&action=<?php echo $l['b_enabled_bo'] == 1 ? 'disable_bo_selected' : 'enable_bo_selected'; ?>&amp;id[]=<?php echo $l['pk_c_code']; ?>'><?php _e($l['b_enabled_bo'] == 1 ? 'Disable (oc-admin)' : 'Enable (oc-admin)'); ?></a> | <a onclick=\"javascript:return confirm('<?php _e('This action can\\\\\'t be undone. Are you sure you want to continue?'); ?>')\" href='<?php echo osc_admin_base_url(true); ?>?page=languages&action=delete&amp;id[]=<?php echo $l['pk_c_code']; ?>'><?php _e('Delete'); ?></a></div>"
+                                ,"<?php echo addslashes(osc_esc_html($l['s_short_name'])); ?>"
+                                ,"<?php echo addslashes(osc_esc_html($l['s_description'])) ; ?>"
                                 ,"<?php echo ($l['b_enabled']) ? __("Yes") : __("No"); ?>"
                                 ,"<?php echo ($l['b_enabled_bo']) ? __("Yes") : __("No"); ?>"
                             ]  <?php echo $last_id != $l['pk_c_code'] ? ',' : ''; ?>

--- oc-admin/themes/modern/pages/frm.php ---
@@ -74,7 +74,7 @@
                 <?php osc_show_flash_message('admin') ; ?>
                 <!-- add new page form -->
                 <div id="settings_form">
-                    <form name="pages_form" id="pages_form" action="<?php echo osc_admin_base_url(true); ?>?page=pages" method="post" onSubmit="return checkForm()">
+                    <form name="pages_form" id="pages_form" action="<?php echo osc_admin_base_url(true); ?>?page=pages" method="post">
                         <input type="hidden" name="action" value="<?php echo $action_frm; ?>" />
                         <?php PageForm::primary_input_hidden($page); ?>
                         <div class="FormElement">

--- oc-admin/themes/modern/pages/index.php ---
@@ -117,7 +117,7 @@ function order_down(id) {
                         ?>
                                   [
                                     "<input type='checkbox' name='id[]' value='<?php echo osc_static_page_id(); ?>' />",
-                                    "<?php echo $page['s_internal_name']; ?><div id='datatables_quick_edit'>" +
+                                    "<?php echo addslashes(osc_esc_html($page['s_internal_name'])); ?><div id='datatables_quick_edit'>" +
                                     "<a href='<?php echo osc_static_page_url(); ?>'>" +
                                     "<?php _e('View page'); ?></a> | " +
                                     "<a href='<?php echo osc_admin_base_url(true); ?>?page=pages&action=edit&id=<?php echo osc_static_page_id(); ?>'>" +

--- oc-admin/themes/modern/settings/add_currency.php ---
@@ -25,20 +25,20 @@
     <body>
         <?php osc_current_admin_theme_path('header.php') ; ?>
         <div id="update_version" style="display:none;"></div>
-		<div id="content">
-			<div id="separator"></div>
-			<?php osc_current_admin_theme_path ( 'include/backoffice_menu.php' ) ; ?>
-		    <div id="right_column">
-				<div id="content_header" class="content_header">
-					<div style="float: left;">
+        <div id="content">
+            <div id="separator"></div>
+            <?php osc_current_admin_theme_path ( 'include/backoffice_menu.php' ) ; ?>
+            <div id="right_column">
+                <div id="content_header" class="content_header">
+                    <div style="float: left;">
                         <img src="<?php echo osc_current_admin_theme_url('images/settings-icon.png') ; ?>" alt="" title=""/>
                     </div>
-					<div id="content_header_arrow">&raquo; <?php _e('Currencies'); ?></div>
-					<div style="clear: both;"></div>
-				</div>
-				<div id="content_separator"></div>
-				<div id="settings_form" style="border: 1px solid #ccc; background: #eee; ">
-					<div style="padding: 20px;">
+                    <div id="content_header_arrow">&raquo; <?php _e('Currencies'); ?></div>
+                    <div style="clear: both;"></div>
+                </div>
+                <div id="content_separator"></div>
+                <div id="settings_form" style="border: 1px solid #ccc; background: #eee; ">
+                    <div style="padding: 20px;">
                         <form action="<?php echo osc_admin_base_url(true); ?>" method="post">
                             <input type="hidden" name="page" value="settings" />
                             <input type="hidden" name="action" value="currencies" />
@@ -50,24 +50,24 @@
                                     <input type="text" name="pk_c_code" id="code" />
                                     <span><?php _e('It should be a three-character code'); ?>.</span>
                                 </p>
-							
+
                                 <p>
                                     <label for="name"><?php _e('Name'); ?></label><br />
                                     <input type="text" name="s_name" id="name" />
                                 </p>
-							
+
                                 <p>
                                     <label for="description"><?php _e('Description'); ?></label><br />
                                     <input type="text" name="s_description" id="description" />
                                 </p>
                             </fieldset>
-                            <input id="button_save" onclick="javascript:history.back();" value="<?php _e('Cancel'); ?>" />
-                            <input id="button_save" type="submit" value="<?php _e('Create'); ?>" />
-						</form>
-					</div>
-				</div>
-			</div>
-		</div><!-- end of container -->
+                            <input id="button_save" onclick="javascript:history.back();" value="<?php osc_esc_html(_e('Cancel')); ?>" />
+                            <input id="button_save" type="submit" value="<?php osc_esc_html(_e('Create')); ?>" />
+                        </form>
+                    </div>
+                </div>
+            </div>
+        </div><!-- end of container -->
         <?php osc_current_admin_theme_path('footer.php') ; ?>
     </body>
 </html>
\ No newline at end of file

--- oc-admin/themes/modern/settings/comments.php ---
@@ -90,7 +90,7 @@ function checkbox_change() {
                                 </fieldset>
                             </div>
                             <div style="clear: both;"></div>
-                            <input id="button_save" type="submit" value="<?php _e('Update'); ?>" />
+                            <input id="button_save" type="submit" value="<?php osc_esc_html(_e('Update')); ?>" />
                         </form>
                     </div>
                 </div>

--- oc-admin/themes/modern/settings/currencies.php ---
@@ -26,6 +26,7 @@
         <?php osc_current_admin_theme_path('head.php') ; ?>
     </head>
     <body>
+        
         <?php osc_current_admin_theme_path('header.php') ; ?>
         <div id="update_version" style="display:none;"></div>
         <script type="text/javascript">
@@ -71,10 +72,10 @@
                     "aaData": [
                         <?php foreach($aCurrencies as $c) { ?>
                         [
-                            "<input type='checkbox' name='code[]' value='<?php echo $c['pk_c_code']; ?>' />",
-                            "<?php echo $c['pk_c_code']; ?> <div><a onclick=\"javascript:return confirm('<?php _e('This action can\\\\\'t be undone. Are you sure you want to continue?'); ?>')\" href='<?php echo osc_admin_base_url(true); ?>?page=settings&amp;action=currencies&amp;type=delete&amp;code[]=<?php echo $c['pk_c_code']; ?>'><?php _e('Delete'); ?></a> | <a href='<?php echo osc_admin_base_url(true); ?>?page=settings&amp;action=currencies&amp;type=edit&amp;code=<?php echo $c['pk_c_code']; ?>'><?php _e('Edit'); ?></a></div>",
-                            "<?php echo addcslashes($c['s_name'],'"'); ?>",
-                            "<?php echo addcslashes($c['s_description'],'"'); ?>"
+                            "<input type='checkbox' name='code[]' value=\"<?php echo addslashes(osc_esc_html($c['pk_c_code'])); ?>\" />",
+                            "<?php echo addslashes(osc_esc_html($c['pk_c_code'])); ?> <div><a onclick=\"javascript:return confirm('<?php _e('This action can\\\\\'t be undone. Are you sure you want to continue?'); ?>')\" href='<?php echo osc_admin_base_url(true); ?>?page=settings&amp;action=currencies&amp;type=delete&amp;code[]=<?php echo urlencode($c['pk_c_code']); ?>'><?php _e('Delete'); ?></a> | <a href='<?php echo osc_admin_base_url(true); ?>?page=settings&amp;action=currencies&amp;type=edit&amp;code=<?php echo urlencode($c['pk_c_code']); ?>'><?php _e('Edit'); ?></a></div>",
+                            "<?php echo addslashes(osc_esc_html($c['s_name']) ); ?>",
+                            "<?php echo addslashes(osc_esc_html($c['s_description']) ); ?>"
                         ]  <?php echo $last_id != $c['pk_c_code'] ? ',' : ''; ?>
                         <?php } ?>
                     ],

--- oc-admin/themes/modern/settings/edit_currency.php ---
@@ -27,52 +27,52 @@
     <body>
         <?php osc_current_admin_theme_path('header.php') ; ?>
         <div id="update_version" style="display:none;"></div>
-		<div id="content">
-			<div id="separator"></div>	
-			<?php osc_current_admin_theme_path ( 'include/backoffice_menu.php' ) ; ?>
-		    <div id="right_column">
-				<div id="content_header" class="content_header">
-					<div style="float: left;">
+        <div id="content">
+            <div id="separator"></div>	
+            <?php osc_current_admin_theme_path ( 'include/backoffice_menu.php' ) ; ?>
+            <div id="right_column">
+                <div id="content_header" class="content_header">
+                    <div style="float: left;">
                         <img src="<?php echo  osc_current_admin_theme_url('images/settings-icon.png') ; ?>" alt="" title=""/>
                     </div>
-					<div id="content_header_arrow">&raquo; <?php _e('Currencies'); ?></div> 
-					<div style="clear: both;"></div>
-				</div>
-				<div id="content_separator"></div>
-				<div id="settings_form" style="border: 1px solid #ccc; background: #eee;">
-					<div style="padding: 20px;">
+                    <div id="content_header_arrow">&raquo; <?php _e('Currencies'); ?></div> 
+                    <div style="clear: both;"></div>
+                </div>
+                <div id="content_separator"></div>
+                <div id="settings_form" style="border: 1px solid #ccc; background: #eee;">
+                    <div style="padding: 20px;">
                         <form action="<?php echo osc_admin_base_url(true); ?>" method="post">
-							<input type="hidden" name="page" value="settings" />
-							<input type="hidden" name="action" value="currencies" />
-							<input type="hidden" name="type" value="edit_post" />
-							<input type="hidden" name="pk_c_code" value="<?php echo $aCurrency['pk_c_code'];?>" />
+                            <input type="hidden" name="page" value="settings" />
+                            <input type="hidden" name="action" value="currencies" />
+                            <input type="hidden" name="type" value="edit_post" />
+                            <input type="hidden" name="pk_c_code" value="<?php echo osc_esc_html($aCurrency['pk_c_code']);?>" />
 
                             <fieldset>
                                 <legend><?php _e('Edit currency') ; ?></legend>
                                 <p>
                                     <label for="code"><?php _e('Code'); ?></label><br />
-                                    <input type="text" name="pk_c_code" id="code" value="<?php echo $aCurrency['pk_c_code'];?>" disabled/>
+                                    <input type="text" name="pk_c_code" id="code" value="<?php echo osc_esc_html($aCurrency['pk_c_code']);?>" disabled/>
                                     <span><?php _e('Once it\'s created, it can\'t be modified') ?>.</span>
                                 </p>
 
                                 <p>
                                     <label for="name"><?php _e('Name'); ?></label><br />
-                                    <input type="text" name="s_name" id="name" value="<?php echo $aCurrency['s_name'];?>" />
+                                    <input type="text" name="s_name" id="name" value="<?php echo osc_esc_html($aCurrency['s_name']);?>" />
                                 </p>
 
                                 <p>
                                     <label for="description"><?php _e('Description'); ?></label><br />
-                                    <input type="text" name="s_description" id="description" value="<?php echo $aCurrency['s_description'];?>" />
+                                    <input type="text" name="s_description" id="description" value="<?php echo osc_esc_html($aCurrency['s_description']);?>" />
                                 </p>
                             </fieldset>
-							
-                            <input id="button_save" onclick="javascript:history.back();" value="<?php _e('Cancel'); ?>" />
-                            <input id="button_save" type="submit" value="<?php _e('Edit'); ?>" />
-						</form>
-					</div>
-				</div>
-			</div>
-		</div><!-- end of container -->
+
+                            <input id="button_save" onclick="javascript:history.back();" value="<?php osc_esc_html(_e('Cancel')); ?>" />
+                            <input id="button_save" type="submit" value="<?php osc_esc_html(_e('Edit')); ?>" />
+                        </form>
+                    </div>
+                </div>
+            </div>
+        </div><!-- end of container -->
         <?php osc_current_admin_theme_path('footer.php') ; ?>
     </body>
 </html>
\ No newline at end of file

--- oc-admin/themes/modern/settings/index.php ---
@@ -64,14 +64,14 @@ function validateInt(field,default_value) {
                             <div style="float: left; width: 50%;">
                                 <fieldset>
                                     <legend><?php _e('Page title'); ?></legend>
-                                    <input style="width: 95%; height: 20px; padding-left: 4px;" type="text" name="pageTitle" id="pageTitle" value="<?php echo osc_page_title() ; ?>" />
+                                    <input style="width: 95%; height: 20px; padding-left: 4px;" type="text" name="pageTitle" id="pageTitle" value="<?php echo osc_esc_html( osc_page_title() ); ?>" />
                                 </fieldset>
                             </div>
 
                             <div style="float: left; width: 50%;">
                                 <fieldset>
                                     <legend><?php _e('Page description'); ?></legend>
-                                    <input style="width: 95%; height: 20px; padding-left: 4px;" type="text" name="pageDesc" id="pageDesc" value="<?php echo osc_page_description() ; ?>" />
+                                    <input style="width: 95%; height: 20px; padding-left: 4px;" type="text" name="pageDesc" id="pageDesc" value="<?php echo osc_esc_html(osc_page_description() ); ?>" />
                                 </fieldset>
                             </div>
 
@@ -80,7 +80,7 @@ function validateInt(field,default_value) {
                             <div style="float: left; width: 50%;">
                                 <fieldset>
                                     <legend><?php _e('Admin e-mail'); ?></legend>
-                                    <input style="width: 95%; height: 20px; padding-left: 4px;" type="text" name="contactEmail" id="contactEmail" value="<?php echo osc_contact_email() ; ?>" />
+                                    <input style="width: 95%; height: 20px; padding-left: 4px;" type="text" name="contactEmail" id="contactEmail" value="<?php echo osc_esc_html(osc_contact_email() ); ?>" />
                                 </fieldset>
                             </div>
 
@@ -115,7 +115,7 @@ function validateInt(field,default_value) {
                                         <?php } ?>
 
                                         <input type="radio" name="df" id="df_custom" value="df_custom" <?php echo (($custom_checked) ? 'checked="checked"' : ''); ?> />
-                                        <label for="df_custom"><?php _e('Custom') ; ?>:</label> <input type="text" <?php echo (($custom_checked) ? 'value="' . osc_date_format() . '"' : ''); ?> onkeyup="javascript:document.getElementById('dateFormat').value = this.value;"/>
+                                        <label for="df_custom"><?php _e('Custom') ; ?>:</label> <input type="text" <?php echo (($custom_checked) ? 'value="' . osc_esc_html(osc_date_format()) . '"' : ''); ?> onkeyup="javascript:document.getElementById('dateFormat').value = this.value;"/>
                                         <input type="hidden" name="dateFormat" id="dateFormat" value="<?php echo osc_date_format(); ?>" />
                                     </div>
                                 </fieldset>
@@ -127,7 +127,7 @@ function validateInt(field,default_value) {
                                     <select name="currency" id="currency_admin">
                                         <?php $currentCurrency = osc_currency(); ?>
                                         <?php foreach($aCurrencies as $currency) { ?>
-                                            <option value="<?php echo $currency['pk_c_code'] ?>" <?php echo (($currentCurrency == $currency['pk_c_code']) ? 'selected="selected"' : ''); ?>><?php echo $currency['pk_c_code'] ?></option>
+                                            <option value="<?php echo osc_esc_html($currency['pk_c_code']); ?>" <?php echo (($currentCurrency == $currency['pk_c_code']) ? 'selected="selected"' : ''); ?>><?php echo $currency['pk_c_code'] ?></option>
                                         <?php } ?>
                                     </select>
                                 </fieldset>
@@ -177,36 +177,36 @@ function validateInt(field,default_value) {
                                                 <br />
                                             <?php } ?>
                                         <input type="radio" name="tf" id="tf_custom" value="tf_custom" <?php echo (($custom_checked) ? 'checked="checked"' : ''); ?> />
-                                        <label for="tf_custom"><?php _e('Custom') ; ?>:</label> <input type="text" <?php echo (($custom_checked) ? 'value="' . osc_time_format() . '"' : ''); ?> onkeyup="javascript:document.getElementById('timeFormat').value = this.value;"/>
-                                        <input type="hidden" name="timeFormat" id="timeFormat" value="<?php echo osc_time_format(); ?>" />
+                                        <label for="tf_custom"><?php _e('Custom') ; ?>:</label> <input type="text" <?php echo (($custom_checked) ? 'value="' . osc_esc_html(osc_time_format()) . '"' : ''); ?> onkeyup="javascript:document.getElementById('timeFormat').value = this.value;"/>
+                                        <input type="hidden" name="timeFormat" id="timeFormat" value="<?php echo osc_esc_html(osc_time_format()); ?>" />
                                     </div>
                                 </fieldset>
                             </div>
 
                             <div style="float: left; width: 50%;">
                                 <fieldset>
                                     <legend><?php _e('Number of items in the RSS') ; ?></legend>
-                                    <input type="text" id="num_rss_items" name="num_rss_items" value="<?php echo osc_num_rss_items(); ?>" onblur='validateInt(this,<?php echo osc_num_rss_items(); ?>)'/>
+                                    <input type="text" id="num_rss_items" name="num_rss_items" value="<?php echo osc_esc_html(osc_num_rss_items()); ?>" onblur='validateInt(this,<?php echo osc_num_rss_items(); ?>)'/>
                                 </fieldset>
                             </div>
 
                             <div style="float: left; width: 50%;">
                                 <fieldset>
                                     <legend><?php _e('Number of recent items displayed at home') ; ?></legend>
-                                    <input type="text" name="max_latest_items_at_home" id="max_latest_items_at_home" value="<?php echo osc_max_latest_items_at_home(); ?>" onblur='validateInt(this,<?php echo osc_max_latest_items_at_home(); ?>)'/>
+                                    <input type="text" name="max_latest_items_at_home" id="max_latest_items_at_home" value="<?php echo osc_esc_html(osc_max_latest_items_at_home()); ?>" onblur='validateInt(this,<?php echo osc_max_latest_items_at_home(); ?>)'/>
                                 </fieldset>
                             </div>
 
                             <div style="float: left; width: 50%;">
                                 <fieldset>
                                     <legend><?php _e('Number of item displayed in search results') ; ?></legend>
-                                    <input type="text" name="default_results_per_page" id="default_results_per_page" value="<?php echo osc_default_results_per_page_at_search(); ?>" onblur='validateInt(this,<?php echo osc_default_results_per_page_at_search(); ?>)'/>
+                                    <input type="text" name="default_results_per_page" id="default_results_per_page" value="<?php echo osc_esc_html(osc_default_results_per_page_at_search()); ?>" onblur='validateInt(this,<?php echo osc_default_results_per_page_at_search(); ?>)'/>
                                 </fieldset>
                             </div>
 
                             <div style="clear: both;"></div>
 
-                            <input id="button_save" type="submit" value="<?php _e('Update') ; ?>" />
+                            <input id="button_save" type="submit" value="<?php osc_esc_html(_e('Update') ); ?>" />
                         </form>
                     </div>
                 </div>

--- oc-admin/themes/modern/settings/locations.php ---
@@ -72,10 +72,10 @@
                             <div style="padding: 4px; width: 90%;">
                                 <div style="float:left;">
                                     <div>
-                                        <a class="close" href="<?php echo osc_admin_base_url(true); ?>?page=settings&action=locations&type=delete_country&id=<?php echo $country['pk_c_code'] ; ?>">
+                                        <a class="close" href="<?php echo osc_admin_base_url(true); ?>?page=settings&action=locations&type=delete_country&id=<?php echo urlencode($country['pk_c_code']) ; ?>">
                                             <img src="<?php echo osc_admin_base_url() ; ?>images/close.png" alt="<?php _e('Close'); ?>" title="<?php _e('Close'); ?>" />
                                         </a>
-                                        <a class="edit" href="javascript:void(0);" style="padding-right: 15px;" onclick="edit_countries($(this));" data="<?php echo $data;?>" code="<?php echo $country['pk_c_code'];?>"><?php echo $country['s_name'] ; ?></a>
+                                        <a class="edit" href="javascript:void(0);" style="padding-right: 15px;" onclick="edit_countries($(this));" data="<?php echo osc_esc_html($data);?>" code="<?php echo $country['pk_c_code'];?>"><?php echo $country['s_name'] ; ?></a>
                                     </div>
                                 </div>
                                 <div style="float:right">
@@ -163,8 +163,8 @@
                         </p>
                     <?php }; ?>
                     <div style="margin-top: 8px; text-align: right; ">
-                        <input type="button" value="<?php _e('Cancel'); ?>" onclick="$('#d_add_country').css('display','none');$('#fade').css('display','none');"/>
-                        <input type="submit" name="submit" value="<?php _e('Add'); ?>" />
+                        <input type="button" value="<?php osc_esc_html(_e('Cancel')); ?>" onclick="$('#d_add_country').css('display','none');$('#fade').css('display','none');"/>
+                        <input type="submit" name="submit" value="<?php osc_esc_html(_e('Add')); ?>" />
                     </div>
                 </form>
             </div>
@@ -202,8 +202,8 @@
                         </p>
                     <?php }; ?>
                     <div style="margin-top: 8px; text-align: right; ">
-                        <input type="button" value="<?php _e('Cancel'); ?>" onclick="$('#d_edit_country').css('display','none');$('#fade').css('display','none');"/>
-                        <input type="submit" name="submit" value="<?php _e('Edit'); ?>" />
+                        <input type="button" value="<?php osc_esc_html(_e('Cancel')); ?>" onclick="$('#d_edit_country').css('display','none');$('#fade').css('display','none');"/>
+                        <input type="submit" name="submit" value="<?php osc_esc_html(_e('Edit')); ?>" />
                     </div>
                 </form>
             </div>
@@ -229,8 +229,8 @@
                         </tr>
                     </table>
                     <div style="margin-top: 8px; text-align: right; ">
-                        <input type="button" value="<?php _e('Cancel'); ?>" onclick="$('#d_add_region').css('display','none');$('#fade').css('display','none');"/>
-                        <input type="submit" name="submit" value="<?php _e('Add'); ?>" />
+                        <input type="button" value="<?php osc_esc_html(_e('Cancel')); ?>" onclick="$('#d_add_region').css('display','none');$('#fade').css('display','none');"/>
+                        <input type="submit" name="submit" value="<?php osc_esc_html(_e('Add')); ?>" />
                     </div>
                 </form>
             </div>
@@ -254,8 +254,8 @@
                         </tr>
                     </table>
                     <div style="margin-top: 8px; text-align: right; ">
-                        <input type="button" value="<?php _e('Cancel'); ?>" onclick="$('#d_edit_region').css('display','none');$('#fade').css('display','none');"/>
-                        <input type="submit" name="submit" value="<?php _e('Edit'); ?>" />
+                        <input type="button" value="<?php osc_esc_html(_e('Cancel')); ?>" onclick="$('#d_edit_region').css('display','none');$('#fade').css('display','none');"/>
+                        <input type="submit" name="submit" value="<?php osc_esc_html(_e('Edit')); ?>" />
                     </div>
                 </form>
             </div>
@@ -282,8 +282,8 @@
                         </tr>
                     </table>
                     <div style="margin-top: 8px; text-align: right; ">
-                        <input type="button" value="<?php _e('Cancel'); ?>" onclick="$('#d_add_city').css('display','none');$('#fade').css('display','none');"/>
-                        <input type="submit" name="submit" value="<?php _e('Add'); ?>" />
+                        <input type="button" value="<?php osc_esc_html(_e('Cancel')); ?>" onclick="$('#d_add_city').css('display','none');$('#fade').css('display','none');"/>
+                        <input type="submit" name="submit" value="<?php osc_esc_html(_e('Add')); ?>" />
                     </div>
                 </form>
             </div>
@@ -307,8 +307,8 @@
                         </tr>
                     </table>
                     <div style="margin-top: 8px; text-align: right; ">
-                        <input type="button" value="<?php _e('Cancel'); ?>" onclick="$('#d_edit_city').css('display','none');$('#fade').css('display','none');"/>
-                        <input type="submit" name="submit" value="<?php _e('Edit'); ?>" />
+                        <input type="button" value="<?php osc_esc_html(_e('Cancel')); ?>" onclick="$('#d_edit_city').css('display','none');$('#fade').css('display','none');"/>
+                        <input type="submit" name="submit" value="<?php osc_esc_html(_e('Edit')); ?>" />
                     </div>
                 </form>
             </div>

--- oc-admin/themes/modern/settings/mailserver.php ---
@@ -85,27 +85,27 @@ function sendEmail() {
                                     <p>
                                         <label><?php _e('Hostname'); ?></label>
                                         <br/>
-                                        <input style="height: 20px; padding-left: 4px;padding-top: 4px;" type="text"  name="mailserver_host" id="mailserver_host" value="<?php echo osc_mailserver_host() ; ?>" />
+                                        <input style="height: 20px; padding-left: 4px;padding-top: 4px;" type="text"  name="mailserver_host" id="mailserver_host" value="<?php echo osc_esc_html(osc_mailserver_host()) ; ?>" />
                                     </p>
                                     <p>
                                         <label><?php _e('Server port'); ?></label>
                                         <br/>
-                                        <input style="height: 20px; padding-left: 4px;padding-top: 4px;" type="text"  name="mailserver_port" id="mailserver_port" value="<?php echo osc_mailserver_port() ; ?>" />
+                                        <input style="height: 20px; padding-left: 4px;padding-top: 4px;" type="text"  name="mailserver_port" id="mailserver_port" value="<?php echo osc_esc_html(osc_mailserver_port()) ; ?>" />
                                     </p>
                                     <p>
                                         <label><?php _e('Username'); ?></label>
                                         <br/>
-                                        <input style="height: 20px; padding-left: 4px;padding-top: 4px;" type="text"  name="mailserver_username" id="mailserver_username" value="<?php echo osc_mailserver_username() ; ?>" />
+                                        <input style="height: 20px; padding-left: 4px;padding-top: 4px;" type="text"  name="mailserver_username" id="mailserver_username" value="<?php echo osc_esc_html(osc_mailserver_username()) ; ?>" />
                                     </p>
                                     <p>
                                         <label><?php _e('Password'); ?></label>
                                         <br/>
-                                        <input style="height: 20px; padding-left: 4px;padding-top: 4px;" type="password"  name="mailserver_password" id="mailserver_password" value="<?php echo osc_mailserver_password() ; ?>" />
+                                        <input style="height: 20px; padding-left: 4px;padding-top: 4px;" type="password"  name="mailserver_password" id="mailserver_password" value="<?php echo osc_esc_html(osc_mailserver_password()) ; ?>" />
                                     </p>
                                     <p>
                                         <label><?php _e('Encryption'); ?></label>
                                         <br/>
-                                        <input style="height: 20px; padding-left: 4px;padding-top: 4px;" type="text"  name="mailserver_ssl" id="mailserver_ssl" value="<?php echo osc_mailserver_ssl() ; ?>" />
+                                        <input style="height: 20px; padding-left: 4px;padding-top: 4px;" type="text"  name="mailserver_ssl" id="mailserver_ssl" value="<?php echo osc_esc_html(osc_mailserver_ssl()) ; ?>" />
                                         <small><?php _e('Options: blank, ssl or tls'); ?></small>
                                     </p>
                                     <p>
@@ -155,7 +155,7 @@ function sendEmail() {
                                 </fieldset>
                             </div>
                             <div style="clear: both;"></div>
-                            <input id="button_save" type="submit" value="<?php _e('Update') ; ?>" />
+                            <input id="button_save" type="submit" value="<?php osc_esc_html(_e('Update')) ; ?>" />
                         </form>
                     </div>
                 </div>

--- oc-admin/themes/modern/settings/media.php ---
@@ -51,12 +51,12 @@
                                 <legend><?php _e('Restrictions'); ?></legend>
                                 <p>
                                     <label for="maxSize"><?php _e('Maximum size, in KB'); ?></label><br />
-                                    <input type="text" name="maxSizeKb" id="maxSize" value="<?php echo osc_max_size_kb() ; ?>" />
+                                    <input type="text" name="maxSizeKb" id="maxSize" value="<?php echo osc_esc_html(osc_max_size_kb()) ; ?>" />
                                 </p>
 
                                 <p>
                                     <label for="allowedExt"><?php _e('Allowed format extensions (eg: png, jpg, gif)'); ?></label><br />
-                                    <input type="text" name="allowedExt" id="allowedExt" value="<?php echo osc_allowed_extension() ; ?>" />
+                                    <input type="text" name="allowedExt" id="allowedExt" value="<?php echo osc_esc_html(osc_allowed_extension()) ; ?>" />
                                 </p>
                                 <?php if(extension_loaded('imagick')) { ?>
                                 <p>
@@ -71,17 +71,17 @@
                                 <legend><?php _e('Dimensions'); ?></legend>
                                 <p>
                                     <label for="thumbnail"><?php _e('Thumbnail dimensions'); ?></label><br />
-                                    <input type="text" name="dimThumbnail" id="thumbnail" value="<?php echo osc_thumbnail_dimensions() ; ?>" />
+                                    <input type="text" name="dimThumbnail" id="thumbnail" value="<?php echo osc_esc_html(osc_thumbnail_dimensions()) ; ?>" />
                                 </p>
 
                                 <p>
                                     <label for="preview"><?php _e('Preview dimensions'); ?></label><br />
-                                    <input type="text" name="dimPreview" id="preview" value="<?php echo osc_preview_dimensions() ; ?>" />
+                                    <input type="text" name="dimPreview" id="preview" value="<?php echo osc_esc_html(osc_preview_dimensions()) ; ?>" />
                                 </p>
 
                                 <p>
                                     <label for="normal"><?php _e('Normal dimensions'); ?></label><br />
-                                    <input type="text" name="dimNormal" id="normal" value="<?php echo osc_normal_dimensions() ; ?>" />
+                                    <input type="text" name="dimNormal" id="normal" value="<?php echo osc_esc_html(osc_normal_dimensions()) ; ?>" />
                                 </p>
 
                                 <p>
@@ -111,11 +111,11 @@
 
                                     <p>
                                         <label for="watermark_color"><?php _e('Watermark color'); ?></label><br />
-                                        <input type="text" maxlength="6" id="colorpickerField" value="<?php echo osc_watermark_text_color(); ?>" name="watermark_text_color"/>
+                                        <input type="text" maxlength="6" id="colorpickerField" value="<?php echo osc_esc_html(osc_watermark_text_color()); ?>" name="watermark_text_color"/>
                                     </p>
                                     <p>
                                         <label for="watermark_text"><?php _e('Watermark text'); ?></label><br />
-                                        <input type="text" name="watermark_text" value="<?php echo htmlentities(osc_watermark_text(), null, "UTF-8"); ?>"/>
+                                        <input type="text" name="watermark_text" value="<?php echo osc_esc_html(osc_watermark_text()); ?>"/>
                                     </p>
                                     <p>
                                         <label><?php _e('Watermark place'); ?></label>
@@ -153,7 +153,7 @@
                                 </div>
 
                             </fieldset>
-                            <input id="button_save" type="submit" value="<?php _e('Update'); ?>" />
+                            <input id="button_save" type="submit" value="<?php osc_esc_html(_e('Update')); ?>" />
                         </form>
                     </div>
                 </div>

--- oc-admin/themes/modern/tools/upgrade.php ---
@@ -58,7 +58,7 @@
 
                             var tempAr = data.url.split('/') ;
                             fileToUnzip = tempAr.pop() ;
-                            $.get('<?php echo osc_admin_base_url(true) ; ?>?page=ajax&action=upgrade&file=' + data.url, function(data) {
+                            $.get('<?php echo osc_admin_base_url(true) ; ?>?page=ajax&action=upgrade' , function(data) {
                                 var loading_image = document.getElementById('loading_image');
                                 loading_image.style.display = "none";
                                 steps.innerHTML += data+"<br/>";

--- oc-admin/themes/modern/users/index.php ---
@@ -81,9 +81,9 @@
                                 if($u['b_enabled']==0) {?><a href='<?php echo osc_admin_base_url(true); ?>?page=users&action=enable&amp;id[]=<?php echo $u['pk_i_id']; ?>'><?php _e('Enable user'); ?></a><?php } else {?><a href='<?php echo osc_admin_base_url(true); ?>?page=users&action=disable&amp;id[]=<?php echo $u['pk_i_id']; ?>'><?php _e('Disable user'); ?></a><?php }; 
 
                                 ?> | <a href='<?php echo osc_admin_base_url(true); ?>?page=users&action=edit&amp;id=<?php echo $u['pk_i_id']; ?>'><?php _e('Edit'); ?></a> | <a onclick=\"javascript:return confirm('<?php _e('This action can\\\\\'t be undone. Are you sure you want to continue?'); ?>')\" href='<?php echo osc_admin_base_url(true); ?>?page=users&action=delete&amp;id[]=<?php echo $u['pk_i_id']; ?>'><?php _e('Delete'); ?></a></div>"
-						        ,"<?php echo addcslashes($u['s_name'], '"') ; ?>"
+						        ,"<?php echo addslashes(osc_esc_html($u['s_name'])) ; ?>"
 						        ,"<?php echo $u['dt_reg_date'] ; ?>"
-                                ,"<?php echo $u['dt_mod_date'] ; ?>"
+                                                        ,"<?php echo $u['dt_mod_date'] ; ?>"
 					        ] <?php echo $last_id != $u['pk_i_id'] ? ',' : '' ; ?>
 				        <?php } ?>
 			        ]

--- oc-content/themes/modern/style.css ---
@@ -353,6 +353,11 @@ option.pad { margin-left:10px;}
 .add_item .photos input { margin-right:10px; }
 .add_item .location label { float:left; margin-right:10px; width:120px; }
 .add_item .go_back { float:left; margin:20px 0 0 20px; }
+.meta { clear: both; margin: 10px 0; }
+.meta > label { float: left; }
+.meta ul { margin-left: 130px; list-style: none; padding: 0; }
+.meta ul li { margin-left: 0; }
+.meta ul li label { float: none; }
 
 #error_list { display:none; border: 1px solid #f7f7f7; background:#fefbea; padding:5px 5px; margin-bottom:15px; }
 #error_list li { background:url(images/icon-remove.png) left center no-repeat; list-style:none; padding:2px 0 2px 18px; }

--- oc-includes/osclass/classes/database/DAO.php ---
@@ -203,8 +203,8 @@ function insert($values)
          * @since unknown
          * @param array $values Array with keys (database field) and values
          * @param array $where
-         * @return mixed It return the number of affected rows if the update has been 
-         * correct or false if nothing has been modified
+         * @return mixed It returns the number of affected rows if the update has been 
+         * correct or false if an error happended
          */
         function update($values, $where)
         {
@@ -229,8 +229,8 @@ function update($values, $where)
          * @access public
          * @since unknown
          * @param array $where
-         * @return mixed It return the number of affected rows if the delete has been 
-         * correct or false if nothing has been modified
+         * @return mixed It returns the number of affected rows if the delete has been 
+         * correct or false if an error happended
          */
         function delete($where)
         {

--- oc-includes/osclass/classes/database/DBConnectionClass.php ---
@@ -178,8 +178,13 @@ public function __destruct()
          */
         function errorReport()
         {
-            $this->errorLevel = $this->db->errno ;
-            $this->errorDesc  = $this->db->error ;
+            if( OSC_DEBUG ) {
+                $this->errorLevel = $this->db->errno ;
+                $this->errorDesc  = $this->db->error ;
+            } else {
+                $this->errorLevel = @$this->db->errno ;
+                $this->errorDesc  = @$this->db->error ;
+            }
         }
 
         /**
@@ -190,8 +195,13 @@ function errorReport()
          */
         function errorConnection()
         {
-            $this->connErrorLevel = $this->db->connect_errno ;
-            $this->connErrorDesc  = $this->db->connect_error ;
+            if( OSC_DEBUG ) {
+                $this->connErrorLevel = $this->db->connect_errno ;
+                $this->connErrorDesc  = $this->db->connect_error ;
+            } else {
+                $this->connErrorLevel = @$this->db->connect_errno ;
+                $this->connErrorDesc  = @$this->db->connect_error ;
+            }
         }
 
         /**
@@ -417,7 +427,11 @@ function getMetadataDb()
          */
         function _connectToDb($host, $user, $password, &$connId)
         {
-            $connId = new mysqli($host, $user, $password) ;
+            if( OSC_DEBUG ) {
+                $connId = new mysqli($host, $user, $password) ;
+            } else {
+                $connId = @new mysqli($host, $user, $password) ;
+            }
 
             if ( $connId == false ) {
                 return false ;
@@ -474,11 +488,11 @@ function _selectDb($dbName, &$connId)
                 return false ;
             }
 
-            if ( !$connId->select_db($dbName) ) {
-                return false ;
+            if( OSC_DEBUG ) {
+                return $connId->select_db($dbName) ;
             }
 
-            return true ;
+            return @$connId->select_db($dbName) ;
         }
 
         /**
@@ -491,7 +505,11 @@ function _selectDb($dbName, &$connId)
          */
         function _setCharset($charset, &$connId)
         {
-            $connId->set_charset($charset) ;
+            if( OSC_DEBUG ) {
+                $connId->set_charset($charset) ;
+            }
+
+            @$connId->set_charset($charset) ;
         }
 
         /**

--- oc-includes/osclass/core/Params.php ---
@@ -23,18 +23,40 @@
 
     class Params
     {
-        function __construct() {}
+        
+        private static $purifier;
+        
+        function __construct() { }
 
-        static function getParam($param, $htmlencode = false)
+        static function getParam($param, $htmlencode = false, $xss_check = true)
         {
             if ($param == "") return '' ;
             if (!isset($_REQUEST[$param])) return '' ;
 
+            if($xss_check==true && !isset(self::$purifier)) {
+                require_once LIB_PATH . 'htmlpurifier/HTMLPurifier.auto.php';
+                $config = HTMLPurifier_Config::createDefault();
+                $config->set('HTML.Allowed', 'b,strong,i,em,u,a[href|title],ul,ol,li,p[style],br,span[style]');
+                $config->set('CSS.AllowedProperties', 'font,font-size,font-weight,font-style,font-family,text-decoration,padding-left,color,background-color,text-align');
+                $config->set('Cache.SerializerPath', ABS_PATH . 'oc-content/uploads');
+                self::$purifier = new HTMLPurifier($config);
+            }
+            
             $value = $_REQUEST[$param];
+
             if (!is_array($value)) {
+                if($xss_check) {
+                    $value = self::$purifier->purify($_REQUEST[$param]);
+                }
                 if ($htmlencode) {
                     return htmlspecialchars(stripslashes($value), ENT_QUOTES);
                 }
+            } else {
+                if($xss_check) {
+                    foreach($value as $k => $v) {
+                        $value[$k] = self::$purifier->purify($v);
+                    }
+                }
             }
 
             if(get_magic_quotes_gpc()) {
@@ -60,30 +82,40 @@ static function getFiles($param)
         }
 
         //$what = "post, get, cookie"
-        static function getParamsAsArray($what = "")
+        static function getParamsAsArray($what = "", $xss_check = true)
         {
             switch ($what) {
                 case("get"):    
-                     if(get_magic_quotes_gpc()) {
-                        return strip_slashes_extended($_GET);
-                    }
-                    return($_GET) ;
+                    $value = $_GET;
                 break;
                 case("post"):   
-                    if(get_magic_quotes_gpc()) {
-                        return strip_slashes_extended($_POST);
-                    }
-                    return($_POST) ;
+                    $value = $_POST;
                 break;
-                case("cookie"): return($_COOKIE) ;
+                case("cookie"):
+                    return $_COOKIE;
                 break;
                 default:        
-                    if(get_magic_quotes_gpc()) {
-                        return strip_slashes_extended($_REQUEST);
-                    }
-                    return($_REQUEST) ;
+                    $value = $_REQUEST;
                 break;
             }
+            
+            if($xss_check==true) {
+                if(!isset(self::$purifier)) {
+                    require_once LIB_PATH . 'htmlpurifier/HTMLPurifier.auto.php';
+                    $config = HTMLPurifier_Config::createDefault();
+                    $config->set('HTML.Allowed', 'b,strong,i,em,u,a[href|title],ul,ol,li,p[style],br,span[style]');
+                    $config->set('CSS.AllowedProperties', 'font,font-size,font-weight,font-style,font-family,text-decoration,padding-left,color,background-color,text-align');
+                    $config->set('Cache.SerializerPath', ABS_PATH . 'oc-content/uploads');
+                    self::$purifier = new HTMLPurifier($config);
+                }
+                foreach($value as $k => $v) {
+                    $value[$k] = self::$purifier->purify($v);
+                }
+            }
+            if(get_magic_quotes_gpc()) {
+                return strip_slashes_extended($value);
+            }
+            return $value;
         }
 
         static function setParam($key, $value)

--- oc-includes/osclass/frm/Category.form.class.php ---
@@ -119,13 +119,13 @@ static public function multilanguage_name_description($locales, $category = null
                     echo '<div class="FormElement">';
                         echo '<div class="FormElementName">' . __('Title') . '</div>';
                         echo '<div class="FormElementInput">' ;
-                            parent::generic_input_text($locale['pk_c_code'] . '#s_name', (isset($category['locale'][$locale['pk_c_code']])) ? htmlspecialchars($category['locale'][$locale['pk_c_code']]['s_name'], ENT_QUOTES) : "") ;
+                            parent::generic_input_text($locale['pk_c_code'] . '#s_name', (isset($category['locale'][$locale['pk_c_code']])) ? $category['locale'][$locale['pk_c_code']]['s_name'] : "") ;
                         echo '</div>' ;
                     echo '</div>';
                     echo '<div class="FormElement">';
                         echo '<div class="FormElementName">' . __('Description') . '</div>';
                         echo '<div class="FormElementInput">' ;
-                            parent::generic_textarea($locale['pk_c_code'] . '#s_description', (isset($category['locale'][$locale['pk_c_code']])) ? htmlspecialchars($category['locale'][$locale['pk_c_code']]['s_description']) : "") ;
+                            parent::generic_textarea($locale['pk_c_code'] . '#s_description', (isset($category['locale'][$locale['pk_c_code']])) ? $category['locale'][$locale['pk_c_code']]['s_description'] : "") ;
                         echo '</div>' ;
                     echo '</div>';
                 echo '</div>';

--- oc-includes/osclass/frm/Field.form.class.php ---
@@ -65,7 +65,7 @@ static public function meta($field = null) {
                         if(count($options)>0) {
                             echo '<select name="meta['.$field['pk_i_id'].']" id="meta_' . $field['s_slug'] . '">';
                             foreach($options as $option) {
-                                echo '<option value="'.$option.'" '.($field['s_value']==$option?'selected="selected"':'').'>'.$option.'</option>';
+                                echo '<option value="'.osc_esc_html($option).'" '.($field['s_value']==$option?'selected="selected"':'').'>'.$option.'</option>';
                             }
                             echo '</select>';
                         }
@@ -74,15 +74,15 @@ static public function meta($field = null) {
                     if(isset($field) && isset($field['s_options'])) {
                         $options = explode(",", $field['s_options']);
                         if(count($options)>0) {
-                            echo '<ul style="float:left;" >';
+                            echo '<ul>';
                             foreach($options as $key => $option) {
-                                echo '<li><input type="radio" name="meta['.$field['pk_i_id'].']" id="meta_' . $field['s_slug'] . '_'.$key.'" value="'.$option.'" '.($field['s_value']==$option?'checked':'').'/><label style="float:none;" for="meta_' . $field['s_slug'] . '_'.$key.'">'.$option.'</label></li>';
+                                echo '<li><input type="radio" name="meta['.$field['pk_i_id'].']" id="meta_' . $field['s_slug'] . '_'.$key.'" value="'.osc_esc_html($option).'" '.($field['s_value']==$option?'checked':'').'/><label for="meta_' . $field['s_slug'] . '_'.$key.'">'.$option.'</label></li>';
                             }
                             echo '</ul>';
                         }
                     }
                 } else {
-                    echo '<input id="meta_'.$field['s_slug'].'" type="text" name="meta['.$field['pk_i_id'].']" value="' . htmlentities((isset($field) && isset($field["s_value"])) ? $field["s_value"] : "", ENT_COMPAT, "UTF-8") . '" ' ;
+                    echo '<input id="meta_'.$field['s_slug'].'" type="text" name="meta['.$field['pk_i_id'].']" value="' . osc_esc_html((isset($field) && isset($field["s_value"])) ? $field["s_value"] : "") . '" ' ;
                     echo '/>' ;
                 }
             }

--- oc-includes/osclass/frm/Form.form.class.php ---
@@ -26,32 +26,32 @@ static protected function generic_select($name, $items, $fld_key, $fld_name, $de
             if (isset($default_item)) echo '<option value="">' . $default_item . '</option>' ;
             foreach($items as $i) {
                 if(isset($fld_key) && isset($fld_name))
-                echo '<option value="' . $i[$fld_key] . '"' . ( ($id == $i[$fld_key]) ? 'selected="selected"' : '' ) . '>' . $i[$fld_name] . '</option>' ;
+                echo '<option value="' . osc_esc_html($i[$fld_key]) . '"' . ( ($id == $i[$fld_key]) ? 'selected="selected"' : '' ) . '>' . $i[$fld_name] . '</option>' ;
             }
             echo '</select>' ;
         }
 
         static protected function generic_input_text($name, $value, $maxLength = null, $readOnly = false, $autocomplete = true) {
-            echo '<input id="' . $name . '" type="text" name="' . $name . '" value="' . htmlentities($value, ENT_COMPAT, "UTF-8") . '" ' ;
+            echo '<input id="' . $name . '" type="text" name="' . $name . '" value="' . osc_esc_html(htmlentities($value, ENT_COMPAT, "UTF-8")) . '" ' ;
             if (isset($maxLength)) echo 'maxlength="' . $maxLength . '" ' ;
             if (!$autocomplete) echo ' autocomplete="off" ';
             if ($readOnly) echo 'disabled readonly ' ;
             echo '/>' ;
         }
 
         static protected function generic_password($name, $value, $maxLength = null, $readOnly = false) {
-            echo '<input id="' . $name . '" type="password" name="' . $name . '" value="' . htmlentities($value, ENT_COMPAT, "UTF-8") . '" ' ;
+            echo '<input id="' . $name . '" type="password" name="' . $name . '" value="' . osc_esc_html(htmlentities($value, ENT_COMPAT, "UTF-8")) . '" ' ;
             if (isset($maxLength)) echo 'maxlength="' . $maxLength . '" ' ;
             if ($readOnly) echo 'disabled readonly ' ;
             echo '/>' ;
         }
 
         static protected function generic_input_hidden($name, $value) {
-            echo '<input id="' . $name . '" type="hidden" name="' . $name . '" value="' . htmlentities($value, ENT_COMPAT, "UTF-8") . '" />' ;
+            echo '<input id="' . $name . '" type="hidden" name="' . $name . '" value="' . osc_esc_html(htmlentities($value, ENT_COMPAT, "UTF-8")) . '" />' ;
         }
 
         static protected function generic_input_checkbox($name, $value, $checked = false) {
-            echo '<input id="' . $name . '" type="checkbox" name="' . $name . '" value="' . htmlentities($value, ENT_COMPAT, "UTF-8") . '" ' ;
+            echo '<input id="' . $name . '" type="checkbox" name="' . $name . '" value="' . osc_esc_html(htmlentities($value, ENT_COMPAT, "UTF-8")) . '" ' ;
             if ($checked) echo 'checked="checked" ' ;
             echo '/>' ;
         }

--- oc-includes/osclass/gui/item.php ---
@@ -24,17 +24,21 @@
 <html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="<?php echo str_replace('_', '-', osc_current_user_locale()); ?>">
     <head>
         <?php osc_current_web_theme_path('head.php') ; ?>
-        <script type="text/javascript" src="<?php echo osc_current_web_theme_js_url('fancybox/jquery.fancybox-1.3.4.js') ; ?>"></script>
-        <link href="<?php echo osc_current_web_theme_js_url('fancybox/jquery.fancybox-1.3.4.css') ; ?>" rel="stylesheet" type="text/css" />
+        <script type="text/javascript" src="<?php echo osc_current_web_theme_js_url('fancybox/jquery.fancybox.js') ; ?>"></script>
+        <link href="<?php echo osc_current_web_theme_js_url('fancybox/jquery.fancybox.css') ; ?>" rel="stylesheet" type="text/css" />
         
         <script type="text/javascript">
             $(document).ready(function(){
                 $("a[rel=image_group]").fancybox({
-                    'transitionIn'		: 'none',
-                    'transitionOut'		: 'none',
-                    'titlePosition' 	: 'over',
-                    'titleFormat'       : function(title, currentArray, currentIndex) {
-                        return '<span id="fancybox-title-over"><?php _e('Image', 'modern'); ?>  ' +  (currentIndex + 1) + ' / ' + currentArray.length + ' ' + title + '</span>';
+                    openEffect : 'none',
+                    closeEffect	: 'none',
+                    nextEffect : 'fade',
+                    prevEffect : 'fade',
+                    loop : false,
+                    helpers : {
+                            title : {
+                                    type : 'inside'
+                            }
                     }
                 });
             });
@@ -170,7 +174,7 @@
                         <?php if( osc_count_item_resources() > 0 ) { ?>
                         <div id="photos">
                             <?php for ( $i = 0; osc_has_item_resources() ; $i++ ) { ?>
-                            <a href="<?php echo osc_resource_url(); ?>" rel="image_group">
+                            <a href="<?php echo osc_resource_url(); ?>" rel="image_group" title="<?php _e('Image', 'modern'); ?> <?php echo $i+1;?> / <?php echo osc_count_item_resources();?>">
                                 <?php if( $i == 0 ) { ?>
                                     <img src="<?php echo osc_resource_url(); ?>" width="315" alt="" title=""/>
                                 <?php } else { ?>

--- oc-includes/osclass/gui/js/fancybox/helpers/jquery.fancybox-buttons.css ---
@@ -0,0 +1,85 @@
+#fancybox-buttons {
+	position: fixed;
+	left: 0;
+	width: 100%;
+	z-index: 1005;
+}
+
+#fancybox-buttons.top {
+	top: 10px;
+}
+
+#fancybox-buttons.bottom {
+	bottom: 10px;
+}
+
+#fancybox-buttons ul {
+	display: block;
+	width: 170px;
+	height: 30px;
+	margin: 0 auto;
+	padding: 0;
+	list-style: none;
+	background: #111;
+	-webkit-box-shadow: 0 1px 3px #000,0 0 0 1px rgba(0,0,0,.7),inset 0 0 0 1px rgba(255,255,255,.05);
+	-moz-box-shadow: 0 1px 3px #000,0 0 0 1px rgba(0,0,0,.7),inset 0 0 0 1px rgba(255,255,255,.05);
+	background: #111 -webkit-gradient(linear,0% 0%,0% 100%,from(rgba(255,255,255,.2)),color-stop(.5,rgba(255,255,255,.15)),color-stop(.5,rgba(255,255,255,.1)),to(rgba(255,255,255,.15)));
+	background: #111 -moz-linear-gradient(top,rgba(255,255,255,.2) 0%,rgba(255,255,255,.15) 50%,rgba(255,255,255,.1) 50%,rgba(255,255,255,.15) 100%);
+	border-radius: 3px;
+}
+
+#fancybox-buttons ul li {
+	float: left;
+	margin: 0;
+	padding: 0;
+}
+
+#fancybox-buttons a {
+	display: block;
+	width: 30px;
+	height: 30px;
+	text-indent: -9999px;
+	background-image: url('fancybox_buttons.png');
+	background-repeat: no-repeat;
+	outline: none;
+}
+
+#fancybox-buttons a.btnPrev {
+	width: 32px;
+	background-position: 6px 0;
+}
+
+#fancybox-buttons a.btnNext {
+	background-position: -33px 0;
+	border-right: 1px solid #3e3e3e;
+}
+
+#fancybox-buttons a.btnPlay {
+	background-position: 0 -30px;
+}
+
+#fancybox-buttons a.btnPlayOn {
+	background-position: -30px -30px;
+}
+
+#fancybox-buttons a.btnToggle {
+	background-position: 3px -60px;
+	border-left: 1px solid #111;
+	border-right: 1px solid #3e3e3e;
+	width: 35px
+}
+
+#fancybox-buttons a.btnToggleOn {
+	background-position: -27px -60px;
+}
+
+#fancybox-buttons a.btnClose {
+	border-left: 1px solid #111;
+	width: 38px;
+	background-position: -57px 0px;
+}
+
+#fancybox-buttons a.btnDisabled {
+	opacity : 0.5;
+	cursor: default;
+}
\ No newline at end of file

--- oc-includes/osclass/gui/js/fancybox/helpers/jquery.fancybox-buttons.js ---
@@ -0,0 +1,115 @@
+ /*!
+ * Buttons helper for fancyBox
+ * version: 1.0.2
+ * @requires fancyBox v2.0 or later
+ *
+ * Usage: 
+ *     $(".fancybox").fancybox({
+ *         buttons: {
+ *             position : 'top'
+ *         }
+ *     });
+ * 
+ * Options:
+ *     tpl - HTML template
+ *     position - 'top' or 'bottom'
+ * 
+ */
+(function ($) {
+	//Shortcut for fancyBox object
+	var F = $.fancybox;
+
+	//Add helper object
+	F.helpers.buttons = {
+		tpl: '<div id="fancybox-buttons"><ul><li><a class="btnPrev" title="Previous" href="javascript:;"></a></li><li><a class="btnPlay" title="Start slideshow" href="javascript:;"></a></li><li><a class="btnNext" title="Next" href="javascript:;"></a></li><li><a class="btnToggle" title="Toggle size" href="javascript:;"></a></li><li><a class="btnClose" title="Close" href="javascript:jQuery.fancybox.close();"></a></li></ul></div>',
+		list: null,
+		buttons: {},
+
+		update: function () {
+			var toggle = this.buttons.toggle.removeClass('btnDisabled btnToggleOn');
+
+			//Size toggle button
+			if (F.current.canShrink) {
+				toggle.addClass('btnToggleOn');
+
+			} else if (!F.current.canExpand) {
+				toggle.addClass('btnDisabled');
+			}
+		},
+
+		beforeLoad: function (opts) {
+			//Remove self if gallery do not have at least two items
+			if (F.group.length < 2) {
+				F.coming.helpers.buttons = false;
+				F.coming.closeBtn = true;
+
+				return;
+			}
+
+			//Increase top margin to give space for buttons
+			F.coming.margin[ opts.position === 'bottom' ? 2 : 0 ] += 30;
+		},
+
+		onPlayStart: function () {
+			if (this.list) {
+				this.buttons.play.attr('title', 'Pause slideshow').addClass('btnPlayOn');
+			}
+		},
+
+		onPlayEnd: function () {
+			if (this.list) {
+				this.buttons.play.attr('title', 'Start slideshow').removeClass('btnPlayOn');
+			}
+		},
+
+		afterShow: function (opts) {
+			var buttons;
+
+			if (!this.list) {
+				this.list = $(opts.tpl || this.tpl).addClass(opts.position || 'top').appendTo('body');
+
+				this.buttons = {
+					prev : this.list.find('.btnPrev').click( F.prev ),
+					next : this.list.find('.btnNext').click( F.next ),
+					play : this.list.find('.btnPlay').click( F.play ),
+					toggle : this.list.find('.btnToggle').click( F.toggle )
+				}
+			}
+
+			buttons = this.buttons;
+
+			//Prev
+			if (F.current.index > 0 || F.current.loop) {
+				buttons.prev.removeClass('btnDisabled');
+			} else {
+				buttons.prev.addClass('btnDisabled');
+			}
+
+			//Next / Play
+			if (F.current.loop || F.current.index < F.group.length - 1) {
+				buttons.next.removeClass('btnDisabled');
+				buttons.play.removeClass('btnDisabled');
+
+			} else {
+				buttons.next.addClass('btnDisabled');
+				buttons.play.addClass('btnDisabled');
+			}
+
+			this.update();
+		},
+
+		onUpdate: function () {
+			this.update();
+		},
+
+		beforeClose: function () {
+			if (this.list) {
+				this.list.remove();
+			}
+
+			this.list = null;
+			this.buttons = {};
+		}
+	};
+
+}(jQuery));
\ No newline at end of file

--- oc-includes/osclass/gui/js/fancybox/helpers/jquery.fancybox-thumbs.css ---
@@ -0,0 +1,54 @@
+#fancybox-thumbs {
+	position: fixed;
+	left: 0px;
+	width: 100%;
+	overflow: hidden;
+	z-index: 1005;
+}
+
+#fancybox-thumbs.bottom {
+	bottom: 2px;
+}
+
+#fancybox-thumbs.top {
+	top: 2px;
+}
+
+#fancybox-thumbs ul {
+	position: relative;
+	list-style: none;
+	margin: 0;
+	padding: 0;
+}
+
+#fancybox-thumbs ul li {
+	float: left;
+	padding: 1px;
+	opacity: 0.5;
+}
+
+#fancybox-thumbs ul li.active {
+	opacity: 0.75;
+	padding: 0;
+	border: 1px solid #fff;
+}
+
+#fancybox-thumbs ul li:hover {
+	opacity: 1;
+}
+
+#fancybox-thumbs ul li a {
+	display: block;
+	position: relative;
+	overflow: hidden;
+	border: 1px solid #222;
+	background: #111;
+	outline: none;
+}
+
+#fancybox-thumbs ul li img {
+	display: block;
+	position: relative;
+	border: 0;
+	padding: 0;
+}
\ No newline at end of file

--- oc-includes/osclass/gui/js/fancybox/helpers/jquery.fancybox-thumbs.js ---
@@ -0,0 +1,151 @@
+ /*!
+ * Thumbnail helper for fancyBox
+ * version: 1.0.2
+ * @requires fancyBox v2.0 or later
+ *
+ * Usage: 
+ *     $(".fancybox").fancybox({
+ *         thumbs: {
+ *             width	: 50,
+ *             height	: 50
+ *         }
+ *     });
+ * 
+ * Options:
+ *     width - thumbnail width
+ *     height - thumbnail height
+ *     source - function to obtain the URL of the thumbnail image
+ *     position - 'top' or 'bottom'
+ * 
+ */
+(function ($) {
+	//Shortcut for fancyBox object
+	var F = $.fancybox;
+
+	//Add helper object
+	F.helpers.thumbs = {
+		wrap: null,
+		list: null,
+		width: 0,
+
+		//Default function to obtain the URL of the thumbnail image
+		source: function (el) {
+			var img = $(el).find('img');
+
+			return img.length ? img.attr('src') : el.href;
+		},
+
+		init: function (opts) {
+			var that = this,
+				list,
+				thumbWidth = opts.width || 50,
+				thumbHeight = opts.height || 50,
+				thumbSource = opts.source || this.source;
+
+			//Build list structure
+			list = '';
+
+			for (var n = 0; n < F.group.length; n++) {
+				list += '<li><a style="width:' + thumbWidth + 'px;height:' + thumbHeight + 'px;" href="javascript:jQuery.fancybox.jumpto(' + n + ');"></a></li>';
+			}
+
+			this.wrap = $('<div id="fancybox-thumbs"></div>').addClass(opts.position || 'bottom').appendTo('body');
+			this.list = $('<ul>' + list + '</ul>').appendTo(this.wrap);
+
+			//Load each thumbnail
+			$.each(F.group, function (i) {
+				$("<img />").load(function () {
+					var width = this.width,
+						height = this.height,
+						widthRatio, heightRatio, parent;
+
+					if (!that.list || !width || !height) {
+						return;
+					}
+
+					//Calculate thumbnail width/height and center it
+					widthRatio = width / thumbWidth;
+					heightRatio = height / thumbHeight;
+					parent = that.list.children().eq(i).find('a');
+
+					if (widthRatio >= 1 && heightRatio >= 1) {
+						if (widthRatio > heightRatio) {
+							width = Math.floor(width / heightRatio);
+							height = thumbHeight;
+
+						} else {
+							width = thumbWidth;
+							height = Math.floor(height / widthRatio);
+						}
+					}
+
+					$(this).css({
+						width: width,
+						height: height,
+						top: Math.floor(thumbHeight / 2 - height / 2),
+						left: Math.floor(thumbWidth / 2 - width / 2)
+					});
+
+					parent.width(thumbWidth).height(thumbHeight);
+
+					$(this).hide().appendTo(parent).fadeIn(300);
+
+				}).attr('src', thumbSource(this));
+			});
+
+			//Set initial width
+			this.width = this.list.children().eq(0).outerWidth();
+
+			this.list.width(this.width * (F.group.length + 1)).css('left', Math.floor($(window).width() * 0.5 - (F.current.index * this.width + this.width * 0.5)));
+		},
+
+		//Center list
+		update: function (opts) {
+			if (this.list) {
+				this.list.stop(true).animate({
+					'left': Math.floor($(window).width() * 0.5 - (F.current.index * this.width + this.width * 0.5))
+				}, 150);
+			}
+		},
+
+		beforeLoad: function (opts) {
+			//Remove self if gallery do not have at least two items 
+			if (F.group.length < 2) {
+				F.coming.helpers.thumbs = false;
+
+				return;
+			}
+
+			//Increase bottom margin to give space for thumbs
+			F.coming.margin[ opts.position === 'top' ? 0 : 2 ] = opts.height + 30;
+		},
+
+		afterShow: function (opts) {
+			//Check if exists and create or update list
+			if (this.list) {
+				this.update(opts);
+
+			} else {
+				this.init(opts);
+			}
+
+			//Set active element
+			this.list.children().removeClass('active').eq(F.current.index).addClass('active');
+		},
+
+		onUpdate: function () {
+			this.update();
+		},
+
+		beforeClose: function () {
+			if (this.wrap) {
+				this.wrap.remove();
+			}
+
+			this.wrap = null;
+			this.list = null;
+			this.width = 0;
+		}
+	}
+
+}(jQuery));
\ No newline at end of file

--- oc-includes/osclass/gui/js/fancybox/jquery.easing-1.3.pack.js ---
@@ -1,72 +0,0 @@
-/*
- * jQuery Easing v1.3 - http://gsgd.co.uk/sandbox/jquery/easing/
- *
- * Uses the built in easing capabilities added In jQuery 1.1
- * to offer multiple easing options
- *
- * TERMS OF USE - jQuery Easing
- * 
- * Open source under the BSD License. 
- * 
- * Copyright  2008 George McGinley Smith
- * All rights reserved.
- * 
- * Redistribution and use in source and binary forms, with or without modification, 
- * are permitted provided that the following conditions are met:
- * 
- * Redistributions of source code must retain the above copyright notice, this list of 
- * conditions and the following disclaimer.
- * Redistributions in binary form must reproduce the above copyright notice, this list 
- * of conditions and the following disclaimer in the documentation and/or other materials 
- * provided with the distribution.
- * 
- * Neither the name of the author nor the names of contributors may be used to endorse 
- * or promote products derived from this software without specific prior written permission.
- * 
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY 
- * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
- * MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
- *  COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- *  EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE
- *  GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED 
- * AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- *  NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED 
- * OF THE POSSIBILITY OF SUCH DAMAGE. 
- *
-*/
-
-// t: current time, b: begInnIng value, c: change In value, d: duration
-eval(function(p,a,c,k,e,r){e=function(c){return(c<a?'':e(parseInt(c/a)))+((c=c%a)>35?String.fromCharCode(c+29):c.toString(36))};if(!''.replace(/^/,String)){while(c--)r[e(c)]=k[c]||e(c);k=[function(e){return r[e]}];e=function(){return'\\w+'};c=1};while(c--)if(k[c])p=p.replace(new RegExp('\\b'+e(c)+'\\b','g'),k[c]);return p}('h.i[\'1a\']=h.i[\'z\'];h.O(h.i,{y:\'D\',z:9(x,t,b,c,d){6 h.i[h.i.y](x,t,b,c,d)},17:9(x,t,b,c,d){6 c*(t/=d)*t+b},D:9(x,t,b,c,d){6-c*(t/=d)*(t-2)+b},13:9(x,t,b,c,d){e((t/=d/2)<1)6 c/2*t*t+b;6-c/2*((--t)*(t-2)-1)+b},X:9(x,t,b,c,d){6 c*(t/=d)*t*t+b},U:9(x,t,b,c,d){6 c*((t=t/d-1)*t*t+1)+b},R:9(x,t,b,c,d){e((t/=d/2)<1)6 c/2*t*t*t+b;6 c/2*((t-=2)*t*t+2)+b},N:9(x,t,b,c,d){6 c*(t/=d)*t*t*t+b},M:9(x,t,b,c,d){6-c*((t=t/d-1)*t*t*t-1)+b},L:9(x,t,b,c,d){e((t/=d/2)<1)6 c/2*t*t*t*t+b;6-c/2*((t-=2)*t*t*t-2)+b},K:9(x,t,b,c,d){6 c*(t/=d)*t*t*t*t+b},J:9(x,t,b,c,d){6 c*((t=t/d-1)*t*t*t*t+1)+b},I:9(x,t,b,c,d){e((t/=d/2)<1)6 c/2*t*t*t*t*t+b;6 c/2*((t-=2)*t*t*t*t+2)+b},G:9(x,t,b,c,d){6-c*8.C(t/d*(8.g/2))+c+b},15:9(x,t,b,c,d){6 c*8.n(t/d*(8.g/2))+b},12:9(x,t,b,c,d){6-c/2*(8.C(8.g*t/d)-1)+b},Z:9(x,t,b,c,d){6(t==0)?b:c*8.j(2,10*(t/d-1))+b},Y:9(x,t,b,c,d){6(t==d)?b+c:c*(-8.j(2,-10*t/d)+1)+b},W:9(x,t,b,c,d){e(t==0)6 b;e(t==d)6 b+c;e((t/=d/2)<1)6 c/2*8.j(2,10*(t-1))+b;6 c/2*(-8.j(2,-10*--t)+2)+b},V:9(x,t,b,c,d){6-c*(8.o(1-(t/=d)*t)-1)+b},S:9(x,t,b,c,d){6 c*8.o(1-(t=t/d-1)*t)+b},Q:9(x,t,b,c,d){e((t/=d/2)<1)6-c/2*(8.o(1-t*t)-1)+b;6 c/2*(8.o(1-(t-=2)*t)+1)+b},P:9(x,t,b,c,d){f s=1.l;f p=0;f a=c;e(t==0)6 b;e((t/=d)==1)6 b+c;e(!p)p=d*.3;e(a<8.w(c)){a=c;f s=p/4}m f s=p/(2*8.g)*8.r(c/a);6-(a*8.j(2,10*(t-=1))*8.n((t*d-s)*(2*8.g)/p))+b},H:9(x,t,b,c,d){f s=1.l;f p=0;f a=c;e(t==0)6 b;e((t/=d)==1)6 b+c;e(!p)p=d*.3;e(a<8.w(c)){a=c;f s=p/4}m f s=p/(2*8.g)*8.r(c/a);6 a*8.j(2,-10*t)*8.n((t*d-s)*(2*8.g)/p)+c+b},T:9(x,t,b,c,d){f s=1.l;f p=0;f a=c;e(t==0)6 b;e((t/=d/2)==2)6 b+c;e(!p)p=d*(.3*1.5);e(a<8.w(c)){a=c;f s=p/4}m f s=p/(2*8.g)*8.r(c/a);e(t<1)6-.5*(a*8.j(2,10*(t-=1))*8.n((t*d-s)*(2*8.g)/p))+b;6 a*8.j(2,-10*(t-=1))*8.n((t*d-s)*(2*8.g)/p)*.5+c+b},F:9(x,t,b,c,d,s){e(s==u)s=1.l;6 c*(t/=d)*t*((s+1)*t-s)+b},E:9(x,t,b,c,d,s){e(s==u)s=1.l;6 c*((t=t/d-1)*t*((s+1)*t+s)+1)+b},16:9(x,t,b,c,d,s){e(s==u)s=1.l;e((t/=d/2)<1)6 c/2*(t*t*(((s*=(1.B))+1)*t-s))+b;6 c/2*((t-=2)*t*(((s*=(1.B))+1)*t+s)+2)+b},A:9(x,t,b,c,d){6 c-h.i.v(x,d-t,0,c,d)+b},v:9(x,t,b,c,d){e((t/=d)<(1/2.k)){6 c*(7.q*t*t)+b}m e(t<(2/2.k)){6 c*(7.q*(t-=(1.5/2.k))*t+.k)+b}m e(t<(2.5/2.k)){6 c*(7.q*(t-=(2.14/2.k))*t+.11)+b}m{6 c*(7.q*(t-=(2.18/2.k))*t+.19)+b}},1b:9(x,t,b,c,d){e(t<d/2)6 h.i.A(x,t*2,0,c,d)*.5+b;6 h.i.v(x,t*2-d,0,c,d)*.5+c*.5+b}});',62,74,'||||||return||Math|function|||||if|var|PI|jQuery|easing|pow|75|70158|else|sin|sqrt||5625|asin|||undefined|easeOutBounce|abs||def|swing|easeInBounce|525|cos|easeOutQuad|easeOutBack|easeInBack|easeInSine|easeOutElastic|easeInOutQuint|easeOutQuint|easeInQuint|easeInOutQuart|easeOutQuart|easeInQuart|extend|easeInElastic|easeInOutCirc|easeInOutCubic|easeOutCirc|easeInOutElastic|easeOutCubic|easeInCirc|easeInOutExpo|easeInCubic|easeOutExpo|easeInExpo||9375|easeInOutSine|easeInOutQuad|25|easeOutSine|easeInOutBack|easeInQuad|625|984375|jswing|easeInOutBounce'.split('|'),0,{}))
-
-/*
- *
- * TERMS OF USE - EASING EQUATIONS
- * 
- * Open source under the BSD License. 
- * 
- * Copyright  2001 Robert Penner
- * All rights reserved.
- * 
- * Redistribution and use in source and binary forms, with or without modification, 
- * are permitted provided that the following conditions are met:
- * 
- * Redistributions of source code must retain the above copyright notice, this list of 
- * conditions and the following disclaimer.
- * Redistributions in binary form must reproduce the above copyright notice, this list 
- * of conditions and the following disclaimer in the documentation and/or other materials 
- * provided with the distribution.
- * 
- * Neither the name of the author nor the names of contributors may be used to endorse 
- * or promote products derived from this software without specific prior written permission.
- * 
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY 
- * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
- * MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
- *  COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- *  EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE
- *  GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED 
- * AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- *  NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED 
- * OF THE POSSIBILITY OF SUCH DAMAGE. 
- *
- */

--- oc-includes/osclass/gui/js/fancybox/jquery.fancybox-1.3.4.css ---
@@ -1,359 +0,0 @@
-/*
- * FancyBox - jQuery Plugin
- * Simple and fancy lightbox alternative
- *
- * Examples and documentation at: http://fancybox.net
- * 
- * Copyright (c) 2008 - 2010 Janis Skarnelis
- * That said, it is hardly a one-person project. Many people have submitted bugs, code, and offered their advice freely. Their support is greatly appreciated.
- * 
- * Version: 1.3.4 (11/11/2010)
- * Requires: jQuery v1.3+
- *
- * Dual licensed under the MIT and GPL licenses:
- *   http://www.opensource.org/licenses/mit-license.php
- *   http://www.gnu.org/licenses/gpl.html
- */
-
-#fancybox-loading {
-	position: fixed;
-	top: 50%;
-	left: 50%;
-	width: 40px;
-	height: 40px;
-	margin-top: -20px;
-	margin-left: -20px;
-	cursor: pointer;
-	overflow: hidden;
-	z-index: 1104;
-	display: none;
-}
-
-#fancybox-loading div {
-	position: absolute;
-	top: 0;
-	left: 0;
-	width: 40px;
-	height: 480px;
-	background-image: url('fancybox.png');
-}
-
-#fancybox-overlay {
-	position: absolute;
-	top: 0;
-	left: 0;
-	width: 100%;
-	z-index: 1100;
-	display: none;
-}
-
-#fancybox-tmp {
-	padding: 0;
-	margin: 0;
-	border: 0;
-	overflow: auto;
-	display: none;
-}
-
-#fancybox-wrap {
-	position: absolute;
-	top: 0;
-	left: 0;
-	padding: 20px;
-	z-index: 1101;
-	outline: none;
-	display: none;
-}
-
-#fancybox-outer {
-	position: relative;
-	width: 100%;
-	height: 100%;
-	background: #fff;
-}
-
-#fancybox-content {
-	width: 0;
-	height: 0;
-	padding: 0;
-	outline: none;
-	position: relative;
-	overflow: hidden;
-	z-index: 1102;
-	border: 0px solid #fff;
-}
-
-#fancybox-hide-sel-frame {
-	position: absolute;
-	top: 0;
-	left: 0;
-	width: 100%;
-	height: 100%;
-	background: transparent;
-	z-index: 1101;
-}
-
-#fancybox-close {
-	position: absolute;
-	top: -15px;
-	right: -15px;
-	width: 30px;
-	height: 30px;
-	background: transparent url('fancybox.png') -40px 0px;
-	cursor: pointer;
-	z-index: 1103;
-	display: none;
-}
-
-#fancybox-error {
-	color: #444;
-	font: normal 12px/20px Arial;
-	padding: 14px;
-	margin: 0;
-}
-
-#fancybox-img {
-	width: 100%;
-	height: 100%;
-	padding: 0;
-	margin: 0;
-	border: none;
-	outline: none;
-	line-height: 0;
-	vertical-align: top;
-}
-
-#fancybox-frame {
-	width: 100%;
-	height: 100%;
-	border: none;
-	display: block;
-}
-
-#fancybox-left, #fancybox-right {
-	position: absolute;
-	bottom: 0px;
-	height: 100%;
-	width: 35%;
-	cursor: pointer;
-	outline: none;
-	background: transparent url('blank.gif');
-	z-index: 1102;
-	display: none;
-}
-
-#fancybox-left {
-	left: 0px;
-}
-
-#fancybox-right {
-	right: 0px;
-}
-
-#fancybox-left-ico, #fancybox-right-ico {
-	position: absolute;
-	top: 50%;
-	left: -9999px;
-	width: 30px;
-	height: 30px;
-	margin-top: -15px;
-	cursor: pointer;
-	z-index: 1102;
-	display: block;
-}
-
-#fancybox-left-ico {
-	background-image: url('fancybox.png');
-	background-position: -40px -30px;
-}
-
-#fancybox-right-ico {
-	background-image: url('fancybox.png');
-	background-position: -40px -60px;
-}
-
-#fancybox-left:hover, #fancybox-right:hover {
-	visibility: visible; /* IE6 */
-}
-
-#fancybox-left:hover span {
-	left: 20px;
-}
-
-#fancybox-right:hover span {
-	left: auto;
-	right: 20px;
-}
-
-.fancybox-bg {
-	position: absolute;
-	padding: 0;
-	margin: 0;
-	border: 0;
-	width: 20px;
-	height: 20px;
-	z-index: 1001;
-}
-
-#fancybox-bg-n {
-	top: -20px;
-	left: 0;
-	width: 100%;
-	background-image: url('fancybox-x.png');
-}
-
-#fancybox-bg-ne {
-	top: -20px;
-	right: -20px;
-	background-image: url('fancybox.png');
-	background-position: -40px -162px;
-}
-
-#fancybox-bg-e {
-	top: 0;
-	right: -20px;
-	height: 100%;
-	background-image: url('fancybox-y.png');
-	background-position: -20px 0px;
-}
-
-#fancybox-bg-se {
-	bottom: -20px;
-	right: -20px;
-	background-image: url('fancybox.png');
-	background-position: -40px -182px; 
-}
-
-#fancybox-bg-s {
-	bottom: -20px;
-	left: 0;
-	width: 100%;
-	background-image: url('fancybox-x.png');
-	background-position: 0px -20px;
-}
-
-#fancybox-bg-sw {
-	bottom: -20px;
-	left: -20px;
-	background-image: url('fancybox.png');
-	background-position: -40px -142px;
-}
-
-#fancybox-bg-w {
-	top: 0;
-	left: -20px;
-	height: 100%;
-	background-image: url('fancybox-y.png');
-}
-
-#fancybox-bg-nw {
-	top: -20px;
-	left: -20px;
-	background-image: url('fancybox.png');
-	background-position: -40px -122px;
-}
-
-#fancybox-title {
-	font-family: Helvetica;
-	font-size: 12px;
-	z-index: 1102;
-}
-
-.fancybox-title-inside {
-	padding-bottom: 10px;
-	text-align: center;
-	color: #333;
-	background: #fff;
-	position: relative;
-}
-
-.fancybox-title-outside {
-	padding-top: 10px;
-	color: #fff;
-}
-
-.fancybox-title-over {
-	position: absolute;
-	bottom: 0;
-	left: 0;
-	color: #FFF;
-	text-align: left;
-}
-
-#fancybox-title-over {
-	padding: 10px;
-	background-image: url('fancy_title_over.png');
-	display: block;
-}
-
-.fancybox-title-float {
-	position: absolute;
-	left: 0;
-	bottom: -20px;
-	height: 32px;
-}
-
-#fancybox-title-float-wrap {
-	border: none;
-	border-collapse: collapse;
-	width: auto;
-}
-
-#fancybox-title-float-wrap td {
-	border: none;
-	white-space: nowrap;
-}
-
-#fancybox-title-float-left {
-	padding: 0 0 0 15px;
-	background: url('fancybox.png') -40px -90px no-repeat;
-}
-
-#fancybox-title-float-main {
-	color: #FFF;
-	line-height: 29px;
-	font-weight: bold;
-	padding: 0 0 3px 0;
-	background: url('fancybox-x.png') 0px -40px;
-}
-
-#fancybox-title-float-right {
-	padding: 0 0 0 15px;
-	background: url('fancybox.png') -55px -90px no-repeat;
-}
-
-/* IE6 */
-
-.fancybox-ie6 #fancybox-close { background: transparent; filter: progid:DXImageTransform.Microsoft.AlphaImageLoader(src='fancybox/fancy_close.png', sizingMethod='scale'); }
-
-.fancybox-ie6 #fancybox-left-ico { background: transparent; filter: progid:DXImageTransform.Microsoft.AlphaImageLoader(src='fancybox/fancy_nav_left.png', sizingMethod='scale'); }
-.fancybox-ie6 #fancybox-right-ico { background: transparent; filter: progid:DXImageTransform.Microsoft.AlphaImageLoader(src='fancybox/fancy_nav_right.png', sizingMethod='scale'); }
-
-.fancybox-ie6 #fancybox-title-over { background: transparent; filter: progid:DXImageTransform.Microsoft.AlphaImageLoader(src='fancybox/fancy_title_over.png', sizingMethod='scale'); zoom: 1; }
-.fancybox-ie6 #fancybox-title-float-left { background: transparent; filter: progid:DXImageTransform.Microsoft.AlphaImageLoader(src='fancybox/fancy_title_left.png', sizingMethod='scale'); }
-.fancybox-ie6 #fancybox-title-float-main { background: transparent; filter: progid:DXImageTransform.Microsoft.AlphaImageLoader(src='fancybox/fancy_title_main.png', sizingMethod='scale'); }
-.fancybox-ie6 #fancybox-title-float-right { background: transparent; filter: progid:DXImageTransform.Microsoft.AlphaImageLoader(src='fancybox/fancy_title_right.png', sizingMethod='scale'); }
-
-.fancybox-ie6 #fancybox-bg-w, .fancybox-ie6 #fancybox-bg-e, .fancybox-ie6 #fancybox-left, .fancybox-ie6 #fancybox-right, #fancybox-hide-sel-frame {
-	height: expression(this.parentNode.clientHeight + "px");
-}
-
-#fancybox-loading.fancybox-ie6 {
-	position: absolute; margin-top: 0;
-	top: expression( (-20 + (document.documentElement.clientHeight ? document.documentElement.clientHeight/2 : document.body.clientHeight/2 ) + ( ignoreMe = document.documentElement.scrollTop ? document.documentElement.scrollTop : document.body.scrollTop )) + 'px');
-}
-
-#fancybox-loading.fancybox-ie6 div	{ background: transparent; filter: progid:DXImageTransform.Microsoft.AlphaImageLoader(src='fancybox/fancy_loading.png', sizingMethod='scale'); }
-
-/* IE6, IE7, IE8 */
-
-.fancybox-ie .fancybox-bg { background: transparent !important; }
-
-.fancybox-ie #fancybox-bg-n { filter: progid:DXImageTransform.Microsoft.AlphaImageLoader(src='fancybox/fancy_shadow_n.png', sizingMethod='scale'); }
-.fancybox-ie #fancybox-bg-ne { filter: progid:DXImageTransform.Microsoft.AlphaImageLoader(src='fancybox/fancy_shadow_ne.png', sizingMethod='scale'); }
-.fancybox-ie #fancybox-bg-e { filter: progid:DXImageTransform.Microsoft.AlphaImageLoader(src='fancybox/fancy_shadow_e.png', sizingMethod='scale'); }
-.fancybox-ie #fancybox-bg-se { filter: progid:DXImageTransform.Microsoft.AlphaImageLoader(src='fancybox/fancy_shadow_se.png', sizingMethod='scale'); }
-.fancybox-ie #fancybox-bg-s { filter: progid:DXImageTransform.Microsoft.AlphaImageLoader(src='fancybox/fancy_shadow_s.png', sizingMethod='scale'); }
-.fancybox-ie #fancybox-bg-sw { filter: progid:DXImageTransform.Microsoft.AlphaImageLoader(src='fancybox/fancy_shadow_sw.png', sizingMethod='scale'); }
-.fancybox-ie #fancybox-bg-w { filter: progid:DXImageTransform.Microsoft.AlphaImageLoader(src='fancybox/fancy_shadow_w.png', sizingMethod='scale'); }
-.fancybox-ie #fancybox-bg-nw { filter: progid:DXImageTransform.Microsoft.AlphaImageLoader(src='fancybox/fancy_shadow_nw.png', sizingMethod='scale'); }
\ No newline at end of file

--- oc-includes/osclass/gui/js/fancybox/jquery.fancybox-1.3.4.js ---
@@ -1,1156 +0,0 @@
-/*
- * FancyBox - jQuery Plugin
- * Simple and fancy lightbox alternative
- *
- * Examples and documentation at: http://fancybox.net
- *
- * Copyright (c) 2008 - 2010 Janis Skarnelis
- * That said, it is hardly a one-person project. Many people have submitted bugs, code, and offered their advice freely. Their support is greatly appreciated.
- *
- * Version: 1.3.4 (11/11/2010)
- * Requires: jQuery v1.3+
- *
- * Dual licensed under the MIT and GPL licenses:
- *   http://www.opensource.org/licenses/mit-license.php
- *   http://www.gnu.org/licenses/gpl.html
- */
-
-;(function($) {
-	var tmp, loading, overlay, wrap, outer, content, close, title, nav_left, nav_right,
-
-		selectedIndex = 0, selectedOpts = {}, selectedArray = [], currentIndex = 0, currentOpts = {}, currentArray = [],
-
-		ajaxLoader = null, imgPreloader = new Image(), imgRegExp = /\.(jpg|gif|png|bmp|jpeg)(.*)?$/i, swfRegExp = /[^\.]\.(swf)\s*$/i,
-
-		loadingTimer, loadingFrame = 1,
-
-		titleHeight = 0, titleStr = '', start_pos, final_pos, busy = false, fx = $.extend($('<div/>')[0], { prop: 0 }),
-
-		isIE6 = $.browser.msie && $.browser.version < 7 && !window.XMLHttpRequest,
-
-		/*
-		 * Private methods 
-		 */
-
-		_abort = function() {
-			loading.hide();
-
-			imgPreloader.onerror = imgPreloader.onload = null;
-
-			if (ajaxLoader) {
-				ajaxLoader.abort();
-			}
-
-			tmp.empty();
-		},
-
-		_error = function() {
-			if (false === selectedOpts.onError(selectedArray, selectedIndex, selectedOpts)) {
-				loading.hide();
-				busy = false;
-				return;
-			}
-
-			selectedOpts.titleShow = false;
-
-			selectedOpts.width = 'auto';
-			selectedOpts.height = 'auto';
-
-			tmp.html( '<p id="fancybox-error">The requested content cannot be loaded.<br />Please try again later.</p>' );
-
-			_process_inline();
-		},
-
-		_start = function() {
-			var obj = selectedArray[ selectedIndex ],
-				href, 
-				type, 
-				title,
-				str,
-				emb,
-				ret;
-
-			_abort();
-
-			selectedOpts = $.extend({}, $.fn.fancybox.defaults, (typeof $(obj).data('fancybox') == 'undefined' ? selectedOpts : $(obj).data('fancybox')));
-
-			ret = selectedOpts.onStart(selectedArray, selectedIndex, selectedOpts);
-
-			if (ret === false) {
-				busy = false;
-				return;
-			} else if (typeof ret == 'object') {
-				selectedOpts = $.extend(selectedOpts, ret);
-			}
-
-			title = selectedOpts.title || (obj.nodeName ? $(obj).attr('title') : obj.title) || '';
-
-			if (obj.nodeName && !selectedOpts.orig) {
-				selectedOpts.orig = $(obj).children("img:first").length ? $(obj).children("img:first") : $(obj);
-			}
-
-			if (title === '' && selectedOpts.orig && selectedOpts.titleFromAlt) {
-				title = selectedOpts.orig.attr('alt');
-			}
-
-			href = selectedOpts.href || (obj.nodeName ? $(obj).attr('href') : obj.href) || null;
-
-			if ((/^(?:javascript)/i).test(href) || href == '#') {
-				href = null;
-			}
-
-			if (selectedOpts.type) {
-				type = selectedOpts.type;
-
-				if (!href) {
-					href = selectedOpts.content;
-				}
-
-			} else if (selectedOpts.content) {
-				type = 'html';
-
-			} else if (href) {
-				if (href.match(imgRegExp)) {
-					type = 'image';
-
-				} else if (href.match(swfRegExp)) {
-					type = 'swf';
-
-				} else if ($(obj).hasClass("iframe")) {
-					type = 'iframe';
-
-				} else if (href.indexOf("#") === 0) {
-					type = 'inline';
-
-				} else {
-					type = 'ajax';
-				}
-			}
-
-			if (!type) {
-				_error();
-				return;
-			}
-
-			if (type == 'inline') {
-				obj	= href.substr(href.indexOf("#"));
-				type = $(obj).length > 0 ? 'inline' : 'ajax';
-			}
-
-			selectedOpts.type = type;
-			selectedOpts.href = href;
-			selectedOpts.title = title;
-
-			if (selectedOpts.autoDimensions) {
-				if (selectedOpts.type == 'html' || selectedOpts.type == 'inline' || selectedOpts.type == 'ajax') {
-					selectedOpts.width = 'auto';
-					selectedOpts.height = 'auto';
-				} else {
-					selectedOpts.autoDimensions = false;	
-				}
-			}
-
-			if (selectedOpts.modal) {
-				selectedOpts.overlayShow = true;
-				selectedOpts.hideOnOverlayClick = false;
-				selectedOpts.hideOnContentClick = false;
-				selectedOpts.enableEscapeButton = false;
-				selectedOpts.showCloseButton = false;
-			}
-
-			selectedOpts.padding = parseInt(selectedOpts.padding, 10);
-			selectedOpts.margin = parseInt(selectedOpts.margin, 10);
-
-			tmp.css('padding', (selectedOpts.padding + selectedOpts.margin));
-
-			$('.fancybox-inline-tmp').unbind('fancybox-cancel').bind('fancybox-change', function() {
-				$(this).replaceWith(content.children());				
-			});
-
-			switch (type) {
-				case 'html' :
-					tmp.html( selectedOpts.content );
-					_process_inline();
-				break;
-
-				case 'inline' :
-					if ( $(obj).parent().is('#fancybox-content') === true) {
-						busy = false;
-						return;
-					}
-
-					$('<div class="fancybox-inline-tmp" />')
-						.hide()
-						.insertBefore( $(obj) )
-						.bind('fancybox-cleanup', function() {
-							$(this).replaceWith(content.children());
-						}).bind('fancybox-cancel', function() {
-							$(this).replaceWith(tmp.children());
-						});
-
-					$(obj).appendTo(tmp);
-
-					_process_inline();
-				break;
-
-				case 'image':
-					busy = false;
-
-					$.fancybox.showActivity();
-
-					imgPreloader = new Image();
-
-					imgPreloader.onerror = function() {
-						_error();
-					};
-
-					imgPreloader.onload = function() {
-						busy = true;
-
-						imgPreloader.onerror = imgPreloader.onload = null;
-
-						_process_image();
-					};
-
-					imgPreloader.src = href;
-				break;
-
-				case 'swf':
-					selectedOpts.scrolling = 'no';
-
-					str = '<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="' + selectedOpts.width + '" height="' + selectedOpts.height + '"><param name="movie" value="' + href + '"></param>';
-					emb = '';
-
-					$.each(selectedOpts.swf, function(name, val) {
-						str += '<param name="' + name + '" value="' + val + '"></param>';
-						emb += ' ' + name + '="' + val + '"';
-					});
-
-					str += '<embed src="' + href + '" type="application/x-shockwave-flash" width="' + selectedOpts.width + '" height="' + selectedOpts.height + '"' + emb + '></embed></object>';
-
-					tmp.html(str);
-
-					_process_inline();
-				break;
-
-				case 'ajax':
-					busy = false;
-
-					$.fancybox.showActivity();
-
-					selectedOpts.ajax.win = selectedOpts.ajax.success;
-
-					ajaxLoader = $.ajax($.extend({}, selectedOpts.ajax, {
-						url	: href,
-						data : selectedOpts.ajax.data || {},
-						error : function(XMLHttpRequest, textStatus, errorThrown) {
-							if ( XMLHttpRequest.status > 0 ) {
-								_error();
-							}
-						},
-						success : function(data, textStatus, XMLHttpRequest) {
-							var o = typeof XMLHttpRequest == 'object' ? XMLHttpRequest : ajaxLoader;
-							if (o.status == 200) {
-								if ( typeof selectedOpts.ajax.win == 'function' ) {
-									ret = selectedOpts.ajax.win(href, data, textStatus, XMLHttpRequest);
-
-									if (ret === false) {
-										loading.hide();
-										return;
-									} else if (typeof ret == 'string' || typeof ret == 'object') {
-										data = ret;
-									}
-								}
-
-								tmp.html( data );
-								_process_inline();
-							}
-						}
-					}));
-
-				break;
-
-				case 'iframe':
-					_show();
-				break;
-			}
-		},
-
-		_process_inline = function() {
-			var
-				w = selectedOpts.width,
-				h = selectedOpts.height;
-
-			if (w.toString().indexOf('%') > -1) {
-				w = parseInt( ($(window).width() - (selectedOpts.margin * 2)) * parseFloat(w) / 100, 10) + 'px';
-
-			} else {
-				w = w == 'auto' ? 'auto' : w + 'px';	
-			}
-
-			if (h.toString().indexOf('%') > -1) {
-				h = parseInt( ($(window).height() - (selectedOpts.margin * 2)) * parseFloat(h) / 100, 10) + 'px';
-
-			} else {
-				h = h == 'auto' ? 'auto' : h + 'px';	
-			}
-
-			tmp.wrapInner('<div style="width:' + w + ';height:' + h + ';overflow: ' + (selectedOpts.scrolling == 'auto' ? 'auto' : (selectedOpts.scrolling == 'yes' ? 'scroll' : 'hidden')) + ';position:relative;"></div>');
-
-			selectedOpts.width = tmp.width();
-			selectedOpts.height = tmp.height();
-
-			_show();
-		},
-
-		_process_image = function() {
-			selectedOpts.width = imgPreloader.width;
-			selectedOpts.height = imgPreloader.height;
-
-			$("<img />").attr({
-				'id' : 'fancybox-img',
-				'src' : imgPreloader.src,
-				'alt' : selectedOpts.title
-			}).appendTo( tmp );
-
-			_show();
-		},
-
-		_show = function() {
-			var pos, equal;
-
-			loading.hide();
-
-			if (wrap.is(":visible") && false === currentOpts.onCleanup(currentArray, currentIndex, currentOpts)) {
-				$.event.trigger('fancybox-cancel');
-
-				busy = false;
-				return;
-			}
-
-			busy = true;
-
-			$(content.add( overlay )).unbind();
-
-			$(window).unbind("resize.fb scroll.fb");
-			$(document).unbind('keydown.fb');
-
-			if (wrap.is(":visible") && currentOpts.titlePosition !== 'outside') {
-				wrap.css('height', wrap.height());
-			}
-
-			currentArray = selectedArray;
-			currentIndex = selectedIndex;
-			currentOpts = selectedOpts;
-
-			if (currentOpts.overlayShow) {
-				overlay.css({
-					'background-color' : currentOpts.overlayColor,
-					'opacity' : currentOpts.overlayOpacity,
-					'cursor' : currentOpts.hideOnOverlayClick ? 'pointer' : 'auto',
-					'height' : $(document).height()
-				});
-
-				if (!overlay.is(':visible')) {
-					if (isIE6) {
-						$('select:not(#fancybox-tmp select)').filter(function() {
-							return this.style.visibility !== 'hidden';
-						}).css({'visibility' : 'hidden'}).one('fancybox-cleanup', function() {
-							this.style.visibility = 'inherit';
-						});
-					}
-
-					overlay.show();
-				}
-			} else {
-				overlay.hide();
-			}
-
-			final_pos = _get_zoom_to();
-
-			_process_title();
-
-			if (wrap.is(":visible")) {
-				$( close.add( nav_left ).add( nav_right ) ).hide();
-
-				pos = wrap.position(),
-
-				start_pos = {
-					top	 : pos.top,
-					left : pos.left,
-					width : wrap.width(),
-					height : wrap.height()
-				};
-
-				equal = (start_pos.width == final_pos.width && start_pos.height == final_pos.height);
-
-				content.fadeTo(currentOpts.changeFade, 0.3, function() {
-					var finish_resizing = function() {
-						content.html( tmp.contents() ).fadeTo(currentOpts.changeFade, 1, _finish);
-					};
-
-					$.event.trigger('fancybox-change');
-
-					content
-						.empty()
-						.removeAttr('filter')
-						.css({
-							'border-width' : currentOpts.padding,
-							'width'	: final_pos.width - currentOpts.padding * 2,
-							'height' : selectedOpts.autoDimensions ? 'auto' : final_pos.height - titleHeight - currentOpts.padding * 2
-						});
-
-					if (equal) {
-						finish_resizing();
-
-					} else {
-						fx.prop = 0;
-
-						$(fx).animate({prop: 1}, {
-							 duration : currentOpts.changeSpeed,
-							 easing : currentOpts.easingChange,
-							 step : _draw,
-							 complete : finish_resizing
-						});
-					}
-				});
-
-				return;
-			}
-
-			wrap.removeAttr("style");
-
-			content.css('border-width', currentOpts.padding);
-
-			if (currentOpts.transitionIn == 'elastic') {
-				start_pos = _get_zoom_from();
-
-				content.html( tmp.contents() );
-
-				wrap.show();
-
-				if (currentOpts.opacity) {
-					final_pos.opacity = 0;
-				}
-
-				fx.prop = 0;
-
-				$(fx).animate({prop: 1}, {
-					 duration : currentOpts.speedIn,
-					 easing : currentOpts.easingIn,
-					 step : _draw,
-					 complete : _finish
-				});
-
-				return;
-			}
-
-			if (currentOpts.titlePosition == 'inside' && titleHeight > 0) {	
-				title.show();	
-			}
-
-			content
-				.css({
-					'width' : final_pos.width - currentOpts.padding * 2,
-					'height' : selectedOpts.autoDimensions ? 'auto' : final_pos.height - titleHeight - currentOpts.padding * 2
-				})
-				.html( tmp.contents() );
-
-			wrap
-				.css(final_pos)
-				.fadeIn( currentOpts.transitionIn == 'none' ? 0 : currentOpts.speedIn, _finish );
-		},
-
-		_format_title = function(title) {
-			if (title && title.length) {
-				if (currentOpts.titlePosition == 'float') {
-					return '<table id="fancybox-title-float-wrap" cellpadding="0" cellspacing="0"><tr><td id="fancybox-title-float-left"></td><td id="fancybox-title-float-main">' + title + '</td><td id="fancybox-title-float-right"></td></tr></table>';
-				}
-
-				return '<div id="fancybox-title-' + currentOpts.titlePosition + '">' + title + '</div>';
-			}
-
-			return false;
-		},
-
-		_process_title = function() {
-			titleStr = currentOpts.title || '';
-			titleHeight = 0;
-
-			title
-				.empty()
-				.removeAttr('style')
-				.removeClass();
-
-			if (currentOpts.titleShow === false) {
-				title.hide();
-				return;
-			}
-
-			titleStr = $.isFunction(currentOpts.titleFormat) ? currentOpts.titleFormat(titleStr, currentArray, currentIndex, currentOpts) : _format_title(titleStr);
-
-			if (!titleStr || titleStr === '') {
-				title.hide();
-				return;
-			}
-
-			title
-				.addClass('fancybox-title-' + currentOpts.titlePosition)
-				.html( titleStr )
-				.appendTo( 'body' )
-				.show();
-
-			switch (currentOpts.titlePosition) {
-				case 'inside':
-					title
-						.css({
-							'width' : final_pos.width - (currentOpts.padding * 2),
-							'marginLeft' : currentOpts.padding,
-							'marginRight' : currentOpts.padding
-						});
-
-					titleHeight = title.outerHeight(true);
-
-					title.appendTo( outer );
-
-					final_pos.height += titleHeight;
-				break;
-
-				case 'over':
-					title
-						.css({
-							'marginLeft' : currentOpts.padding,
-							'width'	: final_pos.width - (currentOpts.padding * 2),
-							'bottom' : currentOpts.padding
-						})
-						.appendTo( outer );
-				break;
-
-				case 'float':
-					title
-						.css('left', parseInt((title.width() - final_pos.width - 40)/ 2, 10) * -1)
-						.appendTo( wrap );
-				break;
-
-				default:
-					title
-						.css({
-							'width' : final_pos.width - (currentOpts.padding * 2),
-							'paddingLeft' : currentOpts.padding,
-							'paddingRight' : currentOpts.padding
-						})
-						.appendTo( wrap );
-				break;
-			}
-
-			title.hide();
-		},
-
-		_set_navigation = function() {
-			if (currentOpts.enableEscapeButton || currentOpts.enableKeyboardNav) {
-				$(document).bind('keydown.fb', function(e) {
-					if (e.keyCode == 27 && currentOpts.enableEscapeButton) {
-						e.preventDefault();
-						$.fancybox.close();
-
-					} else if ((e.keyCode == 37 || e.keyCode == 39) && currentOpts.enableKeyboardNav && e.target.tagName !== 'INPUT' && e.target.tagName !== 'TEXTAREA' && e.target.tagName !== 'SELECT') {
-						e.preventDefault();
-						$.fancybox[ e.keyCode == 37 ? 'prev' : 'next']();
-					}
-				});
-			}
-
-			if (!currentOpts.showNavArrows) { 
-				nav_left.hide();
-				nav_right.hide();
-				return;
-			}
-
-			if ((currentOpts.cyclic && currentArray.length > 1) || currentIndex !== 0) {
-				nav_left.show();
-			}
-
-			if ((currentOpts.cyclic && currentArray.length > 1) || currentIndex != (currentArray.length -1)) {
-				nav_right.show();
-			}
-		},
-
-		_finish = function () {
-			if (!$.support.opacity) {
-				content.get(0).style.removeAttribute('filter');
-				wrap.get(0).style.removeAttribute('filter');
-			}
-
-			if (selectedOpts.autoDimensions) {
-				content.css('height', 'auto');
-			}
-
-			wrap.css('height', 'auto');
-
-			if (titleStr && titleStr.length) {
-				title.show();
-			}
-
-			if (currentOpts.showCloseButton) {
-				close.show();
-			}
-
-			_set_navigation();
-	
-			if (currentOpts.hideOnContentClick)	{
-				content.bind('click', $.fancybox.close);
-			}
-
-			if (currentOpts.hideOnOverlayClick)	{
-				overlay.bind('click', $.fancybox.close);
-			}
-
-			$(window).bind("resize.fb", $.fancybox.resize);
-
-			if (currentOpts.centerOnScroll) {
-				$(window).bind("scroll.fb", $.fancybox.center);
-			}
-
-			if (currentOpts.type == 'iframe') {
-				$('<iframe id="fancybox-frame" name="fancybox-frame' + new Date().getTime() + '" frameborder="0" hspace="0" ' + ($.browser.msie ? 'allowtransparency="true""' : '') + ' scrolling="' + selectedOpts.scrolling + '" src="' + currentOpts.href + '"></iframe>').appendTo(content);
-			}
-
-			wrap.show();
-
-			busy = false;
-
-			$.fancybox.center();
-
-			currentOpts.onComplete(currentArray, currentIndex, currentOpts);
-
-			_preload_images();
-		},
-
-		_preload_images = function() {
-			var href, 
-				objNext;
-
-			if ((currentArray.length -1) > currentIndex) {
-				href = currentArray[ currentIndex + 1 ].href;
-
-				if (typeof href !== 'undefined' && href.match(imgRegExp)) {
-					objNext = new Image();
-					objNext.src = href;
-				}
-			}
-
-			if (currentIndex > 0) {
-				href = currentArray[ currentIndex - 1 ].href;
-
-				if (typeof href !== 'undefined' && href.match(imgRegExp)) {
-					objNext = new Image();
-					objNext.src = href;
-				}
-			}
-		},
-
-		_draw = function(pos) {
-			var dim = {
-				width : parseInt(start_pos.width + (final_pos.width - start_pos.width) * pos, 10),
-				height : parseInt(start_pos.height + (final_pos.height - start_pos.height) * pos, 10),
-
-				top : parseInt(start_pos.top + (final_pos.top - start_pos.top) * pos, 10),
-				left : parseInt(start_pos.left + (final_pos.left - start_pos.left) * pos, 10)
-			};
-
-			if (typeof final_pos.opacity !== 'undefined') {
-				dim.opacity = pos < 0.5 ? 0.5 : pos;
-			}
-
-			wrap.css(dim);
-
-			content.css({
-				'width' : dim.width - currentOpts.padding * 2,
-				'height' : dim.height - (titleHeight * pos) - currentOpts.padding * 2
-			});
-		},
-
-		_get_viewport = function() {
-			return [
-				$(window).width() - (currentOpts.margin * 2),
-				$(window).height() - (currentOpts.margin * 2),
-				$(document).scrollLeft() + currentOpts.margin,
-				$(document).scrollTop() + currentOpts.margin
-			];
-		},
-
-		_get_zoom_to = function () {
-			var view = _get_viewport(),
-				to = {},
-				resize = currentOpts.autoScale,
-				double_padding = currentOpts.padding * 2,
-				ratio;
-
-			if (currentOpts.width.toString().indexOf('%') > -1) {
-				to.width = parseInt((view[0] * parseFloat(currentOpts.width)) / 100, 10);
-			} else {
-				to.width = currentOpts.width + double_padding;
-			}
-
-			if (currentOpts.height.toString().indexOf('%') > -1) {
-				to.height = parseInt((view[1] * parseFloat(currentOpts.height)) / 100, 10);
-			} else {
-				to.height = currentOpts.height + double_padding;
-			}
-
-			if (resize && (to.width > view[0] || to.height > view[1])) {
-				if (selectedOpts.type == 'image' || selectedOpts.type == 'swf') {
-					ratio = (currentOpts.width ) / (currentOpts.height );
-
-					if ((to.width ) > view[0]) {
-						to.width = view[0];
-						to.height = parseInt(((to.width - double_padding) / ratio) + double_padding, 10);
-					}
-
-					if ((to.height) > view[1]) {
-						to.height = view[1];
-						to.width = parseInt(((to.height - double_padding) * ratio) + double_padding, 10);
-					}
-
-				} else {
-					to.width = Math.min(to.width, view[0]);
-					to.height = Math.min(to.height, view[1]);
-				}
-			}
-
-			to.top = parseInt(Math.max(view[3] - 20, view[3] + ((view[1] - to.height - 40) * 0.5)), 10);
-			to.left = parseInt(Math.max(view[2] - 20, view[2] + ((view[0] - to.width - 40) * 0.5)), 10);
-
-			return to;
-		},
-
-		_get_obj_pos = function(obj) {
-			var pos = obj.offset();
-
-			pos.top += parseInt( obj.css('paddingTop'), 10 ) || 0;
-			pos.left += parseInt( obj.css('paddingLeft'), 10 ) || 0;
-
-			pos.top += parseInt( obj.css('border-top-width'), 10 ) || 0;
-			pos.left += parseInt( obj.css('border-left-width'), 10 ) || 0;
-
-			pos.width = obj.width();
-			pos.height = obj.height();
-
-			return pos;
-		},
-
-		_get_zoom_from = function() {
-			var orig = selectedOpts.orig ? $(selectedOpts.orig) : false,
-				from = {},
-				pos,
-				view;
-
-			if (orig && orig.length) {
-				pos = _get_obj_pos(orig);
-
-				from = {
-					width : pos.width + (currentOpts.padding * 2),
-					height : pos.height + (currentOpts.padding * 2),
-					top	: pos.top - currentOpts.padding - 20,
-					left : pos.left - currentOpts.padding - 20
-				};
-
-			} else {
-				view = _get_viewport();
-
-				from = {
-					width : currentOpts.padding * 2,
-					height : currentOpts.padding * 2,
-					top	: parseInt(view[3] + view[1] * 0.5, 10),
-					left : parseInt(view[2] + view[0] * 0.5, 10)
-				};
-			}
-
-			return from;
-		},
-
-		_animate_loading = function() {
-			if (!loading.is(':visible')){
-				clearInterval(loadingTimer);
-				return;
-			}
-
-			$('div', loading).css('top', (loadingFrame * -40) + 'px');
-
-			loadingFrame = (loadingFrame + 1) % 12;
-		};
-
-	/*
-	 * Public methods 
-	 */
-
-	$.fn.fancybox = function(options) {
-		if (!$(this).length) {
-			return this;
-		}
-
-		$(this)
-			.data('fancybox', $.extend({}, options, ($.metadata ? $(this).metadata() : {})))
-			.unbind('click.fb')
-			.bind('click.fb', function(e) {
-				e.preventDefault();
-
-				if (busy) {
-					return;
-				}
-
-				busy = true;
-
-				$(this).blur();
-
-				selectedArray = [];
-				selectedIndex = 0;
-
-				var rel = $(this).attr('rel') || '';
-
-				if (!rel || rel == '' || rel === 'nofollow') {
-					selectedArray.push(this);
-
-				} else {
-					selectedArray = $("a[rel=" + rel + "], area[rel=" + rel + "]");
-					selectedIndex = selectedArray.index( this );
-				}
-
-				_start();
-
-				return;
-			});
-
-		return this;
-	};
-
-	$.fancybox = function(obj) {
-		var opts;
-
-		if (busy) {
-			return;
-		}
-
-		busy = true;
-		opts = typeof arguments[1] !== 'undefined' ? arguments[1] : {};
-
-		selectedArray = [];
-		selectedIndex = parseInt(opts.index, 10) || 0;
-
-		if ($.isArray(obj)) {
-			for (var i = 0, j = obj.length; i < j; i++) {
-				if (typeof obj[i] == 'object') {
-					$(obj[i]).data('fancybox', $.extend({}, opts, obj[i]));
-				} else {
-					obj[i] = $({}).data('fancybox', $.extend({content : obj[i]}, opts));
-				}
-			}
-
-			selectedArray = jQuery.merge(selectedArray, obj);
-
-		} else {
-			if (typeof obj == 'object') {
-				$(obj).data('fancybox', $.extend({}, opts, obj));
-			} else {
-				obj = $({}).data('fancybox', $.extend({content : obj}, opts));
-			}
-
-			selectedArray.push(obj);
-		}
-
-		if (selectedIndex > selectedArray.length || selectedIndex < 0) {
-			selectedIndex = 0;
-		}
-
-		_start();
-	};
-
-	$.fancybox.showActivity = function() {
-		clearInterval(loadingTimer);
-
-		loading.show();
-		loadingTimer = setInterval(_animate_loading, 66);
-	};
-
-	$.fancybox.hideActivity = function() {
-		loading.hide();
-	};
-
-	$.fancybox.next = function() {
-		return $.fancybox.pos( currentIndex + 1);
-	};
-
-	$.fancybox.prev = function() {
-		return $.fancybox.pos( currentIndex - 1);
-	};
-
-	$.fancybox.pos = function(pos) {
-		if (busy) {
-			return;
-		}
-
-		pos = parseInt(pos);
-
-		selectedArray = currentArray;
-
-		if (pos > -1 && pos < currentArray.length) {
-			selectedIndex = pos;
-			_start();
-
-		} else if (currentOpts.cyclic && currentArray.length > 1) {
-			selectedIndex = pos >= currentArray.length ? 0 : currentArray.length - 1;
-			_start();
-		}
-
-		return;
-	};
-
-	$.fancybox.cancel = function() {
-		if (busy) {
-			return;
-		}
-
-		busy = true;
-
-		$.event.trigger('fancybox-cancel');
-
-		_abort();
-
-		selectedOpts.onCancel(selectedArray, selectedIndex, selectedOpts);
-
-		busy = false;
-	};
-
-	// Note: within an iframe use - parent.$.fancybox.close();
-	$.fancybox.close = function() {
-		if (busy || wrap.is(':hidden')) {
-			return;
-		}
-
-		busy = true;
-
-		if (currentOpts && false === currentOpts.onCleanup(currentArray, currentIndex, currentOpts)) {
-			busy = false;
-			return;
-		}
-
-		_abort();
-
-		$(close.add( nav_left ).add( nav_right )).hide();
-
-		$(content.add( overlay )).unbind();
-
-		$(window).unbind("resize.fb scroll.fb");
-		$(document).unbind('keydown.fb');
-
-		content.find('iframe').attr('src', isIE6 && /^https/i.test(window.location.href || '') ? 'javascript:void(false)' : 'about:blank');
-
-		if (currentOpts.titlePosition !== 'inside') {
-			title.empty();
-		}
-
-		wrap.stop();
-
-		function _cleanup() {
-			overlay.fadeOut('fast');
-
-			title.empty().hide();
-			wrap.hide();
-
-			$.event.trigger('fancybox-cleanup');
-
-			content.empty();
-
-			currentOpts.onClosed(currentArray, currentIndex, currentOpts);
-
-			currentArray = selectedOpts	= [];
-			currentIndex = selectedIndex = 0;
-			currentOpts = selectedOpts	= {};
-
-			busy = false;
-		}
-
-		if (currentOpts.transitionOut == 'elastic') {
-			start_pos = _get_zoom_from();
-
-			var pos = wrap.position();
-
-			final_pos = {
-				top	 : pos.top ,
-				left : pos.left,
-				width :	wrap.width(),
-				height : wrap.height()
-			};
-
-			if (currentOpts.opacity) {
-				final_pos.opacity = 1;
-			}
-
-			title.empty().hide();
-
-			fx.prop = 1;
-
-			$(fx).animate({ prop: 0 }, {
-				 duration : currentOpts.speedOut,
-				 easing : currentOpts.easingOut,
-				 step : _draw,
-				 complete : _cleanup
-			});
-
-		} else {
-			wrap.fadeOut( currentOpts.transitionOut == 'none' ? 0 : currentOpts.speedOut, _cleanup);
-		}
-	};
-
-	$.fancybox.resize = function() {
-		if (overlay.is(':visible')) {
-			overlay.css('height', $(document).height());
-		}
-
-		$.fancybox.center(true);
-	};
-
-	$.fancybox.center = function() {
-		var view, align;
-
-		if (busy) {
-			return;	
-		}
-
-		align = arguments[0] === true ? 1 : 0;
-		view = _get_viewport();
-
-		if (!align && (wrap.width() > view[0] || wrap.height() > view[1])) {
-			return;	
-		}
-
-		wrap
-			.stop()
-			.animate({
-				'top' : parseInt(Math.max(view[3] - 20, view[3] + ((view[1] - content.height() - 40) * 0.5) - currentOpts.padding)),
-				'left' : parseInt(Math.max(view[2] - 20, view[2] + ((view[0] - content.width() - 40) * 0.5) - currentOpts.padding))
-			}, typeof arguments[0] == 'number' ? arguments[0] : 200);
-	};
-
-	$.fancybox.init = function() {
-		if ($("#fancybox-wrap").length) {
-			return;
-		}
-
-		$('body').append(
-			tmp	= $('<div id="fancybox-tmp"></div>'),
-			loading	= $('<div id="fancybox-loading"><div></div></div>'),
-			overlay	= $('<div id="fancybox-overlay"></div>'),
-			wrap = $('<div id="fancybox-wrap"></div>')
-		);
-
-		outer = $('<div id="fancybox-outer"></div>')
-			.append('<div class="fancybox-bg" id="fancybox-bg-n"></div><div class="fancybox-bg" id="fancybox-bg-ne"></div><div class="fancybox-bg" id="fancybox-bg-e"></div><div class="fancybox-bg" id="fancybox-bg-se"></div><div class="fancybox-bg" id="fancybox-bg-s"></div><div class="fancybox-bg" id="fancybox-bg-sw"></div><div class="fancybox-bg" id="fancybox-bg-w"></div><div class="fancybox-bg" id="fancybox-bg-nw"></div>')
-			.appendTo( wrap );
-
-		outer.append(
-			content = $('<div id="fancybox-content"></div>'),
-			close = $('<a id="fancybox-close"></a>'),
-			title = $('<div id="fancybox-title"></div>'),
-
-			nav_left = $('<a href="javascript:;" id="fancybox-left"><span class="fancy-ico" id="fancybox-left-ico"></span></a>'),
-			nav_right = $('<a href="javascript:;" id="fancybox-right"><span class="fancy-ico" id="fancybox-right-ico"></span></a>')
-		);
-
-		close.click($.fancybox.close);
-		loading.click($.fancybox.cancel);
-
-		nav_left.click(function(e) {
-			e.preventDefault();
-			$.fancybox.prev();
-		});
-
-		nav_right.click(function(e) {
-			e.preventDefault();
-			$.fancybox.next();
-		});
-
-		if ($.fn.mousewheel) {
-			wrap.bind('mousewheel.fb', function(e, delta) {
-				if (busy) {
-					e.preventDefault();
-
-				} else if ($(e.target).get(0).clientHeight == 0 || $(e.target).get(0).scrollHeight === $(e.target).get(0).clientHeight) {
-					e.preventDefault();
-					$.fancybox[ delta > 0 ? 'prev' : 'next']();
-				}
-			});
-		}
-
-		if (!$.support.opacity) {
-			wrap.addClass('fancybox-ie');
-		}
-
-		if (isIE6) {
-			loading.addClass('fancybox-ie6');
-			wrap.addClass('fancybox-ie6');
-
-			$('<iframe id="fancybox-hide-sel-frame" src="' + (/^https/i.test(window.location.href || '') ? 'javascript:void(false)' : 'about:blank' ) + '" scrolling="no" border="0" frameborder="0" tabindex="-1"></iframe>').prependTo(outer);
-		}
-	};
-
-	$.fn.fancybox.defaults = {
-		padding : 10,
-		margin : 40,
-		opacity : false,
-		modal : false,
-		cyclic : false,
-		scrolling : 'auto',	// 'auto', 'yes' or 'no'
-
-		width : 560,
-		height : 340,
-
-		autoScale : true,
-		autoDimensions : true,
-		centerOnScroll : false,
-
-		ajax : {},
-		swf : { wmode: 'transparent' },
-
-		hideOnOverlayClick : true,
-		hideOnContentClick : false,
-
-		overlayShow : true,
-		overlayOpacity : 0.7,
-		overlayColor : '#777',
-
-		titleShow : true,
-		titlePosition : 'float', // 'float', 'outside', 'inside' or 'over'
-		titleFormat : null,
-		titleFromAlt : false,
-
-		transitionIn : 'fade', // 'elastic', 'fade' or 'none'
-		transitionOut : 'fade', // 'elastic', 'fade' or 'none'
-
-		speedIn : 300,
-		speedOut : 300,
-
-		changeSpeed : 300,
-		changeFade : 'fast',
-
-		easingIn : 'swing',
-		easingOut : 'swing',
-
-		showCloseButton	 : true,
-		showNavArrows : true,
-		enableEscapeButton : true,
-		enableKeyboardNav : true,
-
-		onStart : function(){},
-		onCancel : function(){},
-		onComplete : function(){},
-		onCleanup : function(){},
-		onClosed : function(){},
-		onError : function(){}
-	};
-
-	$(document).ready(function() {
-		$.fancybox.init();
-	});
-
-})(jQuery);
\ No newline at end of file

--- oc-includes/osclass/gui/js/fancybox/jquery.fancybox-1.3.4.pack.js ---
@@ -1,46 +0,0 @@
-/*
- * FancyBox - jQuery Plugin
- * Simple and fancy lightbox alternative
- *
- * Examples and documentation at: http://fancybox.net
- * 
- * Copyright (c) 2008 - 2010 Janis Skarnelis
- * That said, it is hardly a one-person project. Many people have submitted bugs, code, and offered their advice freely. Their support is greatly appreciated.
- * 
- * Version: 1.3.4 (11/11/2010)
- * Requires: jQuery v1.3+
- *
- * Dual licensed under the MIT and GPL licenses:
- *   http://www.opensource.org/licenses/mit-license.php
- *   http://www.gnu.org/licenses/gpl.html
- */
-
-;(function(b){var m,t,u,f,D,j,E,n,z,A,q=0,e={},o=[],p=0,d={},l=[],G=null,v=new Image,J=/\.(jpg|gif|png|bmp|jpeg)(.*)?$/i,W=/[^\.]\.(swf)\s*$/i,K,L=1,y=0,s="",r,i,h=false,B=b.extend(b("<div/>")[0],{prop:0}),M=b.browser.msie&&b.browser.version<7&&!window.XMLHttpRequest,N=function(){t.hide();v.onerror=v.onload=null;G&&G.abort();m.empty()},O=function(){if(false===e.onError(o,q,e)){t.hide();h=false}else{e.titleShow=false;e.width="auto";e.height="auto";m.html('<p id="fancybox-error">The requested content cannot be loaded.<br />Please try again later.</p>');
-F()}},I=function(){var a=o[q],c,g,k,C,P,w;N();e=b.extend({},b.fn.fancybox.defaults,typeof b(a).data("fancybox")=="undefined"?e:b(a).data("fancybox"));w=e.onStart(o,q,e);if(w===false)h=false;else{if(typeof w=="object")e=b.extend(e,w);k=e.title||(a.nodeName?b(a).attr("title"):a.title)||"";if(a.nodeName&&!e.orig)e.orig=b(a).children("img:first").length?b(a).children("img:first"):b(a);if(k===""&&e.orig&&e.titleFromAlt)k=e.orig.attr("alt");c=e.href||(a.nodeName?b(a).attr("href"):a.href)||null;if(/^(?:javascript)/i.test(c)||
-c=="#")c=null;if(e.type){g=e.type;if(!c)c=e.content}else if(e.content)g="html";else if(c)g=c.match(J)?"image":c.match(W)?"swf":b(a).hasClass("iframe")?"iframe":c.indexOf("#")===0?"inline":"ajax";if(g){if(g=="inline"){a=c.substr(c.indexOf("#"));g=b(a).length>0?"inline":"ajax"}e.type=g;e.href=c;e.title=k;if(e.autoDimensions)if(e.type=="html"||e.type=="inline"||e.type=="ajax"){e.width="auto";e.height="auto"}else e.autoDimensions=false;if(e.modal){e.overlayShow=true;e.hideOnOverlayClick=false;e.hideOnContentClick=
-false;e.enableEscapeButton=false;e.showCloseButton=false}e.padding=parseInt(e.padding,10);e.margin=parseInt(e.margin,10);m.css("padding",e.padding+e.margin);b(".fancybox-inline-tmp").unbind("fancybox-cancel").bind("fancybox-change",function(){b(this).replaceWith(j.children())});switch(g){case "html":m.html(e.content);F();break;case "inline":if(b(a).parent().is("#fancybox-content")===true){h=false;break}b('<div class="fancybox-inline-tmp" />').hide().insertBefore(b(a)).bind("fancybox-cleanup",function(){b(this).replaceWith(j.children())}).bind("fancybox-cancel",
-function(){b(this).replaceWith(m.children())});b(a).appendTo(m);F();break;case "image":h=false;b.fancybox.showActivity();v=new Image;v.onerror=function(){O()};v.onload=function(){h=true;v.onerror=v.onload=null;e.width=v.width;e.height=v.height;b("<img />").attr({id:"fancybox-img",src:v.src,alt:e.title}).appendTo(m);Q()};v.src=c;break;case "swf":e.scrolling="no";C='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="'+e.width+'" height="'+e.height+'"><param name="movie" value="'+c+
-'"></param>';P="";b.each(e.swf,function(x,H){C+='<param name="'+x+'" value="'+H+'"></param>';P+=" "+x+'="'+H+'"'});C+='<embed src="'+c+'" type="application/x-shockwave-flash" width="'+e.width+'" height="'+e.height+'"'+P+"></embed></object>";m.html(C);F();break;case "ajax":h=false;b.fancybox.showActivity();e.ajax.win=e.ajax.success;G=b.ajax(b.extend({},e.ajax,{url:c,data:e.ajax.data||{},error:function(x){x.status>0&&O()},success:function(x,H,R){if((typeof R=="object"?R:G).status==200){if(typeof e.ajax.win==
-"function"){w=e.ajax.win(c,x,H,R);if(w===false){t.hide();return}else if(typeof w=="string"||typeof w=="object")x=w}m.html(x);F()}}}));break;case "iframe":Q()}}else O()}},F=function(){var a=e.width,c=e.height;a=a.toString().indexOf("%")>-1?parseInt((b(window).width()-e.margin*2)*parseFloat(a)/100,10)+"px":a=="auto"?"auto":a+"px";c=c.toString().indexOf("%")>-1?parseInt((b(window).height()-e.margin*2)*parseFloat(c)/100,10)+"px":c=="auto"?"auto":c+"px";m.wrapInner('<div style="width:'+a+";height:"+c+
-";overflow: "+(e.scrolling=="auto"?"auto":e.scrolling=="yes"?"scroll":"hidden")+';position:relative;"></div>');e.width=m.width();e.height=m.height();Q()},Q=function(){var a,c;t.hide();if(f.is(":visible")&&false===d.onCleanup(l,p,d)){b.event.trigger("fancybox-cancel");h=false}else{h=true;b(j.add(u)).unbind();b(window).unbind("resize.fb scroll.fb");b(document).unbind("keydown.fb");f.is(":visible")&&d.titlePosition!=="outside"&&f.css("height",f.height());l=o;p=q;d=e;if(d.overlayShow){u.css({"background-color":d.overlayColor,
-opacity:d.overlayOpacity,cursor:d.hideOnOverlayClick?"pointer":"auto",height:b(document).height()});if(!u.is(":visible")){M&&b("select:not(#fancybox-tmp select)").filter(function(){return this.style.visibility!=="hidden"}).css({visibility:"hidden"}).one("fancybox-cleanup",function(){this.style.visibility="inherit"});u.show()}}else u.hide();i=X();s=d.title||"";y=0;n.empty().removeAttr("style").removeClass();if(d.titleShow!==false){if(b.isFunction(d.titleFormat))a=d.titleFormat(s,l,p,d);else a=s&&s.length?
-d.titlePosition=="float"?'<table id="fancybox-title-float-wrap" cellpadding="0" cellspacing="0"><tr><td id="fancybox-title-float-left"></td><td id="fancybox-title-float-main">'+s+'</td><td id="fancybox-title-float-right"></td></tr></table>':'<div id="fancybox-title-'+d.titlePosition+'">'+s+"</div>":false;s=a;if(!(!s||s==="")){n.addClass("fancybox-title-"+d.titlePosition).html(s).appendTo("body").show();switch(d.titlePosition){case "inside":n.css({width:i.width-d.padding*2,marginLeft:d.padding,marginRight:d.padding});
-y=n.outerHeight(true);n.appendTo(D);i.height+=y;break;case "over":n.css({marginLeft:d.padding,width:i.width-d.padding*2,bottom:d.padding}).appendTo(D);break;case "float":n.css("left",parseInt((n.width()-i.width-40)/2,10)*-1).appendTo(f);break;default:n.css({width:i.width-d.padding*2,paddingLeft:d.padding,paddingRight:d.padding}).appendTo(f)}}}n.hide();if(f.is(":visible")){b(E.add(z).add(A)).hide();a=f.position();r={top:a.top,left:a.left,width:f.width(),height:f.height()};c=r.width==i.width&&r.height==
-i.height;j.fadeTo(d.changeFade,0.3,function(){var g=function(){j.html(m.contents()).fadeTo(d.changeFade,1,S)};b.event.trigger("fancybox-change");j.empty().removeAttr("filter").css({"border-width":d.padding,width:i.width-d.padding*2,height:e.autoDimensions?"auto":i.height-y-d.padding*2});if(c)g();else{B.prop=0;b(B).animate({prop:1},{duration:d.changeSpeed,easing:d.easingChange,step:T,complete:g})}})}else{f.removeAttr("style");j.css("border-width",d.padding);if(d.transitionIn=="elastic"){r=V();j.html(m.contents());
-f.show();if(d.opacity)i.opacity=0;B.prop=0;b(B).animate({prop:1},{duration:d.speedIn,easing:d.easingIn,step:T,complete:S})}else{d.titlePosition=="inside"&&y>0&&n.show();j.css({width:i.width-d.padding*2,height:e.autoDimensions?"auto":i.height-y-d.padding*2}).html(m.contents());f.css(i).fadeIn(d.transitionIn=="none"?0:d.speedIn,S)}}}},Y=function(){if(d.enableEscapeButton||d.enableKeyboardNav)b(document).bind("keydown.fb",function(a){if(a.keyCode==27&&d.enableEscapeButton){a.preventDefault();b.fancybox.close()}else if((a.keyCode==
-37||a.keyCode==39)&&d.enableKeyboardNav&&a.target.tagName!=="INPUT"&&a.target.tagName!=="TEXTAREA"&&a.target.tagName!=="SELECT"){a.preventDefault();b.fancybox[a.keyCode==37?"prev":"next"]()}});if(d.showNavArrows){if(d.cyclic&&l.length>1||p!==0)z.show();if(d.cyclic&&l.length>1||p!=l.length-1)A.show()}else{z.hide();A.hide()}},S=function(){if(!b.support.opacity){j.get(0).style.removeAttribute("filter");f.get(0).style.removeAttribute("filter")}e.autoDimensions&&j.css("height","auto");f.css("height","auto");
-s&&s.length&&n.show();d.showCloseButton&&E.show();Y();d.hideOnContentClick&&j.bind("click",b.fancybox.close);d.hideOnOverlayClick&&u.bind("click",b.fancybox.close);b(window).bind("resize.fb",b.fancybox.resize);d.centerOnScroll&&b(window).bind("scroll.fb",b.fancybox.center);if(d.type=="iframe")b('<iframe id="fancybox-frame" name="fancybox-frame'+(new Date).getTime()+'" frameborder="0" hspace="0" '+(b.browser.msie?'allowtransparency="true""':"")+' scrolling="'+e.scrolling+'" src="'+d.href+'"></iframe>').appendTo(j);
-f.show();h=false;b.fancybox.center();d.onComplete(l,p,d);var a,c;if(l.length-1>p){a=l[p+1].href;if(typeof a!=="undefined"&&a.match(J)){c=new Image;c.src=a}}if(p>0){a=l[p-1].href;if(typeof a!=="undefined"&&a.match(J)){c=new Image;c.src=a}}},T=function(a){var c={width:parseInt(r.width+(i.width-r.width)*a,10),height:parseInt(r.height+(i.height-r.height)*a,10),top:parseInt(r.top+(i.top-r.top)*a,10),left:parseInt(r.left+(i.left-r.left)*a,10)};if(typeof i.opacity!=="undefined")c.opacity=a<0.5?0.5:a;f.css(c);
-j.css({width:c.width-d.padding*2,height:c.height-y*a-d.padding*2})},U=function(){return[b(window).width()-d.margin*2,b(window).height()-d.margin*2,b(document).scrollLeft()+d.margin,b(document).scrollTop()+d.margin]},X=function(){var a=U(),c={},g=d.autoScale,k=d.padding*2;c.width=d.width.toString().indexOf("%")>-1?parseInt(a[0]*parseFloat(d.width)/100,10):d.width+k;c.height=d.height.toString().indexOf("%")>-1?parseInt(a[1]*parseFloat(d.height)/100,10):d.height+k;if(g&&(c.width>a[0]||c.height>a[1]))if(e.type==
-"image"||e.type=="swf"){g=d.width/d.height;if(c.width>a[0]){c.width=a[0];c.height=parseInt((c.width-k)/g+k,10)}if(c.height>a[1]){c.height=a[1];c.width=parseInt((c.height-k)*g+k,10)}}else{c.width=Math.min(c.width,a[0]);c.height=Math.min(c.height,a[1])}c.top=parseInt(Math.max(a[3]-20,a[3]+(a[1]-c.height-40)*0.5),10);c.left=parseInt(Math.max(a[2]-20,a[2]+(a[0]-c.width-40)*0.5),10);return c},V=function(){var a=e.orig?b(e.orig):false,c={};if(a&&a.length){c=a.offset();c.top+=parseInt(a.css("paddingTop"),
-10)||0;c.left+=parseInt(a.css("paddingLeft"),10)||0;c.top+=parseInt(a.css("border-top-width"),10)||0;c.left+=parseInt(a.css("border-left-width"),10)||0;c.width=a.width();c.height=a.height();c={width:c.width+d.padding*2,height:c.height+d.padding*2,top:c.top-d.padding-20,left:c.left-d.padding-20}}else{a=U();c={width:d.padding*2,height:d.padding*2,top:parseInt(a[3]+a[1]*0.5,10),left:parseInt(a[2]+a[0]*0.5,10)}}return c},Z=function(){if(t.is(":visible")){b("div",t).css("top",L*-40+"px");L=(L+1)%12}else clearInterval(K)};
-b.fn.fancybox=function(a){if(!b(this).length)return this;b(this).data("fancybox",b.extend({},a,b.metadata?b(this).metadata():{})).unbind("click.fb").bind("click.fb",function(c){c.preventDefault();if(!h){h=true;b(this).blur();o=[];q=0;c=b(this).attr("rel")||"";if(!c||c==""||c==="nofollow")o.push(this);else{o=b("a[rel="+c+"], area[rel="+c+"]");q=o.index(this)}I()}});return this};b.fancybox=function(a,c){var g;if(!h){h=true;g=typeof c!=="undefined"?c:{};o=[];q=parseInt(g.index,10)||0;if(b.isArray(a)){for(var k=
-0,C=a.length;k<C;k++)if(typeof a[k]=="object")b(a[k]).data("fancybox",b.extend({},g,a[k]));else a[k]=b({}).data("fancybox",b.extend({content:a[k]},g));o=jQuery.merge(o,a)}else{if(typeof a=="object")b(a).data("fancybox",b.extend({},g,a));else a=b({}).data("fancybox",b.extend({content:a},g));o.push(a)}if(q>o.length||q<0)q=0;I()}};b.fancybox.showActivity=function(){clearInterval(K);t.show();K=setInterval(Z,66)};b.fancybox.hideActivity=function(){t.hide()};b.fancybox.next=function(){return b.fancybox.pos(p+
-1)};b.fancybox.prev=function(){return b.fancybox.pos(p-1)};b.fancybox.pos=function(a){if(!h){a=parseInt(a);o=l;if(a>-1&&a<l.length){q=a;I()}else if(d.cyclic&&l.length>1){q=a>=l.length?0:l.length-1;I()}}};b.fancybox.cancel=function(){if(!h){h=true;b.event.trigger("fancybox-cancel");N();e.onCancel(o,q,e);h=false}};b.fancybox.close=function(){function a(){u.fadeOut("fast");n.empty().hide();f.hide();b.event.trigger("fancybox-cleanup");j.empty();d.onClosed(l,p,d);l=e=[];p=q=0;d=e={};h=false}if(!(h||f.is(":hidden"))){h=
-true;if(d&&false===d.onCleanup(l,p,d))h=false;else{N();b(E.add(z).add(A)).hide();b(j.add(u)).unbind();b(window).unbind("resize.fb scroll.fb");b(document).unbind("keydown.fb");j.find("iframe").attr("src",M&&/^https/i.test(window.location.href||"")?"javascript:void(false)":"about:blank");d.titlePosition!=="inside"&&n.empty();f.stop();if(d.transitionOut=="elastic"){r=V();var c=f.position();i={top:c.top,left:c.left,width:f.width(),height:f.height()};if(d.opacity)i.opacity=1;n.empty().hide();B.prop=1;
-b(B).animate({prop:0},{duration:d.speedOut,easing:d.easingOut,step:T,complete:a})}else f.fadeOut(d.transitionOut=="none"?0:d.speedOut,a)}}};b.fancybox.resize=function(){u.is(":visible")&&u.css("height",b(document).height());b.fancybox.center(true)};b.fancybox.center=function(a){var c,g;if(!h){g=a===true?1:0;c=U();!g&&(f.width()>c[0]||f.height()>c[1])||f.stop().animate({top:parseInt(Math.max(c[3]-20,c[3]+(c[1]-j.height()-40)*0.5-d.padding)),left:parseInt(Math.max(c[2]-20,c[2]+(c[0]-j.width()-40)*0.5-
-d.padding))},typeof a=="number"?a:200)}};b.fancybox.init=function(){if(!b("#fancybox-wrap").length){b("body").append(m=b('<div id="fancybox-tmp"></div>'),t=b('<div id="fancybox-loading"><div></div></div>'),u=b('<div id="fancybox-overlay"></div>'),f=b('<div id="fancybox-wrap"></div>'));D=b('<div id="fancybox-outer"></div>').append('<div class="fancybox-bg" id="fancybox-bg-n"></div><div class="fancybox-bg" id="fancybox-bg-ne"></div><div class="fancybox-bg" id="fancybox-bg-e"></div><div class="fancybox-bg" id="fancybox-bg-se"></div><div class="fancybox-bg" id="fancybox-bg-s"></div><div class="fancybox-bg" id="fancybox-bg-sw"></div><div class="fancybox-bg" id="fancybox-bg-w"></div><div class="fancybox-bg" id="fancybox-bg-nw"></div>').appendTo(f);
-D.append(j=b('<div id="fancybox-content"></div>'),E=b('<a id="fancybox-close"></a>'),n=b('<div id="fancybox-title"></div>'),z=b('<a href="javascript:;" id="fancybox-left"><span class="fancy-ico" id="fancybox-left-ico"></span></a>'),A=b('<a href="javascript:;" id="fancybox-right"><span class="fancy-ico" id="fancybox-right-ico"></span></a>'));E.click(b.fancybox.close);t.click(b.fancybox.cancel);z.click(function(a){a.preventDefault();b.fancybox.prev()});A.click(function(a){a.preventDefault();b.fancybox.next()});
-b.fn.mousewheel&&f.bind("mousewheel.fb",function(a,c){if(h)a.preventDefault();else if(b(a.target).get(0).clientHeight==0||b(a.target).get(0).scrollHeight===b(a.target).get(0).clientHeight){a.preventDefault();b.fancybox[c>0?"prev":"next"]()}});b.support.opacity||f.addClass("fancybox-ie");if(M){t.addClass("fancybox-ie6");f.addClass("fancybox-ie6");b('<iframe id="fancybox-hide-sel-frame" src="'+(/^https/i.test(window.location.href||"")?"javascript:void(false)":"about:blank")+'" scrolling="no" border="0" frameborder="0" tabindex="-1"></iframe>').prependTo(D)}}};
-b.fn.fancybox.defaults={padding:10,margin:40,opacity:false,modal:false,cyclic:false,scrolling:"auto",width:560,height:340,autoScale:true,autoDimensions:true,centerOnScroll:false,ajax:{},swf:{wmode:"transparent"},hideOnOverlayClick:true,hideOnContentClick:false,overlayShow:true,overlayOpacity:0.7,overlayColor:"#777",titleShow:true,titlePosition:"float",titleFormat:null,titleFromAlt:false,transitionIn:"fade",transitionOut:"fade",speedIn:300,speedOut:300,changeSpeed:300,changeFade:"fast",easingIn:"swing",
-easingOut:"swing",showCloseButton:true,showNavArrows:true,enableEscapeButton:true,enableKeyboardNav:true,onStart:function(){},onCancel:function(){},onComplete:function(){},onCleanup:function(){},onClosed:function(){},onError:function(){}};b(document).ready(function(){b.fancybox.init()})})(jQuery);
\ No newline at end of file

--- oc-includes/osclass/gui/js/fancybox/jquery.fancybox.css ---
@@ -0,0 +1,224 @@
+/*! fancyBox v2.0.4 fancyapps.com | fancyapps.com/fancybox/#license */
+.fancybox-tmp iframe, .fancybox-tmp object {
+	vertical-align: top;
+	padding: 0;
+	margin: 0;
+}
+
+.fancybox-wrap {
+	position: absolute;
+	top: 0;
+	left: 0;
+	z-index: 1002;
+}
+
+.fancybox-outer {
+	padding: 0;
+	margin: 0;
+	background: #f9f9f9;
+	color: #444;
+	text-shadow: none;
+	-webkit-border-radius: 4px;
+	   -moz-border-radius: 4px;
+			border-radius: 4px;
+}
+
+.fancybox-opened {
+	z-index: 1003;	
+}
+
+.fancybox-opened .fancybox-outer {
+	-webkit-box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
+	   -moz-box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
+	        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
+}
+
+.fancybox-inner {
+	width: 100%;
+	height: 100%;
+	padding: 0;
+	margin: 0;
+	position: relative;
+	outline: none;
+	overflow: hidden;
+}
+
+.fancybox-error {
+	color: #444;
+    font: 14px/20px "Helvetica Neue",Helvetica,Arial,sans-serif;
+    margin: 0;
+    padding: 10px;
+}
+
+.fancybox-image, .fancybox-iframe {
+	display: block;
+	width: 100%;
+	height: 100%;
+	border: 0;
+	padding: 0;
+	margin: 0;
+	vertical-align: top;
+}
+
+.fancybox-image {
+	max-width: 100%;
+	max-height: 100%;
+}
+
+#fancybox-loading {
+	position: fixed;
+	top: 50%;
+	left: 50%;
+	margin-top: -21px;
+	margin-left: -21px;
+	width: 42px;
+	height: 42px;
+	background: url('fancybox_loading.gif');
+	opacity: 0.8;
+	cursor: pointer;
+	z-index: 1010;
+}
+
+.fancybox-close, .fancybox-prev span, .fancybox-next span {
+	background-image: url('fancybox_sprite.png');
+}
+
+.fancybox-close {
+	position: absolute;
+	top: -18px;
+	right: -18px;
+	width: 36px;
+	height: 36px;
+	cursor: pointer;
+	z-index: 1004;
+}
+
+.fancybox-prev, .fancybox-next {
+	position: absolute;
+	top: 0;
+	width: 40%;
+	height: 100%;
+	cursor: pointer;
+	background: transparent url('blank.gif'); /* helps IE */
+	z-index: 1003;
+}
+
+.fancybox-prev {
+	left: 0;	
+}
+
+.fancybox-next {
+	right: 0;
+}
+
+.fancybox-prev span, .fancybox-next span {
+	position: absolute;
+	top: 50%;
+	left: -9999px;
+	width: 36px;
+	height: 36px;
+	margin-top: -18px;
+	cursor: pointer;
+	z-index: 1003;
+}
+
+.fancybox-prev span {
+	background-position: 0 -36px;
+}
+
+.fancybox-next span {
+	background-position: 0 -72px;
+}
+
+.fancybox-prev:hover, .fancybox-next:hover {
+	visibility: visible;
+}
+
+.fancybox-prev:hover span {
+	left: 20px;
+}
+
+.fancybox-next:hover span {
+	left: auto;
+	right: 20px;
+}
+
+.fancybox-tmp {
+	position: absolute;
+	top: -9999px;
+	left: -9999px;
+	padding: 0;
+	overflow: visible;
+	visibility: hidden;
+}
+
+/* Overlay helper */
+
+#fancybox-overlay {
+	position: absolute;
+	top: 0;
+	left: 0;
+	overflow: hidden;
+	display: none;
+	z-index: 1001;
+	background: #000;
+}
+
+/* Title helper */
+
+.fancybox-title {
+	visibility: hidden;	
+	font: normal 13px/20px "Helvetica Neue",Helvetica,Arial,sans-serif;
+	position: relative;
+	text-shadow: none;
+	z-index: 1005;
+}
+
+.fancybox-opened .fancybox-title {
+	visibility: visible;
+}
+
+.fancybox-title-float-wrap {
+	position: absolute;
+	bottom: 0;
+	right: 50%;
+	margin-bottom: -35px;
+	z-index: 1003;
+	text-align: center;
+}
+
+.fancybox-title-float-wrap .child {
+	display: inline-block;
+	margin-right: -100%;
+	padding: 2px 20px;
+	background: transparent; /* Fallback for web browsers that doesn't support RGBa */
+	background: rgba(0, 0, 0, 0.8);
+	-webkit-border-radius: 15px;
+	   -moz-border-radius: 15px;
+			border-radius: 15px;
+	text-shadow: 0 1px 2px #222;
+	color: #FFF;
+	font-weight: bold;
+	line-height: 24px;
+	white-space: nowrap;
+}
+
+.fancybox-title-outside-wrap {
+	position: relative;
+	margin-top: 10px;
+	color: #fff;
+}
+
+.fancybox-title-inside-wrap {
+	margin-top: 10px;
+}
+
+.fancybox-title-over-wrap {
+	position: absolute;
+	bottom: 0;
+	left: 0;	
+	color: #fff;
+	padding: 10px;
+	background: #000;
+	background: rgba(0, 0, 0, .8);
+}
\ No newline at end of file

--- oc-includes/osclass/gui/js/fancybox/jquery.fancybox.js ---
@@ -0,0 +1,1310 @@
+ /*!
+ * fancyBox - jQuery Plugin
+ * version: 2.0.4 (12/12/2011)
+ * @requires jQuery v1.6 or later
+ *
+ * Examples at http://fancyapps.com/fancybox/
+ * License: www.fancyapps.com/fancybox/#license
+ *
+ * Copyright 2011 Janis Skarnelis - janis@fancyapps.com
+ *
+ */
+(function (window, document, $) {
+	var W = $(window),
+		D = $(document),
+		F = $.fancybox = function () {
+			F.open.apply( this, arguments );
+		},
+		didResize = false,
+		resizeTimer = null;
+
+	$.extend(F, {
+		// The current version of fancyBox
+		version: '2.0.4',
+
+		defaults: {
+			padding: 15,
+			margin: 20,
+
+			width: 800,
+			height: 600,
+			minWidth: 200,
+			minHeight: 200,
+			maxWidth: 9999,
+			maxHeight: 9999,
+
+			autoSize: true,
+			fitToView: true,
+			aspectRatio: false,
+			topRatio: 0.5,
+
+			fixed: !$.browser.msie || $.browser.version > 6 || !document.documentElement.hasOwnProperty('ontouchstart'),
+			scrolling: 'auto', // 'auto', 'yes' or 'no'
+			wrapCSS: 'fancybox-default',
+
+			arrows: true,
+			closeBtn: true,
+			closeClick: false,
+			nextClick : false,
+			mouseWheel: true,
+			autoPlay: false,
+			playSpeed: 3000,
+
+			modal: false,
+			loop: true,
+			ajax: {},
+			keys: {
+				next: [13, 32, 34, 39, 40], // enter, space, page down, right arrow, down arrow
+				prev: [8, 33, 37, 38], // backspace, page up, left arrow, up arrow
+				close: [27] // escape key
+			},
+
+			// Override some properties
+			index: 0,
+			type: null,
+			href: null,
+			content: null,
+			title: null,
+
+			// HTML templates
+			tpl: {
+				wrap: '<div class="fancybox-wrap"><div class="fancybox-outer"><div class="fancybox-inner"></div></div></div>',
+				image: '<img class="fancybox-image" src="{href}" alt="" />',
+				iframe: '<iframe class="fancybox-iframe" name="fancybox-frame{rnd}" frameborder="0" hspace="0" ' + ($.browser.msie ? 'allowtransparency="true""' : '') + ' scrolling="{scrolling}" src="{href}"></iframe>',
+				swf: '<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="100%" height="100%"><param name="wmode" value="transparent" /><param name="allowfullscreen" value="true" /><param name="allowscriptaccess" value="always" /><param name="movie" value="{href}" /><embed src="{href}" type="application/x-shockwave-flash" allowfullscreen="true" allowscriptaccess="always" width="100%" height="100%" wmode="transparent"></embed></object>',
+				error: '<p class="fancybox-error">The requested content cannot be loaded.<br/>Please try again later.</p>',
+				closeBtn: '<div title="Close" class="fancybox-item fancybox-close"></div>',
+				next: '<a title="Next" class="fancybox-item fancybox-next"><span></span></a>',
+				prev: '<a title="Previous" class="fancybox-item fancybox-prev"><span></span></a>'
+			},
+
+			// Properties for each animation type
+			// Opening fancyBox
+			openEffect: 'fade', // 'elastic', 'fade' or 'none'
+			openSpeed: 250,
+			openEasing: 'swing',
+			openOpacity: true,
+			openMethod: 'zoomIn',
+
+			// Closing fancyBox
+			closeEffect: 'fade', // 'elastic', 'fade' or 'none'
+			closeSpeed: 250,
+			closeEasing: 'swing',
+			closeOpacity: true,
+			closeMethod: 'zoomOut',
+
+			// Changing next gallery item
+			nextEffect: 'elastic', // 'elastic', 'fade' or 'none'
+			nextSpeed: 300,
+			nextEasing: 'swing',
+			nextMethod: 'changeIn',
+
+			// Changing previous gallery item
+			prevEffect: 'elastic', // 'elastic', 'fade' or 'none'
+			prevSpeed: 300,
+			prevEasing: 'swing',
+			prevMethod: 'changeOut',
+
+			// Enabled helpers
+			helpers: {
+				overlay: {
+					speedIn: 0,
+					speedOut: 300,
+					opacity: 0.8,
+					css: {
+						cursor: 'pointer'
+					},
+					closeClick: true
+				},
+				title: {
+					type: 'float' // 'float', 'inside', 'outside' or 'over'
+				}
+			},
+
+			// Callbacks
+			onCancel: $.noop, // If canceling
+			beforeLoad: $.noop, // Before loading
+			afterLoad: $.noop, // After loading
+			beforeShow: $.noop, // Before changing in current item
+			afterShow: $.noop, // After opening
+			beforeClose: $.noop, // Before closing
+			afterClose: $.noop // After closing
+		},
+
+		//Current state
+		group: {}, // Selected group
+		opts: {}, // Group options
+		coming: null, // Element being loaded
+		current: null, // Currently loaded element
+		isOpen: false, // Is currently open
+		isOpened: false, // Have been fully opened at least once
+		wrap: null,
+		outer: null,
+		inner: null,
+
+		player: {
+			timer: null,
+			isActive: false
+		},
+
+		// Loaders
+		ajaxLoad: null,
+		imgPreload: null,
+
+		// Some collections
+		transitions: {},
+		helpers: {},
+
+		/*
+		 *	Static methods
+		 */
+
+		open: function (group, opts) {
+			// Normalize group
+			if (!$.isArray(group)) {
+				group = [group];
+			}
+
+			if (!group.length) {
+				return;
+			}
+
+			//Kill existing instances
+			F.close(true);
+
+			//Extend the defaults
+			F.opts = $.extend(true, {}, F.defaults, opts);
+			F.group = group;
+
+			F._start(F.opts.index || 0);
+		},
+
+		cancel: function () {
+			if (F.coming && false === F.trigger('onCancel')) {
+				return;
+			}
+
+			F.coming = null;
+
+			F.hideLoading();
+
+			if (F.ajaxLoad) {
+				F.ajaxLoad.abort();
+			}
+
+			F.ajaxLoad = null;
+
+			if (F.imgPreload) {
+				F.imgPreload.onload = F.imgPreload.onabort = F.imgPreload.onerror = null;
+			}
+		},
+
+		close: function (a) {
+			F.cancel();
+
+			if (!F.current || false === F.trigger('beforeClose')) {
+				return;
+			}
+
+			F.unbindEvents();
+
+			//If forced or is still opening then remove immediately
+			if (!F.isOpen || (a && a[0] === true)) {
+				$(".fancybox-wrap").stop().trigger('onReset').remove();
+
+				F._afterZoomOut();
+
+			} else {
+				F.isOpen = F.isOpened = false;
+
+				$(".fancybox-item").remove();
+
+				F.wrap.stop(true).removeClass('fancybox-opened');
+				F.inner.css('overflow', 'hidden');
+
+				F.transitions[F.current.closeMethod]();
+			}
+		},
+
+		// Start/stop slideshow
+		play: function (a) {
+			var clear = function () {
+					clearTimeout(F.player.timer);
+				},
+				set = function () {
+					clear();
+
+					if (F.current && F.player.isActive) {
+						F.player.timer = setTimeout(F.next, F.current.playSpeed);
+					}
+				},
+				stop = function () {
+					clear();
+
+					$('body').unbind('.player');
+
+					F.player.isActive = false;
+
+					F.trigger('onPlayEnd');
+				},
+				start = function () {
+					if (F.current && (F.current.loop || F.current.index < F.group.length - 1)) {
+						F.player.isActive = true;
+
+						$('body').bind({
+							'afterShow.player onUpdate.player': set,
+							'onCancel.player beforeClose.player': stop,
+							'beforeLoad.player': clear
+						});
+
+						set();
+
+						F.trigger('onPlayStart');
+					}
+				};
+
+			if (F.player.isActive || (a && a[0] === false)) {
+				stop();
+			} else {
+				start();
+			}
+		},
+
+		next: function () {
+			if (F.current) {
+				F.jumpto(F.current.index + 1);
+			}
+		},
+
+		prev: function () {
+			if (F.current) {
+				F.jumpto(F.current.index - 1);
+			}
+		},
+
+		jumpto: function (index) {
+			if (!F.current) {
+				return;
+			}
+
+			index = parseInt(index, 10);
+
+			if (F.group.length > 1 && F.current.loop) {
+				if (index >= F.group.length) {
+					index = 0;
+
+				} else if (index < 0) {
+					index = F.group.length - 1;
+				}
+			}
+
+			if (typeof F.group[index] !== 'undefined') {
+				F.cancel();
+
+				F._start(index);
+			}
+		},
+
+		reposition: function (a) {
+			if (F.isOpen) {
+				F.wrap.css(F._getPosition(a));
+			}
+		},
+
+		update: function () {
+			if (F.isOpen) {
+				// It's a very bad idea to attach handlers to the window scroll event, run this code after a delay
+				if (!didResize) {
+					resizeTimer = setInterval(function () {
+						if (didResize) {
+							didResize = false;
+
+							clearTimeout(resizeTimer);
+
+							if (F.current) {
+								if (F.current.autoSize) {
+									F.inner.height('auto');
+									F.current.height = F.inner.height();
+								}
+
+								F._setDimension();
+
+								if (F.current.canGrow) {
+									F.inner.height('auto');
+								}
+
+								F.reposition();
+
+								F.trigger('onUpdate');
+							}
+						}
+					}, 100);
+				}
+
+				didResize = true;
+			}
+		},
+
+		toggle: function () {
+			if (F.isOpen) {
+				F.current.fitToView = !F.current.fitToView;
+
+				F.update();
+			}
+		},
+
+		hideLoading: function () {
+			$("#fancybox-loading").remove();
+		},
+
+		showLoading: function () {
+			F.hideLoading();
+
+			$('<div id="fancybox-loading"></div>').click(F.cancel).appendTo('body');
+		},
+
+		getViewport: function () {
+			return {
+				x: W.scrollLeft(),
+				y: W.scrollTop(),
+				w: W.width(),
+				h: W.height()
+			};
+		},
+
+		// Unbind the keyboard / clicking actions
+		unbindEvents: function () {
+			if (F.wrap) {
+				F.wrap.unbind('.fb');	
+			}
+
+			D.unbind('.fb');
+			W.unbind('.fb');
+		},
+
+		bindEvents: function () {
+			var current = F.current,
+				keys = current.keys;
+
+			if (!current) {
+				return;
+			}
+
+			W.bind('resize.fb, orientationchange.fb', F.update);
+
+			if (keys) {
+				D.bind('keydown.fb', function (e) {
+					var code;
+
+					// Ignore key combinations and key events within form elements
+					if (!e.ctrlKey && !e.altKey && !e.shiftKey && !e.metaKey && $.inArray(e.target.tagName.toLowerCase(), ['input', 'textarea', 'select', 'button']) < 0) {
+						code = e.keyCode;
+
+						if ($.inArray(code, keys.close) > -1) {
+							F.close();
+							e.preventDefault();
+
+						} else if ($.inArray(code, keys.next) > -1) {
+							F.next();
+							e.preventDefault();
+
+						} else if ($.inArray(code, keys.prev) > -1) {
+							F.prev();
+							e.preventDefault();
+						}
+					}
+				});
+			}
+
+			if ($.fn.mousewheel && current.mouseWheel && F.group.length > 1) {
+				F.wrap.bind('mousewheel.fb', function (e, delta) {
+					var target = $(e.target).get(0);
+
+					if (target.clientHeight === 0 || target.scrollHeight === target.clientHeight) {
+						e.preventDefault();
+
+						F[delta > 0 ? 'prev' : 'next']();
+					}
+				});
+			}
+		},
+
+		trigger: function (event) {
+			var ret, obj = F[ $.inArray(event, ['onCancel', 'beforeLoad', 'afterLoad']) > -1 ? 'coming' : 'current' ];
+
+			if (!obj) {
+				return;
+			}
+
+			if ($.isFunction( obj[event] )) {
+				ret = obj[event].apply(obj, Array.prototype.slice.call(arguments, 1));
+			}
+
+			if (ret === false) {
+				return false;
+			}
+
+			if (obj.helpers) {
+				$.each(obj.helpers, function (helper, opts) {
+					if (opts && typeof F.helpers[helper] !== 'undefined' && $.isFunction(F.helpers[helper][event])) {
+						F.helpers[helper][event](opts, obj);
+					}
+				});
+			}
+
+			$.event.trigger(event + '.fb');
+		},
+
+		isImage: function (str) {
+			return str && str.match(/\.(jpg|gif|png|bmp|jpeg)(.*)?$/i);
+		},
+
+		isSWF: function (str) {
+			return str && str.match(/\.(swf)(.*)?$/i);
+		},
+
+		_start: function (index) {
+			var coming = {},
+				element = F.group[index] || null,
+				isDom,
+				href,
+				type,
+				rez;
+
+			if (typeof element === 'object' && (element.nodeType || element instanceof $)) {
+				isDom = true;
+
+				if ($.metadata) {
+					coming = $(element).metadata();
+				}
+			}
+
+			coming = $.extend(true, {}, F.opts, {index : index, element : element}, ($.isPlainObject(element) ? element : coming));
+
+			// Re-check overridable options
+			$.each(['href', 'title', 'content', 'type'], function(i,v) {
+				coming[v] = F.opts[ v ] || (isDom && $(element).attr( v )) || coming[ v ] || null;
+			});
+
+			// Convert margin property to array - top, right, bottom, left
+			if (typeof coming.margin === 'number') {
+				coming.margin = [coming.margin, coming.margin, coming.margin, coming.margin];
+			}
+
+			// 'modal' propery is just a shortcut
+			if (coming.modal) {
+				$.extend(true, coming, {
+					closeBtn : false,
+					closeClick: false,
+					nextClick : false,
+					arrows : false,
+					mouseWheel : false,
+					keys : null,
+					helpers: {
+						overlay : {
+							css: {
+								cursor : 'auto'
+							},
+							closeClick : false
+						}
+					}
+				});
+			}
+
+			//Give a chance for callback or helpers to update coming item (type, title, etc)
+			F.coming = coming;
+
+			if (false === F.trigger('beforeLoad')) {
+				F.coming = null;
+				return;
+			}
+
+			type = coming.type;
+			href = coming.href;
+
+			///Check if content type is set, if not, try to get
+			if (!type) {
+				if (isDom) {
+					rez = $(element).data('fancybox-type');
+
+					if (!rez && element.className) {
+						rez = element.className.match(/fancybox\.(\w+)/);
+						type = rez ? rez[1] : null;
+					}
+				}
+
+				if (!type && href) {
+					if (F.isImage(href)) {
+						type = 'image';
+
+					} else if (F.isSWF(href)) {
+						type = 'swf';
+
+					} else if (href.match(/^#/)) {
+						type = 'inline';
+					}
+				}
+
+				// ...if not - display element itself
+				if (!type) {
+					type = isDom ? 'inline' : 'html';
+				}
+
+				coming.type = type;
+			}
+
+			// Check before try to load; 'inline' and 'html' types need content, others - href
+			if (type === 'inline' || type === 'html') {
+				coming.content = coming.content || (type === 'inline' && href ? $(href) : element);
+
+				if (!coming.content.length) {
+					type = null;
+				}
+
+			} else {
+				coming.href = href || element;
+
+				if (!coming.href) {
+					type = null;
+				}
+			}
+
+			/*
+				Add reference to the group, so it`s possible to access from callbacks, example:
+
+				afterLoad : function() {
+					this.title = 'Image ' + (this.index + 1) + ' of ' + this.group.length + (this.title ? ' - ' + this.title : '');
+				}
+
+			*/
+
+			coming.group = F.group;
+
+			if (type === 'image') {
+				F._loadImage();
+
+			} else if (type === 'ajax') {
+				F._loadAjax();
+
+			} else if (type) {
+				F._afterLoad();
+
+			} else {
+				F._error( 'type' );
+			}
+		},
+
+		_error: function ( type ) {
+			$.extend(F.coming, {
+				type : 'html',
+				autoSize : true,
+				minHeight : '0',
+				hasError : type,
+				content : F.coming.tpl.error
+			});
+
+			F._afterLoad();
+		},
+
+		_loadImage: function () {
+			// Reset preload image so it is later possible to check "complete" property
+			F.imgPreload = new Image();
+
+			F.imgPreload.onload = function () {
+				this.onload = this.onerror = null;
+
+				F.coming.width = this.width;
+				F.coming.height = this.height;
+
+				F._afterLoad();
+			};
+
+			F.imgPreload.onerror = function () {
+				this.onload = this.onerror = null;
+
+				F._error( 'image' );
+			};
+
+			F.imgPreload.src = F.coming.href;
+
+			if (!F.imgPreload.complete) {
+				F.showLoading();
+			}
+		},
+
+		_loadAjax: function () {
+			F.showLoading();
+
+			F.ajaxLoad = $.ajax($.extend({}, F.coming.ajax, {
+				url: F.coming.href,
+				error: function (jqXHR, textStatus) {
+					if (textStatus !== 'abort') {
+						F._error( 'ajax', jqXHR );
+
+					} else {
+						F.hideLoading();
+					}
+				},
+				success: function (data, textStatus) {
+					if (textStatus === 'success') {
+						F.coming.content = data;
+
+						F._afterLoad();
+					}
+				}
+			}));
+		},
+
+		_preload : function() {
+			var group = F.group,
+				index = F.current.index,
+				load = function(href) {
+					if (href && F.isImage(href)) {
+						new Image().src = href;
+					}
+				};
+
+			if (group.length > 1) {
+				load( $( group[ index + 1 ] || group[ 0 ] ).attr('href') );
+				load( $( group[ index - 1 ] || group[ group.length - 1 ] ).attr('href') );
+			}
+		},
+
+		_afterLoad: function () {
+			F.hideLoading();
+
+			if (!F.coming || false === F.trigger('afterLoad', F.current)) {
+				F.coming = false;
+
+				return;
+			}
+
+			if (F.isOpened) {
+				$(".fancybox-item").remove();
+
+				F.wrap.stop(true).removeClass('fancybox-opened');
+				F.inner.css('overflow', 'hidden');
+
+				F.transitions[F.current.prevMethod]();
+
+			} else {
+				$(".fancybox-wrap").stop().trigger('onReset').remove();
+
+				F.trigger('afterClose');
+			}
+
+			F.unbindEvents();
+
+			F.isOpen = false;
+			F.current = F.coming;
+			F.coming = false;
+
+			//Build the neccessary markup
+			F.wrap = $(F.current.tpl.wrap).addClass('fancybox-tmp ' + F.current.wrapCSS).appendTo('body');
+			F.outer = $('.fancybox-outer', F.wrap).css('padding', F.current.padding + 'px');
+			F.inner = $('.fancybox-inner', F.wrap);
+
+			F._setContent();
+
+			//Give a chance for helpers or callbacks to update elements
+			F.trigger('beforeShow');
+
+			//Set initial dimensions and hide
+			F._setDimension();
+
+			F.wrap.hide().removeClass('fancybox-tmp');
+
+			F.bindEvents();
+			F._preload();
+
+			F.transitions[ F.isOpened ? F.current.nextMethod : F.current.openMethod ]();
+		},
+
+		_setContent: function () {
+			var content, loadingBay, current = F.current,
+				type = current.type;
+
+			switch (type) {
+				case 'inline':
+				case 'ajax':
+				case 'html':
+					content = current.content;
+
+					if (type === 'inline' && content instanceof $) {
+						content = content.show().detach();
+
+						if (content.parent().hasClass('fancybox-inner')) {
+							content.parents('.fancybox-wrap').trigger('onReset').remove();
+						}
+
+						$(F.wrap).bind('onReset', function () {
+							content.appendTo('body').hide();
+						});
+					}
+
+					if (current.autoSize) {
+						loadingBay = $('<div class="fancybox-tmp"></div>').appendTo($("body")).append(content);
+
+						current.width = loadingBay.outerWidth();
+						current.height = loadingBay.outerHeight(true);
+
+						content = loadingBay.contents().detach();
+
+						loadingBay.remove();
+					}
+
+				break;
+
+				case 'image':
+					content = current.tpl.image.replace('{href}', current.href);
+
+					current.aspectRatio = true;
+				break;
+
+				case 'swf':
+					content = current.tpl.swf.replace(/\{width\}/g, current.width).replace(/\{height\}/g, current.height).replace(/\{href\}/g, current.href);
+				break;
+
+				case 'iframe':
+					content = current.tpl.iframe.replace('{href}', current.href).replace('{scrolling}', current.scrolling).replace('{rnd}', new Date().getTime());
+				break;
+			}
+
+			if ($.inArray(type, ['image', 'swf', 'iframe']) > -1) {
+				current.autoSize = false;
+				current.scrolling = false;
+			}
+
+			F.inner.append(content);
+		},
+
+		_setDimension: function () {
+			var wrap = F.wrap,
+				outer = F.outer,
+				inner = F.inner,
+				current = F.current,
+				viewport = F.getViewport(),
+				margin = current.margin,
+				padding2 = current.padding * 2,
+				width = current.width + padding2,
+				height = current.height + padding2,
+				ratio = current.width / current.height,
+
+				maxWidth = current.maxWidth,
+				maxHeight = current.maxHeight,
+				minWidth = current.minWidth,
+				minHeight = current.minHeight,
+				height_,
+				space;
+
+			viewport.w -= (margin[1] + margin[3]);
+			viewport.h -= (margin[0] + margin[2]);
+
+			if (width.toString().indexOf('%') > -1) {
+				width = ((viewport.w * parseFloat(width)) / 100);
+			}
+
+			if (height.toString().indexOf('%') > -1) {
+				height = ((viewport.h * parseFloat(height)) / 100);
+			}
+
+			if (current.fitToView) {
+				maxWidth = Math.min(viewport.w, maxWidth);
+				maxHeight = Math.min(viewport.h, maxHeight);
+			}
+
+			minWidth = Math.min(width, minWidth);
+			minHeight = Math.min(width, minHeight);
+
+			maxWidth = Math.max(minWidth, maxWidth);
+			maxHeight = Math.max(minHeight, maxHeight);
+
+			if (current.aspectRatio) {
+				if (width > maxWidth) {
+					width = maxWidth;
+					height = ((width - padding2) / ratio) + padding2;
+				}
+
+				if (height > maxHeight) {
+					height = maxHeight;
+					width = ((height - padding2) * ratio) + padding2;
+				}
+
+				if (width < minWidth) {
+					width = minWidth;
+					height = ((width - padding2) / ratio) + padding2;
+				}
+
+				if (height < minHeight) {
+					height = minHeight;
+					width = ((height - padding2) * ratio) + padding2;
+				}
+
+			} else {
+				width = Math.max(minWidth, Math.min(width, maxWidth));
+				height = Math.max(minHeight, Math.min(height, maxHeight));
+			}
+
+			width = Math.round(width);
+			height = Math.round(height);
+
+			//Reset dimensions
+			$(wrap.add(outer).add(inner)).width('auto').height('auto');
+
+			inner.width(width - padding2).height(height - padding2);
+			wrap.width(width);
+
+			height_ = wrap.height(); // Real wrap height
+
+			//Fit wrapper inside
+			if (width > maxWidth || height_ > maxHeight) {
+				while ((width > maxWidth || height_ > maxHeight) && width > minWidth && height_ > minHeight) {
+					height = height - 10;
+
+					if (current.aspectRatio) {
+						width = Math.round(((height - padding2) * ratio) + padding2);
+
+						if (width < minWidth) {
+							width = minWidth;
+							height = ((width - padding2) / ratio) + padding2;
+						}
+
+					} else {
+						width = width - 10;
+					}
+
+					inner.width(width - padding2).height(height - padding2);
+					wrap.width(width);
+
+					height_ = wrap.height();
+				}
+			}
+
+			current.dim = {
+				width: width,
+				height: height_
+			};
+
+			current.canGrow = current.autoSize && height > minHeight && height < maxHeight;
+			current.canShrink = false;
+			current.canExpand = false;
+
+			if ((width - padding2) < current.width || (height - padding2) < current.height) {
+				current.canExpand = true;
+
+			} else if ((width > viewport.w || height_ > viewport.h) && width > minWidth && height > minHeight) {
+				current.canShrink = true;
+			}
+
+			space = height_ - padding2;
+
+			F.innerSpace = space - inner.height();
+			F.outerSpace = space - outer.height();
+		},
+
+		_getPosition: function (a) {
+			var current = F.current,
+				viewport = F.getViewport(),
+				margin = current.margin,
+				width = F.wrap.width() + margin[1] + margin[3],
+				height = F.wrap.height() + margin[0] + margin[2],
+				rez = {
+					position: 'absolute',
+					top: margin[0] + viewport.y,
+					left: margin[3] + viewport.x
+				};
+
+			if (current.fixed && (!a || a[0] === false) && height <= viewport.h && width <= viewport.w) {
+				rez = {
+					position: 'fixed',
+					top: margin[0],
+					left: margin[3]
+				};
+			}
+
+			rez.top = Math.ceil(Math.max(rez.top, rez.top + ((viewport.h - height) * current.topRatio))) + 'px';
+			rez.left = Math.ceil(Math.max(rez.left, rez.left + ((viewport.w - width) * 0.5))) + 'px';
+
+			return rez;
+		},
+
+		_afterZoomIn: function () {
+			var current = F.current;
+
+			F.isOpen = F.isOpened = true;
+
+			F.wrap.addClass('fancybox-opened').css('overflow', 'visible');
+
+			F.update();
+
+			F.inner.css('overflow', current.scrolling === 'auto' ? 'auto' : (current.scrolling === 'yes' ? 'scroll' : 'hidden'));
+
+			//Assign a click event
+			if (current.closeClick || current.nextClick) {
+				F.inner.css('cursor', 'pointer').bind('click.fb', current.nextClick ? F.next : F.close);
+			}
+
+			//Create a close button
+			if (current.closeBtn) {
+				$(current.tpl.closeBtn).appendTo(F.wrap).bind('click.fb', F.close);
+			}
+
+			//Create navigation arrows
+			if (current.arrows && F.group.length > 1) {
+				if (current.loop || current.index > 0) {
+					$(current.tpl.prev).appendTo(F.wrap).bind('click.fb', F.prev);
+				}
+
+				if (current.loop || current.index < F.group.length - 1) {
+					$(current.tpl.next).appendTo(F.wrap).bind('click.fb', F.next);
+				}
+			}
+
+			F.trigger('afterShow');
+
+			if (F.opts.autoPlay && !F.player.isActive) {
+				F.opts.autoPlay = false;
+
+				F.play();
+			}
+		},
+
+		_afterZoomOut: function () {
+			F.trigger('afterClose');
+
+			F.wrap.trigger('onReset').remove();
+
+			$.extend(F, {
+				group: {},
+				opts: {},
+				current: null,
+				isOpened: false,
+				isOpen: false,
+				wrap: null,
+				outer: null,
+				inner: null
+			});
+		}
+	});
+
+	/*
+	 *	Default transitions
+	 */
+
+	F.transitions = {
+		getOrigPosition: function () {
+			var element = F.current.element,
+				pos = {},
+				width = 50,
+				height = 50,
+				image, viewport;
+
+			if (element && element.nodeName && $(element).is(':visible')) {
+				image = $(element).find('img:first');
+
+				if (image.length) {
+					pos = image.offset();
+					width = image.outerWidth();
+					height = image.outerHeight();
+
+				} else {
+					pos = $(element).offset();
+				}
+
+			} else {
+				viewport = F.getViewport();
+				pos.top = viewport.y + (viewport.h - height) * 0.5;
+				pos.left = viewport.x + (viewport.w - width) * 0.5;
+			}
+
+			pos = {
+				top: Math.ceil(pos.top) + 'px',
+				left: Math.ceil(pos.left) + 'px',
+				width: Math.ceil(width) + 'px',
+				height: Math.ceil(height) + 'px'
+			};
+
+			return pos;
+		},
+
+		step: function (now, fx) {
+			var ratio, innerValue, outerValue;
+
+			if (fx.prop === 'width' || fx.prop === 'height') {
+				innerValue = outerValue = Math.ceil(now - (F.current.padding * 2));
+
+				if (fx.prop === 'height') {
+					ratio = (now - fx.start) / (fx.end - fx.start);
+
+					if (fx.start > fx.end) {
+						ratio = 1 - ratio;
+					}
+
+					innerValue -= F.innerSpace * ratio;
+					outerValue -= F.outerSpace * ratio;
+				}
+
+				F.inner[fx.prop](innerValue);
+				F.outer[fx.prop](outerValue);
+			}
+		},
+
+		zoomIn: function () {
+			var wrap = F.wrap,
+				current = F.current,
+				startPos,
+				endPos,
+				dim = current.dim;
+
+			if (current.openEffect === 'elastic') {
+				endPos = $.extend({}, dim, F._getPosition(true));
+
+				//Remove "position" property
+				delete endPos.position;
+
+				startPos = this.getOrigPosition();
+
+				if (current.openOpacity) {
+					startPos.opacity = 0;
+					endPos.opacity = 1;
+				}
+
+				wrap.css(startPos).show().animate(endPos, {
+					duration: current.openSpeed,
+					easing: current.openEasing,
+					step: this.step,
+					complete: F._afterZoomIn
+				});
+
+			} else {
+				wrap.css($.extend({}, dim, F._getPosition()));
+
+				if (current.openEffect === 'fade') {
+					wrap.fadeIn(current.openSpeed, F._afterZoomIn);
+
+				} else {
+					wrap.show();
+					F._afterZoomIn();
+				}
+			}
+		},
+
+		zoomOut: function () {
+			var wrap = F.wrap,
+				current = F.current,
+				endPos;
+
+			if (current.closeEffect === 'elastic') {
+				if (wrap.css('position') === 'fixed') {
+					wrap.css(F._getPosition(true));
+				}
+
+				endPos = this.getOrigPosition();
+
+				if (current.closeOpacity) {
+					endPos.opacity = 0;
+				}
+
+				wrap.animate(endPos, {
+					duration: current.closeSpeed,
+					easing: current.closeEasing,
+					step: this.step,
+					complete: F._afterZoomOut
+				});
+
+			} else {
+				wrap.fadeOut(current.closeEffect === 'fade' ? current.closeSpeed : 0, F._afterZoomOut);
+			}
+		},
+
+		changeIn: function () {
+			var wrap = F.wrap,
+				current = F.current,
+				startPos;
+
+			if (current.nextEffect === 'elastic') {
+				startPos = F._getPosition(true);
+				startPos.opacity = 0;
+				startPos.top = (parseInt(startPos.top, 10) - 200) + 'px';
+
+				wrap.css(startPos).show().animate({
+					opacity: 1,
+					top: '+=200px'
+				}, {
+					duration: current.nextSpeed,
+					complete: F._afterZoomIn
+				});
+
+			} else {
+				wrap.css(F._getPosition());
+
+				if (current.nextEffect === 'fade') {
+					wrap.hide().fadeIn(current.nextSpeed, F._afterZoomIn);
+
+				} else {
+					wrap.show();
+					F._afterZoomIn();
+				}
+			}
+		},
+
+		changeOut: function () {
+			var wrap = F.wrap,
+				current = F.current,
+				cleanUp = function () {
+					$(this).trigger('onReset').remove();
+				};
+
+			wrap.removeClass('fancybox-opened');
+
+			if (current.prevEffect === 'elastic') {
+				wrap.animate({
+					'opacity': 0,
+					top: '+=200px'
+				}, {
+					duration: current.prevSpeed,
+					complete: cleanUp
+				});
+
+			} else {
+				wrap.fadeOut(current.prevEffect === 'fade' ? current.prevSpeed : 0, cleanUp);
+			}
+		}
+	};
+
+	/*
+	 *	Overlay helper
+	 */
+
+	F.helpers.overlay = {
+		overlay: null,
+
+		update: function () {
+			var width, scrollWidth, offsetWidth;
+
+			//Reset width/height so it will not mess
+			this.overlay.width(0).height(0);
+
+			if ($.browser.msie) {
+				scrollWidth = Math.max(document.documentElement.scrollWidth, document.body.scrollWidth);
+				offsetWidth = Math.max(document.documentElement.offsetWidth, document.body.offsetWidth);
+
+				width = scrollWidth < offsetWidth ? W.width() : scrollWidth;
+
+			} else {
+				width = D.width();
+			}
+
+			this.overlay.width(width).height(D.height());
+		},
+
+		beforeShow: function (opts) {
+			if (this.overlay) {
+				return;
+			}
+
+			this.overlay = $('<div id="fancybox-overlay"></div>').css(opts.css || {
+				background: 'black'
+			}).appendTo('body');
+
+			this.update();
+
+			if (opts.closeClick) {
+				this.overlay.bind('click.fb', F.close);
+			}
+
+			W.bind("resize.fb", $.proxy(this.update, this));
+
+			this.overlay.fadeTo(opts.speedIn || "fast", opts.opacity || 1);
+		},
+
+		onUpdate: function () {
+			//Update as content may change document dimensions
+			this.update();
+		},
+
+		afterClose: function (opts) {
+			if (this.overlay) {
+				this.overlay.fadeOut(opts.speedOut || "fast", function () {
+					$(this).remove();
+				});
+			}
+
+			this.overlay = null;
+		}
+	};
+
+	/*
+	 *	Title helper
+	 */
+
+	F.helpers.title = {
+		beforeShow: function (opts) {
+			var title, text = F.current.title;
+
+			if (text) {
+				title = $('<div class="fancybox-title fancybox-title-' + opts.type + '-wrap">' + text + '</div>').appendTo('body');
+
+				if (opts.type === 'float') {
+					//This helps for some browsers
+					title.width(title.width());
+
+					title.wrapInner('<span class="child"></span>');
+
+					//Increase bottom margin so this title will also fit into viewport
+					F.current.margin[2] += Math.abs(parseInt(title.css('margin-bottom'), 10));
+				}
+
+				title.appendTo(opts.type === 'over' ? F.inner : (opts.type === 'outside' ? F.wrap : F.outer));
+			}
+		}
+	};
+
+	// jQuery plugin initialization
+	$.fn.fancybox = function (options) {
+		var opts = options || {},
+			selector = this.selector || '';
+
+		function run(e) {
+			var group = [], relType, relVal, rel = this.rel;
+
+			if (!(e.ctrlKey || e.altKey || e.shiftKey || e.metaKey)) {
+				e.preventDefault();
+
+				relVal = $(this).data('fancybox-group');
+
+				// Check if element has 'data-fancybox-group' attribute, if not - use 'rel'
+				if (typeof relVal !== 'undefined') {
+					relType = relVal ? 'data-fancybox-group' : false;
+
+				} else if (rel && rel !== '' && rel !== 'nofollow') {
+					relVal = rel;
+					relType = 'rel';
+				}
+
+				if (relType) {
+					group = selector.length ? $(selector).filter('[' + relType + '="' + relVal + '"]') : $('[' + relType + '="' + relVal + '"]');
+				}
+
+				if (group.length) {
+					opts.index = group.index(this);
+
+					F.open(group.get(), opts);
+
+				} else {
+					F.open(this, opts);
+				}
+			}
+		}
+
+		if (selector) {
+			D.undelegate(selector, 'click.fb-start').delegate(selector, 'click.fb-start', run);
+
+		} else {
+			$(this).unbind('click.fb-start').bind('click.fb-start', run);
+		}
+
+		return this;
+	};
+
+}(window, document, jQuery));
\ No newline at end of file

--- oc-includes/osclass/gui/js/fancybox/jquery.fancybox.pack.js ---
@@ -0,0 +1,32 @@
+/*! fancyBox v2.0.4 fancyapps.com | fancyapps.com/fancybox/#license */
+(function(u,q,e){var l=e(u),r=e(q),a=e.fancybox=function(){a.open.apply(this,arguments)},s=!1,t=null;e.extend(a,{version:"2.0.4",defaults:{padding:15,margin:20,width:800,height:600,minWidth:200,minHeight:200,maxWidth:9999,maxHeight:9999,autoSize:!0,fitToView:!0,aspectRatio:!1,topRatio:0.5,fixed:!e.browser.msie||6<e.browser.version||!q.documentElement.hasOwnProperty("ontouchstart"),scrolling:"auto",wrapCSS:"fancybox-default",arrows:!0,closeBtn:!0,closeClick:!1,nextClick:!1,mouseWheel:!0,autoPlay:!1,
+playSpeed:3E3,modal:!1,loop:!0,ajax:{},keys:{next:[13,32,34,39,40],prev:[8,33,37,38],close:[27]},tpl:{wrap:'<div class="fancybox-wrap"><div class="fancybox-outer"><div class="fancybox-inner"></div></div></div>',image:'<img class="fancybox-image" src="{href}" alt="" />',iframe:'<iframe class="fancybox-iframe" name="fancybox-frame{rnd}" frameborder="0" hspace="0" '+(e.browser.msie?'allowtransparency="true""':"")+' scrolling="{scrolling}" src="{href}"></iframe>',swf:'<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="100%" height="100%"><param name="wmode" value="transparent" /><param name="allowfullscreen" value="true" /><param name="allowscriptaccess" value="always" /><param name="movie" value="{href}" /><embed src="{href}" type="application/x-shockwave-flash" allowfullscreen="true" allowscriptaccess="always" width="100%" height="100%" wmode="transparent"></embed></object>',
+error:'<p class="fancybox-error">The requested content cannot be loaded.<br/>Please try again later.</p>',closeBtn:'<div title="Close" class="fancybox-item fancybox-close"></div>',next:'<a title="Next" class="fancybox-item fancybox-next"><span></span></a>',prev:'<a title="Previous" class="fancybox-item fancybox-prev"><span></span></a>'},openEffect:"fade",openSpeed:250,openEasing:"swing",openOpacity:!0,openMethod:"zoomIn",closeEffect:"fade",closeSpeed:250,closeEasing:"swing",closeOpacity:!0,closeMethod:"zoomOut",
+nextEffect:"elastic",nextSpeed:300,nextEasing:"swing",nextMethod:"changeIn",prevEffect:"elastic",prevSpeed:300,prevEasing:"swing",prevMethod:"changeOut",helpers:{overlay:{speedIn:0,speedOut:300,opacity:0.8,css:{cursor:"pointer"},closeClick:!0},title:{type:"float"}}},group:{},opts:{},coming:null,current:null,isOpen:!1,isOpened:!1,wrap:null,outer:null,inner:null,player:{timer:null,isActive:!1},ajaxLoad:null,imgPreload:null,transitions:{},helpers:{},open:function(b,c){e.isArray(b)||(b=[b]);if(b.length)a.close(!0),
+a.opts=e.extend(!0,{},a.defaults,c),a.group=b,a._start(a.opts.index||0)},cancel:function(){if(!(a.coming&&!1===a.trigger("onCancel"))&&(a.coming=null,a.hideLoading(),a.ajaxLoad&&a.ajaxLoad.abort(),a.ajaxLoad=null,a.imgPreload))a.imgPreload.onload=a.imgPreload.onabort=a.imgPreload.onerror=null},close:function(b){a.cancel();if(a.current&&!1!==a.trigger("beforeClose"))a.unbindEvents(),!a.isOpen||b&&!0===b[0]?(e(".fancybox-wrap").stop().trigger("onReset").remove(),a._afterZoomOut()):(a.isOpen=a.isOpened=
+!1,e(".fancybox-item").remove(),a.wrap.stop(!0).removeClass("fancybox-opened"),a.inner.css("overflow","hidden"),a.transitions[a.current.closeMethod]())},play:function(b){var c=function(){clearTimeout(a.player.timer)},d=function(){c();if(a.current&&a.player.isActive)a.player.timer=setTimeout(a.next,a.current.playSpeed)},g=function(){c();e("body").unbind(".player");a.player.isActive=!1;a.trigger("onPlayEnd")};if(a.player.isActive||b&&!1===b[0])g();else if(a.current&&(a.current.loop||a.current.index<
+a.group.length-1))a.player.isActive=!0,e("body").bind({"afterShow.player onUpdate.player":d,"onCancel.player beforeClose.player":g,"beforeLoad.player":c}),d(),a.trigger("onPlayStart")},next:function(){a.current&&a.jumpto(a.current.index+1)},prev:function(){a.current&&a.jumpto(a.current.index-1)},jumpto:function(b){a.current&&(b=parseInt(b,10),1<a.group.length&&a.current.loop&&(b>=a.group.length?b=0:0>b&&(b=a.group.length-1)),"undefined"!==typeof a.group[b]&&(a.cancel(),a._start(b)))},reposition:function(b){a.isOpen&&
+a.wrap.css(a._getPosition(b))},update:function(){a.isOpen&&(s||(t=setInterval(function(){if(s&&(s=!1,clearTimeout(t),a.current)){if(a.current.autoSize)a.inner.height("auto"),a.current.height=a.inner.height();a._setDimension();a.current.canGrow&&a.inner.height("auto");a.reposition();a.trigger("onUpdate")}},100)),s=!0)},toggle:function(){if(a.isOpen)a.current.fitToView=!a.current.fitToView,a.update()},hideLoading:function(){e("#fancybox-loading").remove()},showLoading:function(){a.hideLoading();e('<div id="fancybox-loading"></div>').click(a.cancel).appendTo("body")},
+getViewport:function(){return{x:l.scrollLeft(),y:l.scrollTop(),w:l.width(),h:l.height()}},unbindEvents:function(){a.wrap&&a.wrap.unbind(".fb");r.unbind(".fb");l.unbind(".fb")},bindEvents:function(){var b=a.current,c=b.keys;b&&(l.bind("resize.fb, orientationchange.fb",a.update),c&&r.bind("keydown.fb",function(b){var g;if(!b.ctrlKey&&!b.altKey&&!b.shiftKey&&!b.metaKey&&0>e.inArray(b.target.tagName.toLowerCase(),["input","textarea","select","button"]))g=b.keyCode,-1<e.inArray(g,c.close)?(a.close(),b.preventDefault()):
+-1<e.inArray(g,c.next)?(a.next(),b.preventDefault()):-1<e.inArray(g,c.prev)&&(a.prev(),b.preventDefault())}),e.fn.mousewheel&&b.mouseWheel&&1<a.group.length&&a.wrap.bind("mousewheel.fb",function(b,c){var f=e(b.target).get(0);if(0===f.clientHeight||f.scrollHeight===f.clientHeight)b.preventDefault(),a[0<c?"prev":"next"]()}))},trigger:function(b){var c,d=a[-1<e.inArray(b,["onCancel","beforeLoad","afterLoad"])?"coming":"current"];if(d){e.isFunction(d[b])&&(c=d[b].apply(d,Array.prototype.slice.call(arguments,
+1)));if(!1===c)return!1;d.helpers&&e.each(d.helpers,function(c,f){if(f&&"undefined"!==typeof a.helpers[c]&&e.isFunction(a.helpers[c][b]))a.helpers[c][b](f,d)});e.event.trigger(b+".fb")}},isImage:function(a){return a&&a.match(/\.(jpg|gif|png|bmp|jpeg)(.*)?$/i)},isSWF:function(a){return a&&a.match(/\.(swf)(.*)?$/i)},_start:function(b){var c={},d=a.group[b]||null,g,f,k;if("object"===typeof d&&(d.nodeType||d instanceof e))g=!0,e.metadata&&(c=e(d).metadata());c=e.extend(!0,{},a.opts,{index:b,element:d},
+e.isPlainObject(d)?d:c);e.each(["href","title","content","type"],function(b,f){c[f]=a.opts[f]||g&&e(d).attr(f)||c[f]||null});if("number"===typeof c.margin)c.margin=[c.margin,c.margin,c.margin,c.margin];c.modal&&e.extend(!0,c,{closeBtn:!1,closeClick:!1,nextClick:!1,arrows:!1,mouseWheel:!1,keys:null,helpers:{overlay:{css:{cursor:"auto"},closeClick:!1}}});a.coming=c;if(!1===a.trigger("beforeLoad"))a.coming=null;else{f=c.type;b=c.href;if(!f)g&&(k=e(d).data("fancybox-type"),!k&&d.className&&(f=(k=d.className.match(/fancybox\.(\w+)/))?
+k[1]:null)),!f&&b&&(a.isImage(b)?f="image":a.isSWF(b)?f="swf":b.match(/^#/)&&(f="inline")),f||(f=g?"inline":"html"),c.type=f;"inline"===f||"html"===f?(c.content=c.content||("inline"===f&&b?e(b):d),c.content.length||(f=null)):(c.href=b||d,c.href||(f=null));c.group=a.group;"image"===f?a._loadImage():"ajax"===f?a._loadAjax():f?a._afterLoad():a._error("type")}},_error:function(b){e.extend(a.coming,{type:"html",autoSize:!0,minHeight:"0",hasError:b,content:a.coming.tpl.error});a._afterLoad()},_loadImage:function(){a.imgPreload=
+new Image;a.imgPreload.onload=function(){this.onload=this.onerror=null;a.coming.width=this.width;a.coming.height=this.height;a._afterLoad()};a.imgPreload.onerror=function(){this.onload=this.onerror=null;a._error("image")};a.imgPreload.src=a.coming.href;a.imgPreload.complete||a.showLoading()},_loadAjax:function(){a.showLoading();a.ajaxLoad=e.ajax(e.extend({},a.coming.ajax,{url:a.coming.href,error:function(b,c){"abort"!==c?a._error("ajax",b):a.hideLoading()},success:function(b,c){if("success"===c)a.coming.content=
+b,a._afterLoad()}}))},_preload:function(){var b=a.group,c=a.current.index,d=function(b){if(b&&a.isImage(b))(new Image).src=b};1<b.length&&(d(e(b[c+1]||b[0]).attr("href")),d(e(b[c-1]||b[b.length-1]).attr("href")))},_afterLoad:function(){a.hideLoading();!a.coming||!1===a.trigger("afterLoad",a.current)?a.coming=!1:(a.isOpened?(e(".fancybox-item").remove(),a.wrap.stop(!0).removeClass("fancybox-opened"),a.inner.css("overflow","hidden"),a.transitions[a.current.prevMethod]()):(e(".fancybox-wrap").stop().trigger("onReset").remove(),
+a.trigger("afterClose")),a.unbindEvents(),a.isOpen=!1,a.current=a.coming,a.coming=!1,a.wrap=e(a.current.tpl.wrap).addClass("fancybox-tmp "+a.current.wrapCSS).appendTo("body"),a.outer=e(".fancybox-outer",a.wrap).css("padding",a.current.padding+"px"),a.inner=e(".fancybox-inner",a.wrap),a._setContent(),a.trigger("beforeShow"),a._setDimension(),a.wrap.hide().removeClass("fancybox-tmp"),a.bindEvents(),a._preload(),a.transitions[a.isOpened?a.current.nextMethod:a.current.openMethod]())},_setContent:function(){var b,
+c,d=a.current,g=d.type;switch(g){case "inline":case "ajax":case "html":b=d.content;"inline"===g&&b instanceof e&&(b=b.show().detach(),b.parent().hasClass("fancybox-inner")&&b.parents(".fancybox-wrap").trigger("onReset").remove(),e(a.wrap).bind("onReset",function(){b.appendTo("body").hide()}));if(d.autoSize)c=e('<div class="fancybox-tmp"></div>').appendTo(e("body")).append(b),d.width=c.outerWidth(),d.height=c.outerHeight(!0),b=c.contents().detach(),c.remove();break;case "image":b=d.tpl.image.replace("{href}",
+d.href);d.aspectRatio=!0;break;case "swf":b=d.tpl.swf.replace(/\{width\}/g,d.width).replace(/\{height\}/g,d.height).replace(/\{href\}/g,d.href);break;case "iframe":b=d.tpl.iframe.replace("{href}",d.href).replace("{scrolling}",d.scrolling).replace("{rnd}",(new Date).getTime())}if(-1<e.inArray(g,["image","swf","iframe"]))d.autoSize=!1,d.scrolling=!1;a.inner.append(b)},_setDimension:function(){var b=a.wrap,c=a.outer,d=a.inner,g=a.current,f=a.getViewport(),k=g.margin,i=2*g.padding,h=g.width+i,j=g.height+
+i,l=g.width/g.height,o=g.maxWidth,m=g.maxHeight,n=g.minWidth,p=g.minHeight;f.w-=k[1]+k[3];f.h-=k[0]+k[2];-1<h.toString().indexOf("%")&&(h=f.w*parseFloat(h)/100);-1<j.toString().indexOf("%")&&(j=f.h*parseFloat(j)/100);g.fitToView&&(o=Math.min(f.w,o),m=Math.min(f.h,m));n=Math.min(h,n);p=Math.min(h,p);o=Math.max(n,o);m=Math.max(p,m);g.aspectRatio?(h>o&&(h=o,j=(h-i)/l+i),j>m&&(j=m,h=(j-i)*l+i),h<n&&(h=n,j=(h-i)/l+i),j<p&&(j=p,h=(j-i)*l+i)):(h=Math.max(n,Math.min(h,o)),j=Math.max(p,Math.min(j,m)));h=Math.round(h);
+j=Math.round(j);e(b.add(c).add(d)).width("auto").height("auto");d.width(h-i).height(j-i);b.width(h);k=b.height();if(h>o||k>m)for(;(h>o||k>m)&&h>n&&k>p;)j-=10,g.aspectRatio?(h=Math.round((j-i)*l+i),h<n&&(h=n,j=(h-i)/l+i)):h-=10,d.width(h-i).height(j-i),b.width(h),k=b.height();g.dim={width:h,height:k};g.canGrow=g.autoSize&&j>p&&j<m;g.canShrink=!1;g.canExpand=!1;if(h-i<g.width||j-i<g.height)g.canExpand=!0;else if((h>f.w||k>f.h)&&h>n&&j>p)g.canShrink=!0;b=k-i;a.innerSpace=b-d.height();a.outerSpace=b-
+c.height()},_getPosition:function(b){var c=a.current,d=a.getViewport(),e=c.margin,f=a.wrap.width()+e[1]+e[3],k=a.wrap.height()+e[0]+e[2],i={position:"absolute",top:e[0]+d.y,left:e[3]+d.x};if(c.fixed&&(!b||!1===b[0])&&k<=d.h&&f<=d.w)i={position:"fixed",top:e[0],left:e[3]};i.top=Math.ceil(Math.max(i.top,i.top+(d.h-k)*c.topRatio))+"px";i.left=Math.ceil(Math.max(i.left,i.left+0.5*(d.w-f)))+"px";return i},_afterZoomIn:function(){var b=a.current;a.isOpen=a.isOpened=!0;a.wrap.addClass("fancybox-opened").css("overflow",
+"visible");a.update();a.inner.css("overflow","auto"===b.scrolling?"auto":"yes"===b.scrolling?"scroll":"hidden");if(b.closeClick||b.nextClick)a.inner.css("cursor","pointer").bind("click.fb",b.nextClick?a.next:a.close);b.closeBtn&&e(b.tpl.closeBtn).appendTo(a.wrap).bind("click.fb",a.close);b.arrows&&1<a.group.length&&((b.loop||0<b.index)&&e(b.tpl.prev).appendTo(a.wrap).bind("click.fb",a.prev),(b.loop||b.index<a.group.length-1)&&e(b.tpl.next).appendTo(a.wrap).bind("click.fb",a.next));a.trigger("afterShow");
+if(a.opts.autoPlay&&!a.player.isActive)a.opts.autoPlay=!1,a.play()},_afterZoomOut:function(){a.trigger("afterClose");a.wrap.trigger("onReset").remove();e.extend(a,{group:{},opts:{},current:null,isOpened:!1,isOpen:!1,wrap:null,outer:null,inner:null})}});a.transitions={getOrigPosition:function(){var b=a.current.element,c={},d=50,g=50,f;b&&b.nodeName&&e(b).is(":visible")?(f=e(b).find("img:first"),f.length?(c=f.offset(),d=f.outerWidth(),g=f.outerHeight()):c=e(b).offset()):(b=a.getViewport(),c.top=b.y+
+0.5*(b.h-g),c.left=b.x+0.5*(b.w-d));return c={top:Math.ceil(c.top)+"px",left:Math.ceil(c.left)+"px",width:Math.ceil(d)+"px",height:Math.ceil(g)+"px"}},step:function(b,c){var d,e,f;if("width"===c.prop||"height"===c.prop)e=f=Math.ceil(b-2*a.current.padding),"height"===c.prop&&(d=(b-c.start)/(c.end-c.start),c.start>c.end&&(d=1-d),e-=a.innerSpace*d,f-=a.outerSpace*d),a.inner[c.prop](e),a.outer[c.prop](f)},zoomIn:function(){var b=a.wrap,c=a.current,d,g;d=c.dim;if("elastic"===c.openEffect){g=e.extend({},
+d,a._getPosition(!0));delete g.position;d=this.getOrigPosition();if(c.openOpacity)d.opacity=0,g.opacity=1;b.css(d).show().animate(g,{duration:c.openSpeed,easing:c.openEasing,step:this.step,complete:a._afterZoomIn})}else b.css(e.extend({},d,a._getPosition())),"fade"===c.openEffect?b.fadeIn(c.openSpeed,a._afterZoomIn):(b.show(),a._afterZoomIn())},zoomOut:function(){var b=a.wrap,c=a.current,d;if("elastic"===c.closeEffect){"fixed"===b.css("position")&&b.css(a._getPosition(!0));d=this.getOrigPosition();
+if(c.closeOpacity)d.opacity=0;b.animate(d,{duration:c.closeSpeed,easing:c.closeEasing,step:this.step,complete:a._afterZoomOut})}else b.fadeOut("fade"===c.closeEffect?c.closeSpeed:0,a._afterZoomOut)},changeIn:function(){var b=a.wrap,c=a.current,d;"elastic"===c.nextEffect?(d=a._getPosition(!0),d.opacity=0,d.top=parseInt(d.top,10)-200+"px",b.css(d).show().animate({opacity:1,top:"+=200px"},{duration:c.nextSpeed,complete:a._afterZoomIn})):(b.css(a._getPosition()),"fade"===c.nextEffect?b.hide().fadeIn(c.nextSpeed,
+a._afterZoomIn):(b.show(),a._afterZoomIn()))},changeOut:function(){var b=a.wrap,c=a.current,d=function(){e(this).trigger("onReset").remove()};b.removeClass("fancybox-opened");"elastic"===c.prevEffect?b.animate({opacity:0,top:"+=200px"},{duration:c.prevSpeed,complete:d}):b.fadeOut("fade"===c.prevEffect?c.prevSpeed:0,d)}};a.helpers.overlay={overlay:null,update:function(){var a,c;this.overlay.width(0).height(0);e.browser.msie?(a=Math.max(q.documentElement.scrollWidth,q.body.scrollWidth),c=Math.max(q.documentElement.offsetWidth,
+q.body.offsetWidth),a=a<c?l.width():a):a=r.width();this.overlay.width(a).height(r.height())},beforeShow:function(b){if(!this.overlay)this.overlay=e('<div id="fancybox-overlay"></div>').css(b.css||{background:"black"}).appendTo("body"),this.update(),b.closeClick&&this.overlay.bind("click.fb",a.close),l.bind("resize.fb",e.proxy(this.update,this)),this.overlay.fadeTo(b.speedIn||"fast",b.opacity||1)},onUpdate:function(){this.update()},afterClose:function(a){this.overlay&&this.overlay.fadeOut(a.speedOut||
+"fast",function(){e(this).remove()});this.overlay=null}};a.helpers.title={beforeShow:function(b){var c;if(c=a.current.title)c=e('<div class="fancybox-title fancybox-title-'+b.type+'-wrap">'+c+"</div>").appendTo("body"),"float"===b.type&&(c.width(c.width()),c.wrapInner('<span class="child"></span>'),a.current.margin[2]+=Math.abs(parseInt(c.css("margin-bottom"),10))),c.appendTo("over"===b.type?a.inner:"outside"===b.type?a.wrap:a.outer)}};e.fn.fancybox=function(b){function c(b){var c=[],i,h=this.rel;
+if(!b.ctrlKey&&!b.altKey&&!b.shiftKey&&!b.metaKey)b.preventDefault(),b=e(this).data("fancybox-group"),"undefined"!==typeof b?i=b?"data-fancybox-group":!1:h&&""!==h&&"nofollow"!==h&&(b=h,i="rel"),i&&(c=g.length?e(g).filter("["+i+'="'+b+'"]'):e("["+i+'="'+b+'"]')),c.length?(d.index=c.index(this),a.open(c.get(),d)):a.open(this,d)}var d=b||{},g=this.selector||"";g?r.undelegate(g,"click.fb-start").delegate(g,"click.fb-start",c):e(this).unbind("click.fb-start").bind("click.fb-start",c);return this}})(window,
+document,jQuery);
\ No newline at end of file

--- oc-includes/osclass/gui/js/fancybox/jquery.mousewheel-3.0.4.pack.js ---
@@ -1,14 +0,0 @@
-/*! Copyright (c) 2010 Brandon Aaron (http://brandonaaron.net)
-* Licensed under the MIT License (LICENSE.txt).
-*
-* Thanks to: http://adomas.org/javascript-mouse-wheel/ for some pointers.
-* Thanks to: Mathias Bank(http://www.mathias-bank.de) for a scope bug fix.
-* Thanks to: Seamus Leahy for adding deltaX and deltaY
-*
-* Version: 3.0.4
-*
-* Requires: 1.2.2+
-*/
-
-(function(d){function g(a){var b=a||window.event,i=[].slice.call(arguments,1),c=0,h=0,e=0;a=d.event.fix(b);a.type="mousewheel";if(a.wheelDelta)c=a.wheelDelta/120;if(a.detail)c=-a.detail/3;e=c;if(b.axis!==undefined&&b.axis===b.HORIZONTAL_AXIS){e=0;h=-1*c}if(b.wheelDeltaY!==undefined)e=b.wheelDeltaY/120;if(b.wheelDeltaX!==undefined)h=-1*b.wheelDeltaX/120;i.unshift(a,c,h,e);return d.event.handle.apply(this,i)}var f=["DOMMouseScroll","mousewheel"];d.event.special.mousewheel={setup:function(){if(this.addEventListener)for(var a=
-f.length;a;)this.addEventListener(f[--a],g,false);else this.onmousewheel=g},teardown:function(){if(this.removeEventListener)for(var a=f.length;a;)this.removeEventListener(f[--a],g,false);else this.onmousewheel=null}};d.fn.extend({mousewheel:function(a){return a?this.bind("mousewheel",a):this.trigger("mousewheel")},unmousewheel:function(a){return this.unbind("mousewheel",a)}})})(jQuery);
\ No newline at end of file

--- oc-includes/osclass/gui/style.css ---
@@ -353,6 +353,11 @@ option.pad { margin-left:10px;}
 .add_item .photos input { margin-right:10px; }
 .add_item .location label { float:left; margin-right:10px; width:120px; }
 .add_item .go_back { float:left; margin:20px 0 0 20px; }
+.meta { clear: both; margin: 10px 0; }
+.meta > label { float: left; }
+.meta ul { margin-left: 130px; list-style: none; padding: 0; }
+.meta ul li { margin-left: 0; }
+.meta ul li label { float: none; }
 
 #error_list { display:none; border: 1px solid #f7f7f7; background:#fefbea; padding:5px 5px; margin-bottom:15px; }
 #error_list li { background:url(images/icon-remove.png) left center no-repeat; list-style:none; padding:2px 0 2px 18px; }
@@ -547,4 +552,15 @@ div.uploader input { opacity: 0; filter: alpha(opacity:0); position: absolute; t
 
 #user_data {
     padding: 20px;
+}
+
+
+.user_public_profile #main .latest_ads table td.photo {
+    padding-left: 2px;
+}
+
+.user_public_profile #main .latest_ads table td {
+    border-bottom: 1px dotted #DDDDDD;
+    padding: 8px;
+    vertical-align: top;
 }
\ No newline at end of file

--- oc-includes/osclass/gui/user-profile.php ---
@@ -18,6 +18,7 @@
      *      You should have received a copy of the GNU Affero General Public
      * License along with this program.  If not, see <http://www.gnu.org/licenses/>.
      */
+    $locales   = __get('locales') ;
 ?>
 
 <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
@@ -91,6 +92,9 @@
                                 <label for="webSite"><?php _e('Website', 'modern') ; ?></label>
                                 <?php UserForm::website_text(osc_user()) ; ?>
                             </div>
+                            <div class="row">
+                                <?php UserForm::multilanguage_info($locales, osc_user()); ?>
+                            </div>
                             <div class="row">
                                 <button type="submit"><?php _e('Update', 'modern') ; ?></button>
                             </div>

--- oc-includes/osclass/gui/user-public-profile.php ---
@@ -46,11 +46,12 @@
 <html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="<?php echo str_replace('_', '-', osc_current_user_locale()); ?>">
     <head>
         <?php osc_current_web_theme_path('head.php') ; ?>
+        <script type="text/javascript" src="<?php echo osc_current_web_theme_js_url('jquery.validate.min.js') ; ?>"></script>
     </head>
     <body>
         <div class="container">
             <?php osc_current_web_theme_path('header.php') ; ?>
-            <div class="content item">
+            <div class="content item user_public_profile">
                 <div id="item_head">
                     <div class="inner">
                         <h1><?php echo sprintf(__('%s\'s profile', 'modern'), osc_user_name()); ?></h1>
@@ -65,15 +66,16 @@
                             <li><?php _e('Address'); ?>: <?php echo $address; ?></li>
                             <li><?php _e('Location'); ?>: <?php echo $location; ?></li>
                             <li><?php _e('Website'); ?>: <?php echo osc_user_website(); ?></li>
+                            <li><?php _e('User Description'); ?>: <?php echo osc_user_info(); ?></li>
                         </ul>
                     </div>
-                    <div id="description">
+                    <div id="description" class="latest_ads">
                         <h2><?php _e('Latest items'); ?></h2>
                         <table border="0" cellspacing="0">
                             <tbody>
                                 <?php $class = "even" ; ?>
                                 <?php while(osc_has_items()) { ?>
-                                    <tr class="<?php echo $class; ?>">
+                                    <tr class="<?php echo $class; ?>" >
                                         <?php if( osc_images_enabled_at_items() ) { ?>
                                          <td class="photo">
                                              <?php if(osc_count_item_resources()) { ?>
@@ -104,13 +106,6 @@
                     <?php     if(osc_reg_user_can_contact() && osc_is_web_user_logged_in() || !osc_reg_user_can_contact() ) { ?>
                     <div id="contact">
                         <h2><?php _e("Contact publisher", 'modern') ; ?></h2>
-                        <p class="name"><?php _e('Name', 'modern') ?>: <?php echo osc_user_name(); ?></p>
-                        <?php if(osc_item_show_email()) { ?>
-                        <p class="email"><?php _e('E-mail', 'modern'); ?>: <?php echo osc_user_email(); ?></p>
-                        <?php } ?>
-                        <?php if ( osc_user_phone() != '' ) { ?>
-                        <p class="phone"><?php _e("Tel", 'modern'); ?>.: <?php echo osc_user_phone() ; ?></p>
-                        <?php } ?>
                         <ul id="error_list"></ul>
                         <?php ContactForm::js_validation(); ?>
                         <form action="<?php echo osc_base_url(true) ; ?>" method="post" name="contact_form" id="contact_form">

--- oc-includes/osclass/helpers/hPage.php ---
@@ -121,13 +121,13 @@ function osc_static_page_pub_date() {
     function osc_static_page_url($locale = '') {
         if($locale!='') {
             if(osc_rewrite_enabled()) {
-                return osc_base_url().osc_static_page_field("s_internal_name")."-p".osc_static_page_field("pk_i_id")."-".$locale;
+                return osc_base_url().urlencode(osc_static_page_field("s_internal_name"))."-p".osc_static_page_field("pk_i_id")."-".$locale;
             } else {
                 return osc_base_url(true)."?page=page&id=".osc_static_page_field("pk_i_id")."&lang=".$locale;
             }
         } else {
             if(osc_rewrite_enabled()) {
-                return osc_base_url().osc_static_page_field("s_internal_name")."-p".osc_static_page_field("pk_i_id");
+                return osc_base_url().urlencode(osc_static_page_field("s_internal_name"))."-p".osc_static_page_field("pk_i_id");
             } else {
                 return osc_base_url(true)."?page=page&id=".osc_static_page_field("pk_i_id");
             }

--- oc-includes/osclass/helpers/hSanitize.php ---
@@ -115,4 +115,38 @@ function osc_sanitize_phone($value) {
 
         return ($ext)? $value." x".$ext : $value;
     } 
+    
+    /**
+     * Escape html
+     *
+     * Formats text so that it can be safely placed in a form field in the event it has HTML tags.
+     *
+     * @access	public
+     * @param	string
+     * @return	string
+     */	
+    function osc_esc_html($str = '') {
+        if ($str === '') {
+            return '';
+        }
+
+        $temp = '__TEMP_AMPERSANDS__';
+
+        // Replace entities to temporary markers so that
+        // htmlspecialchars won't mess them up
+        $str = preg_replace("/&#(\d+);/", "$temp\\1;", $str);
+        $str = preg_replace("/&(\w+);/",  "$temp\\1;", $str);
+
+        $str = htmlspecialchars($str);
+
+        // In case htmlspecialchars misses these.
+        $str = str_replace(array("'", '"'), array("&#39;", "&quot;"), $str);
+
+        // Decode the temp markers back to entities
+        $str = preg_replace("/$temp(\d+);/","&#\\1;",$str);
+        $str = preg_replace("/$temp(\w+);/","&\\1;",$str);
+
+        return $str;
+    }
+
 ?>

--- oc-includes/osclass/helpers/hSearch.php ---
@@ -200,35 +200,39 @@ function osc_search_category() {
         }
         return($category) ;
     }
-    
+
     /**
      * Gets current search category id
      *
      * @return int
      */
     function osc_search_category_id() {
-        $categories = osc_search_category();
-        $category = array();
-        $where = array();
+        $categories = osc_search_category() ;
+        $category   = array() ;
+        $where      = array() ;
+
         foreach($categories as $cat) {
-            if(is_numeric($cat)) {
-                $where[] = "a.pk_i_id = " . $cat;
+            if( is_numeric($cat) ) {
+                $where[] = "a.pk_i_id = " . $cat ;
             } else {
-                $slug_cat = explode("/", trim($cat, "/"));
-                $where[] = "b.s_slug = '" . $slug_cat[count($slug_cat)-1] . "'";
+                $slug_cat = explode( "/", trim($cat, "/") ) ;
+                $where[]  = "b.s_slug = '" . addslashes( $slug_cat[count($slug_cat)-1] ) . "'" ;
             }
         }
-        if(empty($where)) {
-            return null;
-        } else {
-            $categories = Category::newInstance()->listWhere(implode(" OR ", $where));
-            foreach($categories as $cat) {
-                $category[] = $cat['pk_i_id'];
-            }
-            return $category;    
+
+        if( empty($where) ) {
+            return null ;
         }
+
+        // TODO: not the best way to do it
+        $categories = Category::newInstance()->listWhere( implode(" OR ", $where) ) ;
+        foreach($categories as $cat) {
+            $category[] = $cat['pk_i_id'] ;
+        }
+
+        return $category ;
     }
-    
+
     /**
      * Update the search url with new options
      *

--- oc-includes/osclass/helpers/hUsers.php ---
@@ -252,11 +252,11 @@ function osc_user_info($locale = "") {
         $info = osc_user_field("s_info", $locale) ;
         if($info == '') {
             $info = osc_user_field("s_info", osc_language());
-            if($desc=='') {
+            if($info=='') {
                 $aLocales = osc_get_locales();
                 foreach($aLocales as $locale) {
                     $info = osc_user_field("s_info", $locale);
-                    if($desc!='') {
+                    if($info!='') {
                         break;
                     }
                 }

--- oc-includes/osclass/helpers/hUtils.php ---
@@ -62,7 +62,7 @@ function osc_field($item, $field, $locale) {
                     return $item[$field] ;
                 }
             } else {
-                if(isset($item["locale"]) && isset($item["locale"][$locale]) && isset($item["locale"][$locale][$field])) {
+                if(isset($item["locale"]) && !empty($item['locale']) && isset($item["locale"][$locale]) && isset($item["locale"][$locale][$field])) {
                     return $item["locale"][$locale][$field] ;
                 }else{
                     if(isset($item["locale"])){

--- oc-includes/osclass/installer/basic_data.sql ---
@@ -4,7 +4,7 @@ INSERT INTO /*TABLE_PREFIX*/t_currency (pk_c_code, s_name, s_description, b_enab
     ('EUR', 'European Union euro', 'Euro ', true);
 
 INSERT INTO /*TABLE_PREFIX*/t_preference VALUES
-    ('osclass', 'version', 234, 'INTEGER')
+    ('osclass', 'version', 235, 'INTEGER')
     ,('osclass', 'theme', 'modern', 'STRING')
     ,('osclass', 'admin_language', 'en_US', 'STRING')
     ,('osclass', 'language', 'en_US', 'STRING')

--- oc-includes/osclass/model/Category.php ---
@@ -84,29 +84,40 @@ function __construct($l = '')
          * @param mixed 
          * @return array 
          */
-        public function listWhere() {
-            $argv = func_get_args();
-            $sql  = null;
-            switch (func_num_args ()) {
-                case 0: return array();
-                    break;
-                case 1: $sql = $argv[0];
-                    break;
-                default:
-                    $args = func_get_args();
-                    $format = array_shift($args);
-                    $sql = vsprintf($format, $args);
-                    break;
+        public function listWhere($where = '')
+        {
+            if( $where !== '') {
+                $this->dao->where( $where ) ;
             }
 
-            $result = $this->dao->query(sprintf('SELECT * FROM (SELECT * FROM %s as a INNER JOIN %st_category_description as b ON a.pk_i_id = b.fk_i_category_id WHERE b.s_name != \'\' AND %s  ORDER BY a.i_position DESC) dummytable LEFT JOIN %st_category_stats as c ON dummytable.pk_i_id = c.fk_i_category_id GROUP BY pk_i_id ORDER BY i_position ASC', $this->getTableName(), DB_TABLE_PREFIX, $sql, DB_TABLE_PREFIX));
-            if($result) {
-                return $result->result();
-            } else {
-                return array();
+            // TODO: Can it be done without subquery?
+            // create subquery
+            $this->dao->select() ;
+            $this->dao->from( sprintf( '%s as a', $this->getTableName() ) ) ;
+            $this->dao->join( sprintf( '%st_category_description as b', $this->getTablePrefix() ), 'a.pk_i_id = b.fk_i_category_id', 'INNER' ) ;
+            $this->dao->where( "b.s_name != ''" ) ;
+            $this->dao->orderBy( 'a.i_position', 'DESC' ) ;
+            $subquery = $this->dao->_getSelect() ;
+            $this->dao->_resetSelect() ;
+
+            $this->dao->select() ;
+            $this->dao->from( sprintf( '(%s) dummytable', $subquery ) ) ;
+            $this->dao->join( sprintf( '%st_category_stats as c', $this->getTablePrefix() ), 'dummytable.pk_i_id = c.fk_i_category_id', 'LEFT' ) ;
+            $this->dao->groupBy( 'pk_i_id' ) ;
+            $this->dao->orderBy( 'i_position', 'ASC' ) ;
+            $rs = $this->dao->get() ;
+
+            if( $rs === false ) {
+                return array() ;
+            }
+
+            if( $rs->numRows() == 0 ) {
+                return array() ;
             }
+
+            return $rs->result() ;
         }
-        
+
         /**
          * List all enabled categories
          * 
@@ -117,14 +128,14 @@ public function listWhere() {
         public function listEnabled() 
         {
             $sql = 'SELECT * FROM (';
-            $sql .= 'SELECT a.*, b.*, c.i_num_items, FIELD(fk_c_locale_code, \''.osc_current_user_locale().'\') as locale_order FROM '.$this->getTableName().' as a INNER JOIN '.DB_TABLE_PREFIX.'t_category_description as b ON a.pk_i_id = b.fk_i_category_id ';
+            $sql .= 'SELECT a.*, b.*, c.i_num_items, FIELD(fk_c_locale_code, \''.$this->dao->connId->real_escape_string(osc_current_user_locale()).'\') as locale_order FROM '.$this->getTableName().' as a INNER JOIN '.DB_TABLE_PREFIX.'t_category_description as b ON a.pk_i_id = b.fk_i_category_id ';
             $sql .= 'LEFT JOIN '.DB_TABLE_PREFIX.'t_category_stats as c ON a.pk_i_id = c.fk_i_category_id ';
             $sql .= 'WHERE b.s_name != \'\' AND a.b_enabled = 1 ORDER BY locale_order DESC';
             $sql .= ') as dummytable GROUP BY pk_i_id ORDER BY i_position ASC';
             $result = $this->dao->query($sql);
             return $result->result();
         }
-        
+
         /**
          * Return categories in a tree
          * 
@@ -133,7 +144,8 @@ public function listEnabled()
          * @param bool $empty
          * @return array 
          */
-        public function toTree($empty = true) {
+        public function toTree($empty = true)
+        {
             if($empty==$this->empty_tree && $this->tree!=null) {
                 return $this->tree;
             }
@@ -171,7 +183,8 @@ public function toTree($empty = true) {
          * @param array $relation
          * @return array 
          */
-        private function sideTree($branch, $categories, $relation) {
+        private function sideTree($branch, $categories, $relation)
+        {
             $tree = array();
             if( !empty($branch) ) {
                 foreach($branch as $b) {
@@ -194,8 +207,13 @@ private function sideTree($branch, $categories, $relation) {
          * @since unknown
          * @return array 
          */
-        public function findRootCategories() {
-            return $this->listWhere("a.fk_i_parent_id IS NULL") ;
+        public function findRootCategories()
+        {
+            // juanramon: specific condition
+            $this->dao->where( 'a.fk_i_parent_id IS NULL' ) ;
+            // end specific condition
+
+            return $this->listWhere() ;
         }
 
         /**
@@ -205,10 +223,16 @@ public function findRootCategories() {
          * @since unknown
          * @return array 
          */
-        public function findRootCategoriesEnabled() {
-            return $this->listWhere("a.fk_i_parent_id IS NULL AND a.b_enabled = 1") ;
+        public function findRootCategoriesEnabled()
+        {
+            // juanramon: specific condition
+            $this->dao->where( 'a.fk_i_parent_id IS NULL' ) ;
+            $this->dao->where( 'a.b_enabled', '1' ) ;
+            // end specific condition
+
+            return $this->listWhere() ;
         }
-        
+
         /**
          * Returna  tree of a given category as the root
          * 
@@ -217,7 +241,8 @@ public function findRootCategoriesEnabled() {
          * @param integer$category
          * @return array 
          */
-        public function toSubTree($category = null) {
+        public function toSubTree($category = null)
+        {
             $this->toTree();
             if($category==null) {
                 return array();
@@ -238,24 +263,13 @@ public function toSubTree($category = null) {
          * @since unknown
          * @return array 
          */
-        public function listAll($description = true) {
-            if( $description ) {
-                return $this->listWhere('1 = 1');
-            }
-
-            $this->dao->select( $this->getFields() ) ;
-            $this->dao->from( $this->getTableName() ) ;
-            $result = $this->dao->get() ;
-
-            if( $result == false ) {
-                return array() ;
-            }
-
-            if( $result->numRows() == 0 ) {
-                return array() ;
-            }
+        public function listAll($description = true)
+        {
+            // juanramon: specific condition
+            $this->dao->where( '1 = 1' ) ;
+            // end specific condition
 
-            return $result->result() ;
+            return $this->listWhere() ;
         }
 
         /**
@@ -265,7 +279,8 @@ public function listAll($description = true) {
          * @since unknown
          * @return array 
          */
-        public function toTreeAll() {
+        public function toTreeAll()
+        {
             $categories = $this->listAll();
             $all_categories = array();
             $all_relation = array();
@@ -295,7 +310,8 @@ public function toTreeAll() {
          * @param integer$category
          * @return array 
          */
-        public function toRootTree($cat = null) {
+        public function toRootTree($cat = null)
+        {
             $tree = array();
             if($cat!=null) {
                 $tree_b = array();
@@ -319,16 +335,23 @@ public function toRootTree($cat = null) {
          * 
          * @access public
          * @since unknown
-         * @param integer$category_id
+         * @param integer $categoryID
          * @return array 
          */
-        public function findRootCategory($category_id) {
-            $results = $this->listWhere("a.pk_i_id = " . $category_id . " AND a.fk_i_parent_id IS NOT NULL");
-            if (count($results) > 0) {
-                return $this->findRootCategory($results[0]['fk_i_parent_id']);
-            } else {
-                return $this->findByPrimaryKey($category_id);
+        public function findRootCategory($categoryID)
+        {
+            // juanramon: specific condition
+            $this->dao->where( 'a.fk_i_parent_id IS NOT NULL' ) ;
+            $this->dao->where( 'a.pk_i_id', $categoryID ) ;
+            // end specific condition
+
+            $results = $this->listWhere() ;
+
+            if( count($results) > 0 ) {
+                return $this->findRootCategory( $results[0]['fk_i_parent_id'] ) ;
             }
+
+            return $this->findByPrimaryKey( $categoryID ) ;
         }
 
         /**
@@ -339,12 +362,18 @@ public function findRootCategory($category_id) {
          * @param string $slug
          * @return array 
          */
-        public function findBySlug($slug) {
-            $results = $this->listWhere("b.s_slug = '" . $slug . "'");
-            if(isset($results[0])) {
-                return $results[0];
+        public function findBySlug($slug)
+        {
+            // juanramon: specific condition
+            $this->dao->where( 'b.s_slug', $slug ) ;
+            // end specific condition
+
+            $results = $this->listWhere() ;
+            if( count($results) > 0 ) {
+                return $results[0] ;
             }
-            return null;
+
+            return array() ;
         }
 
         /**
@@ -355,7 +384,8 @@ public function findBySlug($slug) {
          * @param integer$category_id
          * @return array 
          */
-        public function hierarchy($category_id) {
+        public function hierarchy($category_id)
+        {
             return array_reverse($this->toRootTree($category_id));
         }
 
@@ -367,13 +397,20 @@ public function hierarchy($category_id) {
          * @param integer$category_id
          * @return boolean
          */
-        public function isRoot($category_id) {
-            $results = $this->listWhere("pk_i_id = " . $category_id . " AND fk_i_parent_id IS NULL");
-            if (count($results) > 0) {
-                return true;
-            } else {
-                return false;
+        public function isRoot($categoryID)
+        {
+            // juanramon: specific condition
+            $this->dao->where( 'fk_i_parent_id IS NULL' ) ;
+            $this->dao->where( 'pk_i_id', $categoryID ) ;
+            // end specific condition
+
+            $results = $this->listWhere() ;
+
+            if( count($results) > 0 ) {
+                return true ;
             }
+
+            return false ;
         }
 
         /**
@@ -384,8 +421,13 @@ public function isRoot($category_id) {
          * @param integer$cat_id
          * @return array 
          */
-        public function findSubcategories($cat_id) {
-            return $this->listWhere("fk_i_parent_id = %d", $cat_id);
+        public function findSubcategories($categoryID)
+        {
+            // juanramon: specific condition
+            $this->dao->where( 'fk_i_parent_id', $categoryID ) ;
+            // end specific condition
+
+            return $this->listWhere() ;
         }
 
         /**
@@ -458,7 +500,8 @@ public function findByPrimaryKey($categoryID)
          * @since unknown
          * @param integer$pk primary key
          */
-        public function deleteByPrimaryKey($pk) {
+        public function deleteByPrimaryKey($pk)
+        {
             $items = Item::newInstance()->findByCategoryID($pk);
             $subcats = $this->findSubcategories($pk);
             if (count($subcats) > 0) {
@@ -478,7 +521,8 @@ public function deleteByPrimaryKey($pk) {
             $this->dao->delete( sprintf('%st_plugin_category', DB_TABLE_PREFIX), array('fk_i_category_id' => $pk) ) ;
             $this->dao->delete( sprintf('%st_category_description', DB_TABLE_PREFIX), array('fk_i_category_id' => $pk) ) ;
             $this->dao->delete( sprintf('%st_category_stats', DB_TABLE_PREFIX), array('fk_i_category_id' => $pk) ) ;
-            $this->dao->delete( sprintf('%st_category', DB_TABLE_PREFIX), array('pk_i_id' => $pk) ) ;
+            $this->dao->delete( sprintf('%st_meta_categories', DB_TABLE_PREFIX), array('fk_i_category_id' => $pk) ) ;
+            return $this->dao->delete( sprintf('%st_category', DB_TABLE_PREFIX), array('pk_i_id' => $pk) ) ;
         }
 
         /**
@@ -489,41 +533,69 @@ public function deleteByPrimaryKey($pk) {
          * @param array $fields
          * @param array $aFieldsDescriptions
          * @param int $pk primary key
+         * @return mixed bool if there is an error, affectedRows if there isn't errors
          */
-        public function updateByPrimaryKey($data, $pk) {
+        public function updateByPrimaryKey($data, $pk)
+        {
             $fields = $data['fields'];
+
             $aFieldsDescription = $data['aFieldsDescription'];
+            $return       = true;
+            $affectedRows = 0;
             //UPDATE for category
-            $this->dao->update($this->getTableName(), $fields, array('pk_i_id' => $pk)) ;
-            foreach ($aFieldsDescription as $k => $fieldsDescription) {
-                //UPDATE for description of categories
-                $fieldsDescription['fk_i_category_id'] = $pk;
-                $fieldsDescription['fk_c_locale_code'] = $k;
-                $slug_tmp = $slug = osc_sanitizeString(osc_apply_filter('slug', isset($fieldsDescription['s_name'])?$fieldsDescription['s_name']:''));
-                $slug_unique = 1;
-                while(true) {
-                    $cat_slug = $this->findBySlug($slug);
-                    if(!isset($cat_slug['pk_i_id']) || $cat_slug['pk_i_id']==$pk) {
-                        break;
-                    } else {
-                        $slug = $slug_tmp . "_" . $slug_unique;
-                        $slug_unique++;
+            $res = $this->dao->update($this->getTableName(), $fields, array('pk_i_id' => $pk)) ;
+            if($res >= 0) {
+                $affectedRows = $res;
+                foreach ($aFieldsDescription as $k => $fieldsDescription) {
+                    //UPDATE for description of categories
+                    $fieldsDescription['fk_i_category_id'] = $pk;
+                    $fieldsDescription['fk_c_locale_code'] = $k;
+                    $slug_tmp = $slug = osc_sanitizeString(osc_apply_filter('slug', isset($fieldsDescription['s_name'])?$fieldsDescription['s_name']:''));
+                    $slug_unique = 1;
+                    while(true) {
+                        $cat_slug = $this->findBySlug($slug);
+                        if(!isset($cat_slug['pk_i_id']) || $cat_slug['pk_i_id']==$pk) {
+                            break;
+                        } else {
+                            $slug = $slug_tmp . "_" . $slug_unique;
+                            $slug_unique++;
+                        }
                     }
-                }
-                $fieldsDescription['s_slug'] = $slug;
-                $array_where = array(
-                    'fk_i_category_id'  => $pk,
-                    'fk_c_locale_code'  => $fieldsDescription["fk_c_locale_code"]
-                );
-                
-                $rs = $this->dao->update(DB_TABLE_PREFIX.'t_category_description', $fieldsDescription, $array_where) ;
-
-                if($rs == 0) {
-                    $rows = $this->dao->query(sprintf("SELECT * FROM %s as a INNER JOIN %st_category_description as b ON a.pk_i_id = b.fk_i_category_id WHERE a.pk_i_id = '%s' AND b.fk_c_locale_code = '%s'", $this->tableName, DB_TABLE_PREFIX, $pk, $k));
-                    if($rows->numRows == 0) {
-                        $this->insertDescription($fieldsDescription);
+                    $fieldsDescription['s_slug'] = $slug;
+                    $array_where = array(
+                        'fk_i_category_id'  => $pk,
+                        'fk_c_locale_code'  => $fieldsDescription["fk_c_locale_code"]
+                    );
+
+                    $rs = $this->dao->update(DB_TABLE_PREFIX.'t_category_description', $fieldsDescription, $array_where) ;
+                    if($rs == 0) {
+                        $this->dao->select();
+                        $this->dao->from($this->tableName." as a");
+                        $this->dao->join(sprintf("%st_category_description as b", DB_TABLE_PREFIX), "a.pk_i_id = b.fk_i_category_id", "INNER");
+                        $this->dao->where("a.pk_i_id", $pk);
+                        $this->dao->where("b.fk_c_locale_code", $k);
+                        $result = $this->dao->get() ;
+                        $rows = $result->result() ;
+                        if($result->numRows == 0) {
+                            $res_insert = $this->insertDescription($fieldsDescription);
+                            $affectedRows += 1;
+                        }
+                    } else if($rs > 0) {
+                        $affectedRows += $rs;
+                    } else if( is_bool($rs) ) { // catch error
+                        if($return) {
+                            $return = $rs;
+                        }
                     }
                 }
+            } else {
+                $return = $res;
+            }
+            
+            if($return) {
+                return $affectedRows;
+            } else {
+                return $return;
             }
         }
 
@@ -565,10 +637,12 @@ public function insert($fields, $aFieldsDescription = null )
          * @access public
          * @since unknown
          * @param array $fields_description
+         * @return bool
          */
-        public function insertDescription($fields_description) {
+        public function insertDescription($fields_description)
+        {
             if (!empty($fields_description['s_name'])) {
-                $this->dao->insert(DB_TABLE_PREFIX . 't_category_description', $fields_description );
+                return $this->dao->insert(DB_TABLE_PREFIX . 't_category_description', $fields_description );
             }
         }
 
@@ -581,9 +655,16 @@ public function insertDescription($fields_description) {
          * @param integer$order
          * @return mixed false on fail, int of num. of affected rows
          */
-        public function updateOrder($pk_i_id, $order) {
-            $sql = 'UPDATE ' . $this->tableName . " SET `i_position` = '".$order."' WHERE `pk_i_id` = " . $pk_i_id;
-            return $this->dao->query($sql);
+        public function updateOrder($pk_i_id, $order)
+        {
+            $array_set = array(
+                'i_position'    => $order
+            );
+            $array_where = array(
+                'pk_i_id'  => $pk_i_id
+            );
+            return $this->dao->update($this->tableName, $array_set, $array_where);
+
         }
 
         /**
@@ -596,21 +677,23 @@ public function updateOrder($pk_i_id, $order) {
          * @param string $name
          * @return mixed false on fail, int of num. of affected rows
          */
-        public function updateName($pk_i_id, $locale, $name) {
+        public function updateName($pk_i_id, $locale, $name)
+        {
             $array_set = array(
                 's_name'    => $name
             );
             $array_where = array(
                 'fk_i_category_id'  => $pk_i_id,
                 'fk_c_locale_code'  => $locale
             );
-            return $this->dao->update(DB_TABLE_PREFIX.'t_category_description', $array_set);
+            return $this->dao->update(DB_TABLE_PREFIX.'t_category_description', $array_set, $array_where);
         }
         
-         /**
-        * Formats a value before being inserted in DB.
-        */
-        public function formatValue($value) {
+        /**
+         * Formats a value before being inserted in DB.
+         */
+        public function formatValue($value)
+        {
             if(is_null($value)) return DB_CONST_NULL;
             else $value = trim($value);
             switch($value) {

--- oc-includes/osclass/model/CategoryStats.php ---
@@ -76,6 +76,9 @@ function __construct()
          */
         public function increaseNumItems($categoryId) 
         {
+            if(!is_numeric($categoryId)) {
+                return false;
+            }
             $sql = sprintf('INSERT INTO %s (fk_i_category_id, i_num_items) VALUES (%d, 1) ON DUPLICATE KEY UPDATE i_num_items = i_num_items + 1', $this->getTableName(), $categoryId);
             $return = $this->dao->query($sql);
             $result = Category::newInstance()->findByPrimaryKey($categoryId);

--- oc-includes/osclass/model/Country.php ---
@@ -99,7 +99,7 @@ public function findByName($name)
          */
         public function listAll($language = '') {
             if($language=='') { $language = osc_current_user_locale(); }
-            $result = $this->dao->query(sprintf('SELECT * FROM (SELECT *, FIELD(fk_c_locale_code, \'%s\', \'%s\') as sorter FROM %st_country WHERE s_name != \'\' ORDER BY sorter DESC) dummytable GROUP BY pk_c_code ORDER BY s_name ASC',osc_current_user_locale(), $language, DB_TABLE_PREFIX));
+            $result = $this->dao->query(sprintf('SELECT * FROM (SELECT *, FIELD(fk_c_locale_code, \'%s\', \'%s\') as sorter FROM %st_country WHERE s_name != \'\' ORDER BY sorter DESC) dummytable GROUP BY pk_c_code ORDER BY s_name ASC',  $this->dao->connId->real_escape_string(osc_current_user_locale()), $this->dao->connId->real_escape_string($language), DB_TABLE_PREFIX));
             return $result->result();
         }
 
@@ -114,11 +114,14 @@ public function listAll($language = '') {
         public function listAllAdmin($language = "")
         {
             if($language=='') { $language = osc_current_user_locale(); }
-            $result = $this->dao->query(sprintf('SELECT * FROM (SELECT *, FIELD(fk_c_locale_code, \'%s\', \'%s\') as sorter FROM %st_country WHERE s_name != \'\' ORDER BY sorter DESC) dummytable GROUP BY pk_c_code ORDER BY s_name ASC',osc_current_user_locale(), $language, DB_TABLE_PREFIX));
+            $result = $this->dao->query(sprintf('SELECT * FROM (SELECT *, FIELD(fk_c_locale_code, \'%s\', \'%s\') as sorter FROM %st_country WHERE s_name != \'\' ORDER BY sorter DESC) dummytable GROUP BY pk_c_code ORDER BY s_name ASC',$this->dao->connId->real_escape_string(osc_current_user_locale()), $this->dao->connId->real_escape_string($language), DB_TABLE_PREFIX));
             $countries_temp = $result->result();
             $countries = array();
             foreach($countries_temp as $country) {
-                $locales = $this->dao->query(sprintf("SELECT * FROM %st_country WHERE pk_c_code = '%s'", DB_TABLE_PREFIX, $country['pk_c_code']));
+                $this->dao->select();
+                $this->dao->from($this->tableName);
+                $this->dao->where('pk_c_code', $country['pk_c_code']);
+                $locales = $this->dao->get();
                 $locales = $locales->result();
                 foreach($locales as $locale) {
                     $country['locales'][$locale['fk_c_locale_code']] = $locale['s_name'];

--- oc-includes/osclass/model/Dump.php ---
@@ -115,8 +115,9 @@ function table_data($path, $table)
         {
             if ( !is_writable($path) ) return false ;
 
-            $sql = "select * from `$table`;" ;
-            $res = $this->dao->query($sql);
+            $this->dao->select();
+            $this->dao->from($table);
+            $res = $this->dao->get();
             if($res) {
                 $result = $res->result();
             } else {

--- oc-includes/osclass/model/Field.php ---
@@ -21,7 +21,7 @@
      */
 
     /**
-     * Model database for City table
+     * Model database for Field table
      * 
      * @package OSClass
      * @subpackage Model
@@ -30,7 +30,7 @@
     class Field extends DAO
     {
         /**
-         * It references to self object: City.
+         * It references to self object: Field.
          * It is used as a singleton
          * 
          * @access private
@@ -123,6 +123,10 @@ public function findByCategory($id)
          */
         public function findByCategoryItem($catId, $itemId)
         {
+            
+            if(!is_numeric($catId) || !is_numeric($itemId)) {
+                return false;
+            }
             $result = $this->dao->query(sprintf("SELECT query.*, im.s_value as s_value FROM (SELECT mf.* FROM %st_meta_fields mf, %st_meta_categories mc WHERE mc.fk_i_category_id = %d AND mf.pk_i_id = mc.fk_i_field_id) as query LEFT JOIN %st_item_meta im ON im.fk_i_field_id = query.pk_i_id AND im.fk_i_item_id = %d", DB_TABLE_PREFIX, DB_TABLE_PREFIX, $catId, DB_TABLE_PREFIX, $itemId));
 
             if( $result == false ) {
@@ -237,18 +241,17 @@ public function insertField($name, $type, $slug, $required, $options, $categorie
          * @since unknown
          * @param int $id
          * @param array $categories 
+         * @return bool
          */
         public function insertCategories($id, $categories = null) {
             if($categories!=null) {
                 foreach($categories as $c) {
-                    $this->dao->insert(sprintf('%st_meta_categories', DB_TABLE_PREFIX), array('fk_i_category_id' => $c, 'fk_i_field_id' =>$id));
-                    $subcategories = Category::newInstance()->findSubcategories($c);
-                    if(count($subcategories)>0) {
-                        foreach($subcategories as $k => $v) {
-                            $this->insertCategories($id, array($v['pk_i_id']));
-                        }
+                    $res = $this->dao->insert(sprintf('%st_meta_categories', DB_TABLE_PREFIX), array('fk_i_category_id' => $c, 'fk_i_field_id' =>$id));
+                    if(!$res) {
+                        return $res;
                     }
                 }
+                return true;
             }
         }
         

--- oc-includes/osclass/model/ItemStats.php ---
@@ -87,6 +87,10 @@ function increase($column, $itemId)
             if( !in_array($column, $increaseColumns) ) {
                 return false ;
             }
+            
+            if (!is_numeric($itemId)) {
+                return false;
+            }
 
             $sql = 'INSERT INTO '.$this->getTableName().' (fk_i_item_id, dt_date, '.$column.') VALUES ('.$itemId.', \''.date('Y-m-d H:i:s').'\',1) ON DUPLICATE KEY UPDATE  '.$column.' = '.$column.' + 1 ';
             return $this->dao->query($sql);

--- oc-includes/osclass/model/Search.php ---
@@ -486,16 +486,24 @@ private function pruneBranches($branches = null) {
          */
         public function addCategory($category = null)
         {
-            if($category == null) return '' ;
+            if( $category == null ) {
+                return '' ;
+            }
 
-            if(!is_numeric($category)) {
-                $category = preg_replace('|/$|','',$category);
+            if( !is_numeric($category) ) {
+                $category  = preg_replace('|/$|','',$category);
                 $aCategory = explode('/', $category) ;
-                $category = Category::newInstance()->findBySlug($aCategory[count($aCategory)-1]) ;
-                $category = $category['pk_i_id'] ;
+                $category  = Category::newInstance()->findBySlug($aCategory[count($aCategory)-1]) ;
+
+                if( count($category) == 0 ) {
+                    return '' ;
+                }
+
+                $category  = $category['pk_i_id'] ;
             }
+
             $tree = Category::newInstance()->toSubTree($category) ;
-            if(!in_array($category, $this->categories)) {
+            if( !in_array($category, $this->categories) ) {
                 $this->categories[] = sprintf("%st_item.fk_i_category_id = %d ", DB_TABLE_PREFIX, $category) ;
             }
             $this->pruneBranches($tree) ;
@@ -670,12 +678,12 @@ public function getLatestItems()
             $extraFields        = $arrayConditions['extraFields'];
             $conditionsSQL      = $arrayConditions['conditionsSQL'];
             
-            $this->addTable(sprintf('%st_item', DB_TABLE_PREFIX));
-            $this->addTable(sprintf('%st_item_location', DB_TABLE_PREFIX));
-            $this->addTable(sprintf('%st_category'), DB_TABLE_PREFIX);
-            $this->addTable(sprintf('%st_category_description as cd', DB_TABLE_PREFIX));
+            $this->addTable( sprintf('%st_item', DB_TABLE_PREFIX) ) ;
+            $this->addTable( sprintf('%st_item_location', DB_TABLE_PREFIX) ) ;
+            $this->addTable( sprintf('%st_category', DB_TABLE_PREFIX) ) ;
+            $this->addTable( sprintf('%st_category_description as cd', DB_TABLE_PREFIX) ) ;
             
-            $aux_tables   = implode(', ', $this->tables);
+            $aux_tables = implode(', ', $this->tables);
             
             $this->sql = sprintf("SELECT %st_item.*, %st_item_location.*, cd.s_name as s_category_name %s FROM %s WHERE %st_item_location.fk_i_item_id = %st_item.pk_i_id %s AND %st_item.fk_i_category_id = cd.fk_i_category_id GROUP BY %st_item.pk_i_id ORDER BY %s %s LIMIT %d, %d", DB_TABLE_PREFIX, DB_TABLE_PREFIX, $extraFields, $aux_tables, DB_TABLE_PREFIX, DB_TABLE_PREFIX, $conditionsSQL, DB_TABLE_PREFIX, DB_TABLE_PREFIX, $this->order_column, $this->order_direction, $this->limit_init, $this->results_per_page);
             $result = $this->dao->query($this->sql);
@@ -686,6 +694,7 @@ public function getLatestItems()
             $items = $result->result();
             return Item::newInstance()->extendData($items);
         }
+
         /**
          * Returns number of ads from each country
          *

--- oc-includes/osclass/upgrade-funcs.php ---
@@ -46,14 +46,12 @@
         }
     }
 
-
     Preference::newInstance()->update(array('s_value' => time()), array( 's_section' => 'osclass', 's_name' => 'last_version_check'));
 
     $conn = DBConnectionClass::newInstance();
     $c_db = $conn->getOsclassDb() ;
     $comm = new DBCommandClass( $c_db ) ;
 
-
     if(osc_version() < 210) {
         $comm->query(sprintf("INSERT INTO %st_preference VALUES ('osclass', 'save_latest_searches', '0', 'BOOLEAN')", DB_TABLE_PREFIX));
         $comm->query(sprintf("INSERT INTO %st_preference VALUES ('osclass', 'purge_latest_searches', '1000', 'STRING')", DB_TABLE_PREFIX));
@@ -204,14 +202,15 @@
         osc_changeVersionTo(230) ;
     }
 
-    
     if(osc_version() < 234) {
         @unlink(osc_admin_base_path()."upgrade.php");
         @unlink(osc_admin_base_path()."/themes/modern/tools/upgrade-plugins.php");
         @unlink(osc_admin_base_path()."upgrade-plugin.php");
         osc_changeVersionTo(234) ;
     }
-    
+
+    osc_changeVersionTo(235) ;
+
     if(Params::getParam('action') == '') {
         $title   = 'OSClass &raquo; Updated correctly' ;
         $message = 'OSClass has been updated successfully. <a href="http://forums.osclass.org/">Need more help?</a>';

--- oc-load.php ---
@@ -19,7 +19,7 @@
  * License along with this program.  If not, see <http://www.gnu.org/licenses/>.
  */
 
-define('OSCLASS_VERSION', '2.3.4') ;
+define('OSCLASS_VERSION', '2.3.5') ;
 
 if( !defined('ABS_PATH') ) {
     define( 'ABS_PATH', dirname(__FILE__) . '/' );

--- readme.php ---
@@ -28,7 +28,7 @@ function osc_getAbsoluteWebURL() {
                             <img src="oc-includes/images/osclass-logo.png" alt="OSClass" title="OSClass"/>
                         </a>
                         <br/>
-                        Version 2.3.3
+                        Version 2.3.5
                     </h1>
                 </div>
                 <div id="content">


--- libavcodec/utils.c ---
@@ -1024,7 +1024,7 @@ FF_ENABLE_DEPRECATION_WARNINGS
 
     return ret;
 free_and_end:
-    if (avctx->codec &&
+    if (avctx->codec && avctx->codec->close &&
         (codec_init_ok ||
          (avctx->codec->caps_internal & FF_CODEC_CAP_INIT_CLEANUP)))
         avctx->codec->close(avctx);


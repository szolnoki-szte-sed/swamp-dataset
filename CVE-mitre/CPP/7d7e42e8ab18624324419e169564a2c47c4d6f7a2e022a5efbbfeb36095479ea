--- CHANGELOG.md ---
@@ -7,6 +7,10 @@ and this project adheres to [Semantic Versioning](http://semver.org/spec/v2.0.0.
 
 ## [Unreleased]
 
+### Fixed
+
+- NPE in parser when file ends before it really starts
+
 ## [3.1.0] - 2022-09-30
 
 ### Changed

--- src/deps/PDFWriter/PDFParser.cpp ---
@@ -352,6 +352,12 @@ EStatusCode PDFParser::ParseLastXrefPosition()
 		mObjectParser.ResetReadState();
 		RefCountPtr<PDFObject> anObject(mObjectParser.ParseNewObject());
 
+		if (!anObject) {
+			status = PDFHummus::eFailure;
+			TRACE_LOG("PDFParser::ParseXrefPosition: Unable to find any object");
+			break;
+		}
+
 		if(anObject->GetType() == PDFObject::ePDFObjectInteger)
 		{
 			mLastXrefPosition = (LongFilePositionType)((PDFInteger*)anObject.GetPtr())->GetValue();

--- tests/SigSeg.js ---
@@ -0,0 +1,12 @@
+var muhammara = require("../muhammara");
+const { expect } = require("chai");
+
+describe("SigSegv test", function () {
+  it("should read fields correctly", function () {
+    expect(() =>
+      muhammara.createReader(
+        __dirname + "/TestMaterials/BrokenPdfBadHeader.txt"
+      )
+    ).to.throw();
+  });
+});

--- tests/TestMaterials/BrokenPdfBadHeader.txt ---
@@ -0,0 +1,2 @@
+%PDF-1.4
+%%EOF
\ No newline at end of file


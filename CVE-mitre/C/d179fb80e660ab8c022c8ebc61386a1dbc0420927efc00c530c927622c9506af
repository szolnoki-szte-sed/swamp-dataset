--- ChangeLog ---
@@ -1,3 +1,9 @@
+2012-11-18  Bob Friesenhahn  <bfriesen@simple.dallas.tx.us>
+
+	* libtiff/tif_{unix,vms,win32}.c (_TIFFmalloc): ANSI C does not
+	require malloc() to return NULL pointer if requested allocation
+	size is zero.  Assure that _TIFFmalloc does.
+
 2012-11-01  Frank Warmerdam  <warmerdam@pobox.com>
 
 	* tools/ppm2tiff.c: avoid zero size buffer vulnerability.

--- libtiff/tif_unix.c ---
@@ -257,6 +257,9 @@ TIFFOpenW(const wchar_t* name, const char* mode)
 void*
 _TIFFmalloc(tmsize_t s)
 {
+        if (s == 0)
+                return ((void *) NULL);
+
 	return (malloc((size_t) s));
 }
 

--- libtiff/tif_vms.c ---
@@ -264,6 +264,9 @@ TIFFOpen(const char* name, const char* mode)
 tdata_t
 _TIFFmalloc(tsize_t s)
 {
+        if (s == 0)
+                return ((void *) NULL);
+
 	return (malloc((size_t) s));
 }
 

--- libtiff/tif_win32.c ---
@@ -329,6 +329,9 @@ TIFFOpenW(const wchar_t* name, const char* mode)
 void*
 _TIFFmalloc(tmsize_t s)
 {
+        if (s == 0)
+                return ((void *) NULL);
+
 	return (malloc((size_t) s));
 }
 


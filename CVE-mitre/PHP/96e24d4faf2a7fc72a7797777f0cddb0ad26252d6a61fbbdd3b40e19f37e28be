--- AuthCryp.php ---
@@ -81,7 +81,7 @@ function dataCreator($char = '', $type = '')
 			"n"	=>	"Z",
 			"o"	=>	"W",
 			"p"	=>	"J",
-			"q"	=>	"Z",
+			"q"	=>	"V",
 			"r"	=>	"A",
 			"s"	=>	"U",
 			"t"	=>	"E",
@@ -122,7 +122,7 @@ function dataCreator($char = '', $type = '')
 			"Z" => "n",
 			"W" => "o",
 			"J" => "p",
-			"Z" => "q",
+			"V" => "q",
 			"A" => "r",
 			"U" => "s",
 			"E" => "t",
@@ -286,4 +286,4 @@ function cryptor($word = '', $type = '', $call = '')
 	}
 }
 
-?>
\ No newline at end of file
+?>

--- BackupForRollover.php ---
@@ -29,98 +29,105 @@
 include('Warehouse.php');
 require_once("Data.php");
 sleep(5);
-$print_form = 1;
-$output_messages = array();
+$print_form=1;
+$output_messages=array();
 //test mysql connection
-ini_set('memory_limit', '9000M');
-ini_set('max_execution_time', '50000');
-ini_set('max_input_time', '50000');
-if (User('PROFILE') == 'admin' && isset($_REQUEST['action']) && $_REQUEST['action'] == 'Backup') {
-  $mysql_host = $DatabaseServer;
-  $mysql_database = $DatabaseName;
-  $mysql_username = $DatabaseUsername;
-  $mysql_password = $DatabasePassword;
-  $mysql_port = $DatabasePort;
-
-
-  $print_form = 0;
-  $date_time = date("m-d-Y");
-
-  $backup_folder = 'opensis_databackup';
-  if (!is_dir($backup_folder)) {
-    mkdir("opensis_databackup");
-  }
-
-  $Export_FileName = 'opensis_databackup/' . $mysql_database . 'Backup' . $date_time . '.sql';
-  $dbconn = new mysqli($mysql_host, $mysql_username, $mysql_password, $mysql_database, $mysql_port);
-  if ($dbconn->connect_errno != 0)
-    exit($dbconn->error);
-  if (strtoupper(substr(PHP_OS, 0, 3)) === 'WIN') {
-    $result = $dbconn->query("SHOW VARIABLES LIKE 'basedir'");
-    $row = $result->fetch_assoc();
-    $mysql_dir1 = substr($row['Value'], 0, 2);
-    $sql_path_arr = explode("\\", $_SERVER['MYSQL_HOME']);
-    $sql_path = "\\" . $sql_path_arr[1] . '\\' . $sql_path_arr[2] . '\\' . $sql_path_arr[3];
-    $mysql_dir = str_replace('\\', '\\\\', $mysql_dir1 . $_SERVER['MYSQL_HOME']);
-    //        $mysql_dir = str_replace('\\', '\\\\', $mysql_dir1.$sql_path);
-  }
-  if (strtoupper(substr(PHP_OS, 0, 3)) === 'WIN') {
-    if ($mysql_password == '')
-      exec("$mysql_dir\\mysqldump -n -c --skip-add-locks --skip-disable-keys --routines --triggers --user $mysql_username  $mysql_database > $Export_FileName");
-    else
-      exec("$mysql_dir\\mysqldump -n -c --skip-add-locks --skip-disable-keys --routines --triggers --user $mysql_username --password='$mysql_password' $mysql_database > $Export_FileName");
-  } else {
-    exec("mysqldump -n -c --skip-add-locks --skip-disable-keys --routines --triggers --user $mysql_username --password='$mysql_password' $mysql_database > $Export_FileName");
-  }
-  //$mysql_password=$_REQUEST['mysql_password'];
-
-  //		_mysql_test($mysql_host,$mysql_database, $mysql_username, $mysql_password,$mysql_port);
-  //		
-  //			$print_form=0;
-  //			
-  //                        $date_time=date("m-d-Y");
-  //                    ;
-  //                        $Export_FileName=$mysql_database.'_'.$date_time ;
-  //
-  //
-  //			$myfile = fopen($Export_FileName.".sql", "w");
-  //                        fclose($myfile);
-  //         unset($myfile);
-  //			                        $f_content= "-- Server version:". mysqli_get_server_info()."\n";
-  //                        $f_content= "-- PHP Version: ".phpversion()."\n\n";
-  //                        $f_content.= 'SET SQL_MODE="NO_AUTO_VALUE_ON_ZERO";';
-  //
-  //                        $f_content.= "\n\n/*!40101 SET @OLD_CHARACTER_SET_CLIENT=@@CHARACTER_SET_CLIENT */;\n";
-  //                        $f_content.= "/*!40101 SET @OLD_CHARACTER_SET_RESULTS=@@CHARACTER_SET_RESULTS */;\n";
-  //                        $f_content.= "/*!40101 SET @OLD_COLLATION_CONNECTION=@@COLLATION_CONNECTION */;\n";
-  //                        $f_content.= "/*!40101 SET NAMES utf8 */;\n\n";
-  //
-  //                        $f_content.= "--\n";
-  //                        $f_content.= "-- Database: `$mysql_database`\n";
-  //                        $f_content.= "--\n\n";
-  //                        $f_content.= "-- --------------------------------------------------------\n\n";
-  //
-  //
-  //
-  //			$f_content.=_mysqldump($mysql_database) or die('not working');
-  //                        $myfile = fopen($Export_FileName.".sql", "w") or die('not working');
-  //                        fwrite($myfile, $f_content) or die('not working');
-  //                        fclose($myfile) or die('not working');
-  echo _fileSaved;
+ini_set('memory_limit','9000M');
+ini_set('max_execution_time','50000');
+ini_set('max_input_time','50000');
+if(User('PROFILE')=='admin'&& isset($_REQUEST['action']) && $_REQUEST['action']=='Backup' )
+{
+	$mysql_host=$DatabaseServer;
+	$mysql_database=$DatabaseName;
+	$mysql_username=$DatabaseUsername;
+        $mysql_password=$DatabasePassword;
+        $mysql_port=$DatabasePort;
+        
+        
+        $print_form = 0;
+    $date_time = date("m-d-Y");
+
+    $backup_folder = 'opensis_databackup';
+    if(!is_dir($backup_folder))
+    {
+      mkdir("opensis_databackup");
+    }
+
+    $Export_FileName = 'opensis_databackup/'.$mysql_database . 'Backup' . $date_time . '.sql';
+    $dbconn = new mysqli($mysql_host, $mysql_username, $mysql_password, $mysql_database, $mysql_port);
+    if ($dbconn->connect_errno != 0)
+        exit($dbconn->error);
+    if (strtoupper(substr(PHP_OS, 0, 3)) === 'WIN') {
+        $result = $dbconn->query("SHOW VARIABLES LIKE 'basedir'");
+        $row = $result->fetch_assoc();
+        $mysql_dir1 = substr($row['Value'], 0, 2);
+        $sql_path_arr=explode("\\",$_SERVER['MYSQL_HOME']);
+        $sql_path="\\".$sql_path_arr[1].'\\'.$sql_path_arr[2].'\\'.$sql_path_arr[3];
+        $mysql_dir = str_replace('\\', '\\\\', $mysql_dir1.$_SERVER['MYSQL_HOME']);
+//        $mysql_dir = str_replace('\\', '\\\\', $mysql_dir1.$sql_path);
+    }
+    if (strtoupper(substr(PHP_OS, 0, 3)) === 'WIN') {
+        if ($mysql_password == '')
+            exec("$mysql_dir\\mysqldump -n -c --skip-add-locks --skip-disable-keys --routines --triggers --user $mysql_username  $mysql_database > $Export_FileName");
+        else
+            exec("$mysql_dir\\mysqldump -n -c --skip-add-locks --skip-disable-keys --routines --triggers --user $mysql_username --password='$mysql_password' $mysql_database > $Export_FileName");
+    }
+    else {
+        exec("mysqldump -n -c --skip-add-locks --skip-disable-keys --routines --triggers --user $mysql_username --password='$mysql_password' $mysql_database > $Export_FileName");
+    }
+	//$mysql_password=$_REQUEST['mysql_password'];
+        
+//		_mysql_test($mysql_host,$mysql_database, $mysql_username, $mysql_password,$mysql_port);
+//		
+//			$print_form=0;
+//			
+//                        $date_time=date("m-d-Y");
+//                    ;
+//                        $Export_FileName=$mysql_database.'_'.$date_time ;
+//
+//
+//			$myfile = fopen($Export_FileName.".sql", "w");
+//                        fclose($myfile);
+//         unset($myfile);
+//			                        $f_content= "-- Server version:". mysqli_get_server_info()."\n";
+//                        $f_content= "-- PHP Version: ".phpversion()."\n\n";
+//                        $f_content.= 'SET SQL_MODE="NO_AUTO_VALUE_ON_ZERO";';
+//
+//                        $f_content.= "\n\n/*!40101 SET @OLD_CHARACTER_SET_CLIENT=@@CHARACTER_SET_CLIENT */;\n";
+//                        $f_content.= "/*!40101 SET @OLD_CHARACTER_SET_RESULTS=@@CHARACTER_SET_RESULTS */;\n";
+//                        $f_content.= "/*!40101 SET @OLD_COLLATION_CONNECTION=@@COLLATION_CONNECTION */;\n";
+//                        $f_content.= "/*!40101 SET NAMES utf8 */;\n\n";
+//
+//                        $f_content.= "--\n";
+//                        $f_content.= "-- Database: `$mysql_database`\n";
+//                        $f_content.= "--\n\n";
+//                        $f_content.= "-- --------------------------------------------------------\n\n";
+//
+//
+//
+//			$f_content.=_mysqldump($mysql_database) or die('not working');
+//                        $myfile = fopen($Export_FileName.".sql", "w") or die('not working');
+//                        fwrite($myfile, $f_content) or die('not working');
+//                        fclose($myfile) or die('not working');
+                        echo _fileSaved;
+			
+		
 }
 function _mysqldump($mysql_database)
 {
 
-  $sql = 'show tables where tables_in_' . $mysql_database . ' not like \'course_details%\' and tables_in_' . $mysql_database . ' not like \'enroll_grade%\'
-               and tables_in_' . $mysql_database . ' not like \'marking_periods%\' and tables_in_' . $mysql_database . ' not like \'student_contacts%\' and tables_in_' . $mysql_database . ' not like \'transcript_grades%\' ;';
-  $result = DBGet(DBQuery($sql));
-  $column_name = strtoupper('tables_in_' . $mysql_database);
-  if (count($result) > 0) {
-    foreach ($result as $row) {
-      $f_content_n .= _mysqldump_table_structure($row[$column_name]);
-      $f_content_n .= _mysqldump_table_data($row[$column_name]);
-    }
-    $f_content_n .= "--
+        $sql='show tables where tables_in_'.$mysql_database.' not like \'course_details%\' and tables_in_'.$mysql_database.' not like \'enroll_grade%\'
+               and tables_in_'.$mysql_database.' not like \'marking_periods%\' and tables_in_'.$mysql_database.' not like \'student_contacts%\' and tables_in_'.$mysql_database.' not like \'transcript_grades%\' ;';
+	$result= DBGet(DBQuery($sql));
+        $column_name=strtoupper('tables_in_'.$mysql_database);
+	if( count($result)>0)
+	{
+                foreach($result as $row)
+		{
+                        $f_content_n.= _mysqldump_table_structure($row[$column_name]);
+			$f_content_n.= _mysqldump_table_data($row[$column_name]);
+		}
+	$f_content_n.= "--
               --
               --
 
@@ -191,7 +198,7 @@ function _mysqldump($mysql_database)
             INNER JOIN student_gpa_calculated sgc ON sgc.student_id = rcg.student_id AND sgc.marking_period_id = rcg.marking_period_id
             INNER JOIN schools s ON s.id = mp.school_id;\n
             ";
-    $f_content_n .= "DELIMITER $$
+        $f_content_n.= "DELIMITER $$
 --
 -- Procedures
 --
@@ -598,7 +605,7 @@ class_rank = rank
 DELIMITER ;
 -- --------------------------------------------------------\n
 ";
-    $f_content_n .= "--
+$f_content_n.= "--
 -- Triggers `STUDENT_REPORT_CARD_GRADES`
 --
 DROP TRIGGER IF EXISTS `ti_student_report_card_grades`;
@@ -664,118 +671,136 @@ class_rank = rank
 	DELETE mi.* FROM missing_attendance mi,course_periods cp WHERE mi.course_period_id=cp.course_period_id and cp.calendar_id=OLD.calendar_id AND mi.SCHOOL_DATE=OLD.school_date;
 
 -- --------------------------------------------------------";
-  } else {
-    $f_content_n .= "/* no tables in $mysql_database \n";
-  }
-  //mysql_free_result($result);
-  return $f_content_n;
+        }
+	else
+	{
+		$f_content_n.= "/* no tables in $mysql_database \n";
+	}
+	//mysql_free_result($result);
+        return $f_content_n;
 }
 
 function _mysqldump_table_structure($table)
 {
-  $f_content_ns .= "--\n";
-  $f_content_ns .= "-- Table structure for table `$table` \n";
-  $f_content_ns .= "--\n\n";
-
-
-  $sql = "show create table `$table`; ";
-  $result = DBGet(DBQuery($sql));
-  if (count($result) > 0) {
-    foreach ($result as $row) {
-      $f_content_ns .= $row['Create Table'] . ";\n\n";
-    }
-  }
-  //mysql_free_result($result);
-  return $f_content_ns;
+	$f_content_ns.= "--\n";
+        $f_content_ns.= "-- Table structure for table `$table` \n";
+        $f_content_ns.= "--\n\n";
+
+       
+	         $sql="show create table `$table`; ";
+		$result=DBGet(DBQuery($sql));
+		if( count($result)>0)
+		{
+			foreach($result as $row)
+			{
+				$f_content_ns.= $row['Create Table'].";\n\n";
+			}
+		}
+		//mysql_free_result($result);
+return $f_content_ns;
 }
 
 function _mysqldump_table_data($table)
 {
-  $sql = 'select * from `' . $table . '`;';
-  $result =  DBQuery($sql);
-  if ($result) {
-    /*
+	$sql='select * from `'.$table.'`;';
+	$result=  DBQuery($sql);
+	if( $result)
+	{
+            /*
 		$num_rows= mysql_num_rows($result);
 		$num_fields= mysql_num_fields($result);
                 $numfields = mysql_num_fields($result);
-            */
-    $num_rows = $result->num_rows;
-    $num_fields = $result->field_count;
-    $numfields = $result->field_count;
-    if ($num_rows > 0) {
-
-
-      $f_content_nd .= "--\n";
-      $f_content_nd .= "-- Dumping data for table  `$table` \n";
-      $f_content_nd .= "--\n";
-
-      $field_type = array();
-      $i = 0;
-      while ($i < $num_fields) {
-        //$meta= mysql_fetch_field($result, $i);
-        $meta = $result->fetch_field();
-        array_push($field_type, $meta->type);
-        //$colfields[] = mysql_field_name($result,$i);
-        $colfields[] = $meta->name;
-        $i++;
-      }
-
-      $f_content_nd .= 'insert into `' . $table . '` (';
-      for ($j = 0; $j < $num_fields; $j++) {
-        if ($j == $num_fields - 1)
-          $f_content_nd .= $colfields[$j];
-        else
-          $f_content_nd .= $colfields[$j] . ',';
-      }
-      $f_content_nd .= ")values\n";
-      $index = 0;
-      //while( $row= mysql_fetch_row($result))
-      while ($row = $result->fetch_row()) {
-        $f_content_nd .= '(';
-        for ($i = 0; $i < $num_fields; $i++) {
-          if (is_null($row[$i]))
-            $f_content_nd .= 'null';
-          else {
-            switch ($field_type[$i]) {
-              case 'int':
-                $f_content_nd .= $row[$i];
-                break;
-              case 'string':
-              case 'blob':
-              default:
-                $f_content_nd .= "'" . mysqli_real_escape_string($row[$i]) . "'";
-            }
-          }
-          if ($i < $num_fields - 1)
-            $f_content_nd .= ',';
-        }
-        $f_content_nd .= ')';
-        if ($index < $num_rows - 1)
-          $f_content_nd .= ',';
-        else
-          $f_content_nd .= ";";
-        $f_content_nd .= "\n";
-        $index++;
-      }
-    }
-  }
-  //mysql_free_result($result);
-  $f_content_nd .= "\n";
-  return $f_content_nd;
+            */    
+                $num_rows= $result->num_rows;
+		$num_fields= $result->field_count;
+                $numfields = $result->field_count;
+		if( $num_rows> 0)
+		{
+			
+
+                        $f_content_nd.= "--\n";
+                        $f_content_nd.= "-- Dumping data for table  `$table` \n";
+                        $f_content_nd.= "--\n";
+
+			$field_type=array();
+			$i=0;
+			while( $i <$num_fields)
+			{
+				//$meta= mysql_fetch_field($result, $i);
+                                $meta= $result->fetch_field();
+				array_push($field_type, $meta->type);
+                                //$colfields[] = mysql_field_name($result,$i);
+                                $colfields[] = $meta->name;
+				$i++;
+			}
+			
+			$f_content_nd.= 'insert into `'.$table.'` (';
+                        for($j=0; $j < $num_fields; $j++)
+                        {
+                            if($j==$num_fields-1)
+                            $f_content_nd.= $colfields[$j];
+                        else
+                        $f_content_nd.= $colfields[$j].',';
+                        }
+                        $f_content_nd.= ")values\n";
+			$index=0;
+			//while( $row= mysql_fetch_row($result))
+                        while( $row= $result->fetch_row())
+			{
+				$f_content_nd.= '(';
+				for( $i=0; $i <$num_fields; $i++)
+				{
+					if( is_null( $row[$i]))
+						$f_content_nd.= 'null';
+					else
+					{
+						switch( $field_type[$i])
+						{
+							case 'int':
+								$f_content_nd.= $row[$i];
+								break;
+							case 'string':
+							case 'blob' :
+							default:
+								$f_content_nd.= "'".mysqli_real_escape_string($row[$i])."'";
+						}
+					}
+					if( $i <$num_fields-1)
+						$f_content_nd.= ',';
+				}
+				$f_content_nd.= ')';
+				if( $index <$num_rows-1)
+					$f_content_nd.= ',';
+				else
+					$f_content_nd.= ";";
+				$f_content_nd.= "\n";
+				$index++;
+			}
+		}
+	}
+	//mysql_free_result($result);
+	$f_content_nd.= "\n";
+        return $f_content_nd;
 }
-function _mysql_test($mysql_host, $mysql_database, $mysql_username, $mysql_password, $mysql_port)
+function _mysql_test($mysql_host,$mysql_database, $mysql_username, $mysql_password)
 {
-  global $output_messages;
-  $link = new mysqli($mysql_host, $mysql_username, $mysql_password, $mysql_database, $mysql_port);
-  if (!$link) {
-    array_push($output_messages, '' . _couldNotConnect . ': ' . mysql_error());
-  } else {
-    array_push($output_messages, "" . _connectedWithMySqlServer . ":$mysql_username@$mysql_host successfully");
-    //$db_selected = mysql_select_db($mysql_database, $link);
-    $db_selected = new mysqli($mysql_host, $mysql_username, $mysql_password, $mysql_database, $mysql_port);
-    if (!$db_selected) {
-      array_push($output_messages, '' . _canTUse . ' $mysql_database : ' . mysql_error());
-    } else
-      array_push($output_messages, "" . _connectedWithMySqlDatabase . ":$mysql_database successfully");
-  }
+	global $output_messages;
+	$link = new mysqli($mysql_host, $mysql_username, $mysql_password,$mysql_database,$mysql_port);
+	if (!$link)
+	{
+	   array_push($output_messages, ''._couldNotConnect.': ' . mysql_error());
+	}
+	else
+	{
+		array_push ($output_messages,""._connectedWithMySqlServer.":$mysql_username@$mysql_host successfully");
+		//$db_selected = mysql_select_db($mysql_database, $link);
+                $db_selected = new mysqli($mysql_host, $mysql_username, $mysql_password,$mysql_database,$mysql_port);
+		if (!$db_selected)
+		{
+			array_push ($output_messages,''._canTUse.' $mysql_database : ' . mysql_error());
+		}
+		else
+			array_push ($output_messages,""._connectedWithMySqlDatabase.":$mysql_database successfully");
+	}
 }
+?>
\ No newline at end of file

--- Bottom.php ---
@@ -31,63 +31,71 @@
 include "./Warehouse.php";
 // include('functions/SqlSecurityFnc.php');
 
-$url = validateQueryString(curPageURL());
-if ($url === FALSE) {
-	header('Location: index.php');
-}
+$url=validateQueryString(curPageURL());
+if($url===FALSE)
+ {
+ header('Location: index.php');
+ }
 
-if (clean_param($_REQUEST['modfunc'], PARAM_ALPHA) == 'print') {
-	$connection = new mysqli($DatabaseServer, $DatabaseUsername, $DatabasePassword, $DatabaseName, $DatabasePort);
+if(clean_param($_REQUEST['modfunc'],PARAM_ALPHA)=='print')
+{
+     $connection = new mysqli($DatabaseServer, $DatabaseUsername, $DatabasePassword, $DatabaseName);
 	$_REQUEST = $_SESSION['_REQUEST_vars'];
 	$_REQUEST['_openSIS_PDF'] = true;
-	$_REQUEST['_openSIS_PDF'] = mysqli_real_escape_string($connection, optional_param('_openSIS_PDF', '', PARAM_RAW));
-	$_REQUEST['modname'] = mysqli_real_escape_string($connection, optional_param('modname', '', PARAM_RAW));
-	$_REQUEST['failed_login'] = mysqli_real_escape_string($connection, optional_param('failed_login', '', PARAM_RAW));
-	if (strpos($_REQUEST['modname'], '?') !== false)
-		$modname = substr(mysqli_real_escape_string($connection, optional_param('modname', '', PARAM_RAW)), 0, strpos(mysqli_real_escape_string($connection, optional_param('modname', '', PARAM_RAW)), '?'));
+        $_REQUEST['_openSIS_PDF'] = mysqli_real_escape_string($connection,optional_param('_openSIS_PDF', '', PARAM_RAW));
+        $_REQUEST['modname'] = mysqli_real_escape_string($connection,optional_param('modname', '', PARAM_RAW));
+        $_REQUEST['failed_login'] = mysqli_real_escape_string($connection,optional_param('failed_login', '', PARAM_RAW));
+	if(strpos($_REQUEST['modname'],'?')!==false)
+		$modname = substr(mysqli_real_escape_string($connection,optional_param('modname', '', PARAM_RAW)),0,strpos(mysqli_real_escape_string($connection,optional_param('modname', '', PARAM_RAW)),'?'));
 	else
-		$modname = mysqli_real_escape_string($connection, optional_param('modname', '', PARAM_RAW));
+		$modname = mysqli_real_escape_string($connection,optional_param('modname', '', PARAM_RAW));
 	ob_start();
-	include('modules/' . sqlSecurityFilter($modname));
-	if ($htmldocPath) {
-		if ($htmldocAssetsPath)
-			$html = par_rep('/</?CENTER>/', '', str_replace('assets/', $htmldocAssetsPath, ob_get_contents()));
+	include('modules/'.sqlSecurityFilter($modname));
+	if($htmldocPath)
+	{
+		if($htmldocAssetsPath)
+			$html = par_rep('/</?CENTER>/','',str_replace('assets/',$htmldocAssetsPath,ob_get_contents()));
 		else
-			$html = par_rep('/</?CENTER>/', '', ob_get_contents());
+			$html = par_rep('/</?CENTER>/','',ob_get_contents());
 		ob_end_clean();
 
 		// get a temp filename, and then change its extension from .tmp to .html to make htmldoc happy.
-		$temphtml = tempnam('', 'html');
-		$temphtml_tmp = substr($temphtml, 0, strrpos($temphtml, ".")) . 'html';
+		$temphtml=tempnam('','html');
+		$temphtml_tmp=substr($temphtml, 0, strrpos($temphtml, ".")).'html';
 		rename($temphtml_tmp, $temphtml);
 
-		$fp = @fopen($temphtml, "w+");
+		$fp=@fopen($temphtml,"w+");
 		if (!$fp)
-			die("" . _canTOpen . " $temphtml");
-		fputs($fp, '<HTML><BODY>' . $html . '</BODY></HTML>');
+			die(""._canTOpen." $temphtml");
+		fputs($fp,'<HTML><BODY>'.$html.'</BODY></HTML>');
 		@fclose($fp);
 
 		header("Cache-Control: public");
 		header("Pragma: ");
 		header("Content-Type: application/pdf");
-		header("Content-Disposition: inline; filename=\"" . ProgramTitle() . ".pdf\"\n");
+		header("Content-Disposition: inline; filename=\"".ProgramTitle().".pdf\"\n");
 
 		$orientation = 'portrait';
-		if ($_REQUEST['expanded_view'] || $_SESSION['orientation'] == 'landscape') {
+		if($_REQUEST['expanded_view'] || $_SESSION['orientation'] == 'landscape')
+		{
 			$orientation = 'landscape';
 			unset($_SESSION['orientation']);
 		}
 		passthru("$htmldocPath --webpage --quiet -t pdf12 --jpeg --no-links --$orientation --footer t --header . --left 0.5in --top 0.5in \"$temphtml\"");
 		@unlink($temphtml);
-	} else {
-		$html = par_rep('/</?CENTER>/', '', ob_get_contents());
+	}
+	else
+	{
+		$html = par_rep('/</?CENTER>/','',ob_get_contents());
 		ob_end_clean();
-		echo '<HTML><BODY>' . $html . '</BODY></HTML>';
+		echo '<HTML><BODY>'.$html.'</BODY></HTML>';
 	}
-} else {
-	echo "
+}
+else
+{
+echo "
 	<HTML>
-		<HEAD><TITLE>" . _openSisSchoolSoftware . "</TITLE>
+		<HEAD><TITLE>"._openSisSchoolSoftware."</TITLE>
 		<SCRIPT>
 		size = 30;
 		function expandFrame()
@@ -104,31 +112,37 @@ function expandFrame()
 			}
 		}
 		</SCRIPT>";
-	//		<link rel=stylesheet type=text/css href=styles/Help.css>
-	echo "</HEAD>
+//		<link rel=stylesheet type=text/css href=styles/Help.css>
+		echo "</HEAD>
 		<BODY><table width=100%; cellspacing=0 cellpadding=0><tr><td>";
-
+	
 	include 'Help.php';
 	include 'Menu.php';
 	$profile = User('PROFILE');
 	echo '<div style=" width:470px; height:188px; background-color:transparent; overflow-x:hidden; overflow-y:scroll; text-align:left"><div style="padding:0px 12px 0px 12px;">';
-	if ($_REQUEST['modcat'] && $_REQUEST['modname']) {
-		echo '<b>' . str_replace('_', ' ', $_REQUEST['modcat']);
-		echo ' : ' . $_openSIS['Menu'][$_REQUEST['modcat']][$_REQUEST['modname']];
+                  if($_REQUEST['modcat'] && $_REQUEST['modname'])
+	{
+		echo '<b>'.str_replace('_',' ',$_REQUEST['modcat']);
+		echo ' : '.$_openSIS['Menu'][$_REQUEST['modcat']][$_REQUEST['modname']];
 		echo '</b>';
 	}
-	if ($help[$_REQUEST['modcat']] && !$_REQUEST['modname']) {
-		if ($student == true)
-			$help[$_REQUEST['modcat']] = str_replace('your child', 'yourself', str_replace('your child\'s', 'your', $help[$_REQUEST['modcat']]));
-		echo $help[$_REQUEST['modcat']];
-	} elseif ($help[$_REQUEST['modname']]) {
-		if ($student == true)
-			$help[$_REQUEST['modname']] = str_replace('your child', 'yourself', str_replace('your child\'s', 'your', $help[$_REQUEST['modname']]));
+                  if($help[$_REQUEST['modcat']] && !$_REQUEST['modname'])
+	{
+		if($student==true)
+			$help[$_REQUEST['modcat']] = str_replace('your child','yourself',str_replace('your child\'s','your',$help[$_REQUEST['modcat']]));
+                                    echo $help[$_REQUEST['modcat']];
+                  }
+	elseif($help[$_REQUEST['modname']])
+	{
+		if($student==true)
+			$help[$_REQUEST['modname']] = str_replace('your child','yourself',str_replace('your child\'s','your',$help[$_REQUEST['modname']]));
 
 		echo $help[$_REQUEST['modname']];
-	} else
+	}
+	else
 		echo $help['default'];
 	echo '</div></DIV>';
 	echo '</td></tr></table></BODY>';
 	echo '</HTML>';
 }
+?>

--- CalendarModal.php ---
@@ -2,7 +2,7 @@
 include("functions/ParamLibFnc.php");
 require_once("Data.php");
 include('RedirectRootInc.php');
-include 'ConfigInc.php';
+include'ConfigInc.php';
 include 'Warehouse.php';
 /*
  * To change this license header, choose License Headers in Project Properties.
@@ -11,8 +11,8 @@
  */
 
 //----------------------- modal for event start---------------------//
-$connection = new mysqli($DatabaseServer, $DatabaseUsername, $DatabasePassword, $DatabaseName, $DatabasePort);
-$_REQUEST['event_id'] = mysqli_real_escape_string($connection, optional_param('event_id', '', PARAM_DATA));
+$connection = new mysqli($DatabaseServer, $DatabaseUsername, $DatabasePassword, $DatabaseName);
+$_REQUEST['event_id'] = mysqli_real_escape_string($connection,optional_param('event_id', '', PARAM_DATA));
 if (($_REQUEST['event_id'] || !isset($_REQUEST['event_id'])) && !isset($_REQUEST[assignment_id])) {
     if ($_REQUEST['event_id'] != 'new' && isset($_REQUEST['event_id'])) {
         $RET = DBGet(DBQuery("SELECT TITLE,DESCRIPTION,SCHOOL_DATE,CALENDAR_ID FROM calendar_events WHERE ID='$_REQUEST[event_id]'"));
@@ -37,50 +37,52 @@
 echo '<div id=err_message ></div>';
 
 echo '<div class="form-group">';
-echo '<label class="control-label">Date : ' . $_REQUEST['school_date'] . '&nbsp;</label>';
+echo '<label class="control-label">Date : '.$_REQUEST['school_date'].'&nbsp;</label>';
 echo '</div>';
 
 if ($RET[1]['TITLE'] == '') {
     echo '<div class="form-group">';
-    echo '<label class="control-label">' . _title . ' : &nbsp;</label>';
-    echo (User('PROFILE') == 'admin' ? TextInputModal($RET[1]['TITLE'], 'values[TITLE]', '', 'id=title placeholder="' . _enterTitle . '"') : $RET[1]['TITLE']);
+    echo '<label class="control-label">'._title.' : &nbsp;</label>';
+    echo (User('PROFILE') == 'admin' ? TextInputModal($RET[1]['TITLE'], 'values[TITLE]', '', 'id=title placeholder="'._enterTitle.'"') : $RET[1]['TITLE']);
     echo '</div>';
 } else {
     echo '<div class="form-group">';
-    echo '<label class="control-label">' . _title . ' : &nbsp;</label>';
+    echo '<label class="control-label">'._title.' : &nbsp;</label>';
     //echo (User('PROFILE') == 'admin' ? TextInputCusIdModal($RET[1]['TITLE'], 'values[TITLE]', '', ' placeholder="'._enterTitle.'"', true, 'title') : $RET[1]['TITLE']);
-    echo (User('PROFILE') == 'admin' ? '<input class="form-control" id="values[TITLE]" name="values[TITLE]" value="' . $RET[1]['TITLE'] . '" placeholder="' . _enterTitle . '" size="10" type="text">' : $RET[1]['TITLE']);
+    echo (User('PROFILE') == 'admin' ? '<input class="form-control" id="values[TITLE]" name="values[TITLE]" value="' . $RET[1]['TITLE'] . '" placeholder="'._enterTitle.'" size="10" type="text">' : $RET[1]['TITLE']);
     echo '</div>';
 }
 
 if ($RET[1]['STAFF_ID']) {
-    echo '<div class="form-group"><label class="control-label">' . _teacher . ' : &nbsp;</label>' . (User('PROFILE') == 'admin' ? TextAreaInput($RET[1]['STAFF_ID'], 'values[STAFF_ID]', '', 'placeholder="' . _enterTeacher . '"') : $RET[1]['STAFF_ID']) . '</div>';
+    echo '<div class="form-group"><label class="control-label">'._teacher.' : &nbsp;</label>' . (User('PROFILE') == 'admin' ? TextAreaInput($RET[1]['STAFF_ID'], 'values[STAFF_ID]', '', 'placeholder="'._enterTeacher.'"') : $RET[1]['STAFF_ID']) . '</div>';
 }
 
 if ($RET[1]['ASSIGNED_DATE']) {
-    echo '<div class="form-group"><label class="control-label">' . _assignedDate . ' : &nbsp;</label>' . (User('PROFILE') == 'admin' ? TextAreaInput($RET[1]['ASSIGNED_DATE'], 'values[ASSIGNED_DATE]', '', 'placeholder="' . _enterAssignedDate . '"') : $RET[1]['ASSIGNED_DATE']) . '</div>';
+    echo '<div class="form-group"><label class="control-label">'._assignedDate.' : &nbsp;</label>' . (User('PROFILE') == 'admin' ? TextAreaInput($RET[1]['ASSIGNED_DATE'], 'values[ASSIGNED_DATE]', '', 'placeholder="'._enterAssignedDate.'"') : $RET[1]['ASSIGNED_DATE']) . '</div>';
 }
 
 if ($RET[1]['DUE_DATE']) {
-    echo '<div class="form-group"><label class="control-label">' . _dueDate . ' : &nbsp;</label>' . (User('PROFILE') == 'admin' ? TextAreaInput($RET[1]['DUE_DATE'], 'values[DUE_DATE]', '', 'placeholder="' . _enterDueDate . '"') : $RET[1]['DUE_DATE']) . '</div>';
+    echo '<div class="form-group"><label class="control-label">'._dueDate.' : &nbsp;</label>' . (User('PROFILE') == 'admin' ? TextAreaInput($RET[1]['DUE_DATE'], 'values[DUE_DATE]', '', 'placeholder="'._enterDueDate.'"') : $RET[1]['DUE_DATE']) . '</div>';
 }
 echo '<div class="form-group">';
-echo '<label class="control-label">' . _notes . ' : &nbsp;</label>';
+echo '<label class="control-label">'._notes.' : &nbsp;</label>';
 //echo (User('PROFILE') == 'admin' ? TextAreaInputModal(html_entity_decode($RET[1]['DESCRIPTION']), 'values[DESCRIPTION]', '', 'style=height:200px;  placeholder="'._enterNotes.'"') : html_entity_decode($RET[1]['DESCRIPTION']));
 if ($RET[1]['DESCRIPTION'] != '') {
     $RET[1]['DESCRIPTION'] = html_entity_decode(html_entity_decode($RET[1]['DESCRIPTION']));
     $RET[1]['DESCRIPTION'] = strip_tags($RET[1]['DESCRIPTION']);
 }
-echo (User('PROFILE') == 'admin' ? '<input class="form-control" id="values[DESCRIPTION]" name="values[DESCRIPTION]" value="' . $RET[1]['DESCRIPTION'] . '" placeholder="' . _enterNotes . '" size="10" type="textArea">' : $RET[1]['DESCRIPTION']);
+echo (User('PROFILE') == 'admin' ? '<input class="form-control" id="values[DESCRIPTION]" name="values[DESCRIPTION]" value="' . $RET[1]['DESCRIPTION'] . '" placeholder="'._enterNotes.'" size="10" type="textArea">' : $RET[1]['DESCRIPTION']);
 echo '</div>';
 
 //        if (AllowEdit())
-if (User('PROFILE') == 'admin') {
-    if ($_REQUEST['event_id'] != 'new') {
-        if ($RET[1]['CALENDAR_ID'] == 0)
-            $RET[1]['CALENDAR_ID'] = 1;
-        else
-            $RET[1]['CALENDAR_ID'] = 0;
+if (User('PROFILE') == 'admin')
+{
+    if($_REQUEST['event_id']!='new')
+    {
+    if($RET[1]['CALENDAR_ID']==0)
+    $RET[1]['CALENDAR_ID']=1;
+    else
+    $RET[1]['CALENDAR_ID']=0;
     }
     echo '<div class="form-group">' . CheckboxInputSwitchModal($RET[1]['CALENDAR_ID'], 'new', _showEventsSystemWide, '', false, 'Yes', 'No', '', 'switch-success') . '</div>';
 }
@@ -91,10 +93,10 @@
 
 if (User('PROFILE') == 'admin') {
     echo '<div class="modal-footer">';
-    echo '<INPUT type=submit class="btn btn-primary" name=button value=' . _save . ' >';
+    echo '<INPUT type=submit class="btn btn-primary" name=button value='._save.' >';
     echo '&nbsp;';
     if ($_REQUEST['event_id'] != 'new') {
-        echo '<INPUT type=submit name=button class="btn btn-white" value=' . _delete . ' >';
+        echo '<INPUT type=submit name=button class="btn btn-white" value='._delete.' >';
     }
     echo '</div>'; //.modal-footer
 }

--- ConnectionClass.php ---
@@ -28,13 +28,15 @@
 // Establish MySQL DB connection.  
 class ConnectDBOpensis
 {
-    var $auto_init = true;
-    function init($DatabaseServer, $DatabaseUsername, $DatabasePassword, $DatabaseName, $DatabasePort)
+    var $auto_init= true;
+    function init($DatabaseServer,$DatabaseUsername,$DatabasePassword,$DatabaseName)
     {
-        // Used to ensure system is only accessed by a web browser
-        $user_agent = explode('/', $_SERVER['HTTP_USER_AGENT']);
-        if ($user_agent[0] == 'Mozilla') {
-            return new mysqli($DatabaseServer, $DatabaseUsername, $DatabasePassword, $DatabaseName, $DatabasePort);
+        $user_agent=explode('/',$_SERVER['HTTP_USER_AGENT']);
+        if($user_agent[0]=='Mozilla')
+        {
+        return new mysqli($DatabaseServer,$DatabaseUsername,$DatabasePassword,$DatabaseName);
         }
     }
 }
+
+?>

--- DatabaseInc.php ---
@@ -26,32 +26,35 @@
 #
 #***************************************************************************************
 // Establish MySQL DB connection.  
-include('RedirectRootInc.php');
-include('ConnectionClass.php');
+include('RedirectRootInc.php'); 
+include('ConnectionClass.php'); 
 require_once("functions/PragRepFnc.php");
 function db_start()
-{
-	global $DatabaseServer, $DatabaseUsername, $DatabasePassword, $DatabaseName, $DatabasePort, $DatabaseType, $connection;
+{	global $DatabaseServer,$DatabaseUsername,$DatabasePassword,$DatabaseName,$DatabasePort,$DatabaseType,$connection ;
 
 
-	switch ($DatabaseType) {
+	switch($DatabaseType)
+	{
 		case 'mysqli':
-			$connection = new ConnectDBOpensis();
-			if ($connection->auto_init == true) {
-				$connection = $connection->init($DatabaseServer, $DatabaseUsername, $DatabasePassword, $DatabaseName, $DatabasePort);
-				mysqli_set_charset($connection, "utf8");
-			}
-			break;
+                        $connection = new ConnectDBOpensis();
+                        if($connection->auto_init==true)
+                        {
+                        $connection=$connection->init($DatabaseServer, $DatabaseUsername, $DatabasePassword, $DatabaseName);
+                       mysqli_set_charset($connection,"utf8");
+                        }
+		break;
 	}
 
 	// Error code for both.
-	if ($connection === false) {
-		switch ($DatabaseType) {
+	if($connection === false)
+	{
+		switch($DatabaseType)
+		{
 			case 'mysqli':
 				$errormessage = mysqli_error($connection);
-				break;
+			break;
 		}
-		db_show_error("", "" . _couldNotConnectToDatabase . ": $DatabaseServer", $errstring);
+		db_show_error("",""._couldNotConnectToDatabase.": $DatabaseServer",$errstring);
 	}
 	return $connection;
 }
@@ -60,185 +63,226 @@ function db_start()
 // Not receiving the return == unusable search.
 //		ie, $processable_results = DBQuery("select * from students");
 function DBQuery($sql)
-{
-	global $DatabaseType, $_openSIS;
+{	global $DatabaseType,$_openSIS;
 
 	$connection = db_start();
 
-	switch ($DatabaseType) {
+	switch($DatabaseType)
+	{
 		case 'mysqli':
-
+                    
 			$sql = str_replace('&amp;', "", $sql);
 			$sql = str_replace('&quot', "", $sql);
 			$sql = str_replace('&#039;', "", $sql);
 			$sql = str_replace('&lt;', "", $sql);
 			$sql = str_replace('&gt;', "", $sql);
-			$sql = par_rep("/([,\(=])[\r\n\t ]*''/", '\\1NULL', $sql);
-			if (preg_match_all("/'(\d\d-[A-Za-z]{3}-\d{2,4})'/", $sql, $matches)) {
-				foreach ($matches[1] as $match) {
-					if (strlen($date_cheker_mod[2]) == 4 && $date_cheker_mod[2] < 1970) {
-						$month_names = array('JAN' => '01', 'FEB' => '02', 'MAR' => '03', 'APR' => '04', 'MAY' => '05', 'JUN' => '06', 'JUL' => '07', 'AUG' => '08', 'SEP' => '09', 'OCT' => '10', 'NOV' => '11', 'DEC' => '12');
-						$date_cheker_mod[1] = $month_names[$date_cheker_mod[1]];
-						$dt = $date_cheker_mod[2] . '-' . $date_cheker_mod[1] . '-' . $date_cheker_mod[0];
-					} else
-						$dt = date('Y-m-d', strtotime($match));
-
-					$sql = par_rep("/'$match'/", "'$dt'", $sql);
+		  	$sql = par_rep("/([,\(=])[\r\n\t ]*''/",'\\1NULL',$sql);
+			if(preg_match_all("/'(\d\d-[A-Za-z]{3}-\d{2,4})'/",$sql,$matches))
+				{ 
+					foreach($matches[1] as $match)
+					{
+                                                if(strlen($date_cheker_mod[2])==4 && $date_cheker_mod[2]<1970)
+                                                {
+                                                 $month_names=array('JAN'=>'01','FEB'=>'02','MAR'=>'03','APR'=>'04','MAY'=>'05','JUN'=>'06','JUL'=>'07','AUG'=>'08','SEP'=>'09','OCT'=>'10','NOV'=>'11','DEC'=>'12');
+                                                 $date_cheker_mod[1]=$month_names[$date_cheker_mod[1]];
+                                                 $dt =$date_cheker_mod[2].'-'.$date_cheker_mod[1].'-'.$date_cheker_mod[0] ;
+                                                }
+                                                else
+						$dt = date('Y-m-d',strtotime($match));
+
+						$sql = par_rep("/'$match'/","'$dt'",$sql);
+					}
 				}
-			}
-			if (substr($sql, 0, 6) == "BEGIN;") {
-				$array = explode(";", $sql);
-
-				foreach ($array as $value) {
-					if ($value != "") {
-						$user_agent = explode('/', $_SERVER['HTTP_USER_AGENT']);
-						if ($user_agent[0] == 'Mozilla') {
-							$result = $connection->query($value);
-						}
-						if (!$result) {
-							$user_agent = explode('/', $_SERVER['HTTP_USER_AGENT']);
-							if ($user_agent[0] == 'Mozilla') {
-								$connection->query("ROLLBACK");
-								die(db_show_error($sql, _dbExecuteFailed, mysqli_error($connection)));
-							}
+			if(substr($sql,0,6)=="BEGIN;")
+			{
+				$array = explode( ";", $sql );
+                                
+				foreach( $array as $value )
+				{
+					if($value!="")
+					{
+                                           $user_agent=explode('/',$_SERVER['HTTP_USER_AGENT']);
+                                           if($user_agent[0]=='Mozilla')
+                                           { 
+                                           $result = $connection->query($value);
+                                           }
+						if(!$result)
+						{
+                                                    $user_agent=explode('/',$_SERVER['HTTP_USER_AGENT']);
+                                                    if($user_agent[0]=='Mozilla')
+                                                    {
+                                                    $connection->query("ROLLBACK");
+                                                    die(db_show_error($sql,_dbExecuteFailed,mysqli_error($connection)));
+                                                    }
 						}
 					}
 				}
-			} else {
-				$user_agent = explode('/', $_SERVER['HTTP_USER_AGENT']);
-				if ($user_agent[0] == 'Mozilla') {
-					$result = $connection->query($sql) or die(db_show_error($sql, _dbExecuteFailed, mysqli_error($connection)));
-				}
 			}
-			break;
+			else
+			{
+                                $user_agent=explode('/',$_SERVER['HTTP_USER_AGENT']);
+                                if($user_agent[0]=='Mozilla')
+                                {
+                                $result = $connection->query($sql) or die(db_show_error($sql,_dbExecuteFailed,mysqli_error($connection)));
+                                }
+                                
+			}
+		break;
 	}
 	return $result;
 }
 function DBQuery_assignment($sql)
-{
-	global $DatabaseType, $_openSIS;
+{	global $DatabaseType,$_openSIS;
 
 	$connection = db_start();
 
-	switch ($DatabaseType) {
+	switch($DatabaseType)
+	{
 		case 'mysqli':
-			$sql = par_rep("/([,\(=])[\r\n\t ]*''/", '\\1NULL', $sql);
-			if (preg_match_all("/'(\d\d-[A-Za-z]{3}-\d{2,4})'/", $sql, $matches)) {
-				foreach ($matches[1] as $match) {
-					$date_cheker_mod = explode('-', $match);
-					if (strlen($date_cheker_mod[2]) == 4 && $date_cheker_mod[2] < 1970) {
-						$month_names = array('JAN' => '01', 'FEB' => '02', 'MAR' => '03', 'APR' => '04', 'MAY' => '05', 'JUN' => '06', 'JUL' => '07', 'AUG' => '08', 'SEP' => '09', 'OCT' => '10', 'NOV' => '11', 'DEC' => '12');
-						$date_cheker_mod[1] = $month_names[$date_cheker_mod[1]];
-						$dt = $date_cheker_mod[2] . '-' . $date_cheker_mod[1] . '-' . $date_cheker_mod[0];
-					} else
-						$dt = date('Y-m-d', strtotime($match));
-
-					$sql = par_rep("/'$match'/", "'$dt'", $sql);
+		  	$sql = par_rep("/([,\(=])[\r\n\t ]*''/",'\\1NULL',$sql);
+			if(preg_match_all("/'(\d\d-[A-Za-z]{3}-\d{2,4})'/",$sql,$matches))
+				{
+					foreach($matches[1] as $match)
+					{
+                                                $date_cheker_mod=explode('-',$match);
+                                                if(strlen($date_cheker_mod[2])==4 && $date_cheker_mod[2]<1970)
+                                                {
+                                                 $month_names=array('JAN'=>'01','FEB'=>'02','MAR'=>'03','APR'=>'04','MAY'=>'05','JUN'=>'06','JUL'=>'07','AUG'=>'08','SEP'=>'09','OCT'=>'10','NOV'=>'11','DEC'=>'12');
+                                                 $date_cheker_mod[1]=$month_names[$date_cheker_mod[1]];
+                                                 $dt =$date_cheker_mod[2].'-'.$date_cheker_mod[1].'-'.$date_cheker_mod[0] ;
+                                                }
+                                                else
+						$dt = date('Y-m-d',strtotime($match));
+
+						$sql = par_rep("/'$match'/","'$dt'",$sql);
+					}
 				}
-			}
-			if (substr($sql, 0, 6) == "BEGIN;") {
-				$array = explode(";", $sql);
-				foreach ($array as $value) {
-					if ($value != "") {
-						$user_agent = explode('/', $_SERVER['HTTP_USER_AGENT']);
-						if ($user_agent[0] == 'Mozilla') {
-							$result = $connection->query($value);
-						}
-						if (!$result) {
-							$user_agent = explode('/', $_SERVER['HTTP_USER_AGENT']);
-							if ($user_agent[0] == 'Mozilla') {
-								$connection->query("ROLLBACK");
-								die(db_show_error($sql, _dbExecuteFailed, mysqli_error($connection)));
-							}
+			if(substr($sql,0,6)=="BEGIN;")
+			{
+				$array = explode( ";", $sql );
+				foreach( $array as $value )
+				{
+					if($value!="")
+					{
+                                                $user_agent=explode('/',$_SERVER['HTTP_USER_AGENT']);
+                                                if($user_agent[0]=='Mozilla')
+                                                { 
+                                                $result = $connection->query($value);
+                                                }
+						if(!$result)
+						{
+                                                    $user_agent=explode('/',$_SERVER['HTTP_USER_AGENT']);
+                                                    if($user_agent[0]=='Mozilla')
+                                                    {
+							$connection->query("ROLLBACK");
+							die(db_show_error($sql,_dbExecuteFailed,mysqli_error($connection)));
+                                                    }
 						}
 					}
 				}
-			} else {
-				$user_agent = explode('/', $_SERVER['HTTP_USER_AGENT']);
-				if ($user_agent[0] == 'Mozilla') {
-					$result = $connection->query($sql) or die(db_show_error($sql, _dbExecuteFailed, mysqli_error($connection)));
-				}
 			}
-			break;
+			else
+			{
+                                $user_agent=explode('/',$_SERVER['HTTP_USER_AGENT']);
+                                if($user_agent[0]=='Mozilla')
+                                { 
+                                $result = $connection->query($sql) or die(db_show_error($sql,_dbExecuteFailed,mysqli_error($connection)));
+                                }
+				
+			}
+		break;
 	}
 	return $result;
 }
 function DBQueryMod($sql)
-{
-	global $DatabaseType, $_openSIS;
+{	global $DatabaseType,$_openSIS;
 
 	$connection = db_start();
 
-	switch ($DatabaseType) {
+	switch($DatabaseType)
+	{
 		case 'mysqli':
 			$sql = str_replace('&amp;', "", $sql);
 			$sql = str_replace('&quot', "", $sql);
 			$sql = str_replace('&#039;', "", $sql);
 			$sql = str_replace('&lt;', "", $sql);
 			$sql = str_replace('&gt;', "", $sql);
 
-			if (preg_match_all("/'(\d\d-[A-Za-z]{3}-\d{2,4})'/", $sql, $matches)) {
-				foreach ($matches[1] as $match) {
-					$dt = date('Y-m-d', strtotime($match));
-					$sql = par_rep("/'$match'/", "'$dt'", $sql);
+			if(preg_match_all("/'(\d\d-[A-Za-z]{3}-\d{2,4})'/",$sql,$matches))
+				{
+					foreach($matches[1] as $match)
+					{
+						$dt = date('Y-m-d',strtotime($match));
+						$sql = par_rep("/'$match'/","'$dt'",$sql);
+					}
 				}
-			}
-			if (substr($sql, 0, 6) == "BEGIN;") {
-				$array = explode(";", $sql);
-				foreach ($array as $value) {
-					if ($value != "") {
-						$user_agent = explode('/', $_SERVER['HTTP_USER_AGENT']);
-						if ($user_agent[0] == 'Mozilla') {
-							$result = $connection->query($value);
-						}
-
-						if (!$result) {
-							$user_agent = explode('/', $_SERVER['HTTP_USER_AGENT']);
-							if ($user_agent[0] == 'Mozilla') {
-								$connection->query("ROLLBACK");
-								die(db_show_error($sql, _dbExecuteFailed, mysqli_error($connection)));
-							}
+			if(substr($sql,0,6)=="BEGIN;")
+			{
+				$array = explode( ";", $sql );
+				foreach( $array as $value )
+				{
+					if($value!="")
+					{
+                                                $user_agent=explode('/',$_SERVER['HTTP_USER_AGENT']);
+                                                if($user_agent[0]=='Mozilla')
+                                                { 
+                                                $result = $connection->query($value);
+                                                }
+						
+						if(!$result)
+						{
+                                                    $user_agent=explode('/',$_SERVER['HTTP_USER_AGENT']);
+                                                    if($user_agent[0]=='Mozilla')
+                                                    {
+							$connection->query("ROLLBACK");
+							die(db_show_error($sql,_dbExecuteFailed,mysqli_error($connection)));
+                                                    }
 						}
 					}
 				}
-			} else {
-				$user_agent = explode('/', $_SERVER['HTTP_USER_AGENT']);
-				if ($user_agent[0] == 'Mozilla') {
-					$result = $connection->query($sql) or die(db_show_error($sql, _dbExecuteFailed, mysqli_error($connection)));
-				}
 			}
-			break;
+			else
+			{
+                                $user_agent=explode('/',$_SERVER['HTTP_USER_AGENT']);
+                                if($user_agent[0]=='Mozilla')
+                                { 
+                                $result = $connection->query($sql) or die(db_show_error($sql,_dbExecuteFailed,mysqli_error($connection)));
+                                }
+				
+			}
+		break;
 	}
 	return $result;
 }
 
 // return next row.
 function db_fetch_row($result)
-{
-	global $DatabaseType;
+{	global $DatabaseType;
 
-	switch ($DatabaseType) {
+	switch($DatabaseType)
+	{
 		case 'mysqli':
 			$return = $result->fetch_assoc();
-			if (is_array($return)) {
-				foreach ($return as $key => $value) {
-					if (is_int($key))
+			if(is_array($return))
+			{
+				foreach($return as $key => $value)
+				{
+					if(is_int($key))
 						unset($return[$key]);
 				}
 			}
-			break;
+		break;
 	}
-	return @array_change_key_case($return, CASE_UPPER);
+	return @array_change_key_case($return,CASE_UPPER);
 }
 
 // returns code to go into SQL statement for accessing the next value of a sequence function db_seq_nextval($seqname)
 function db_seq_nextval($seqname)
-{
-	global $DatabaseType;
-
-	if ($DatabaseType == 'mysqli')
-		$seq = "fn_" . strtolower($seqname) . "()";
+{	global $DatabaseType;
 
+	if($DatabaseType=='mysqli')
+		$seq="fn_".strtolower($seqname)."()";
+		
 	return $seq;
 }
 
@@ -247,130 +291,138 @@ function db_seq_nextval($seqname)
 // DECODE and CASE-WHEN support
 
 function db_case($array)
-{
-	global $DatabaseType;
+{	global $DatabaseType;
 
-	$counter = 0;
-	if ($DatabaseType == 'mysqli') {
-		$array_count = count($array);
+	$counter=0;
+	if($DatabaseType=='mysqli')
+	{
+		$array_count=count($array);
 		$string = " CASE WHEN $array[0] =";
 		$counter++;
 		$arr_count = count($array);
-		for ($i = 1; $i < $arr_count; $i++) {
+		for($i=1;$i<$arr_count;$i++)
+		{
 			$value = $array[$i];
 
-			if ($value == "''" && substr($string, -1) == '=') {
+			if($value=="''" && substr($string,-1)=='=')
+			{
 				$value = ' IS NULL';
-				$string = substr($string, 0, -1);
+				$string = substr($string,0,-1);
 			}
 
-			$string .= "$value";
-			if ($counter == ($array_count - 2) && $array_count % 2 == 0)
-				$string .= " ELSE ";
-			elseif ($counter == ($array_count - 1))
-				$string .= " END ";
-			elseif ($counter % 2 == 0)
-				$string .= " WHEN $array[0]=";
-			elseif ($counter % 2 == 1)
-				$string .= " THEN ";
+			$string.="$value";
+			if($counter==($array_count-2) && $array_count%2==0)
+				$string.=" ELSE ";
+			elseif($counter==($array_count-1))
+				$string.=" END ";
+			elseif($counter%2==0)
+				$string.=" WHEN $array[0]=";
+			elseif($counter%2==1)
+				$string.=" THEN ";
 
 			$counter++;
 		}
 	}
-
+	
 	return $string;
 }
 
 
 function db_properties($table)
-{
-	global $DatabaseType, $DatabaseUsername;
+{	global $DatabaseType,$DatabaseUsername;
 
-	switch ($DatabaseType) {
+	switch($DatabaseType)
+	{
 		case 'mysqli':
 			$result = DBQuery("SHOW COLUMNS FROM $table");
-			while ($row = db_fetch_row($result)) {
-				$properties[strtoupper($row['FIELD'])]['TYPE'] = strtoupper($row['TYPE'], strpos($row['TYPE'], '('));
-				if (!$pos = strpos($row['TYPE'], ','))
-					$pos = strpos($row['TYPE'], ')');
+			while($row = db_fetch_row($result))
+			{
+				$properties[strtoupper($row['FIELD'])]['TYPE'] = strtoupper($row['TYPE'],strpos($row['TYPE'],'('));
+				if(!$pos = strpos($row['TYPE'],','))
+					$pos = strpos($row['TYPE'],')');
 				else
-					$properties[strtoupper($row['FIELD'])]['SCALE'] = substr($row['TYPE'], $pos + 1);
+					$properties[strtoupper($row['FIELD'])]['SCALE'] = substr($row['TYPE'],$pos+1);
 
-				$properties[strtoupper($row['FIELD'])]['SIZE'] = substr($row['TYPE'], strpos($row['TYPE'], '(') + 1, $pos);
+				$properties[strtoupper($row['FIELD'])]['SIZE'] = substr($row['TYPE'],strpos($row['TYPE'],'(')+1,$pos);
 
-				if ($row['NULL'] != '')
+				if($row['NULL']!='')
 					$properties[strtoupper($row['FIELD'])]['NULL'] = "Y";
 				else
 					$properties[strtoupper($row['FIELD'])]['NULL'] = "N";
 			}
-			break;
+		break;
 	}
 	return $properties;
 }
 
-function db_show_error($sql, $failnote, $additional = '')
-{
-	global $openSISTitle, $openSISVersion, $openSISNotifyAddress;
+function db_show_error($sql,$failnote,$additional='')
+{	global $openSISTitle,$openSISVersion,$openSISNotifyAddress;
 
 	PopTable('header', _error);
 	$tb = debug_backtrace();
 	$error = $tb[1]['file'] . " at " . $tb[1]['line'];
 	echo "
 		<TABLE CELLSPACING=10 BORDER=0>
-			<TD align=right><b>" . _date . ":</b></TD>
-			<TD><pre>" . date("m/d/Y h:i:s") . "</pre></TD>
+			<TD align=right><b>"._date.":</b></TD>
+			<TD><pre>".date("m/d/Y h:i:s")."</pre></TD>
 		</TR><TR>
-			<TD align=right><b>" . _failureNotice . ":</b></TD>
+			<TD align=right><b>"._failureNotice.":</b></TD>
 			<TD><pre> $failnote </pre></TD>
 		</TR><TR>
-			<TD align=right><b>" . _sql . ":</b></TD>
+			<TD align=right><b>"._sql.":</b></TD>
 			<TD>$sql</TD>
 		</TR>
 		</TR><TR>
-			<TD align=right><b>" . _traceback . ":</b></TD>
+			<TD align=right><b>"._traceback.":</b></TD>
 			<TD>$error</TD>
 		</TR>
 		</TR><TR>
-			<TD align=right><b>" . _additionalInformation . ":</b></TD>
+			<TD align=right><b>"._additionalInformation.":</b></TD>
 			<TD>$additional</TD>
 		</TR>
 		</TABLE>";
-	echo "
+		echo "
 		<TABLE CELLSPACING=10 BORDER=0>
-			<TR><TD align=right><b>" . _date . ":</TD>
-			<TD><pre>" . date("m/d/Y h:i:s") . "</pre></TD>
+			<TR><TD align=right><b>"._date.":</TD>
+			<TD><pre>".date("m/d/Y h:i:s")."</pre></TD>
 		</TR><TR>
 			<TD align=right></TD>
-			<TD>" . _openSisHasEncounteredAnErrorThatCouldHaveResultedFromAnyOfTheFollowing . ":
+			<TD>"._openSisHasEncounteredAnErrorThatCouldHaveResultedFromAnyOfTheFollowing.":
 			<br/>
 			<ul>
-			<li>" . _invalidDataInput . "</li>
-			<li>" . _databaseSqlError . "</li>
-			<li>" . _programError . "</li>
+			<li>"._invalidDataInput."</li>
+			<li>"._databaseSqlError."</li>
+			<li>"._programError."</li>
 			</ul>
 			
-			" . _pleaseTakeThisScreenShotAndSendItToYourOpenSisRepresentativeForDebuggingAndResolution . ".
+			"._pleaseTakeThisScreenShotAndSendItToYourOpenSisRepresentativeForDebuggingAndResolution.".
 			</TD>
 		</TR>
 		
 		</TABLE>";
 	//Something you have asked the system to do has thrown a database error.  A system administrator has been notified, and the problem will be fixed as soon as possible.  It might be that changing the input parameters sent to this program will cause it to run properly.  Thanks for your patience.
 	PopTable('footer');
-	echo "<!-- " . _sqlStatement . ": \n\n $sql \n\n -->";
+	echo "<!-- "._sqlStatement.": \n\n $sql \n\n -->";
 
+	
 
-
-	if ($openSISNotifyAddress) {
-		$message = "" . _system . ": $openSISTitle \n";
-		$message .= "" . _date . ": " . date("m/d/Y h:i:s") . "\n";
-		$message .= "" . _page . ": " . $_SERVER['PHP_SELF'] . ' ' . ProgramTitle() . " \n\n";
-		$message .= "" . _failureNotice . ":  $failnote \n";
-		$message .= "" . _additionalInfo . ": $additional \n";
+	if($openSISNotifyAddress)
+	{
+		$message = ""._system.": $openSISTitle \n";
+		$message .= ""._date.": ".date("m/d/Y h:i:s")."\n";
+		$message .= ""._page.": ".$_SERVER['PHP_SELF'].' '.ProgramTitle()." \n\n";
+		$message .= ""._failureNotice.":  $failnote \n";
+		$message .= ""._additionalInfo.": $additional \n";
 		$message .= "\n $sql \n";
-		$message .= "" . _requestArray . ": \n" . ShowVar($_REQUEST, 'Y', 'N');
-		$message .= "\n\n" . _sessionArray . ": \n" . ShowVar($_SESSION, 'Y', 'N');
-		mail($openSISNotifyAddress, _openSisDatabaseError, $message);
+		$message .= ""._requestArray.": \n".ShowVar($_REQUEST,'Y', 'N');
+		$message .= "\n\n"._sessionArray.": \n".ShowVar($_SESSION,'Y', 'N');
+		mail($openSISNotifyAddress,_openSisDatabaseError,$message);
+
 	}
 
 	die();
 }
+
+         
+
+?>

--- DownloadWindow.php ---
@@ -34,25 +34,41 @@
 
 if(isset($_REQUEST['down_id']) && $_REQUEST['down_id']!='')
 {
-    $downfile_info= DBGet(DBQuery('SELECT * FROM user_file_upload WHERE ID='.$down_id.''));
-        header("Cache-Control: public");
-        header("Pragma: ");
-        header("Expires: 0"); 
-        header("Cache-Control: must-revalidate, post-check=0, pre-check=0"); 
-        header("Cache-Control: private",false); // required for certain browsers 
-        header("Content-Length: ".$downfile_info[1]['SIZE']."");
-        header("Content-Type: ".$downfile_info[1]['TYPE']."");
-//        header("Content-Disposition: attachment; filename=\"".str_replace(' ','_',$downfile_info[1]['NAME'])."\";");
-        header("Content-Disposition: attachment; filename=\"".$downfile_info[1]['NAME']."\";");
-        header("Content-Transfer-Encoding: binary");
-        ob_clean();
-        flush();
+    $downfile_info= DBGet(DBQuery('SELECT * FROM user_file_upload WHERE DOWNLOAD_ID=\''.$down_id.'\''));
+    header("Cache-Control: public");
+    header("Pragma: ");
+    header("Expires: 0"); 
+    header("Cache-Control: must-revalidate, post-check=0, pre-check=0"); 
+    header("Cache-Control: private",false); // required for certain browsers 
+    header("Content-Length: ".$downfile_info[1]['SIZE']."");
+    header("Content-Type: ".$downfile_info[1]['TYPE']."");
+    // header("Content-Disposition: attachment; filename=\"".str_replace(' ','_',$downfile_info[1]['NAME'])."\";");
+    // header("Content-Disposition: attachment; filename=\"".$downfile_info[1]['NAME']."\";");
+    header("Content-Disposition: attachment; filename=\"".str_replace("opensis_space_here", " ", str_replace($downfile_info[1]['USER_ID']."-","",$downfile_info[1]['NAME']))."\";");
+    header("Content-Transfer-Encoding: binary");
+    ob_clean();
+    flush();
+
+    if(isset($_REQUEST['studentfile']) && $_REQUEST['studentfile']=='Y')
+    {
+        $filedata = @file_get_contents('assets/studentfiles/'.$downfile_info[1]['NAME']);
+        echo $filedata;
+    }
+    else if(isset($_REQUEST['userfile']) && $_REQUEST['userfile']=='Y')
+    {
+        $filedata = @file_get_contents('assets/stafffiles/'.$downfile_info[1]['NAME']);
+        echo $filedata;
+    }
+    else
+    {
         echo $downfile_info[1]['CONTENT'];
-        exit;
-}
-else
-{
-header('Content-Disposition: attachment; filename="'.urldecode($_REQUEST['name']).'" ');
-readfile('assets/'.urldecode($_REQUEST['filename']));
+    }
+    
+    exit;
 }
+// else
+// {
+//     header('Content-Disposition: attachment; filename="'.urldecode($_REQUEST['name']).'" ');
+//     readfile('assets/'.urldecode($_REQUEST['filename']));
+// }
 ?>

--- EmailCheck.php ---
@@ -1,19 +1,19 @@
 <?php
 #**************************************************************************
-#  openSIS is a free student information system for public and non-public 
+#  openSIS is a free student information system for public and non-public
 #  schools from Open Solutions for Education, Inc. web: www.os4ed.com
 #
-#  openSIS is  web-based, open source, and comes packed with features that 
-#  include student demographic info, scheduling, grade book, attendance, 
-#  report cards, eligibility, transcripts, parent portal, 
-#  student portal and more.   
+#  openSIS is  web-based, open source, and comes packed with features that
+#  include student demographic info, scheduling, grade book, attendance,
+#  report cards, eligibility, transcripts, parent portal,
+#  student portal and more.
 #
 #  Visit the openSIS web site at http://www.opensis.com to learn more.
-#  If you have question regarding this system or the license, please send 
+#  If you have question regarding this system or the license, please send
 #  an email to info@os4ed.com.
 #
-#  This program is released under the terms of the GNU General Public License as  
-#  published by the Free Software Foundation, version 2 of the License. 
+#  This program is released under the terms of the GNU General Public License as
+#  published by the Free Software Foundation, version 2 of the License.
 #  See license.txt.
 #
 #  This program is distributed in the hope that it will be useful,
@@ -25,36 +25,28 @@
 #  along with this program.  If not, see <http://www.gnu.org/licenses/>.
 #
 #***************************************************************************************
-include('RedirectRootInc.php'); 
-	include 'Warehouse.php';
-	include 'Data.php';
+include 'RedirectRootInc.php';
+include 'Warehouse.php';
+include 'Data.php';
 // include('functions/SqlSecurityFnc.php');
 
 $email = sqlSecurityFilter($_REQUEST['email']);
 $p_id = sqlSecurityFilter($_REQUEST['p_id']);
-        
-        if(isset($_REQUEST['email']) && $_REQUEST['email']!='')
-        {
-            if($_REQUEST['p_id']==0)
-            {
-        $result=DBGet(DBQuery('SELECT STAFF_ID FROM people WHERE EMAIL=\''.$email.'\''));
-        $res_stf=DBGet(DBQuery('SELECT STAFF_ID FROM staff WHERE EMAIL=\''.$email.'\''));
-        $res_stu=DBGet(DBQuery('SELECT STUDENT_ID FROM students WHERE EMAIL=\''.$email.'\''));
-            }
-            else
-            {
-        $result=DBGet(DBQuery('SELECT STAFF_ID FROM people WHERE EMAIL=\''.$email.'\' AND STAFF_ID!='.$p_id));    
-        $res_stf=DBGet(DBQuery('SELECT STAFF_ID FROM staff WHERE EMAIL=\''.$email.'\''));
-        $res_stu=DBGet(DBQuery('SELECT STUDENT_ID FROM students WHERE EMAIL=\''.$email.'\''));
-            }
-            if(count($result)>0 || count($res_stf)>0 ||  count($res_stu)>0)
-            {
-                echo '0_'.$_REQUEST['opt'];
-            }
-            else
-            {
-                echo '1_'.$_REQUEST['opt'];
-            }
-            exit;
-        }
-?>
+
+if (isset($_REQUEST['email']) && $_REQUEST['email'] != '') {
+    if ($_REQUEST['p_id'] == 0) {
+        $result = DBGet(DBQuery('SELECT STAFF_ID FROM people WHERE EMAIL=\'' . $email . '\''));
+        $res_stf = DBGet(DBQuery('SELECT STAFF_ID FROM staff WHERE EMAIL=\'' . $email . '\''));
+        $res_stu = DBGet(DBQuery('SELECT STUDENT_ID FROM students WHERE EMAIL=\'' . $email . '\''));
+    } else {
+        $result = DBGet(DBQuery('SELECT STAFF_ID FROM people WHERE EMAIL=\'' . $email . '\' AND STAFF_ID!=' . $p_id));
+        $res_stf = DBGet(DBQuery('SELECT STAFF_ID FROM staff WHERE EMAIL=\'' . $email . '\''));
+        $res_stu = DBGet(DBQuery('SELECT STUDENT_ID FROM students WHERE EMAIL=\'' . $email . '\''));
+    }
+    if (count($result) > 0 || count($res_stf) > 0 || count($res_stu) > 0) {
+        echo '0_' . urlencode($_REQUEST['opt']) {0};
+    } else {
+        echo '1_' . urlencode($_REQUEST['opt']) {0};
+    }
+    exit;
+}

--- ForgotPass.php ---
@@ -36,8 +36,7 @@
 include("lang/language.php");
 
 
-function DateInputAY($value, $name, $counter = 1, $placeholder = _enterDate)
-{
+function DateInputAY($value, $name, $counter = 1, $placeholder = _enterDate) {
 
     $show = "";
     $date_sep = "";
@@ -56,13 +55,12 @@ function DateInputAY($value, $name, $counter = 1, $placeholder = _enterDate)
     }
 }
 
-function db_start()
-{
+function db_start() {
     global $DatabaseServer, $DatabaseUsername, $DatabasePassword, $DatabaseName, $DatabasePort, $DatabaseType;
 
     switch ($DatabaseType) {
         case 'mysqli':
-            $connection = new mysqli($DatabaseServer, $DatabaseUsername, $DatabasePassword, $DatabaseName, $DatabasePort);
+            $connection = new mysqli($DatabaseServer, $DatabaseUsername, $DatabasePassword, $DatabaseName);
             break;
     }
 
@@ -73,16 +71,15 @@ function db_start()
                 $errormessage = mysqli_error($connection);
                 break;
         }
-        db_show_error("", "" . _couldNotConnectToDatabase . ": $DatabaseServer", $errormessage);
+        db_show_error("", ""._couldNotConnectToDatabase.": $DatabaseServer", $errstring);
     }
     return $connection;
 }
 
 // This function connects, and does the passed query, then returns a connection identifier.
 // Not receiving the return == unusable search.
 //		ie, $processable_results = DBQuery("select * from students");
-function DBQuery($sql)
-{
+function DBQuery($sql) {
     global $DatabaseType, $_openSIS;
 
     $connection = db_start();
@@ -121,8 +118,7 @@ function DBQuery($sql)
 }
 
 // return next row.
-function db_fetch_row($result)
-{
+function db_fetch_row($result) {
     global $DatabaseType;
 
     switch ($DatabaseType) {
@@ -140,8 +136,7 @@ function db_fetch_row($result)
 }
 
 // returns code to go into SQL statement for accessing the next value of a sequence function db_seq_nextval($seqname)
-function db_seq_nextval($seqname)
-{
+function db_seq_nextval($seqname) {
     global $DatabaseType;
 
     if ($DatabaseType == 'mysqli')
@@ -150,8 +145,7 @@ function db_seq_nextval($seqname)
     return $seq;
 }
 
-function db_case($array)
-{
+function db_case($array) {
     global $DatabaseType;
 
     $counter = 0;
@@ -168,24 +162,23 @@ function db_case($array)
                 $string = substr($string, 0, -1);
             }
 
-            $string .= "$value";
+            $string.="$value";
             if ($counter == ($array_count - 2) && $array_count % 2 == 0)
-                $string .= " ELSE ";
+                $string.=" ELSE ";
             elseif ($counter == ($array_count - 1))
-                $string .= " END ";
+                $string.=" END ";
             elseif ($counter % 2 == 0)
-                $string .= " WHEN $array[0]=";
+                $string.=" WHEN $array[0]=";
             elseif ($counter % 2 == 1)
-                $string .= " THEN ";
+                $string.=" THEN ";
 
             $counter++;
         }
     }
     return $string;
 }
 
-function db_properties($table)
-{
+function db_properties($table) {
     global $DatabaseType, $DatabaseUsername;
 
     switch ($DatabaseType) {
@@ -210,49 +203,48 @@ function db_properties($table)
     return $properties;
 }
 
-function db_show_error($sql, $failnote, $additional = '')
-{
+function db_show_error($sql, $failnote, $additional = '') {
     global $openSISTitle, $openSISVersion, $openSISNotifyAddress, $openSISMode;
 
     $tb = debug_backtrace();
     $error = $tb[1]['file'] . " at " . $tb[1]['line'];
 
     echo "
                     <TABLE CELLSPACING=10 BORDER=0>
-                            <TD align=right><b>" . _date . ":</TD>
+                            <TD align=right><b>"._date.":</TD>
                             <TD><pre>" . date("m/d/Y h:i:s") . "</pre></TD>
                     </TR><TR>
-                            <TD align=right><b>" . _failureNotice . ":</b></TD>
+                            <TD align=right><b>"._failureNotice.":</b></TD>
                             <TD><pre> $failnote </pre></TD>
                     </TR><TR>
-                            <TD align=right><b>" . _sql . ":</b></TD>
+                            <TD align=right><b>"._sql.":</b></TD>
                             <TD>$sql</TD>
                     </TR>
                     </TR><TR>
-                            <TD align=right><b>" . _traceback . ":</b></TD>
+                            <TD align=right><b>"._traceback.":</b></TD>
                             <TD>$error</TD>
                     </TR>
                     </TR><TR>
-                            <TD align=right><b>" . _additionalInformation . ":</b></TD>
+                            <TD align=right><b>"._additionalInformation.":</b></TD>
                             <TD>$additional</TD>
                     </TR>
                     </TABLE>";
 
     echo "
 		<TABLE CELLSPACING=10 BORDER=0>
-			<TR><TD align=right><b>" . _date . ":</TD>
+			<TR><TD align=right><b>"._date.":</TD>
 			<TD><pre>" . date("m/d/Y h:i:s") . "</pre></TD>
 		</TR><TR>
 			<TD align=right></TD>
-			<TD>" . _openSisHasEncounteredAnErrorThatCouldHaveResultedFromAnyOfTheFollowing . ":
+			<TD>"._openSisHasEncounteredAnErrorThatCouldHaveResultedFromAnyOfTheFollowing.":
 			<br/>
 			<ul>
-			<li>" . _invalidDataInput . "</li>
-			<li>" . _databaseSqlError . "</li>
-			<li>" . _programError . "</li>
+			<li>"._invalidDataInput."</li>
+			<li>"._databaseSqlError."</li>
+			<li>"._programError."</li>
 			</ul>
 			
-			" . _pleaseTakeThisScreenShotAndSendItToYourOpenSisRepresentativeForDebuggingAndResolution . ".
+			"._pleaseTakeThisScreenShotAndSendItToYourOpenSisRepresentativeForDebuggingAndResolution.".
 			</TD>
 		</TR>
 		
@@ -279,226 +271,224 @@ function db_show_error($sql, $failnote, $additional = '')
 ?>
 <!DOCTYPE html>
 <html lang="en">
-
-<head>
-    <meta charset="utf-8">
-    <meta http-equiv="X-UA-Compatible" content="IE=edge">
-    <meta name="viewport" content="width=device-width, initial-scale=1">
-    <title>openSIS Student Information System</title>
-    <link rel="shortcut icon" href="favicon.ico">
-    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
-    <link href="styles/fonts/font-awesome/css/font-awesome.min.css" rel="stylesheet">
-    <link href="assets/css/icons/icomoon/styles.css" rel="stylesheet" type="text/css">
-    <link rel="stylesheet" type="text/css" href="assets/css/bootstrap.min.css">
-    <link rel="stylesheet" type="text/css" href="assets/css/login.css">
-    <script src='js/Ajaxload.js'></script>
-    <script src='js/Validation.js'></script>
-    <script src='js/Validator.js'></script>
-    <script src='js/ForgotPass.js'></script>
-    <script type='text/javascript'>
-        function init(param, param2) {
-            calendar.set('date_' + param);
-            document.getElementById('date_' + param).click();
-        }
-    </script>
-
-    <script src="assets/js/core/libraries/jquery.min.js"></script>
-    <script src="assets/js/core/libraries/bootstrap.min.js"></script>
-    <script src="assets/js/plugins/ui/moment/moment.min.js"></script>
-    <script src="assets/js/plugins/pickers/datepicker.js"></script>
-    <script type="text/javascript">
-        $(document).ready(function() {
-            $('.daterange-single').datepicker({
-                autoclose: true
-            });
-            $('.daterange-single').datepicker().on('changeDate', function(ev, picker) {
-                var dateText = $(this).val();
-                var pieces = dateText.split("/");
-                var getID = $(this).attr('id').split("_");
-                var parent = $(this).closest('.form-group');
-                parent.children("#monthSelect" + getID[1]).val(pieces[0]);
-                parent.children("#daySelect" + getID[1]).val(pieces[1]);
-                parent.children("#yearSelect" + getID[1]).val(pieces[2]);
-            });
-
-            $('.daterange-single').each(function() {
-                var placeholderText = $(this).attr('data-placeholder');
-                $('.daterange-single').attr('placeholder', placeholderText).val('');
+    <head>
+        <meta charset="utf-8">
+        <meta http-equiv="X-UA-Compatible" content="IE=edge">
+        <meta name="viewport" content="width=device-width, initial-scale=1">
+        <title>openSIS Student Information System</title>
+        <link rel="shortcut icon" href="favicon.ico">
+        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
+        <link href="styles/fonts/font-awesome/css/font-awesome.min.css" rel="stylesheet">
+        <link href="assets/css/icons/icomoon/styles.css" rel="stylesheet" type="text/css">
+        <link rel="stylesheet" type="text/css" href="assets/css/bootstrap.min.css">
+        <link rel="stylesheet" type="text/css" href="assets/css/login.css">
+        <script src='js/Ajaxload.js'></script>
+        <script src='js/Validation.js'></script>
+        <script src='js/Validator.js'></script>
+        <script src='js/ForgotPass.js'></script>
+        <script type='text/javascript'>
+            function init(param, param2) {
+                calendar.set('date_' + param);
+                document.getElementById('date_' + param).click();
+            }
+        </script>
+
+        <script src="assets/js/core/libraries/jquery.min.js"></script>
+        <script src="assets/js/core/libraries/bootstrap.min.js"></script>
+        <script src="assets/js/plugins/ui/moment/moment.min.js"></script>
+        <script src="assets/js/plugins/pickers/datepicker.js"></script>
+        <script type="text/javascript">
+            $(document).ready(function () {
+                $('.daterange-single').datepicker({
+                    autoclose: true
+                });
+                $('.daterange-single').datepicker().on('changeDate', function(ev, picker) {
+                    var dateText = $(this).val();
+                    var pieces = dateText.split("/");
+                    var getID = $(this).attr('id').split("_");
+                    var parent = $(this).closest('.form-group');
+                    parent.children("#monthSelect" + getID[1]).val(pieces[0]);
+                    parent.children("#daySelect" + getID[1]).val(pieces[1]);
+                    parent.children("#yearSelect" + getID[1]).val(pieces[2]);
+                });
+
+                $('.daterange-single').each(function () {
+                    var placeholderText = $(this).attr('data-placeholder');
+                    $('.daterange-single').attr('placeholder', placeholderText).val('');
+                });
+
+                var monthNames = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
+                var dayNames = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"]
+
+
+                var newDate = new Date();
+
+                newDate.setDate(newDate.getDate());
+
+                $('#Date').html(dayNames[newDate.getDay()] + ", " + monthNames[newDate.getMonth()] + ' ' + newDate.getDate() + ', ' + newDate.getFullYear());
+
+
+
+                setInterval(function () {
+                    // Create a newDate() object and extract the minutes of the current time on the visitor's
+                    var minutes = new Date().getMinutes();
+                    // Add a leading zero to the minutes value
+                    $("#min").html((minutes < 10 ? "0" : "") + minutes);
+                }, 1000);
+
+                setInterval(function () {
+                    // Create a newDate() object and extract the hours of the current time on the visitor's
+                    var hours = new Date().getHours();
+                    // Add a leading zero to the hours value
+                    $("#hours").html((hours < 10 ? "0" : "") + hours);
+                }, 1000);
             });
+        </script>
+        <!--custom script-->
+        <script src="js/custom.js"></script>
+    </head>
+    <body>
+
+        <div class="clock">
+            <ul>
+                <li id="hours"></li>
+                <li id="point">:</li>
+                <li id="min"></li>
+            </ul>
+            <div id="Date"></div>
+        </div>
+        <section class="section-forgot-password">
+            <div class="login-wrapper clearfix">
 
-            var monthNames = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
-            var dayNames = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"]
-
-
-            var newDate = new Date();
-
-            newDate.setDate(newDate.getDate());
-
-            $('#Date').html(dayNames[newDate.getDay()] + ", " + monthNames[newDate.getMonth()] + ' ' + newDate.getDate() + ', ' + newDate.getFullYear());
+                <div class="panel">
 
+                    <div class="panel-heading">
+                        <div class="logo">
+                            <img src="assets/images/opensis_logo.png" alt="openSIS" />
+                        </div>
+                    </div>
 
+                    <div class="panel-inside">
+                        <div class="panel-heading">
+                            <ul class="forgot-tabs clearfix">
+                                <li class="active"><a data-toggle="tab" href="#forgot_password"><?=_forgotPassword?></a></li>
+                                <li><a data-toggle="tab" href="#forgot_username"><?=_forgotUsername?></a></li>
+                            </ul>
+                        </div>
+                        <div class="panel-body">
 
-            setInterval(function() {
-                // Create a newDate() object and extract the minutes of the current time on the visitor's
-                var minutes = new Date().getMinutes();
-                // Add a leading zero to the minutes value
-                $("#min").html((minutes < 10 ? "0" : "") + minutes);
-            }, 1000);
+ <div class="tab-content">
+<div id="forgot_password" class="tab-pane fade in active">
+ <form name="f1" id="f1" method="post" action="ResetUserInfo.php">
+ <div class="form-group">
+ <label><?=_iAmA?></label>
+    <div class="radio styled-radio">
+<label><input type="radio" name="pass_user_type" id="pass_student" value="pass_student" checked="checked" onclick="show_fields('student');
+forgotpassusername_init(this.value);" /><span></span><?=_student?></label>
 
-            setInterval(function() {
-                // Create a newDate() object and extract the hours of the current time on the visitor's
-                var hours = new Date().getHours();
-                // Add a leading zero to the hours value
-                $("#hours").html((hours < 10 ? "0" : "") + hours);
-            }, 1000);
-        });
-    </script>
-    <!--custom script-->
-    <script src="js/custom.js"></script>
-</head>
 
-<body>
+ <label><input type="radio" name="pass_user_type" id="pass_staff" value="pass_staff" onclick="show_fields('staff');
+ forgotpassusername_init(this.value);
+ forgotpassemail_init('pass_email');" /><span></span><?=_teacher?></label>
+<label><input type="radio" name="pass_user_type" id="pass_parent" value="pass_parent" onclick="show_fields('parent');  forgotpassusername_init(this.value);
+   forgotpassemail_init('pass_email');" /><span></span><?=_parent?></label>
+ </div>
+ <input type="hidden" name="pass_type_form" id="pass_type_form" value="password"/>
 
-    <div class="clock">
-        <ul>
-            <li id="hours"></li>
-            <li id="point">:</li>
-            <li id="min"></li>
-        </ul>
-        <div id="Date"></div>
     </div>
-    <section class="section-forgot-password">
-        <div class="login-wrapper clearfix">
-
-            <div class="panel">
-
-                <div class="panel-heading">
-                    <div class="logo">
-                        <img src="assets/images/opensis_logo.png" alt="openSIS" />
-                    </div>
-                </div>
-
-                <div class="panel-inside">
-                    <div class="panel-heading">
-                        <ul class="forgot-tabs clearfix">
-                            <li class="active"><a data-toggle="tab" href="#forgot_password"><?= _forgotPassword ?></a></li>
-                            <li><a data-toggle="tab" href="#forgot_username"><?= _forgotUsername ?></a></li>
-                        </ul>
-                    </div>
-                    <div class="panel-body">
-
-                        <div class="tab-content">
-                            <div id="forgot_password" class="tab-pane fade in active">
-                                <form name="f1" id="f1" method="post" action="ResetUserInfo.php">
-                                    <div class="form-group">
-                                        <label><?= _iAmA ?></label>
-                                        <div class="radio styled-radio">
-                                            <label><input type="radio" name="pass_user_type" id="pass_student" value="pass_student" checked="checked" onclick="show_fields('student');
-forgotpassusername_init(this.value);" /><span></span><?= _student ?></label>
-
+    <input type="hidden" id="valid_func" value="N"/>
+    <div id="divErr">
+<?php
+if ($_SESSION['err_msg'] != '')
+    echo $_SESSION['err_msg'];
+ unset($_SESSION['err_msg']);
+                                            ?>
+                                        </div>
 
-                                            <label><input type="radio" name="pass_user_type" id="pass_staff" value="pass_staff" onclick="show_fields('staff');
- forgotpassusername_init(this.value);
- forgotpassemail_init('pass_email');" /><span></span><?= _teacher ?></label>
-                                            <label><input type="radio" name="pass_user_type" id="pass_parent" value="pass_parent" onclick="show_fields('parent');  forgotpassusername_init(this.value);
-   forgotpassemail_init('pass_email');" /><span></span><?= _parent ?></label>
+                                        <div class="form-group" id="pass_stu_id">
+                                            <input type="text" name="password_stn_id" id="password_stn_id" placeholder="<?= _studentId ?>" class="form-control" onkeydown="return numberOnly(event);" onblur="return check_input_val(this.value, 'password_stn_id');"/>
                                         </div>
-                                        <input type="hidden" name="pass_type_form" id="pass_type_form" value="password" />
-
-                                    </div>
-                                    <input type="hidden" id="valid_func" value="N" />
-                                    <div id="divErr">
-                                        <?php
-                                        if ($_SESSION['err_msg'] != '')
-                                            echo $_SESSION['err_msg'];
-                                        unset($_SESSION['err_msg']);
-                                        ?>
-                                    </div>
-
-                                    <div class="form-group" id="pass_stu_id">
-                                        <input type="text" name="password_stn_id" id="password_stn_id" placeholder="<?= _studentId ?>" class="form-control" onkeydown="return numberOnly(event);" onblur="return check_input_val(this.value, 'password_stn_id');" />
-                                    </div>
-                                    <div class="form-group">
-                                        <input type="text" name="uname" id="uname" placeholder="<?= _username ?>" class="form-control" onkeydown=" return withoutspace_forgotpass(event);" onblur="return withoutspace_forgotpass(event);" />
-                                        <span style="display: none" id="calculating"><img src="assets/ajax_loader.gif" /></span>
-                                        <p id="err_msg"></p>
-                                    </div>
-                                    <div class="form-group" id="pass_stu_dob">
-                                        <?php echo DateInputAY('', 'password_dob', 3, _dateOfBirth) ?>
-                                    </div>
-                                    <div id="pass_stf_email" class="form-group" style="display: none">
-                                        <input type="hidden" name="pass_email" id="pass_email" value="" />
-                                        <input type="text" name="password_stf_email" id="password_stf_email" placeholder="<?= _emailAddress ?>" class="form-control" onblur="forgotpassemail_init('pass_email');" />
-                                        <span style="display: none" id="pass_calculating_email"><img src="assets/ajax_loader.gif" />
-                                        </span>
-                                        <span id="pass_err_msg_email">
-
-                                        </span>
-                                    </div>
-                                    <div class="row">
-                                        <div class="col-xs-6">
-                                            <input type="submit" class="btn btn-success btn-lg btn-block" value="<?= _confirm ?>" />
+                                        <div class="form-group">
+                                            <input type="text" name="uname" id="uname" placeholder="<?=_username?>" class="form-control" onkeydown=" return withoutspace_forgotpass(event);" onblur="return withoutspace_forgotpass(event);"/>
+                                            <span style="display: none" id="calculating"><img src="assets/ajax_loader.gif"/></span>
+                                            <p id="err_msg"></p>
                                         </div>
-                                        <div class="col-xs-6">
-                                            <a href="index.php?language=<?= $_SESSION['language'] ?>" class="btn btn-default btn-rounded btn-lg btn-block"><?= _cancel ?></a>
+                                        <div class="form-group" id="pass_stu_dob">
+                                            <?php echo DateInputAY('', 'password_dob', 3, _dateOfBirth) ?>
                                         </div>
-                                    </div>
-                                </form>
-                            </div>
-                            <div id="forgot_username" class="tab-pane fade">
-                                <form name="f1" id="f1" method="post" action="ResetUserInfo.php">
-                                    <div class="form-group">
-                                        <label><?= _iAmA ?></label>
-                                        <div class="radio styled-radio">
-                                            <label onclick="uname_show_fields('student')"><input type="radio" name="uname_user_type" id="uname_student" value="uname_student" checked="checked" /><span></span><?= _student ?></label>
-                                            <label onclick="uname_show_fields('staff');
-                                                        forgotpassemail_init('uname_email');"><input type="radio" name="uname_user_type" id="uname_staff" value="uname_staff" /><span></span><?= _teacher ?></label>
-                                            <label onclick="uname_show_fields('parent');
-                                                        forgotpassemail_init('uname_email');"><input type="radio" name="uname_user_type" id="uname_parent" value="uname_parent" /><span></span><?= _parent ?></label>
+                                        <div id="pass_stf_email" class="form-group" style="display: none">
+                                            <input type="hidden" name="pass_email" id="pass_email" value=""/>
+                                            <input type="text" name="password_stf_email" id="password_stf_email" placeholder="<?=_emailAddress?>" class="form-control" onblur="forgotpassemail_init('pass_email');" />
+                                            <span style="display: none" id="pass_calculating_email"><img src="assets/ajax_loader.gif"/>
+                                            </span>
+                                            <span id="pass_err_msg_email">
+                                                
+                                            </span>
+                                        </div>
+                                        <div class="row">
+                                            <div class="col-xs-6">
+                                                <input type="submit" class="btn btn-success btn-lg btn-block" value="<?=_confirm?>" />
+                                            </div>
+                                            <div class="col-xs-6">
+                                                <a href="index.php?language=<?=$_SESSION['language']?>" class="btn btn-default btn-rounded btn-lg btn-block"><?=_cancel?></a>
+                                            </div>
+                                        </div>
+                                    </form>
+                                </div>
+                                <div id="forgot_username" class="tab-pane fade">
+                                    <form name="f1" id="f1" method="post" action="ResetUserInfo.php">
+                                        <div class="form-group">
+                                            <label><?=_iAmA?></label>
+                                            <div class="radio styled-radio">
+                                                <label onclick="uname_show_fields('student')"><input type="radio" name="uname_user_type" id="uname_student" value="uname_student" checked="checked" /><span></span><?=_student?></label>
+                                                <label onclick="uname_show_fields('staff');
+                                                        forgotpassemail_init('uname_email');"><input type="radio" name="uname_user_type" id="uname_staff" value="uname_staff" /><span></span><?=_teacher?></label>
+                                                <label onclick="uname_show_fields('parent');
+                                                        forgotpassemail_init('uname_email');"><input type="radio" name="uname_user_type" id="uname_parent" value="uname_parent" /><span></span><?=_parent?></label>
+                                            </div>                                            
+                                            <input type="hidden" name="user_type_form" id="user_type_form" value="username" />                                            
+
+                                        </div>
+                                        <div class="form-group" id="uname_stu_id">
+                                            <input type="text" name="username_stn_id" id="username_stn_id" class="form-control" placeholder="<?=_studentId?>" onblur="return check_input_val(this.value, 'username_stn_id');" onkeydown="return numberOnly(event);"/>
                                         </div>
-                                        <input type="hidden" name="user_type_form" id="user_type_form" value="username" />
-
-                                    </div>
-                                    <div class="form-group" id="uname_stu_id">
-                                        <input type="text" name="username_stn_id" id="username_stn_id" class="form-control" placeholder="<?= _studentId ?>" onblur="return check_input_val(this.value, 'username_stn_id');" onkeydown="return numberOnly(event);" />
-                                    </div>
-                                    <div class="form-group">
-                                        <input type="password" name="pass" id="pass" class="form-control" placeholder="<?= _password ?>" />
-                                    </div>
-                                    <div class="form-group" id="uname_stu_dob">
-                                        <?php echo DateInputAY('', 'username_dob', 2, _dateOfBirth) ?>
-                                    </div>
-                                    <div class="form-group" id="uname_stf_email" style="display: none">
-                                        <input type="hidden" name="un_email" id="un_email" value="" />
-                                        <input type="text" name="username_stf_email" id="username_stf_email" class="form-control" placeholder="<?= _emailAddress ?>" onblur="forgotpassemail_init('uname_email');" />
-                                        <span style="display: none" id="uname_calculating_email"><img src="assets/ajax_loader.gif" /></span>
-                                        <span id="uname_err_msg_email"></span>
-                                    </div>
-                                    <div class="row">
-                                        <div class="col-xs-6">
-                                            <input type="submit" class="btn btn-success btn-lg btn-block" name="save" onClick="return forgotusername();" value="<?= _confirm ?>" />
+                                        <div class="form-group">
+                                            <input type="password" name="pass" id="pass" class="form-control" placeholder="<?=_password?>" />
                                         </div>
-                                        <div class="col-xs-6">
-                                            <a href="index.php?language=<?= $_SESSION['language'] ?>" class="btn btn-default btn-rounded btn-lg btn-block"><?= _cancel ?></a>
+                                        <div class="form-group" id="uname_stu_dob">
+                                            <?php echo DateInputAY('', 'username_dob', 2, _dateOfBirth) ?>
+                                        </div>                                        
+                                        <div class="form-group" id="uname_stf_email" style="display: none">
+                                            <input type="hidden" name="un_email" id="un_email" value=""/>
+                                            <input type="text" name="username_stf_email" id="username_stf_email" class="form-control" placeholder="<?=_emailAddress?>" onblur="forgotpassemail_init('uname_email');" />
+                                            <span style="display: none" id="uname_calculating_email"><img src="assets/ajax_loader.gif"/></span>
+                                            <span id="uname_err_msg_email"></span>
                                         </div>
-                                    </div>
-                                </form>
+                                        <div class="row">
+                                            <div class="col-xs-6">
+                                                <input type="submit" class="btn btn-success btn-lg btn-block" name="save" onClick="return forgotusername();" value="<?=_confirm?>" />
+                                            </div>
+                                            <div class="col-xs-6">
+                                                <a href="index.php?language=<?=$_SESSION['language']?>" class="btn btn-default btn-rounded btn-lg btn-block"><?=_cancel?></a>
+                                            </div>
+                                        </div>
+                                    </form>
+                                </div>
                             </div>
+                            </form>
                         </div>
-                        </form>
                     </div>
-                </div>
-                <!--                    <div class="panel-footer">
+                    <!--                    <div class="panel-footer">
                                             <p class="info-text"><?php echo $log_msg[1]['MESSAGE']; ?></p>
                                         </div>-->
+                </div>
+                <footer>
+                    <!-- openSIS is a product of Open Solutions for Education, Inc. (<a href='http://www.os4ed.com' target='_blank'>OS4ED</a>) and is licensed under the <a href='http://www.gnu.org/licenses/gpl.html' target='_blank'>GPL license</a>. -->
+                    <?=_footerText?>
+                </footer>
             </div>
-            <footer>
-                <!-- openSIS is a product of Open Solutions for Education, Inc. (<a href='http://www.os4ed.com' target='_blank'>OS4ED</a>) and is licensed under the <a href='http://www.gnu.org/licenses/gpl.html' target='_blank'>GPL license</a>. -->
-                <?= _footerText ?>
-            </footer>
-        </div>
-    </section>
+        </section>
 
-</body>
+    </body>
+</html>
 
-</html>
\ No newline at end of file

--- ForgotPassUserName.php ---
@@ -30,23 +30,25 @@
 include("functions/DbGetFnc.php");
 require_once("functions/PragRepFnc.php");
 function db_start()
-{
-	global $DatabaseServer, $DatabaseUsername, $DatabasePassword, $DatabaseName, $DatabasePort, $DatabaseType;
+{	global $DatabaseServer,$DatabaseUsername,$DatabasePassword,$DatabaseName,$DatabasePort,$DatabaseType;
 
-	switch ($DatabaseType) {
+	switch($DatabaseType)
+	{
 		case 'mysqli':
-			$connection = new mysqli($DatabaseServer, $DatabaseUsername, $DatabasePassword, $DatabaseName, $DatabasePort);
-			break;
+                    $connection = new mysqli($DatabaseServer,$DatabaseUsername,$DatabasePassword,$DatabaseName);
+		break;
 	}
 
 	// Error code for both.
-	if ($connection === false) {
-		switch ($DatabaseType) {
+	if($connection === false)
+	{
+		switch($DatabaseType)
+		{
 			case 'mysqli':
 				$errormessage = mysqli_error($connection);
-				break;
+			break;
 		}
-		db_show_error("", "" . _couldNotConnectToDatabase . ": $DatabaseServer", $errormessage);
+		db_show_error("",""._couldNotConnectToDatabase.": $DatabaseServer",$errstring);
 	}
 	return $connection;
 }
@@ -55,145 +57,156 @@ function db_start()
 // Not receiving the return == unusable search.
 //		ie, $processable_results = DBQuery("select * from students");
 function DBQuery($sql)
-{
-	global $DatabaseType, $_openSIS;
+{	global $DatabaseType,$_openSIS;
 
 	$connection = db_start();
 
-	switch ($DatabaseType) {
+	switch($DatabaseType)
+	{
 		case 'mysqli':
 			$sql = str_replace('&amp;', "", $sql);
 			$sql = str_replace('&quot', "", $sql);
 			$sql = str_replace('&#039;', "", $sql);
 			$sql = str_replace('&lt;', "", $sql);
 			$sql = str_replace('&gt;', "", $sql);
-			$sql = par_rep("/([,\(=])[\r\n\t ]*''/", '\\1NULL', $sql);
-			if (preg_match_all("/'(\d\d-[A-Za-z]{3}-\d{2,4})'/", $sql, $matches)) {
-				foreach ($matches[1] as $match) {
-					$dt = date('Y-m-d', strtotime($match));
-					$sql = par_rep("/'$match'/", "'$dt'", $sql);
+		  	$sql = par_rep("/([,\(=])[\r\n\t ]*''/",'\\1NULL',$sql);
+			if(preg_match_all("/'(\d\d-[A-Za-z]{3}-\d{2,4})'/",$sql,$matches))
+				{
+					foreach($matches[1] as $match)
+					{
+						$dt = date('Y-m-d',strtotime($match));
+						$sql = par_rep("/'$match'/","'$dt'",$sql);
+					}
 				}
-			}
-			if (substr($sql, 0, 6) == "BEGIN;") {
-				$array = explode(";", $sql);
-				foreach ($array as $value) {
-					if ($value != "") {
-						$result = $connection->query($value);
-						if (!$result) {
-							$connection->query("ROLLBACK");
-							die(db_show_error($sql, _dbExecuteFailed, mysql_error()));
+			if(substr($sql,0,6)=="BEGIN;")
+			{
+				$array = explode( ";", $sql );
+				foreach( $array as $value )
+				{
+					if($value!="")
+					{
+                                             $result = $connection->query($value);
+						if(!$result)
+						{
+                                                    $connection->query("ROLLBACK");
+							die(db_show_error($sql,_dbExecuteFailed,mysql_error()));
 						}
 					}
 				}
-			} else {
-				$result = $connection->query($sql) or die(db_show_error($sql, _dbExecuteFailed, mysql_error()));
 			}
-			break;
+			else
+			{
+				$result =$connection->query($sql) or die(db_show_error($sql,_dbExecuteFailed,mysql_error()));
+			}
+		break;
 	}
 	return $result;
 }
 
 // return next row.
 function db_fetch_row($result)
-{
-	global $DatabaseType;
+{	global $DatabaseType;
 
-	switch ($DatabaseType) {
+	switch($DatabaseType)
+	{
 		case 'mysqli':
-			$return = $result->fetch_assoc();
-			if (is_array($return)) {
-				foreach ($return as $key => $value) {
-					if (is_int($key))
+                    $return = $result->fetch_assoc();
+			if(is_array($return))
+			{
+				foreach($return as $key => $value)
+				{
+					if(is_int($key))
 						unset($return[$key]);
 				}
 			}
-			break;
+		break;
 	}
-	return @array_change_key_case($return, CASE_UPPER);
+	return @array_change_key_case($return,CASE_UPPER);
 }
 
 // returns code to go into SQL statement for accessing the next value of a sequence function db_seq_nextval($seqname)
 function db_seq_nextval($seqname)
-{
-	global $DatabaseType;
+{	global $DatabaseType;
 
-	if ($DatabaseType == 'mysqli')
-		$seq = "fn_" . strtolower($seqname) . "()";
+	if($DatabaseType=='mysqli')
+		$seq="fn_".strtolower($seqname)."()";
 	return $seq;
 }
 
 function db_case($array)
-{
-	global $DatabaseType;
-	$counter = 0;
-	if ($DatabaseType == 'mysqli') {
-		$array_count = count($array);
+{	global $DatabaseType;
+$counter=0;
+	if($DatabaseType=='mysqli')
+	{
+		$array_count=count($array);
 		$string = " CASE WHEN $array[0] =";
 		$counter++;
 		$arr_count = count($array);
-		for ($i = 1; $i < $arr_count; $i++) {
+		for($i=1;$i<$arr_count;$i++)
+		{
 			$value = $array[$i];
 
-			if ($value == "''" && substr($string, -1) == '=') {
+			if($value=="''" && substr($string,-1)=='=')
+			{
 				$value = ' IS NULL';
-				$string = substr($string, 0, -1);
+				$string = substr($string,0,-1);
 			}
 
-			$string .= "$value";
-			if ($counter == ($array_count - 2) && $array_count % 2 == 0)
-				$string .= " ELSE ";
-			elseif ($counter == ($array_count - 1))
-				$string .= " END ";
-			elseif ($counter % 2 == 0)
-				$string .= " WHEN $array[0]=";
-			elseif ($counter % 2 == 1)
-				$string .= " THEN ";
+			$string.="$value";
+			if($counter==($array_count-2) && $array_count%2==0)
+				$string.=" ELSE ";
+			elseif($counter==($array_count-1))
+				$string.=" END ";
+			elseif($counter%2==0)
+				$string.=" WHEN $array[0]=";
+			elseif($counter%2==1)
+				$string.=" THEN ";
 
 			$counter++;
 		}
 	}
-
+	
 	return $string;
 }
 
 function db_properties($table)
-{
-	global $DatabaseType, $DatabaseUsername;
+{	global $DatabaseType,$DatabaseUsername;
 
-	switch ($DatabaseType) {
+	switch($DatabaseType)
+	{
 		case 'mysqli':
 			$result = DBQuery("SHOW COLUMNS FROM $table");
-			while ($row = db_fetch_row($result)) {
-				$properties[strtoupper($row['FIELD'])]['TYPE'] = strtoupper($row['TYPE'], strpos($row['TYPE'], '('));
-				if (!$pos = strpos($row['TYPE'], ','))
-					$pos = strpos($row['TYPE'], ')');
+			while($row = db_fetch_row($result))
+			{
+				$properties[strtoupper($row['FIELD'])]['TYPE'] = strtoupper($row['TYPE'],strpos($row['TYPE'],'('));
+				if(!$pos = strpos($row['TYPE'],','))
+					$pos = strpos($row['TYPE'],')');
 				else
-					$properties[strtoupper($row['FIELD'])]['SCALE'] = substr($row['TYPE'], $pos + 1);
+					$properties[strtoupper($row['FIELD'])]['SCALE'] = substr($row['TYPE'],$pos+1);
 
-				$properties[strtoupper($row['FIELD'])]['SIZE'] = substr($row['TYPE'], strpos($row['TYPE'], '(') + 1, $pos);
+				$properties[strtoupper($row['FIELD'])]['SIZE'] = substr($row['TYPE'],strpos($row['TYPE'],'(')+1,$pos);
 
-				if ($row['NULL'] != '')
+				if($row['NULL']!='')
 					$properties[strtoupper($row['FIELD'])]['NULL'] = "Y";
 				else
 					$properties[strtoupper($row['FIELD'])]['NULL'] = "N";
 			}
-			break;
+		break;
 	}
 	return $properties;
 }
 
-function db_show_error($sql, $failnote, $additional = '')
-{
-	global $openSISTitle, $openSISVersion, $openSISNotifyAddress, $openSISMode;
-
+function db_show_error($sql,$failnote,$additional='')
+{	global $openSISTitle,$openSISVersion,$openSISNotifyAddress,$openSISMode;
 
+	
 	$tb = debug_backtrace();
 	$error = $tb[1]['file'] . " at " . $tb[1]['line'];
-
-	echo "
+        
+            echo "
                     <TABLE CELLSPACING=10 BORDER=0>
                             <TD align=right><b>Date:</TD>
-                            <TD><pre>" . date("m/d/Y h:i:s") . "</pre></TD>
+                            <TD><pre>".date("m/d/Y h:i:s")."</pre></TD>
                     </TR><TR>
                             <TD align=right><b>Failure Notice:</b></TD>
                             <TD><pre> $failnote </pre></TD>
@@ -210,11 +223,11 @@ function db_show_error($sql, $failnote, $additional = '')
                             <TD>$additional</TD>
                     </TR>
                     </TABLE>";
-
-	echo "
+       
+		echo "
 		<TABLE CELLSPACING=10 BORDER=0>
 			<TR><TD align=right><b>Date:</TD>
-			<TD><pre>" . date("m/d/Y h:i:s") . "</pre></TD>
+			<TD><pre>".date("m/d/Y h:i:s")."</pre></TD>
 		</TR><TR>
 			<TD align=right></TD>
 			<TD>openSIS has encountered an error that could have resulted from any of the following:
@@ -230,56 +243,76 @@ function db_show_error($sql, $failnote, $additional = '')
 		</TR>
 		
 		</TABLE>";
-
+        
 	echo "<!-- SQL STATEMENT: \n\n $sql \n\n -->";
 
-	if ($openSISNotifyAddress) {
+	if($openSISNotifyAddress)
+	{
 		$message = "System: $openSISTitle \n";
-		$message .= "Date: " . date("m/d/Y h:i:s") . "\n";
-		$message .= "Page: " . $_SERVER['PHP_SELF'] . ' ' . ProgramTitle() . " \n\n";
+		$message .= "Date: ".date("m/d/Y h:i:s")."\n";
+		$message .= "Page: ".$_SERVER['PHP_SELF'].' '.ProgramTitle()." \n\n";
 		$message .= "Failure Notice:  $failnote \n";
 		$message .= "Additional Info: $additional \n";
 		$message .= "\n $sql \n";
-		$message .= "Request Array: \n" . ShowVar($_REQUEST, 'Y', 'N');
-		$message .= "\n\nSession Array: \n" . ShowVar($_SESSION, 'Y', 'N');
-		mail($openSISNotifyAddress, 'openSIS Database Error', $message);
+		$message .= "Request Array: \n".ShowVar($_REQUEST,'Y', 'N');
+		$message .= "\n\nSession Array: \n".ShowVar($_SESSION,'Y', 'N');
+		mail($openSISNotifyAddress,'openSIS Database Error',$message);
+
 	}
 
 	die();
 }
-$used_for = $_GET['used_for'];
-if ($used_for == 'username') {
-	$username = $_GET['u'];
-	$usr_type = $_GET['user_type'];
-	$found = false;
-	if ($usr_type == 'student') {
-		$check_uname =  DBGet(DBQuery('SELECT * FROM login_authentication WHERE USERNAME = \'' . $username . '\'  AND PROFILE_ID IN (SELECT ID FROM user_profiles WHERE PROFILE=\'student\')'));
-	} elseif ($usr_type == 'staff') {
-		$check_uname =  DBGet(DBQuery('SELECT * FROM login_authentication WHERE USERNAME = \'' . $username . '\'  AND PROFILE_ID IN (SELECT ID FROM user_profiles WHERE ID NOT IN (0,3,4))'));
-	} else {
-		$check_uname =  DBGet(DBQuery('SELECT * FROM login_authentication WHERE USERNAME = \'' . $username . '\'  AND PROFILE_ID IN (SELECT ID FROM user_profiles WHERE PROFILE=\'parent\')'));
-	}
-	if ($check_uname[1]['USERNAME'] != '') {
-		echo '1';
-	} else
-		echo '0';
-} else {
-	$email = $_GET['u'];
-	$usr_type = $_GET['user_type'];
-	$found = false;
-	if ($usr_type == 'staff') {
-		if ($_GET['username'] != '')
-			$check_email =  DBGet(DBQuery('SELECT * FROM staff s,login_authentication la WHERE EMAIL = \'' . $email . '\' AND s.STAFF_ID=la.USER_ID AND la.username=\'' . $_GET['username'] . '\''));
-		else
-			$check_email =  DBGet(DBQuery('SELECT * FROM staff WHERE EMAIL = \'' . $email . '\''));
-	} else {
-		if ($_GET['username'] != '')
-			$check_email =  DBGet(DBQuery('SELECT * FROM people p,login_authentication la WHERE EMAIL = \'' . $email . '\' AND p.STAFF_ID=la.USER_ID AND la.username=\'' . $_GET['username'] . '\''));
-		else
-			$check_email =  DBGet(DBQuery('SELECT * FROM people WHERE EMAIL = \'' . $email . '\''));
-	}
-	if ($check_email[1]['EMAIL'] != '') {
-		echo '1~' . $_GET['form'];
-	} else
-		echo '0~' . $_GET['form'];
-}
+        $used_for=$_GET['used_for'];
+        if($used_for=='username')
+        {
+            $username = $_GET['u'];
+            $usr_type = $_GET['user_type'];
+            $found= false;
+            if($usr_type=='student')
+            {
+                $check_uname=  DBGet(DBQuery('SELECT * FROM login_authentication WHERE USERNAME = \''.$username.'\'  AND PROFILE_ID IN (SELECT ID FROM user_profiles WHERE PROFILE=\'student\')'));
+            }
+            elseif($usr_type=='staff') 
+            {
+                $check_uname=  DBGet(DBQuery('SELECT * FROM login_authentication WHERE USERNAME = \''.$username.'\'  AND PROFILE_ID IN (SELECT ID FROM user_profiles WHERE ID NOT IN (0,3,4))'));
+            }
+            else
+            {
+                $check_uname=  DBGet(DBQuery('SELECT * FROM login_authentication WHERE USERNAME = \''.$username.'\'  AND PROFILE_ID IN (SELECT ID FROM user_profiles WHERE PROFILE=\'parent\')'));
+            }
+            if($check_uname[1]['USERNAME']!='')
+            {
+                echo '1';
+            }
+            else
+                echo '0';
+        }
+        else
+        {
+            $email = $_GET['u'];
+            $usr_type = $_GET['user_type'];
+            $found= false;
+            if($usr_type=='staff') 
+            {
+                if($_GET['username']!='')
+                    $check_email=  DBGet(DBQuery('SELECT * FROM staff s,login_authentication la WHERE EMAIL = \''.$email.'\' AND s.STAFF_ID=la.USER_ID AND la.username=\''.$_GET['username'].'\''));
+                else
+                    $check_email=  DBGet(DBQuery('SELECT * FROM staff WHERE EMAIL = \''.$email.'\''));
+            }
+            else
+            {
+                if($_GET['username']!='')
+                    $check_email=  DBGet(DBQuery('SELECT * FROM people p,login_authentication la WHERE EMAIL = \''.$email.'\' AND p.STAFF_ID=la.USER_ID AND la.username=\''.$_GET['username'].'\''));
+                else
+                    $check_email=  DBGet(DBQuery('SELECT * FROM people WHERE EMAIL = \''.$email.'\''));
+            }
+            if($check_email[1]['EMAIL']!='')
+            {
+                echo '1~'.$_GET['form'];
+            }
+            else
+                echo '0~'.$_GET['form'];
+        }
+      
+        
+?>
\ No newline at end of file

--- LoginInc.php ---
@@ -142,8 +142,9 @@ function delete_cookie (cookie_name)
                                 ?>
                                 <div class="form-group">
                                     <?php
+                                    include_once './AuthCryp.php';
                                     if (isset($_COOKIE['remember_me_name']))
-                                        $name = mysqli_real_escape_string($cont, strip_tags(trim($_COOKIE['remember_me_name'])));
+                                        $name = mysqli_real_escape_string($cont, strip_tags(trim(cryptor($_COOKIE['remember_me_name'], 'DEC'))));
                                     if (isset($_SESSION['fill_username'])) {
                                         $name = $_SESSION['fill_username'];
                                         unset($_SESSION['fill_username']);
@@ -154,7 +155,7 @@ function delete_cookie (cookie_name)
                                 <div class="form-group">
                                     <?php
                                     if (isset($_COOKIE['remember_me_pwd']))
-                                        $pwd = mysqli_real_escape_string($cont, strip_tags(trim($_COOKIE['remember_me_pwd'])));
+                                        $pwd = mysqli_real_escape_string($cont, strip_tags(trim(cryptor($_COOKIE['remember_me_pwd'], 'DEC'))));
                                     ?>
                                     <input type="password" class="form-control password" placeholder="<?=_enterPassword?>" id="password" name='PASSWORD' AUTOCOMPLETE='off' value="<?php echo $pwd; ?>">
                                 </div>

--- Modules.php ---
@@ -120,7 +120,7 @@
     echo '<script type="text/javascript" src="assets/js/core/libraries/jquery_ui/interactions.min.js"></script>';
     echo '<script type="text/javascript" src="assets/js/plugins/loaders/blockui.min.js"></script>';
     echo '<script type="text/javascript" src="assets/js/plugins/ui/prism.min.js"></script>';
-    echo '<script type="text/javascript" src="assets/js/plugins/media/cropper.min.js"></script>';
+    echo '<script type="text/javascript" src="assets/js/plugins/media/cropper.min.js"></script>';    
     echo '<script type="text/javascript" src="assets/js/plugins/editors/ckeditor/ckeditor.js"></script>';
     echo '<script type="text/javascript" src="assets/js/plugins/tables/datatables/datatables.min.js"></script>';
     echo '<script type="text/javascript" src="assets/js/plugins/forms/selects/select2.min.js"></script>';
@@ -159,14 +159,14 @@
             }
         });
     </script>';
-
+    
 
     if (strpos($_REQUEST['modname'], 'miscellaneous/') === false)
         echo '<script language="JavaScript">if(window == top  && (!window.opener || window.opener.location.href.substring(0,(window.opener.location.href.indexOf("&")!=-1?window.opener.location.href.indexOf("&"):window.opener.location.href.replace("#","").length))!=window.location.href.substring(0,(window.location.href.indexOf("&")!=-1?window.location.href.indexOf("&"):window.location.href.replace("#","").length)))) window.location.href = "index.php";</script>';
 
     echo "<BODY>";
 }
-echo '<div id="loading-image"><i class="fa fa-cog fa-spin fa-lg fa-fw"></i> ' . _loading . '...</div>';
+echo '<div id="loading-image"><i class="fa fa-cog fa-spin fa-lg fa-fw"></i> '._loading.'...</div>';
 echo '<div class="navbar navbar-inverse bg-white">
             <div class="navbar-header">
                 <a class="sidebar-control sidebar-main-toggle hidden-xs" data-popup="tooltip" data-placement="bottom" data-container="body" data-original-title="Collapse Menu"><i class="icon-paragraph-justify3"></i></a>
@@ -197,7 +197,7 @@
     echo "</div></FORM></li>";
 
     //===================================================================================================
-
+    
     echo "<li><FORM name=head_frm id=head_frm action=Side.php?modfunc=update&btnn=$btn&nsc=$ns&act=syear method=POST><div class=\"form-group\"><INPUT type=hidden name=modcat value='' id=modcat_input>";
     $school_years_RET = DBGet(DBQuery("SELECT YEAR(sy.START_DATE)AS START_DATE,YEAR(sy.END_DATE)AS END_DATE FROM school_years sy,staff st INNER JOIN staff_school_relationship ssr USING(staff_id) WHERE ssr.SYEAR=sy.SYEAR AND sy.school_id=ssr.school_id AND sy.school_id=" . UserSchool() . " AND st.staff_id=$_SESSION[STAFF_ID]"));
     echo "<SELECT class=\"select\" name=syear onChange='this.form.submit();' style='width:80;'>";
@@ -208,7 +208,7 @@
     echo "</div></FORM></li>";
 
     //===================================================================================================
-
+    
     echo "<li><FORM name=head_frm id=head_frm action=Side.php?modfunc=update&btnn=$btn&nsc=$ns&act=mp method=POST><div class=\"form-group\"><INPUT type=hidden name=modcat value='' id=modcat_input>";
     $RET = DBGet(DBQuery("SELECT MARKING_PERIOD_ID,TITLE FROM school_quarters WHERE SCHOOL_ID='" . UserSchool() . "' AND SYEAR='" . UserSyear() . "' ORDER BY SORT_ORDER"));
     if (!isset($_SESSION['UserMP'])) {
@@ -295,7 +295,8 @@
             } else
                 $stu_ID = UserStudentID();
             $school_years_RET = DBGet(DBQuery("SELECT DISTINCT sy.START_DATE,sy.END_DATE FROM school_years sy,student_enrollment se WHERE se.SYEAR=sy.SYEAR AND se.STUDENT_ID=" . $stu_ID . " AND sy.SCHOOL_ID=" . UserSchool() . " "));
-        } else {
+        }
+        else {
             $school_years_RET = DBGet(DBQuery("SELECT sy.START_DATE,sy.END_DATE FROM school_years sy ,staff s INNER JOIN staff_school_relationship ssr ON s.staff_id=ssr.staff_id WHERE sy.school_id=ssr.school_id AND sy.syear=ssr.syear AND sy.SCHOOL_ID=" . UserSchool() . " AND s.staff_id='$_SESSION[STAFF_ID]'"));
         }
         foreach ($school_years_RET as $school_years) {
@@ -315,7 +316,8 @@
             } else
                 $stu_ID = UserStudentID();
             $school_years_RET = DBGet(DBQuery("SELECT DISTINCT sy.START_DATE,sy.END_DATE FROM school_years sy,student_enrollment se WHERE se.SYEAR=sy.SYEAR AND se.STUDENT_ID=" . $stu_ID . " AND sy.SCHOOL_ID=" . UserSchool() . " "));
-        } else {
+        }
+        else {
             if (UserSchool())
                 $school_years_RET = DBGet(DBQuery("SELECT sy.START_DATE,sy.END_DATE FROM school_years sy ,staff s INNER JOIN staff_school_relationship ssr ON s.staff_id=ssr.staff_id WHERE sy.school_id=ssr.school_id AND sy.syear=ssr.syear AND sy.SCHOOL_ID=" . UserSchool() . " AND s.staff_id='$_SESSION[STAFF_ID]'"));
             else
@@ -389,7 +391,7 @@
     // Marking Period
 
     echo '</FORM></div></li>';
-} ################## Porfile Not Teacher End ##########################################
+}################## Porfile Not Teacher End ##########################################
 
 if (UserStudentID() && User('PROFILE') != 'parent' && User('PROFILE') != 'student') {
     $RET = DBGet(DBQuery("SELECT FIRST_NAME,LAST_NAME,MIDDLE_NAME,NAME_SUFFIX FROM students WHERE STUDENT_ID='" . UserStudentID() . "'"));
@@ -442,21 +444,23 @@
         echo '<OPTION value="">n/a</OPTION>';
     }
     echo "</SELECT>";
-    //===================================================================================================		
+//===================================================================================================		
     echo "</FORM></div></li>";
     echo "<li><div class=\"form-group\"><FORM name=head_frm id=head_frm action=Side.php?modfunc=update&btnn=$btn&nsc=$ns&act=course method=POST><INPUT type=hidden name=modcat value='' id=modcat_input>";
     $course = DBQuery("SELECT DISTINCT cd.COURSE_TITLE, cd.COURSE_ID,cd.SUBJECT_ID,cd.SCHOOL_ID FROM course_details cd WHERE (cd.TEACHER_ID='" . User('STAFF_ID') . "' OR cd.SECONDARY_TEACHER_ID='" . User('STAFF_ID') . "') AND cd.SYEAR='" . UserSyear() . "' AND cd.SCHOOL_ID='" . UserSchool() . "' AND cd.SUBJECT_ID='" . UserSubject() . "' AND (cd.MARKING_PERIOD_ID IN (" . GetAllMP($allMP, UserMP()) . ") OR (cd.MARKING_PERIOD_ID IS NULL ))"); //AND cd.BEGIN_DATE<='".date('Y-m-d')."' AND cd.END_DATE>='".date('Y-m-d')."'))");					
-    $RET_temp = DBGet($course);
-    $ret_increment = 1;
-    $RET = array();
-    foreach ($RET_temp as $ret_courses) {
-        $get_cps = DBGet(DBQuery("SELECT cpv.ID,cp.COURSE_PERIOD_ID,cp.MARKING_PERIOD_ID,cp.COURSE_ID,cp.TITLE,cp.SCHOOL_ID,cpv.PERIOD_ID FROM course_periods cp,course_period_var cpv WHERE cp.SYEAR='" . UserSyear() . "' AND cp.COURSE_PERIOD_ID=cpv.COURSE_PERIOD_ID AND cp.SCHOOL_ID='" . UserSchool() . "' AND cp.COURSE_ID='" . $ret_courses['COURSE_ID'] . "' AND (TEACHER_ID='" . User('STAFF_ID') . "' OR SECONDARY_TEACHER_ID='" . User('STAFF_ID') . "') AND (MARKING_PERIOD_ID IN (" . GetAllMP($allMP, UserMP()) . ") OR (MARKING_PERIOD_ID IS NULL)) group by (cp.COURSE_PERIOD_ID)"));
-        if (count($get_cps) > 0) {
-            $RET[$ret_increment] = $ret_courses;
+    $RET_temp= DBGet($course);
+    $ret_increment=1;
+    $RET=array();
+    foreach($RET_temp as $ret_courses)
+    {
+        $get_cps=DBGet(DBQuery("SELECT cpv.ID,cp.COURSE_PERIOD_ID,cp.MARKING_PERIOD_ID,cp.COURSE_ID,cp.TITLE,cp.SCHOOL_ID,cpv.PERIOD_ID FROM course_periods cp,course_period_var cpv WHERE cp.SYEAR='" . UserSyear() . "' AND cp.COURSE_PERIOD_ID=cpv.COURSE_PERIOD_ID AND cp.SCHOOL_ID='" . UserSchool() . "' AND cp.COURSE_ID='" . $ret_courses['COURSE_ID'] . "' AND (TEACHER_ID='" . User('STAFF_ID') . "' OR SECONDARY_TEACHER_ID='" . User('STAFF_ID') . "') AND (MARKING_PERIOD_ID IN (" . GetAllMP($allMP, UserMP()) . ") OR (MARKING_PERIOD_ID IS NULL)) group by (cp.COURSE_PERIOD_ID)"));
+        if(count($get_cps)>0)
+        {
+            $RET[$ret_increment]=$ret_courses;
             $ret_increment++;
         }
     }
-
+   
     if (!UserCourse()) {
         $_SESSION['UserCourse'] = $RET[1]['COURSE_ID'];
     }
@@ -469,7 +473,7 @@
         echo '<OPTION value="">n/a</OPTION>';
     }
     echo "</SELECT>";
-    //===================================================================================================							     					     
+//===================================================================================================							     					     
     echo "</FORM></div></li>";
 
     echo "<li><div class=\"form-group\"><FORM name=head_frm id=head_frm action=Side.php?modfunc=update&btnn=$btn&nsc=$ns&act=period method=POST><INPUT type=hidden name=modcat value='' id=modcat_input>";
@@ -524,31 +528,34 @@
 }
 $user_picture = '';
 if (User('PROFILE') != 'parent') {
-
-    if (User('PROFILE') == 'student') {
-        $img_info = DBGet(DBQuery('SELECT * FROM user_file_upload WHERE USER_ID=' . UserStudentID() . ' AND PROFILE_ID=3 AND SCHOOL_ID=' . UserSchool() . ' AND SYEAR=' . UserSyear() . ' AND FILE_INFO=\'stuimg\''));
-        $img_info = $img_info[1]['CONTENT'];
-    } else {
-        $img_info = DBGet(DBQuery('SELECT * FROM staff WHERE STAFF_ID=' . UserID()));
-        $img_info = $img_info[1]['IMG_CONTENT'];
+    
+    if(User('PROFILE')=='student')
+    {
+    $img_info = DBGet(DBQuery('SELECT * FROM user_file_upload WHERE USER_ID=' . UserStudentID(). ' AND PROFILE_ID=3 AND SCHOOL_ID=' . UserSchool() . ' AND SYEAR=' . UserSyear() . ' AND FILE_INFO=\'stuimg\''));
+    $img_info=$img_info[1]['CONTENT'];
     }
-    if ($img_info != '')
-        $user_picture = '<a href="javascript:void(0)"><IMG src="data:image/jpeg;base64,' . base64_encode($img_info) . '" class="img-circle img-responsive"></a>';
+    else
+    {
+    $img_info= DBGet(DBQuery('SELECT * FROM staff WHERE STAFF_ID=' .UserID()));
+    $img_info=$img_info[1]['IMG_CONTENT'];
+    }
+    if($img_info!='')
+      $user_picture = '<a href="javascript:void(0)"><IMG src="data:image/jpeg;base64,'. base64_encode($img_info) . '" class="img-circle img-responsive"></a>';
     else
         $user_picture = '<a href="javascript:void(0)"><IMG SRC="assets/no_avtar.png" class="img-circle img-responsive"></a>';
-    // if (($StudentPicturesPath . UserStudentID() . '.JPG' || ($UserPicturesPath . UserID() . '.JPG'))) {
-    //     if (UserStudentID())
-    //         $picture_path = $StudentPicturesPath . UserStudentID() . '.JPG';
-    //     if (UserID())
-    //         $picture_path = $UserPicturesPath . UserID() . '.JPG';
-    //     if (file_exists($picture_path)) {
-    //         $user_picture = '<a href="javascript:void(0)"><img src="' . $picture_path . '"  alt="" class="img-circle img-responsive"></a>';
-    //     } else {
-    //         $user_picture = '<a href="javascript:void(0)"><IMG SRC="assets/no_avtar.png" class="img-circle img-responsive"></a>';
-    //     }
-    // } else {
-    //     $user_picture = '<a href="javascript:void(0)"><IMG SRC="assets/no_avtar.png" class="img-circle img-responsive"></a>';
-    // }
+   // if (($StudentPicturesPath . UserStudentID() . '.JPG' || ($UserPicturesPath . UserID() . '.JPG'))) {
+   //     if (UserStudentID())
+   //         $picture_path = $StudentPicturesPath . UserStudentID() . '.JPG';
+   //     if (UserID())
+   //         $picture_path = $UserPicturesPath . UserID() . '.JPG';
+   //     if (file_exists($picture_path)) {
+   //         $user_picture = '<a href="javascript:void(0)"><img src="' . $picture_path . '"  alt="" class="img-circle img-responsive"></a>';
+   //     } else {
+   //         $user_picture = '<a href="javascript:void(0)"><IMG SRC="assets/no_avtar.png" class="img-circle img-responsive"></a>';
+   //     }
+   // } else {
+   //     $user_picture = '<a href="javascript:void(0)"><IMG SRC="assets/no_avtar.png" class="img-circle img-responsive"></a>';
+   // }
 }
 
 //$user_picture .= '<input type="file" name=""  />';
@@ -560,11 +567,11 @@
 // }elseif(User('PROFILE') == "Administrator")
 // {
 //     $userProfile = _administrator;
-
+    
 // }elseif(User('PROFILE') == "Teacher")
 // {
 //     $userProfile = _teacher;
-
+    
 // }elseif(User('PROFILE') == "Student")
 // {
 //     $userProfile = _student;
@@ -605,18 +612,18 @@
                                         </div>
 
                                         <div class="sidebar-user-material-menu">
-                                            <a href="#user-nav" data-toggle="collapse"><span>' . _myAccount . '</span> <i class="caret"></i></a>
+                                            <a href="#user-nav" data-toggle="collapse"><span>'._myAccount.'</span> <i class="caret"></i></a>
                                         </div>
                                     </div>
 
                                     <div class="navigation-wrapper collapse" id="user-nav">
                                         <ul class="navigation">
                                 
-                                            <li><a href="javascript:void(0)" onclick="check_content(\'Ajax.php?modname=messaging/Inbox.php\');"><i class="icon-comment-discussion"></i> <span>' . _messages . '</span></a></li>';
-if (User('PROFILE') != 'student')
-    echo '<li><a href="javascript:void(0)" onclick="check_content(\'Ajax.php?modname=users/Preferences.php\');"><i class="icon-equalizer"></i> <span>' . _preferences . '</span></a></li>';
+                                            <li><a href="javascript:void(0)" onclick="check_content(\'Ajax.php?modname=messaging/Inbox.php\');"><i class="icon-comment-discussion"></i> <span>'._messages.'</span></a></li>';
+if(User('PROFILE')!='student')                                            
+echo'<li><a href="javascript:void(0)" onclick="check_content(\'Ajax.php?modname=users/Preferences.php\');"><i class="icon-equalizer"></i> <span>'._preferences.'</span></a></li>';
 
-echo '<li><a href="index.php?modfunc=logout"><i class="icon-switch2"></i> <span>' . _logout . '</span></a></li>
+                                            echo'<li><a href="index.php?modfunc=logout"><i class="icon-switch2"></i> <span>'._logout.'</span></a></li>
                                         </ul>
                                     </div>
                                 </div>
@@ -651,7 +658,7 @@
 );
 
 //echo "<li><a href='javascript:void(0)' onmouseup='check_content(\"Ajax.php?modname=miscellaneous/Portal.php\");' onmousedown='document.getElementById(\"header\").innerHTML = \"Home\";document.getElementById(\"cframe\").src = \"Bottom.php?modcat=home\"'><i class=\"icon-home4\"></i><span>" . "Home" . "</span></a></li>";
-echo "<li><a href='#' onmouseup='check_content(\"Ajax.php?modname=miscellaneous/Portal.php\");' onmousedown='document.getElementById(\"header\").innerHTML = \"Home\";document.getElementById(\"cframe\").src = \"Bottom.php?modcat=home\"'><i class=\"icon-home4\"></i><span>" . _home . "</span></a></li>";
+echo "<li><a href='#' onmouseup='check_content(\"Ajax.php?modname=miscellaneous/Portal.php\");' onmousedown='document.getElementById(\"header\").innerHTML = \"Home\";document.getElementById(\"cframe\").src = \"Bottom.php?modcat=home\"'><i class=\"icon-home4\"></i><span>" ._home . "</span></a></li>";
 foreach ($_openSIS['Menu'] as $modcat => $programs) {
     if (count($_openSIS['Menu'][$modcat])) {
         $keys = array_keys($_openSIS['Menu'][$modcat]);
@@ -667,24 +674,24 @@
 
 
         if (User('PROFILE') != 'admin' && $modcat == "schoolsetup") {
-            echo "<li " . (($current_mod == $modcat) ? 'class="active"' : '') . "><a HREF=javascript:void(0)><i class=\"{$menu_icons[$modcat]}\"></i><span>" . _schoolInfo . "</span></a>";
+            echo "<li " . (($current_mod == $modcat) ? 'class="active"' : '') . "><a HREF=javascript:void(0)><i class=\"{$menu_icons[$modcat]}\"></i><span>"._schoolInfo."</span></a>";
         } elseif (User('PROFILE') != 'admin' && $modcat == "users") {
-            echo "<li " . (($current_mod == $modcat) ? 'class="active"' : '') . "><a HREF=javascript:void(0)><i class=\"{$menu_icons[$modcat]}\"></i><span>" . _myInfo . "</span></a>";
+            echo "<li " . (($current_mod == $modcat) ? 'class="active"' : '') . "><a HREF=javascript:void(0)><i class=\"{$menu_icons[$modcat]}\"></i><span>"._myInfo."</span></a>";
         } elseif (User('PROFILE') == 'student' && $modcat == "students") {
 
-            echo "<li " . (($current_mod == $modcat) ? 'class="active"' : '') . "><a HREF=javascript:void(0)><i class=\"{$menu_icons[$modcat]}\"></i><span>" . _myInfo . "</span></a>";
+            echo "<li " . (($current_mod == $modcat) ? 'class="active"' : '') . "><a HREF=javascript:void(0)><i class=\"{$menu_icons[$modcat]}\"></i><span>"._myInfo."</span></a>";
         } elseif (User('PROFILE') == 'student' && $modcat == "scheduling") {
-            echo "<li " . (($current_mod == $modcat) ? 'class="active"' : '') . "><a HREF=javascript:void(0)><i class=\"{$menu_icons[$modcat]}\"></i><span>" . _schedule . "</span></a>";
+            echo "<li " . (($current_mod == $modcat) ? 'class="active"' : '') . "><a HREF=javascript:void(0)><i class=\"{$menu_icons[$modcat]}\"></i><span>"._schedule."</span></a>";
         } elseif ($modcat == "messaging") {
-            echo "<li " . (($current_mod == $modcat) ? 'class="active"' : '') . "><a HREF=javascript:void(0)><i class=\"{$menu_icons[$modcat]}\"></i><span>" . _messaging . "</span></a>";
+            echo "<li " . (($current_mod == $modcat) ? 'class="active"' : '') . "><a HREF=javascript:void(0)><i class=\"{$menu_icons[$modcat]}\"></i><span>"._messaging."</span></a>";
         } else {
 
             if ($modcat == 'eligibility') {
-                echo "<li " . (($current_mod == $modcat) ? 'class="active"' : '') . "><a HREF=javascript:void(0)><i class=\"{$menu_icons[$modcat]}\"></i><span>" . _extracurricular . "</span></a>";
+                echo "<li " . (($current_mod == $modcat) ? 'class="active"' : '') . "><a HREF=javascript:void(0)><i class=\"{$menu_icons[$modcat]}\"></i><span>"._extracurricular."</span></a>";
             } elseif ($modcat == 'schoolsetup')
-                echo "<li " . (($current_mod == $modcat) ? 'class="active"' : '') . "><a HREF=javascript:void(0)><i class=\"{$menu_icons[$modcat]}\"></i><span>" . _schoolSetup . "</span></a>";
+                echo "<li " . (($current_mod == $modcat) ? 'class="active"' : '') . "><a HREF=javascript:void(0)><i class=\"{$menu_icons[$modcat]}\"></i><span>"._schoolSetup."</span></a>";
             else {
-                echo "<li " . (($current_mod == $modcat) ? 'class="active"' : '') . "><a HREF=javascript:void(0)><i class=\"{$menu_icons[$modcat]}\"></i><span>" . ucfirst(str_replace('_', ' ', constant('_' . $modcat))) . "</span></a>";
+                echo "<li " . (($current_mod == $modcat) ? 'class="active"' : '') . "><a HREF=javascript:void(0)><i class=\"{$menu_icons[$modcat]}\"></i><span>" . ucfirst(str_replace('_', ' ', constant('_'.$modcat))) . "</span></a>";
             }
         }
 
@@ -725,7 +732,7 @@
                                 if ($modcat != 'tools')
                                     echo "<li  " . (($current_menu == $title) ? 'class="current-submenu"' : '') . "><A id=hm HREF=javascript:void(0) onClick='check_content(\"Ajax.php?modname=" . $file . " \");'  onmousedown='document.getElementById(\"header\").innerHTML = \"" . ($modcat == 'schoolsetup' ? schoolSetup : ucwords(constant($modcat))) . " <i class=\"icon-arrow-right5\"></i> " . "$title\"' onmouseup=\"document.getElementById('cframe').src='Bottom.php?modname=" . str_replace('&', '?', $file) . "';\">$title</A>";
                             } else
-                                echo "<li  " . (($current_menu == $title) ? 'class="current-submenu"' : '') . "><A id=hm HREF=javascript:void(0) onClick='check_content(\"Ajax.php?modname=" . $file . " \");'  onmousedown='$(\"#header\").html(\"" . ($modcat == 'schoolsetup' ? schoolSetup : ucwords(constant($modcat))) . " <i class=icon-arrow-right5></i> " . $title . "\");' onmouseup=\"$('#cframe').attr('src','Bottom.php?modname=" . str_replace('&', '?', $file) . "');\">$title</A>";
+                                echo "<li  " . (($current_menu == $title) ? 'class="current-submenu"' : '') . "><A id=hm HREF=javascript:void(0) onClick='check_content(\"Ajax.php?modname=" . $file . " \");'  onmousedown='$(\"#header\").html(\"" . ($modcat == 'schoolsetup' ? schoolSetup : ucwords(constant($modcat))) . " <i class=icon-arrow-right5></i> " . $title."\");' onmouseup=\"$('#cframe').attr('src','Bottom.php?modname=" . str_replace('&', '?', $file) . "');\">$title</A>";
                         }
                     }
                 elseif ($keys[$key_index + 1] && !is_numeric($keys[$key_index + 1])) {
@@ -766,7 +773,8 @@
                         } else
                             echo "<li " . (($current_menu == $title) ? 'class="current-submenu"' : '') . "><A id=dd HREF=javascript:void(0) onClick='check_content(\"Ajax.php?modname=" . $file . " \");'  onmousedown='document.getElementById(\"header\").innerHTML = \"" . ($modcat == 'schoolsetup' ? schoolSetup : ucwords(constant($modcat))) . " <i class=\"icon-arrow-right5\"></i> " . "$title\"' onmouseup=\"document.getElementById('cframe').src='Bottom.php?modname=" . $file . "';\">$title</A>";
                     }
-                } elseif ($keys[$key_index + 1] && !is_numeric($keys[$key_index + 1])) {
+                }
+                elseif ($keys[$key_index + 1] && !is_numeric($keys[$key_index + 1])) {
                     $mm = $mm + 1;
                     echo '</ul></li><li><a href="javascript:void(0)">' . $title . '</a><ul>';
                     $child2 = 1;
@@ -827,46 +835,46 @@
     $admin_COMMON_WHERE = " WHERE s.STUDENT_ID=ssm.STUDENT_ID  AND a.STUDENT_ID=s.STUDENT_ID AND a.TYPE='Home Address' AND ssm.SYEAR=" . UserSyear() . " AND ssm.SCHOOL_ID=" . UserSchool() . " ";
 
     if (optional_param('mp_comment', '', PARAM_NOTAGS) || $_SESSION['smc']) {
-        $admin_COMMON_FROM .= " ,student_mp_comments smc";
-        $admin_COMMON_WHERE .= " AND smc.STUDENT_ID=s.STUDENT_ID ";
+        $admin_COMMON_FROM .=" ,student_mp_comments smc";
+        $admin_COMMON_WHERE .=" AND smc.STUDENT_ID=s.STUDENT_ID ";
         $_SESSION['smc'] = '1';
     }
 
     if (optional_param('goal_description', '', PARAM_NOTAGS) || optional_param('goal_title', '', PARAM_NOTAGS) || $_SESSION['g']) {
-        $admin_COMMON_FROM .= " ,student_goal g ";
-        $admin_COMMON_WHERE .= " AND g.STUDENT_ID=s.STUDENT_ID ";
+        $admin_COMMON_FROM .=" ,student_goal g ";
+        $admin_COMMON_WHERE .=" AND g.STUDENT_ID=s.STUDENT_ID ";
         $_SESSION['g'] = '1';
     }
 
     if (optional_param('progress_name', '', PARAM_NOTAGS) || optional_param('progress_description', '', PARAM_NOTAGS) || $_SESSION['p']) {
-        $admin_COMMON_FROM .= " ,student_goal_progress p ";
-        $admin_COMMON_WHERE .= " AND p.STUDENT_ID=s.STUDENT_ID ";
+        $admin_COMMON_FROM .=" ,student_goal_progress p ";
+        $admin_COMMON_WHERE .=" AND p.STUDENT_ID=s.STUDENT_ID ";
         $_SESSION['p'] = '1';
     }
 
     if (optional_param('doctors_note_comments', '', PARAM_NOTAGS) || optional_param('med_day', '', PARAM_NOTAGS) || optional_param('med_month', '', PARAM_NOTAGS) || optional_param('med_year', '', PARAM_NOTAGS) || $_SESSION['smn']) {
-        $admin_COMMON_FROM .= " ,student_medical_notes smn ";
-        $admin_COMMON_WHERE .= " AND smn.STUDENT_ID=s.STUDENT_ID ";
+        $admin_COMMON_FROM .=" ,student_medical_notes smn ";
+        $admin_COMMON_WHERE .=" AND smn.STUDENT_ID=s.STUDENT_ID ";
         $_SESSION['smn'] = '1';
     }
 
     if (optional_param('type', '', PARAM_NOTAGS) || optional_param('imm_comments', '', PARAM_NOTAGS) || optional_param('imm_day', '', PARAM_NOTAGS) || optional_param('imm_month', '', PARAM_NOTAGS) || optional_param('imm_year', '', PARAM_NOTAGS) || $_SESSION['sm']) {
 
-        $admin_COMMON_FROM .= " ,student_immunization sm ";
-        $admin_COMMON_WHERE .= " AND sm.STUDENT_ID=s.STUDENT_ID ";
+        $admin_COMMON_FROM .=" ,student_immunization sm ";
+        $admin_COMMON_WHERE .=" AND sm.STUDENT_ID=s.STUDENT_ID ";
         $_SESSION['sm'] = '1';
     }
 
 
     if (optional_param('ma_day', '', PARAM_NOTAGS) || optional_param('ma_month', '', PARAM_NOTAGS) || optional_param('ma_year', '', PARAM_NOTAGS) || optional_param('med_alrt_title', '', PARAM_NOTAGS) || $_SESSION['sma']) {
-        $admin_COMMON_FROM .= " ,student_medical_alerts sma  ";
-        $admin_COMMON_WHERE .= " AND sma.STUDENT_ID=s.STUDENT_ID ";
+        $admin_COMMON_FROM .=" ,student_medical_alerts sma  ";
+        $admin_COMMON_WHERE .=" AND sma.STUDENT_ID=s.STUDENT_ID ";
         $_SESSION['sma'] = '1';
     }
 
     if (optional_param('nv_day', '', PARAM_NOTAGS) || optional_param('nv_month', '', PARAM_NOTAGS) || optional_param('nv_year', '', PARAM_NOTAGS) || optional_param('reason', '', PARAM_NOTAGS) || optional_param('result', '', PARAM_NOTAGS) || optional_param('med_vist_comments', '', PARAM_NOTAGS) || $_SESSION['smv']) {
-        $admin_COMMON_FROM .= " ,student_medical_visits smv   ";
-        $admin_COMMON_WHERE .= " AND smv.STUDENT_ID=s.STUDENT_ID ";
+        $admin_COMMON_FROM .=" ,student_medical_visits smv   ";
+        $admin_COMMON_WHERE .=" AND smv.STUDENT_ID=s.STUDENT_ID ";
         $_SESSION['smv'] = '1';
     }
     $admin_COMMON = $admin_COMMON_FROM . $admin_COMMON_WHERE;
@@ -881,45 +889,45 @@
 
 
     if (optional_param('mp_comment', '', PARAM_SPCL) || $_SESSION['smc']) {
-        $teacher_COMMON_FROM .= " ,student_mp_comments smc";
-        $teacher_COMMON_WHERE .= " AND smc.STUDENT_ID=s.STUDENT_ID ";
+        $teacher_COMMON_FROM .=" ,student_mp_comments smc";
+        $teacher_COMMON_WHERE .=" AND smc.STUDENT_ID=s.STUDENT_ID ";
         $_SESSION['smc'] = '1';
     }
 
     if (optional_param('goal_description', '', PARAM_SPCL) || optional_param('goal_title', '', PARAM_SPCL) || $_SESSION['g']) {
-        $teacher_COMMON_FROM .= " ,student_goal g ";
-        $teacher_COMMON_WHERE .= " AND g.STUDENT_ID=s.STUDENT_ID ";
+        $teacher_COMMON_FROM .=" ,student_goal g ";
+        $teacher_COMMON_WHERE .=" AND g.STUDENT_ID=s.STUDENT_ID ";
         $_SESSION['g'] = '1';
     }
 
     if (optional_param('progress_name', '', PARAM_NOTAGS) || optional_param('progress_description', '', PARAM_NOTAGS) || $_SESSION['p']) {
-        $teacher_COMMON_FROM .= " ,student_goal_progress p ";
-        $teacher_COMMON_WHERE .= " AND p.STUDENT_ID=s.STUDENT_ID ";
+        $teacher_COMMON_FROM .=" ,student_goal_progress p ";
+        $teacher_COMMON_WHERE .=" AND p.STUDENT_ID=s.STUDENT_ID ";
         $_SESSION['p'] = '1';
     }
 
     if (optional_param('doctors_note_comments', '', PARAM_NOTAGS) || optional_param('med_day', '', PARAM_NOTAGS) || optional_param('med_month', '', PARAM_NOTAGS) || optional_param('med_year', '', PARAM_NOTAGS) || $_SESSION['smn']) {
-        $teacher_COMMON_FROM .= " ,student_medical_notes smn ";
-        $teacher_COMMON_WHERE .= " AND smn.STUDENT_ID=s.STUDENT_ID ";
+        $teacher_COMMON_FROM .=" ,student_medical_notes smn ";
+        $teacher_COMMON_WHERE .=" AND smn.STUDENT_ID=s.STUDENT_ID ";
         $_SESSION['smn'] = '1';
     }
 
     if (optional_param('type', '', PARAM_NOTAGS) || optional_param('imm_comments', '', PARAM_NOTAGS) || optional_param('imm_day', '', PARAM_NOTAGS) || optional_param('imm_month', '', PARAM_NOTAGS) || optional_param('imm_year', '', PARAM_NOTAGS) || $_SESSION['sm']) {
 
-        $teacher_COMMON_FROM .= " ,student_immunization sm ";
-        $teacher_COMMON_WHERE .= " AND sm.STUDENT_ID=s.STUDENT_ID ";
+        $teacher_COMMON_FROM .=" ,student_immunization sm ";
+        $teacher_COMMON_WHERE .=" AND sm.STUDENT_ID=s.STUDENT_ID ";
         $_SESSION['sm'] = '1';
     }
 
     if (optional_param('ma_day', '', PARAM_NOTAGS) || optional_param('ma_month', '', PARAM_NOTAGS) || optional_param('ma_year', '', PARAM_NOTAGS) || optional_param('med_alrt_title', '', PARAM_NOTAGS) || $_SESSION['sma']) {
-        $teacher_COMMON_FROM .= " ,student_medical_alerts sma  ";
-        $teacher_COMMON_WHERE .= " AND sma.STUDENT_ID=s.STUDENT_ID ";
+        $teacher_COMMON_FROM .=" ,student_medical_alerts sma  ";
+        $teacher_COMMON_WHERE .=" AND sma.STUDENT_ID=s.STUDENT_ID ";
         $_SESSION['sma'] = '1';
     }
 
     if (optional_param('nv_day', '', PARAM_NOTAGS) || optional_param('nv_month', '', PARAM_NOTAGS) || optional_param('nv_year', '', PARAM_NOTAGS) || optional_param('reason', '', PARAM_NOTAGS) || optional_param('result', '', PARAM_NOTAGS) || optional_param('med_vist_comments', '', PARAM_NOTAGS) || $_SESSION['smv']) {
-        $teacher_COMMON_FROM .= " ,student_medical_visits smv   ";
-        $teacher_COMMON_WHERE .= " AND smv.STUDENT_ID=s.STUDENT_ID ";
+        $teacher_COMMON_FROM .=" ,student_medical_visits smv   ";
+        $teacher_COMMON_WHERE .=" AND smv.STUDENT_ID=s.STUDENT_ID ";
         $_SESSION['smv'] = '1';
     }
     $teacher_COMMON = $teacher_COMMON_FROM . $teacher_COMMON_WHERE;
@@ -983,26 +991,29 @@
             }
         }
     }
-
+    
 
     ##### REMOVE FILES FROM ROOT - START #####
 
     $check_backups = DBGet(DBQuery("SELECT * FROM `program_config` WHERE `program` = 'DB_BACKUP'"));
 
-    if (!empty($check_backups)) {
-        foreach ($check_backups as $each_backups) {
-            $filename = $each_backups['TITLE'] . '.sql';
+    if(!empty($check_backups))
+    {
+        foreach($check_backups as $each_backups)
+        {
+            $filename = $each_backups['TITLE'].'.sql';
 
-            if (file_exists($filename)) {
+            if(file_exists($filename))
+            {
                 unlink($filename);
 
-                DBQuery("DELETE FROM `program_config` WHERE `program` = 'DB_BACKUP' AND `value` = '" . $each_backups['VALUE'] . "'");
+                DBQuery("DELETE FROM `program_config` WHERE `program` = 'DB_BACKUP' AND `value` = '".$each_backups['VALUE']."'");
             }
         }
     }
 
     ##### REMOVE FILES FROM ROOT - END #####
-
+    
 
     if (optional_param('modname', '', PARAM_NOTAGS) == 'users/TeacherPrograms.php?include=attendance/TakeAttendance.php')
         $allowed = true;
@@ -1031,9 +1042,10 @@
         if (Preferences('SEARCH') != 'Y' && substr(clean_param($modname, PARAM_NOTAGS), 0, 6) != 'users/')
             $_REQUEST['search_modfunc'] = 'list';
         include('modules/' . $modname);
-    } else {
+    }
+    else {
         if (User('USERNAME')) {
-            echo "" . _youReNotAllowedToUseThisProgram . "! " . _thisAttemptedViolationHasBeenLoggedAndYourIpAddressWasCaptured . ".";
+            echo ""._youReNotAllowedToUseThisProgram."! "._thisAttemptedViolationHasBeenLoggedAndYourIpAddressWasCaptured.".";
             Warehouse('footer');
 
             if ($_SERVER['HTTP_X_FORWARDED_FOR']) {
@@ -1113,7 +1125,7 @@
                 <div class="row">
                     <div class="col-md-9">
                         <div class="navbar-text">
-                            ' . _footerText . '
+                            '._footerText.'
                         </div>
                     </div>
                     <div class="col-md-3">
@@ -1128,3 +1140,4 @@
 
 echo "</body>";
 echo "</html>";
+?>

--- PasswordCheck.php ---
@@ -30,168 +30,181 @@
 include("functions/DbGetFnc.php");
 require_once("functions/PragRepFnc.php");
 function db_start()
-{
-	global $DatabaseServer, $DatabaseUsername, $DatabasePassword, $DatabaseName, $DatabasePort, $DatabaseType;
+{	global $DatabaseServer,$DatabaseUsername,$DatabasePassword,$DatabaseName,$DatabasePort,$DatabaseType;
 
-	switch ($DatabaseType) {
+	switch($DatabaseType)
+	{
 		case 'mysqli':
-			$connection = new mysqli($DatabaseServer, $DatabaseUsername, $DatabasePassword, $DatabaseName, $DatabasePort);
-			break;
+                     $connection = new mysqli($DatabaseServer,$DatabaseUsername,$DatabasePassword,$DatabaseName);
+		break;
 	}
 	// Error code for both.
-	if ($connection === false) {
-		switch ($DatabaseType) {
+	if($connection === false)
+	{
+		switch($DatabaseType)
+		{
 			case 'mysqil':
 				$errormessage = mysqli_error($connection);
-				break;
+			break;
 		}
-		db_show_error("", "" . _couldNotConnectToDatabase . ": $DatabaseServer", $errormessage);
+		db_show_error("",""._couldNotConnectToDatabase.": $DatabaseServer",$errstring);
 	}
 	return $connection;
 }
 // This function connects, and does the passed query, then returns a connection identifier.
 // Not receiving the return == unusable search.
 //		ie, $processable_results = DBQuery("select * from students");
 function DBQuery($sql)
-{
-	global $DatabaseType, $_openSIS;
+{	global $DatabaseType,$_openSIS;
 
 	$connection = db_start();
 
-	switch ($DatabaseType) {
+	switch($DatabaseType)
+	{
 		case 'mysqli':
 			$sql = str_replace('&amp;', "", $sql);
 			$sql = str_replace('&quot', "", $sql);
 			$sql = str_replace('&#039;', "", $sql);
 			$sql = str_replace('&lt;', "", $sql);
 			$sql = str_replace('&gt;', "", $sql);
-			$sql = par_rep("/([,\(=])[\r\n\t ]*''/", '\\1NULL', $sql);
-			if (preg_match_all("/'(\d\d-[A-Za-z]{3}-\d{2,4})'/", $sql, $matches)) {
-				foreach ($matches[1] as $match) {
-					$dt = date('Y-m-d', strtotime($match));
-					$sql = par_rep("/'$match'/", "'$dt'", $sql);
+		  	$sql = par_rep("/([,\(=])[\r\n\t ]*''/",'\\1NULL',$sql);
+			if(preg_match_all("/'(\d\d-[A-Za-z]{3}-\d{2,4})'/",$sql,$matches))
+				{
+					foreach($matches[1] as $match)
+					{
+						$dt = date('Y-m-d',strtotime($match));
+						$sql = par_rep("/'$match'/","'$dt'",$sql);
+					}
 				}
-			}
-			if (substr($sql, 0, 6) == "BEGIN;") {
-				$array = explode(";", $sql);
-				foreach ($array as $value) {
-					if ($value != "") {
-						$result = $connection->query($value);
-						if (!$result) {
-							$connection->query("ROLLBACK");
-							die(db_show_error($sql, _dbExecuteFailed, mysql_error()));
+			if(substr($sql,0,6)=="BEGIN;")
+			{
+				$array = explode( ";", $sql );
+				foreach( $array as $value )
+				{
+					if($value!="")
+					{
+                                            $result = $connection->query($value);
+						if(!$result)
+						{
+                                                    $connection->query("ROLLBACK");
+							die(db_show_error($sql,_dbExecuteFailed,mysql_error()));
 						}
 					}
 				}
-			} else {
-				$result = $connection->query($sql) or die(db_show_error($sql, _dbExecuteFailed, mysql_error()));
 			}
-			break;
+			else
+			{
+				$result = $connection->query($sql) or die(db_show_error($sql,_dbExecuteFailed,mysql_error()));
+			}
+		break;
 	}
 	return $result;
 }
 // return next row.
 function db_fetch_row($result)
-{
-	global $DatabaseType;
+{	global $DatabaseType;
 
-	switch ($DatabaseType) {
+	switch($DatabaseType)
+	{
 		case 'mysqli':
 			$return = $result->fetch_assoc();
-			if (is_array($return)) {
-				foreach ($return as $key => $value) {
-					if (is_int($key))
+			if(is_array($return))
+			{
+				foreach($return as $key => $value)
+				{
+					if(is_int($key))
 						unset($return[$key]);
 				}
 			}
-			break;
+		break;
 	}
-	return @array_change_key_case($return, CASE_UPPER);
+	return @array_change_key_case($return,CASE_UPPER);
 }
 
 // returns code to go into SQL statement for accessing the next value of a sequence function db_seq_nextval($seqname)
 function db_seq_nextval($seqname)
-{
-	global $DatabaseType;
-
-	if ($DatabaseType == 'mysqli')
-		$seq = "fn_" . strtolower($seqname) . "()";
+{	global $DatabaseType;
 
+	if($DatabaseType=='mysqli')
+		$seq="fn_".strtolower($seqname)."()";
+		
 	return $seq;
 }
 
 function db_case($array)
-{
-	global $DatabaseType;
+{	global $DatabaseType;
 
-	$counter = 0;
-	if ($DatabaseType == 'mysqli') {
-		$array_count = count($array);
+	$counter=0;
+	if($DatabaseType=='mysqli')
+	{
+		$array_count=count($array);
 		$string = " CASE WHEN $array[0] =";
 		$counter++;
 		$arr_count = count($array);
-		for ($i = 1; $i < $arr_count; $i++) {
+		for($i=1;$i<$arr_count;$i++)
+		{
 			$value = $array[$i];
 
-			if ($value == "''" && substr($string, -1) == '=') {
+			if($value=="''" && substr($string,-1)=='=')
+			{
 				$value = ' IS NULL';
-				$string = substr($string, 0, -1);
+				$string = substr($string,0,-1);
 			}
 
-			$string .= "$value";
-			if ($counter == ($array_count - 2) && $array_count % 2 == 0)
-				$string .= " ELSE ";
-			elseif ($counter == ($array_count - 1))
-				$string .= " END ";
-			elseif ($counter % 2 == 0)
-				$string .= " WHEN $array[0]=";
-			elseif ($counter % 2 == 1)
-				$string .= " THEN ";
+			$string.="$value";
+			if($counter==($array_count-2) && $array_count%2==0)
+				$string.=" ELSE ";
+			elseif($counter==($array_count-1))
+				$string.=" END ";
+			elseif($counter%2==0)
+				$string.=" WHEN $array[0]=";
+			elseif($counter%2==1)
+				$string.=" THEN ";
 
 			$counter++;
 		}
 	}
-
+	
 	return $string;
 }
 
 function db_properties($table)
-{
-	global $DatabaseType, $DatabaseUsername;
+{	global $DatabaseType,$DatabaseUsername;
 
-	switch ($DatabaseType) {
+	switch($DatabaseType)
+	{
 		case 'mysqli':
 			$result = DBQuery("SHOW COLUMNS FROM $table");
-			while ($row = db_fetch_row($result)) {
-				$properties[strtoupper($row['FIELD'])]['TYPE'] = strtoupper($row['TYPE'], strpos($row['TYPE'], '('));
-				if (!$pos = strpos($row['TYPE'], ','))
-					$pos = strpos($row['TYPE'], ')');
+			while($row = db_fetch_row($result))
+			{
+				$properties[strtoupper($row['FIELD'])]['TYPE'] = strtoupper($row['TYPE'],strpos($row['TYPE'],'('));
+				if(!$pos = strpos($row['TYPE'],','))
+					$pos = strpos($row['TYPE'],')');
 				else
-					$properties[strtoupper($row['FIELD'])]['SCALE'] = substr($row['TYPE'], $pos + 1);
+					$properties[strtoupper($row['FIELD'])]['SCALE'] = substr($row['TYPE'],$pos+1);
 
-				$properties[strtoupper($row['FIELD'])]['SIZE'] = substr($row['TYPE'], strpos($row['TYPE'], '(') + 1, $pos);
+				$properties[strtoupper($row['FIELD'])]['SIZE'] = substr($row['TYPE'],strpos($row['TYPE'],'(')+1,$pos);
 
-				if ($row['NULL'] != '')
+				if($row['NULL']!='')
 					$properties[strtoupper($row['FIELD'])]['NULL'] = "Y";
 				else
 					$properties[strtoupper($row['FIELD'])]['NULL'] = "N";
 			}
-			break;
+		break;
 	}
 	return $properties;
 }
-function db_show_error($sql, $failnote, $additional = '')
-{
-	global $openSISTitle, $openSISVersion, $openSISNotifyAddress, $openSISMode;
-
+function db_show_error($sql,$failnote,$additional='')
+{	global $openSISTitle,$openSISVersion,$openSISNotifyAddress,$openSISMode;
 
+	
 	$tb = debug_backtrace();
 	$error = $tb[1]['file'] . " at " . $tb[1]['line'];
-
-	echo "
+        
+            echo "
                     <TABLE CELLSPACING=10 BORDER=0>
                             <TD align=right><b>Date:</TD>
-                            <TD><pre>" . date("m/d/Y h:i:s") . "</pre></TD>
+                            <TD><pre>".date("m/d/Y h:i:s")."</pre></TD>
                     </TR><TR>
                             <TD align=right><b>Failure Notice:</b></TD>
                             <TD><pre> $failnote </pre></TD>
@@ -208,11 +221,11 @@ function db_show_error($sql, $failnote, $additional = '')
                             <TD>$additional</TD>
                     </TR>
                     </TABLE>";
-
-	echo "
+       
+		echo "
 		<TABLE CELLSPACING=10 BORDER=0>
 			<TR><TD align=right><b>Date:</TD>
-			<TD><pre>" . date("m/d/Y h:i:s") . "</pre></TD>
+			<TD><pre>".date("m/d/Y h:i:s")."</pre></TD>
 		</TR><TR>
 			<TD align=right></TD>
 			<TD>openSIS has encountered an error that could have resulted from any of the following:
@@ -228,27 +241,33 @@ function db_show_error($sql, $failnote, $additional = '')
 		</TR>
 		
 		</TABLE>";
-
+        
 	echo "<!-- SQL STATEMENT: \n\n $sql \n\n -->";
 
-	if ($openSISNotifyAddress) {
+	if($openSISNotifyAddress)
+	{
 		$message = "System: $openSISTitle \n";
-		$message .= "Date: " . date("m/d/Y h:i:s") . "\n";
-		$message .= "Page: " . $_SERVER['PHP_SELF'] . ' ' . ProgramTitle() . " \n\n";
+		$message .= "Date: ".date("m/d/Y h:i:s")."\n";
+		$message .= "Page: ".$_SERVER['PHP_SELF'].' '.ProgramTitle()." \n\n";
 		$message .= "Failure Notice:  $failnote \n";
 		$message .= "Additional Info: $additional \n";
 		$message .= "\n $sql \n";
-		$message .= "Request Array: \n" . ShowVar($_REQUEST, 'Y', 'N');
-		$message .= "\n\nSession Array: \n" . ShowVar($_SESSION, 'Y', 'N');
-		mail($openSISNotifyAddress, 'openSIS Database Error', $message);
+		$message .= "Request Array: \n".ShowVar($_REQUEST,'Y', 'N');
+		$message .= "\n\nSession Array: \n".ShowVar($_SESSION,'Y', 'N');
+		mail($openSISNotifyAddress,'openSIS Database Error',$message);
+
 	}
 
 	die();
 }
 
-$res_pass_chk = DBGet(DBQuery("SELECT * FROM login_authentication WHERE PASSWORD = '" . md5($_GET['password']) . "' AND USERNAME!='" . $_GET['usrid'] . "' AND PROFILE_ID!='" . $_GET['prof_id'] . "'"));
-if ($res_pass_chk[1]['USER_ID'] != '') {
-	echo '1';
-} else {
-	echo '0';
-}
+$res_pass_chk = DBGet(DBQuery("SELECT * FROM login_authentication WHERE PASSWORD = '".md5($_GET['password'])."' AND USERNAME!='".$_GET['usrid']."' AND PROFILE_ID!='".$_GET['prof_id']."'"));
+                        if($res_pass_chk[1]['USER_ID']!='')
+                        {
+                            echo '1';
+                            
+                        }
+                        else
+                        {
+                            echo '0';
+                        }
\ No newline at end of file

--- ResetUserInfo.php ---
@@ -34,13 +34,12 @@
 include("AuthCryp.php");
 include('functions/SqlSecurityFnc.php');
 
-function db_start()
-{
+function db_start() {
     global $DatabaseServer, $DatabaseUsername, $DatabasePassword, $DatabaseName, $DatabasePort, $DatabaseType;
 
     switch ($DatabaseType) {
         case 'mysqli':
-            $connection = new mysqli($DatabaseServer, $DatabaseUsername, $DatabasePassword, $DatabaseName, $DatabasePort);
+            $connection = new mysqli($DatabaseServer, $DatabaseUsername, $DatabasePassword, $DatabaseName);
             break;
     }
 
@@ -51,16 +50,15 @@ function db_start()
                 $errormessage = mysqli_error($connection);
                 break;
         }
-        db_show_error("", "" . _couldNotConnectToDatabase . ": $DatabaseServer", $errormessage);
+        db_show_error("", ""._couldNotConnectToDatabase.": $DatabaseServer", $errstring);
     }
     return $connection;
 }
 
 // This function connects, and does the passed query, then returns a connection identifier.
 // Not receiving the return == unusable search.
 //		ie, $processable_results = DBQuery("select * from students");
-function DBQuery($sql)
-{
+function DBQuery($sql) {
     global $DatabaseType, $_openSIS;
 
     $connection = db_start();
@@ -99,8 +97,7 @@ function DBQuery($sql)
 }
 
 // return next row.
-function db_fetch_row($result)
-{
+function db_fetch_row($result) {
     global $DatabaseType;
 
     switch ($DatabaseType) {
@@ -118,8 +115,7 @@ function db_fetch_row($result)
 }
 
 // returns code to go into SQL statement for accessing the next value of a sequence function db_seq_nextval($seqname)
-function db_seq_nextval($seqname)
-{
+function db_seq_nextval($seqname) {
     global $DatabaseType;
 
     if ($DatabaseType == 'mysqli')
@@ -128,8 +124,7 @@ function db_seq_nextval($seqname)
     return $seq;
 }
 
-function db_case($array)
-{
+function db_case($array) {
     global $DatabaseType;
 
     $counter = 0;
@@ -146,15 +141,15 @@ function db_case($array)
                 $string = substr($string, 0, -1);
             }
 
-            $string .= "$value";
+            $string.="$value";
             if ($counter == ($array_count - 2) && $array_count % 2 == 0)
-                $string .= " ELSE ";
+                $string.=" ELSE ";
             elseif ($counter == ($array_count - 1))
-                $string .= " END ";
+                $string.=" END ";
             elseif ($counter % 2 == 0)
-                $string .= " WHEN $array[0]=";
+                $string.=" WHEN $array[0]=";
             elseif ($counter % 2 == 1)
-                $string .= " THEN ";
+                $string.=" THEN ";
 
             $counter++;
         }
@@ -163,8 +158,7 @@ function db_case($array)
     return $string;
 }
 
-function db_properties($table)
-{
+function db_properties($table) {
     global $DatabaseType, $DatabaseUsername;
 
     switch ($DatabaseType) {
@@ -189,8 +183,7 @@ function db_properties($table)
     return $properties;
 }
 
-function db_show_error($sql, $failnote, $additional = '')
-{
+function db_show_error($sql, $failnote, $additional = '') {
     global $openSISTitle, $openSISVersion, $openSISNotifyAddress, $openSISMode;
 
 
@@ -267,15 +260,15 @@ function db_show_error($sql, $failnote, $additional = '')
     if ($_REQUEST['pass_user_type'] == 'pass_student') {
         if ($_REQUEST['password_stn_id'] == '') {
             $_SESSION['err_msg'] = '<font color="red"><b>Please Enter Student Id.</b></font>';
-            echo '<script>window.location.href="ForgotPass.php"</script>';
+            echo'<script>window.location.href="ForgotPass.php"</script>';
         }
         if ($_REQUEST['uname'] == '') {
             $_SESSION['err_msg'] = '<font color="red"><b>Please Enter Username.</b></font>';
-            echo '<script>window.location.href="ForgotPass.php"</script>';
+            echo'<script>window.location.href="ForgotPass.php"</script>';
         }
         if ($_REQUEST['month_password_dob'] == '' || $_REQUEST['day_password_dob'] == '' || $_REQUEST['year_password_dob'] == '') {
             $_SESSION['err_msg'] = '<font color="red"><b>Please Enter Birthday Properly.</b></font>';
-            echo '<script>window.location.href="ForgotPass.php"</script>';
+            echo'<script>window.location.href="ForgotPass.php"</script>';
         }
 
         if ($_REQUEST['password_stn_id'] != '' && $_REQUEST['uname'] != '' && $_REQUEST['month_password_dob'] != '' && $_REQUEST['day_password_dob'] != '' && $_REQUEST['year_password_dob'] != '') {
@@ -285,7 +278,7 @@ function db_show_error($sql, $failnote, $additional = '')
             if ($stu_info[1]['STUDENT_ID'] == '') {
                 $_SESSION['err_msg'] = '<font color="red" ><b>Incorrect login credential.</b></font>';
 
-                echo '<script>window.location.href="ForgotPass.php"</script>';
+                echo'<script>window.location.href="ForgotPass.php"</script>';
             } else {
                 $flag = 'stu_pass';
             }
@@ -295,11 +288,11 @@ function db_show_error($sql, $failnote, $additional = '')
 
         if ($_REQUEST['uname'] == '') {
             $_SESSION['err_msg'] = '<font color="red"><b>Please Enter Username.</b></font>';
-            echo '<script>window.location.href="ForgotPass.php"</script>';
+            echo'<script>window.location.href="ForgotPass.php"</script>';
         }
         if ($_REQUEST['password_stf_email'] == '') {
             $_SESSION['err_msg'] = '<font color="red"><b>Please Enter Email Address.</b></font>';
-            echo '<script>window.location.href="ForgotPass.php"</script>';
+            echo'<script>window.location.href="ForgotPass.php"</script>';
         }
 
         if ($_REQUEST['password_stf_email'] != '' && $_REQUEST['uname'] != '') {
@@ -308,7 +301,7 @@ function db_show_error($sql, $failnote, $additional = '')
 
             if ($stf_info[1]['STAFF_ID'] == '') {
                 $_SESSION['err_msg'] = '<font color="red" ><b>Incorrect login credential.</b></font>';
-                echo '<script>window.location.href="ForgotPass.php"</script>';
+                echo'<script>window.location.href="ForgotPass.php"</script>';
             } else {
                 $flag = 'stf_pass';
             }
@@ -317,11 +310,11 @@ function db_show_error($sql, $failnote, $additional = '')
     if ($_REQUEST['pass_user_type'] == 'pass_parent') {
         if ($_REQUEST['uname'] == '') {
             $_SESSION['err_msg'] = '<font color="red"><b>Please Enter Username.</b></font>';
-            echo '<script>window.location.href="ForgotPass.php"</script>';
+            echo'<script>window.location.href="ForgotPass.php"</script>';
         }
         if ($_REQUEST['password_stf_email'] == '') {
             $_SESSION['err_msg'] = '<font color="red"><b>Please Enter Email Address.</b></font>';
-            echo '<script>window.location.href="ForgotPass.php"</script>';
+            echo'<script>window.location.href="ForgotPass.php"</script>';
         }
 
         if ($_REQUEST['password_stf_email'] != '' && $_REQUEST['uname'] != '') {
@@ -330,7 +323,7 @@ function db_show_error($sql, $failnote, $additional = '')
 
             if ($par_info[1]['STAFF_ID'] == '') {
                 $_SESSION['err_msg'] = '<font color="red" ><b>Incorrect login credential.</b></font>';
-                echo '<script>window.location.href="ForgotPass.php"</script>';
+                echo'<script>window.location.href="ForgotPass.php"</script>';
             } else {
                 $flag = 'par_pass';
             }
@@ -341,15 +334,15 @@ function db_show_error($sql, $failnote, $additional = '')
     if ($_REQUEST['uname_user_type'] == 'uname_student') {
         if ($_REQUEST['username_stn_id'] == '') {
             $_SESSION['err_msg'] = '<font color="red"><b>Please Enter Student Id.</b></font>';
-            echo '<script>window.location.href="ForgotPass.php"</script>';
+            echo'<script>window.location.href="ForgotPass.php"</script>';
         }
         if ($_REQUEST['pass'] == '') {
             $_SESSION['err_msg'] = '<font color="red"><b>Please Enter Password.</b></font>';
-            echo '<script>window.location.href="ForgotPass.php"</script>';
+            echo'<script>window.location.href="ForgotPass.php"</script>';
         }
         if ($_REQUEST['month_username_dob'] == '' || $_REQUEST['day_username_dob'] == '' || $_REQUEST['year_username_dob'] == '') {
             $_SESSION['err_msg'] = '<font color="red"><b>Please Enter Birthday Properly.</b></font>';
-            echo '<script>window.location.href="ForgotPass.php"</script>';
+            echo'<script>window.location.href="ForgotPass.php"</script>';
         }
 
         if ($_REQUEST['username_stn_id'] != '' && $_REQUEST['pass'] != '' && $_REQUEST['month_username_dob'] != '' && $_REQUEST['day_username_dob'] != '' && $_REQUEST['year_username_dob'] != '') {
@@ -358,58 +351,58 @@ function db_show_error($sql, $failnote, $additional = '')
 
             if ($stu_info[1]['STUDENT_ID'] == '') {
                 $_SESSION['err_msg'] = '<font color="red" ><b>Incorrect login credential.</b></font>';
-                echo '<script>window.location.href="ForgotPass.php"</script>';
+                echo'<script>window.location.href="ForgotPass.php"</script>';
             } else {
                 $get_uname = DBGet(DBQuery('SELECT USERNAME FROM login_authentication WHERE USER_ID=' . $username_stn_id . ' AND PROFILE_ID=3'));
                 $_SESSION['fill_username'] = $get_uname[1]['USERNAME'];
-                echo '<script>window.location.href="index.php"</script>';
+                echo'<script>window.location.href="index.php"</script>';
             }
         }
     }
     if ($_REQUEST['uname_user_type'] == 'uname_staff') {
 
         if ($_REQUEST['pass'] == '') {
             $_SESSION['err_msg'] = '<font color="red"><b>Please Enter Password.</b></font>';
-            echo '<script>window.location.href="ForgotPass.php"</script>';
+            echo'<script>window.location.href="ForgotPass.php"</script>';
         }
         if ($_REQUEST['username_stf_email'] == '') {
             $_SESSION['err_msg'] = '<font color="red"><b>Please Enter Email Address.</b></font>';
-            echo '<script>window.location.href="ForgotPass.php"</script>';
+            echo'<script>window.location.href="ForgotPass.php"</script>';
         }
 
         if ($_REQUEST['username_stf_email'] != '' && $_REQUEST['pass'] != '') {
             $stf_info = DBGet(DBQuery('SELECT s.* FROM staff s,login_authentication la WHERE la.USER_ID=s.STAFF_ID AND la.PASSWORD=\'' . md5($_REQUEST['pass']) . '\' AND s.EMAIL=\'' . $username_stf_email . '\''));
 
             if ($stf_info[1]['STAFF_ID'] == '') {
                 $_SESSION['err_msg'] = '<font color="red" ><b>Incorrect login credential.</b></font>';
-                echo '<script>window.location.href="ForgotPass.php"</script>';
+                echo'<script>window.location.href="ForgotPass.php"</script>';
             } else {
                 $get_uname = DBGet(DBQuery('SELECT USERNAME FROM login_authentication WHERE USER_ID=' . $stf_info[1]['STAFF_ID'] . ' AND PROFILE_ID=' . $stf_info[1]['PROFILE_ID']));
                 $_SESSION['fill_username'] = $get_uname[1]['USERNAME'];
-                echo '<script>window.location.href="index.php"</script>';
+                echo'<script>window.location.href="index.php"</script>';
             }
         }
     }
     if ($_REQUEST['uname_user_type'] == 'uname_parent') {
         if ($_REQUEST['pass'] == '') {
             $_SESSION['err_msg'] = '<font color="red"><b>Please Enter Password.</b></font>';
-            echo '<script>window.location.href="ForgotPass.php"</script>';
+            echo'<script>window.location.href="ForgotPass.php"</script>';
         }
         if ($_REQUEST['username_stf_email'] == '') {
             $_SESSION['err_msg'] = '<font color="red"><b>Please Enter Email Address.</b></font>';
-            echo '<script>window.location.href="ForgotPass.php"</script>';
+            echo'<script>window.location.href="ForgotPass.php"</script>';
         }
 
         if ($_REQUEST['username_stf_email'] != '' && $_REQUEST['pass'] != '') {
             $par_info = DBGet(DBQuery('SELECT p.* FROM people p,login_authentication la WHERE la.USER_ID=p.STAFF_ID AND la.PASSWORD=\'' . md5($_REQUEST['pass']) . '\' AND p.EMAIL=\'' . $username_stf_email . '\' '));
 
             if ($par_info[1]['STAFF_ID'] == '') {
                 $_SESSION['err_msg'] = '<font color="red" ><b>Incorrect login credential.</b></font>';
-                echo '<script>window.location.href="ForgotPass.php"</script>';
+                echo'<script>window.location.href="ForgotPass.php"</script>';
             } else {
                 $get_uname = DBGet(DBQuery('SELECT USERNAME FROM login_authentication WHERE USER_ID=' . $par_info[1]['STAFF_ID'] . ' AND PROFILE_ID=4'));
                 $_SESSION['fill_username'] = $get_uname[1]['USERNAME'];
-                echo '<script>window.location.href="index.php"</script>';
+                echo'<script>window.location.href="index.php"</script>';
             }
         }
     }
@@ -427,158 +420,156 @@ function db_show_error($sql, $failnote, $additional = '')
     } else {
         DBQuery('UPDATE login_authentication SET password=\'' . md5($_REQUEST['ver_pass']) . '\' WHERE user_id=\'' . $get_vals[0] . '\' AND profile_id=\'' . $get_vals[1] . '\' ');
         $_SESSION['conf_msg'] = '<font color="red" ><b>Password updated successfully.</b></font>';
-        echo '<script>window.location.href="index.php"</script>';
+        echo'<script>window.location.href="index.php"</script>';
     }
 }
 ?>
 <!DOCTYPE html>
 <html lang="en">
+    <head>
+        <meta charset="utf-8">
+        <meta http-equiv="X-UA-Compatible" content="IE=edge">
+        <meta name="viewport" content="width=device-width, initial-scale=1">
+        <title>openSIS Student Information System</title>
+        <link rel="shortcut icon" href="favicon.ico">
+        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
+        <link href="styles/fonts/font-awesome/css/font-awesome.min.css" rel="stylesheet">
+        <link rel="stylesheet" type="text/css" href="assets/css/bootstrap.min.css">
+        <link rel="stylesheet" type="text/css" href="assets/css/login.css">
+        <script src='js/Ajaxload.js'></script>
+        <script src='js/Validation.js'></script>
+        <script src='js/Validator.js'></script>
+        <script src='js/ForgotPass.js'></script>
+        <script type='text/javascript'>
+            function init(param, param2) {
+                calendar.set('date_' + param);
+                document.getElementById('date_' + param).click();
+            }
+        </script>
 
-<head>
-    <meta charset="utf-8">
-    <meta http-equiv="X-UA-Compatible" content="IE=edge">
-    <meta name="viewport" content="width=device-width, initial-scale=1">
-    <title>openSIS Student Information System</title>
-    <link rel="shortcut icon" href="favicon.ico">
-    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
-    <link href="styles/fonts/font-awesome/css/font-awesome.min.css" rel="stylesheet">
-    <link rel="stylesheet" type="text/css" href="assets/css/bootstrap.min.css">
-    <link rel="stylesheet" type="text/css" href="assets/css/login.css">
-    <script src='js/Ajaxload.js'></script>
-    <script src='js/Validation.js'></script>
-    <script src='js/Validator.js'></script>
-    <script src='js/ForgotPass.js'></script>
-    <script type='text/javascript'>
-        function init(param, param2) {
-            calendar.set('date_' + param);
-            document.getElementById('date_' + param).click();
-        }
-    </script>
-
-    <script src="assets/js/core/libraries/jquery.min.js"></script>
-    <script src="assets/js/core/libraries/bootstrap.min.js"></script>
-    <script type="text/javascript">
-        $(document).ready(function() {
-
-            var monthNames = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
-            var dayNames = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"]
+        <script src="assets/js/core/libraries/jquery.min.js"></script>
+        <script src="assets/js/core/libraries/bootstrap.min.js"></script>
+        <script type="text/javascript">
+            $(document).ready(function () {
 
+                var monthNames = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
+                var dayNames = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"]
 
-            var newDate = new Date();
 
-            newDate.setDate(newDate.getDate());
+                var newDate = new Date();
 
-            $('#Date').html(dayNames[newDate.getDay()] + ", " + monthNames[newDate.getMonth()] + ' ' + newDate.getDate() + ', ' + newDate.getFullYear());
+                newDate.setDate(newDate.getDate());
 
+                $('#Date').html(dayNames[newDate.getDay()] + ", " + monthNames[newDate.getMonth()] + ' ' + newDate.getDate() + ', ' + newDate.getFullYear());
 
 
-            setInterval(function() {
-                // Create a newDate() object and extract the minutes of the current time on the visitor's
-                var minutes = new Date().getMinutes();
-                // Add a leading zero to the minutes value
-                $("#min").html((minutes < 10 ? "0" : "") + minutes);
-            }, 1000);
 
-            setInterval(function() {
-                // Create a newDate() object and extract the hours of the current time on the visitor's
-                var hours = new Date().getHours();
-                // Add a leading zero to the hours value
-                $("#hours").html((hours < 10 ? "0" : "") + hours);
-            }, 1000);
-        });
-    </script>
-    <!--custom script-->
-    <script src="js/custom.js"></script>
-</head>
+                setInterval(function () {
+                    // Create a newDate() object and extract the minutes of the current time on the visitor's
+                    var minutes = new Date().getMinutes();
+                    // Add a leading zero to the minutes value
+                    $("#min").html((minutes < 10 ? "0" : "") + minutes);
+                }, 1000);
 
-<body>
+                setInterval(function () {
+                    // Create a newDate() object and extract the hours of the current time on the visitor's
+                    var hours = new Date().getHours();
+                    // Add a leading zero to the hours value
+                    $("#hours").html((hours < 10 ? "0" : "") + hours);
+                }, 1000);
+            });
+        </script>
+        <!--custom script-->
+        <script src="js/custom.js"></script>
+    </head>
+    <body>
 
-    <div class="clock">
-        <ul>
-            <li id="hours"></li>
-            <li id="point">:</li>
-            <li id="min"></li>
-        </ul>
-        <div id="Date"></div>
-    </div>
-    <section class="login">
-        <div class="login-wrapper">
+        <div class="clock">
+            <ul>
+                <li id="hours"></li>
+                <li id="point">:</li>
+                <li id="min"></li>
+            </ul>
+            <div id="Date"></div>
+        </div>
+        <section class="login">
+            <div class="login-wrapper">
 
-            <div class="panel">
+                <div class="panel">
 
-                <div class="panel-heading">
-                    <div class="logo">
-                        <img src="assets/images/opensis_logo.png" alt="openSIS" />
+                    <div class="panel-heading">
+                        <div class="logo">
+                            <img src="assets/images/opensis_logo.png" alt="openSIS" />
+                        </div>                    
+                        <h3>Forgot Password</h3>
                     </div>
-                    <h3>Forgot Password</h3>
-                </div>
-                <div class="panel-body">
-                    <form name="f1" method="post" class="text-left" action="">
-
-                        <?php if ($flag == 'stu_pass') { ?>
-                            <input type="hidden" name="user_info" value="<?php echo cryptor($stu_info[1]['STUDENT_ID'], 'ENC', '') . ',' . cryptor('3', 'ENC', '') . ',' . $_REQUEST['uname']; ?>" />
-                        <?php
-                        }
-                        if ($flag == 'stf_pass') {
-                        ?>
-                            <input type="hidden" name="user_info" value="<?php echo cryptor($stf_info[1]['STAFF_ID'], 'ENC', '') . ',' . cryptor($stf_info[1]['PROFILE_ID'], 'ENC', '') . ',' . $_REQUEST['uname']; ?>" />
-                        <?php
-                        }
-                        if ($flag == 'par_pass') {
-                        ?>
-                            <input type="hidden" name="user_info" value="<?php echo cryptor($par_info[1]['STAFF_ID'], 'ENC', '') . ',' . cryptor($par_info[1]['PROFILE_ID'], 'ENC', '') . ',' . $_REQUEST['uname']; ?>" />
-                        <?php
-                        }
-                        if ($flag == 'submited_value') {
-                        ?>
-                            <input type="hidden" name="user_info" value="<?php echo $_REQUEST['user_info']; ?>" />
-                        <?php
-                        }
-                        ?>
-
-                        <div id="divErr">
-                            <?php
-                            if ($_SESSION['err_msg_mod'] != '')
-                                echo $_SESSION['err_msg_mod'];
-                            unset($_SESSION['err_msg_mod']);
+                    <div class="panel-body">
+                        <form name="f1" method="post" class="text-left" action="">
+
+                            <?php if ($flag == 'stu_pass') { ?>
+                                <input type="hidden" name="user_info" value="<?php echo cryptor($stu_info[1]['STUDENT_ID'], 'ENC', '') . ',' . cryptor('3', 'ENC', '') . ',' . $_REQUEST['uname']; ?>"/>
+                                <?php
+                            }
+                            if ($flag == 'stf_pass') {
+                                ?>
+                                <input type="hidden" name="user_info" value="<?php echo cryptor($stf_info[1]['STAFF_ID'], 'ENC', '') . ',' . cryptor($stf_info[1]['PROFILE_ID'], 'ENC', '') . ',' . $_REQUEST['uname']; ?>"/>
+                                <?php
+                            }
+                            if ($flag == 'par_pass') {
+                                ?>
+                                <input type="hidden" name="user_info" value="<?php echo cryptor($par_info[1]['STAFF_ID'], 'ENC', '') . ',' . cryptor($par_info[1]['PROFILE_ID'], 'ENC', '') . ',' . $_REQUEST['uname']; ?>"/>
+                                <?php
+                            }
+                            if ($flag == 'submited_value') {
+                                ?>
+                                <input type="hidden" name="user_info" value="<?php echo $_REQUEST['user_info']; ?>"/>
+                                <?php
+                            }
                             ?>
-                        </div>
-                        <p>Password must be minimum 8 characters long with at least one capital, one numeric and one special character. Example: S@mple123</p>
-                        <div class="form-group">
-                            <!--                                <label class="control-label">Enter new password</label>-->
-                            <input type="password" name="new_pass" id="new_pass" class="form-control" placeholder="Enter new password" AUTOCOMPLETE="off" onkeyup="forgotpasswordStrength(this.value);
+
+                            <div id="divErr">
+                                <?php
+                                if ($_SESSION['err_msg_mod'] != '')
+                                    echo $_SESSION['err_msg_mod'];
+                                unset($_SESSION['err_msg_mod']);
+                                ?>
+                            </div>
+                            <p>Password must be minimum 8 characters long with at least one capital, one numeric and one special character. Example: S@mple123</p>
+                            <div class="form-group">
+                                <!--                                <label class="control-label">Enter new password</label>-->
+                                <input type="password" name="new_pass" id="new_pass" class="form-control" placeholder="Enter new password" AUTOCOMPLETE="off" onkeyup="forgotpasswordStrength(this.value);
                 passwordMatch();
                 forgotpassvalidate_password(this.value, '<?php echo $_REQUEST['uname']; ?>',<?php
-                                                                                            if ($flag == 'stu_pass')
-                                                                                                echo 3;
-                                                                                            else if ($flag == 'stf_pass')
-                                                                                                echo $stf_info[1]['PROFILE_ID'];
-                                                                                            else
-                                                                                                echo $par_info[1]['PROFILE_ID'];
-                                                                                            ?>);" />
-                            <p id="passwordStrength" class="p-5"></p>
-                        </div>
-
-                        <div class="form-group">
-                            <!--                                <label class="control-label">Re-enter new password</label>-->
-                            <input type="password" name="ver_pass" id="ver_pass" class="form-control" placeholder="Re-enter new password" AUTOCOMPLETE="off" onkeyup="passwordMatch();" />
-                            <p id=passwordMatch></p>
-                        </div>
-
-                        <div class="text-center">
-                            <input type="submit" name="save" class="btn btn-primary" value="Update" onClick="return pass_check();" />
-                            <a class="btn btn-default" href="ForgotPass.php" style="text-decoration:none;color:black;font-weight:bold">Cancel</a>
-                        </div>
-
-                    </form>
+                                if ($flag == 'stu_pass')
+                                    echo 3;
+                                else if ($flag == 'stf_pass')
+                                    echo $stf_info[1]['PROFILE_ID'];
+                                else
+                                    echo $par_info[1]['PROFILE_ID'];
+                                ?>);" />
+                                <p id="passwordStrength" class="p-5"></p>
+                            </div>
+
+                            <div class="form-group">
+                                <!--                                <label class="control-label">Re-enter new password</label>-->
+                                <input type="password" name="ver_pass" id="ver_pass" class="form-control" placeholder="Re-enter new password" AUTOCOMPLETE = "off" onkeyup="passwordMatch();"/>
+                                <p id=passwordMatch></p>
+                            </div>
+
+                            <div class="text-center">
+                                <input type="submit" name="save" class="btn btn-primary" value="Update" onClick="return pass_check();"/>
+                                <a class="btn btn-default" href="ForgotPass.php" style="text-decoration:none;color:black;font-weight:bold">Cancel</a>
+                            </div>
+
+                        </form>
+                    </div>
                 </div>
-            </div>
 
-            <footer>
-                Copyright &copy; Open Solutions for Education, Inc. (<a href="http://www.os4ed.com">OS4Ed</a>).
-            </footer>
-        </div>
-    </section>
-</body>
+                <footer>
+                    Copyright &copy; Open Solutions for Education, Inc. (<a href="http://www.os4ed.com">OS4Ed</a>).
+                </footer>
+            </div>
+        </section>
+    </body>
+</html>
 
-</html>
\ No newline at end of file

--- RolloverShadow.php ---
@@ -33,20 +33,22 @@
 $next_s_start_date=$_SESSION['roll_s_start_date'];
 $next_s_end_date=$_SESSION['roll_s_end_date'];
 //exit;
-$tables = array('staff'=>_users,
-'school_periods'=>_schoolPeriods,
-'school_years'=>_markingPeriods,
-'school_calendars'=>_calendars,
-'report_card_grade_scales'=>_reportCardGradeCodes,
-'course_subjects'=>_subjects,
-'courses'=>_courses,
-'course_periods'=>_coursePeriods,
-'student_enrollment'=>_students,
-'honor_roll'=>_honorRollSetup,
-'attendance_codes'=>_attendanceCodes,
-'student_enrollment_codes'=>_studentEnrollmentCodes,
-'report_card_comments'=>_reportCardCommentCodes,
-'NONE'=>_none,
+$tables = array('staff'=>'users','school_periods'=>'School Periods','school_years'=>'Marking Periods','school_calendars'=>'Calendars','report_card_grade_scales'=>'Report Card Grade Codes','course_subjects'=>'Subjects','courses'=>'Courses','course_periods'=>'Course Periods','student_enrollment'=>'Students','honor_roll'=>'Honor Roll Setup','attendance_codes'=>'Attendance Codes','student_enrollment_codes'=>'Student Enrollment Codes','report_card_comments'=>'Report Card Comment Codes','NONE'=>'none');
+$tablesDisplay = array(
+    'staff'=>_users,
+    'school_periods'=>_schoolPeriods,
+    'school_years'=>_markingPeriods,
+    'school_calendars'=>_calendars,
+    'report_card_grade_scales'=>_reportCardGradeCodes,
+    'course_subjects'=>_subjects,
+    'courses'=>_courses,
+    'course_periods'=>_coursePeriods,
+    'student_enrollment'=>_students,
+    'honor_roll'=>_honorRollSetup,
+    'attendance_codes'=>_attendanceCodes,
+    'student_enrollment_codes'=>_studentEnrollmentCodes,
+    'report_card_comments'=>_reportCardCommentCodes,
+    'NONE'=>_none,
 );
 $no_school_tables = array('student_enrollment_codes'=>true,'staff'=>true);
 switch($table)
@@ -58,7 +60,7 @@
                         DBQuery('INSERT INTO staff_school_relationship (staff_id,school_id,syear,start_date) SELECT staff_id,school_id,syear+1,start_date +INTERVAL 1 YEAR FROM staff_school_relationship WHERE school_id=\''.  UserSchool().'\' AND syear=\''. UserSyear().'\'');
                         $exists_RET[$table] = DBGet(DBQuery('SELECT count(*) AS COUNT from staff_school_relationship WHERE SYEAR=\''.$next_syear.'\' AND SCHOOL_ID=\''.UserSchool().'\''));
                         $total_rolled_data=$exists_RET[$table][1]['COUNT'];
-                        echo $tables['staff'].'|'.'(|'.$total_rolled_data.'|)';
+                        echo $tables['staff'].'|'.'(|'.$total_rolled_data.'|)|'.$tablesDisplay[$table];
                     break;
 
 		case 'school_periods':
@@ -67,7 +69,7 @@
                         DBQuery('INSERT INTO school_periods (SYEAR,SCHOOL_ID,SORT_ORDER,TITLE,SHORT_NAME,LENGTH,ATTENDANCE,ROLLOVER_ID,START_TIME,END_TIME) SELECT SYEAR+1,SCHOOL_ID,SORT_ORDER,TITLE,SHORT_NAME,LENGTH,ATTENDANCE,PERIOD_ID,START_TIME,END_TIME FROM school_periods WHERE SYEAR=\''.UserSyear().'\' AND SCHOOL_ID=\''.UserSchool().'\'');
                         $exists_RET[$table] = DBGet(DBQuery('SELECT count(*) AS COUNT from '.$table.' WHERE SYEAR=\''.$next_syear.'\''.(!$no_school_tables[$table]?' AND SCHOOL_ID=\''.UserSchool().'\'':'')));
                         $total_rolled_data=$exists_RET[$table][1]['COUNT'];
-                        echo $tables['school_periods'].'|'.'(|'.$total_rolled_data.'|)';
+                        echo $tables['school_periods'].'|'.'(|'.$total_rolled_data.'|)|'.$tablesDisplay[$table];
                     break;
 		
 		case 'school_calendars':
@@ -95,7 +97,7 @@
                         $exists_RET[$table] = DBGet(DBQuery('SELECT count(*) AS COUNT from '.$table.' WHERE SYEAR=\''.$next_syear.'\''.(!$no_school_tables[$table]?' AND SCHOOL_ID=\''.UserSchool().'\'':'')));
                         $total_rolled_data=$exists_RET[$table][1]['COUNT'];
                         
-                        echo $tables['school_calendars'].'|'.'(|'.$total_rolled_data.'|)';                                      //-------------------end--------------------------------
+                        echo $tables['school_calendars'].'|'.'(|'.$total_rolled_data.'|)|'.$tablesDisplay[$table];                                      //-------------------end--------------------------------
                     break;
 
 		case 'school_years':
@@ -163,15 +165,15 @@
                         }
                         $exists_RET[$table] = DBGet(DBQuery("SELECT count(*) AS COUNT from $table WHERE SYEAR='$next_syear'".(!$no_school_tables[$table]?" AND SCHOOL_ID='".UserSchool()."'":'')));             
                         $total_rolled_data=$exists_RET[$table][1]['COUNT'];
-                        echo $tables['school_years'].'|'.'(|'.$total_rolled_data.'|)';
+                        echo $tables['school_years'].'|'.'(|'.$total_rolled_data.'|)|'.$tablesDisplay[$table];
                     break;
 
                     case 'course_subjects':
                     DBQuery('DELETE FROM course_subjects WHERE SYEAR=\''.$next_syear.'\' AND SCHOOL_ID=\''.UserSchool().'\'');
                     DBQuery('INSERT INTO course_subjects (SYEAR,SCHOOL_ID,TITLE,SHORT_NAME,ROLLOVER_ID) SELECT SYEAR+1,SCHOOL_ID,TITLE,SHORT_NAME,SUBJECT_ID FROM course_subjects WHERE SYEAR=\''.UserSyear().'\' AND SCHOOL_ID=\''.UserSchool().'\'');
                     $exists_RET[$table] = DBGet(DBQuery('SELECT count(*) AS COUNT from '.$table.' WHERE SYEAR=\''.$next_syear.'\''.(!$no_school_tables[$table]?' AND SCHOOL_ID=\''.UserSchool().'\'':'')));
                     $total_rolled_data=$exists_RET[$table][1]['COUNT'];
-                    echo $tables['course_subjects'].'|'.'(|'.$total_rolled_data.'|)';
+                    echo $tables['course_subjects'].'|'.'(|'.$total_rolled_data.'|)|'.$tablesDisplay[$table];
                     break;
 
 		case 'courses':
@@ -180,7 +182,7 @@
                     DBQuery('INSERT INTO courses (SYEAR,SUBJECT_ID,SCHOOL_ID,GRADE_LEVEL,TITLE,SHORT_NAME,ROLLOVER_ID) SELECT SYEAR+1,(SELECT SUBJECT_ID FROM course_subjects s WHERE s.SYEAR=c.SYEAR+1 AND s.ROLLOVER_ID=c.SUBJECT_ID),SCHOOL_ID,GRADE_LEVEL,TITLE,SHORT_NAME,COURSE_ID FROM courses c WHERE SYEAR=\''.UserSyear().'\' AND SCHOOL_ID=\''.UserSchool().'\'');
                     $exists_RET[$table] = DBGet(DBQuery('SELECT count(*) AS COUNT from '.$table.' WHERE SYEAR=\''.$next_syear.'\''.(!$no_school_tables[$table]?' AND SCHOOL_ID=\''.UserSchool().'\'':'')));
                     $total_rolled_data=$exists_RET[$table][1]['COUNT'];
-                    echo $tables['courses'].'|'.'(|'.$total_rolled_data.'|)';
+                    echo $tables['courses'].'|'.'(|'.$total_rolled_data.'|)|'.$tablesDisplay[$table];
                     break;
                    
                     case 'course_periods':
@@ -241,7 +243,7 @@
                         
                         $exists_RET[$table] = DBGet(DBQuery('SELECT count(*) AS COUNT from '.$table.' WHERE SYEAR=\''.$next_syear.'\''.(!$no_school_tables[$table]?' AND SCHOOL_ID=\''.UserSchool().'\'':'')));
                         $total_rolled_data=$exists_RET[$table][1]['COUNT'];
-                    echo $tables['course_periods'].'|'.'(|'.$total_rolled_data.'|)';
+                    echo $tables['course_periods'].'|'.'(|'.$total_rolled_data.'|)|'.$tablesDisplay[$table];
                         break;
 		case 'student_enrollment':
                    
@@ -258,7 +260,7 @@
                                                     
                         $exists_RET[$table] = DBGet(DBQuery('SELECT count(*) AS COUNT from '.$table.' WHERE SYEAR=\''.$next_syear.'\''.(!$no_school_tables[$table]?' AND SCHOOL_ID=\''.UserSchool().'\'':'')));
                         $total_rolled_data=$exists_RET[$table][1]['COUNT'];
-                        echo $tables['student_enrollment'].'|'.'(|'.$total_rolled_data.'|)';
+                        echo $tables['student_enrollment'].'|'.'(|'.$total_rolled_data.'|)|'.$tablesDisplay[$table];
                     break;
         
 		case 'report_card_grade_scales':
@@ -270,7 +272,7 @@
 			DBQuery('INSERT INTO report_card_grades (SYEAR,SCHOOL_ID,TITLE,COMMENT,BREAK_OFF,GPA_VALUE,GRADE_SCALE_ID,UNWEIGHTED_GP,SORT_ORDER) SELECT SYEAR+1,SCHOOL_ID,TITLE,COMMENT,BREAK_OFF,GPA_VALUE,(SELECT ID FROM report_card_grade_scales WHERE ROLLOVER_ID=GRADE_SCALE_ID AND SCHOOL_ID=report_card_grades.SCHOOL_ID),UNWEIGHTED_GP,SORT_ORDER FROM report_card_grades WHERE SYEAR=\''.UserSyear().'\' AND SCHOOL_ID=\''.UserSchool().'\'');
                         $exists_RET[$table] = DBGet(DBQuery('SELECT count(*) AS COUNT from '.$table.' WHERE SYEAR=\''.$next_syear.'\''.(!$no_school_tables[$table]?' AND SCHOOL_ID=\''.UserSchool().'\'':'')));
                         $total_rolled_data=$exists_RET[$table][1]['COUNT'];
-                        echo $tables['report_card_grade_scales'].'|'.'(|'.$total_rolled_data.'|)';
+                        echo $tables['report_card_grade_scales'].'|'.'(|'.$total_rolled_data.'|)|'.$tablesDisplay[$table];
                     break;
        
 		case 'report_card_comments':
@@ -279,7 +281,7 @@
 			DBQuery('INSERT INTO report_card_comments (SYEAR,SCHOOL_ID,TITLE,SORT_ORDER,COURSE_ID) SELECT SYEAR+1,SCHOOL_ID,TITLE,SORT_ORDER,'.db_case(array('COURSE_ID',"''",'NULL',db_case(array('COURSE_ID','0','0','(SELECT COURSE_ID FROM courses WHERE ROLLOVER_ID=rc.COURSE_ID)')))).' FROM report_card_comments rc WHERE SYEAR=\''.UserSyear().'\' AND SCHOOL_ID=\''.UserSchool().'\'');
                         $exists_RET[$table] = DBGet(DBQuery('SELECT count(*) AS COUNT from '.$table.' WHERE SYEAR=\''.$next_syear.'\''.(!$no_school_tables[$table]?' AND SCHOOL_ID=\''.UserSchool().'\'':'')));
                         $total_rolled_data=$exists_RET[$table][1]['COUNT'];
-                        echo $tables['report_card_comments'].'|'.'(|'.$total_rolled_data.'|)';
+                        echo $tables['report_card_comments'].'|'.'(|'.$total_rolled_data.'|)|'.$tablesDisplay[$table];
                      break;
                   case 'honor_roll':
 		//case 'eligibility_activities':
@@ -296,7 +298,7 @@
                         
                         $exists_RET[$table] = DBGet(DBQuery('SELECT count(*) AS COUNT from '.$table.' WHERE SYEAR=\''.$next_syear.'\''.(!$no_school_tables[$table]?' AND SCHOOL_ID=\''.UserSchool().'\'':'')));
                         $total_rolled_data=$exists_RET[$table][1]['COUNT'];
-                        echo $tables['honor_roll'].'|'.'(|'.$total_rolled_data.'|)';
+                        echo $tables['honor_roll'].'|'.'(|'.$total_rolled_data.'|)|'.$tablesDisplay[$table];
                       break;
 
 		case 'attendance_codes':
@@ -325,7 +327,7 @@
                          
                          $exists_RET[$table] = DBGet(DBQuery('SELECT count(*) AS COUNT from '.$table.' WHERE SYEAR=\''.$next_syear.'\''.(!$no_school_tables[$table]?' AND SCHOOL_ID=\''.UserSchool().'\'':'')));
                         $total_rolled_data=$exists_RET[$table][1]['COUNT'];
-                        echo $tables['attendance_codes'].'|'.'(|'.$total_rolled_data.'|)';
+                        echo $tables['attendance_codes'].'|'.'(|'.$total_rolled_data.'|)|'.$tablesDisplay[$table];
                       
                         break;
 
@@ -351,7 +353,7 @@
                         }
                         $exists_RET[$table] = DBGet(DBQuery('SELECT count(*) AS COUNT from '.$table.' WHERE SYEAR=\''.$next_syear.'\''.(!$no_school_tables[$table]?' AND SCHOOL_ID=\''.UserSchool().'\'':'')));
                         $total_rolled_data=$exists_RET[$table][1]['COUNT'];
-                        echo $tables['student_enrollment_codes'].'|'.'(|'.$total_rolled_data.'|)';
+                        echo $tables['student_enrollment_codes'].'|'.'(|'.$total_rolled_data.'|)|'.$tablesDisplay[$table];
                       break;
 
                     case 'NONE' :

--- StudentFilterList.php ---
@@ -0,0 +1,60 @@
+<?php
+
+#**************************************************************************
+#  openSIS is a free student information system for public and non-public 
+#  schools from Open Solutions for Education, Inc. web: www.os4ed.com
+#
+#  openSIS is  web-based, open source, and comes packed with features that 
+#  include student demographic info, scheduling, grade book, attendance, 
+#  report cards, eligibility, transcripts, parent portal, 
+#  student portal and more.   
+#
+#  Visit the openSIS web site at http://www.opensis.com to learn more.
+#  If you have question regarding this system or the license, please send 
+#  an email to info@os4ed.com.
+#
+#  This program is released under the terms of the GNU General Public License as  
+#  published by the Free Software Foundation, version 2 of the License. 
+#  See license.txt.
+#
+#  This program is distributed in the hope that it will be useful,
+#  but WITHOUT ANY WARRANTY; without even the implied warranty of
+#  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+#  GNU General Public License for more details.
+#
+#  You should have received a copy of the GNU General Public License
+#  along with this program.  If not, see <http://www.gnu.org/licenses/>.
+#
+#***************************************************************************************
+
+include('RedirectRootInc.php');
+include 'Warehouse.php';
+include 'Data.php';
+
+session_start();
+
+if ($_REQUEST['modfunc'] != 'remove') {
+        
+    $sql = 'SELECT FILTER_ID, FILTER_NAME,NULL AS REMOVE_LINK,NULL AS MODIFY_LINK FROM filters WHERE SCHOOL_ID IN ('.UserSchool().',0) AND SHOW_TO IN ('. UserID().',0)';
+    $F = DBQuery($sql);
+
+    $filters_RET = DBGet($F);
+    
+    $columns2 = array('REMOVE_LINK' => '','FILTER_NAME' => _filterName,'MODIFY_LINK' => '');
+
+    $filter_counter=1;
+    foreach($filters_RET as $key)
+    {
+        $filter_remove_link='<a class="btn btn-danger btn-icon btn-xs legitRipple" href="Modules.php?modname=students/StudentFilters.php&amp;modfunc=remove&amp;filter_id='.$key['FILTER_ID'].'" onclick="hide_filter_modal();"><i class="icon-cross2 "></i></a>';
+
+        $filter_modify_link='<a class="btn btn-primary btn-xs display-inline-block" href="Modules.php?modname=students/StudentFilters.php&amp;modfunc=filter_edit&amp;filter_id='.$key['FILTER_ID'].'" onClick="hide_filter_modal()">'. _edit .'</a>';
+
+        $filters_RET[$filter_counter]['REMOVE_LINK'] = $filter_remove_link; 
+        $filters_RET[$filter_counter]['MODIFY_LINK'] = $filter_modify_link; 
+        $filter_counter++;
+    }
+
+    ListOutput($filters_RET, $columns2, _filter, _filters, false, array(), array('search' => false, 'save' => false));
+}
+
+?>

--- api/SchoolInfo.php ---
@@ -10,13 +10,12 @@
 include("../functions/SqlSecurityFnc.php");
 require_once("../Data.php");
 require_once("../functions/PragRepFnc.php");
-function db_start()
-{
+function db_start() {
     global $DatabaseServer, $DatabaseUsername, $DatabasePassword, $DatabaseName, $DatabasePort, $DatabaseType;
 
     switch ($DatabaseType) {
         case 'mysqli':
-            $connection = new mysqli($DatabaseServer, $DatabaseUsername, $DatabasePassword, $DatabaseName, $DatabasePort);
+            $connection = new mysqli($DatabaseServer, $DatabaseUsername, $DatabasePassword, $DatabaseName);
             break;
     }
 
@@ -27,16 +26,15 @@ function db_start()
                 $errormessage = mysqli_error($connection);
                 break;
         }
-        db_show_error("", "" . _couldNotConnectToDatabase . ": $DatabaseServer", $errormessage);
+        db_show_error("", ""._couldNotConnectToDatabase.": $DatabaseServer", $errstring);
     }
     return $connection;
 }
 
 // This function connects, and does the passed query, then returns a connection identifier.
 // Not receiving the return == unusable search.
 //		ie, $processable_results = DBQuery("select * from students");
-function DBQuery($sql)
-{
+function DBQuery($sql) {
     global $DatabaseType, $_openSIS;
 
     $connection = db_start();
@@ -75,8 +73,7 @@ function DBQuery($sql)
 }
 
 // return next row.
-function db_fetch_row($result)
-{
+function db_fetch_row($result) {
     global $DatabaseType;
 
     switch ($DatabaseType) {
@@ -94,8 +91,7 @@ function db_fetch_row($result)
 }
 
 // returns code to go into SQL statement for accessing the next value of a sequence function db_seq_nextval($seqname)
-function db_seq_nextval($seqname)
-{
+function db_seq_nextval($seqname) {
     global $DatabaseType;
 
     if ($DatabaseType == 'mysqli')
@@ -104,8 +100,7 @@ function db_seq_nextval($seqname)
     return $seq;
 }
 
-function db_case($array)
-{
+function db_case($array) {
     global $DatabaseType;
 
     $counter = 0;
@@ -122,24 +117,23 @@ function db_case($array)
                 $string = substr($string, 0, -1);
             }
 
-            $string .= "$value";
+            $string.="$value";
             if ($counter == ($array_count - 2) && $array_count % 2 == 0)
-                $string .= " ELSE ";
+                $string.=" ELSE ";
             elseif ($counter == ($array_count - 1))
-                $string .= " END ";
+                $string.=" END ";
             elseif ($counter % 2 == 0)
-                $string .= " WHEN $array[0]=";
+                $string.=" WHEN $array[0]=";
             elseif ($counter % 2 == 1)
-                $string .= " THEN ";
+                $string.=" THEN ";
 
             $counter++;
         }
     }
     return $string;
 }
 
-function db_properties($table)
-{
+function db_properties($table) {
     global $DatabaseType, $DatabaseUsername;
 
     switch ($DatabaseType) {
@@ -163,50 +157,55 @@ function db_properties($table)
     }
     return $properties;
 }
-function singleQuoteReplace($param1 = false, $param2 = false, $param3)
+function singleQuoteReplace($param1=false,$param2=false,$param3)
 {
-    return str_replace("'", "''", str_replace("\'", "'", $param3));
+    return str_replace("'","''",str_replace("\'","'",$param3));
 }
-function DBGet($QI, $functions = array(), $index = array())
-{
-    global $THIS_RET;
-
-    $index_count = count($index);
-    $tmp_THIS_RET = $THIS_RET;
-    $results = array();
-    while ($RET = db_fetch_row($QI)) {
-        $THIS_RET = $RET;
-
-        if ($index_count) {
-            $ind = '';
-            foreach ($index as $col)
-                $ind .= "['" . singleQuoteReplace("'", "\'", $THIS_RET[$col]) . "']";
-            eval('$s' . $ind . '++;$this_ind=$s' . $ind . ';');
-        } else
-            $s++; // 1-based if no index specified
-        foreach ($RET as $key => $value) {
-            if (strlen($value) == strlen(strip_tags($value)))
-                $value =  htmlentities($value);
-            if ($functions[$key] && function_exists($functions[$key])) {
-                if ($index_count)
-                    eval('$results' . $ind . '[$this_ind][$key] = $functions[$key]($value,$key);');
-                else
-                    $results[$s][$key] = $functions[$key]($value, $key);
-            } else {
-                if ($index_count)
-                    eval('$results' . $ind . '[$this_ind][$key] = $value;');
-                else
-                    $results[$s][$key] = $value;
-            }
-        }
-    }
-
-    $THIS_RET = $tmp_THIS_RET;
-    return $results;
+function DBGet($QI,$functions=array(),$index=array())
+{	global $THIS_RET;
+
+	$index_count = count($index);
+	$tmp_THIS_RET = $THIS_RET;
+	$results = array();
+	while($RET=db_fetch_row($QI))
+	{
+		$THIS_RET = $RET;
+
+		if($index_count)
+		{
+			$ind = '';
+			foreach($index as $col)
+				$ind .= "['".singleQuoteReplace("'","\'",$THIS_RET[$col])."']";
+			eval('$s'.$ind.'++;$this_ind=$s'.$ind.';');
+		}
+		else
+			$s++; // 1-based if no index specified
+		foreach($RET as $key=>$value)
+		{                    
+                    if(strlen($value) == strlen(strip_tags($value)))
+                    $value=  htmlentities($value);
+			if($functions[$key] && function_exists($functions[$key]))
+			{
+				if($index_count)
+					eval('$results'.$ind.'[$this_ind][$key] = $functions[$key]($value,$key);');
+				else
+					$results[$s][$key] = $functions[$key]($value,$key);
+			}
+			else
+			{
+				if($index_count)
+					eval('$results'.$ind.'[$this_ind][$key] = $value;');
+				else
+					$results[$s][$key] = $value;
+			}
+		}
+	}
+
+	$THIS_RET = $tmp_THIS_RET;
+	return $results;
 }
 
-function db_show_error($sql, $failnote, $additional = '')
-{
+function db_show_error($sql, $failnote, $additional = '') {
     global $openSISTitle, $openSISVersion, $openSISNotifyAddress, $openSISMode;
 
     $tb = debug_backtrace();
@@ -269,167 +268,208 @@ function db_show_error($sql, $failnote, $additional = '')
 
     die();
 }
-function GetMP($mp = '', $column = 'TITLE', $syear, $school)
-{
-    global $_openSIS;
-    // mab - need to translate marking_period_id to title to be useful as a function call from dbget
-    // also, it doesn't make sense to ask for same thing you give
-    if ($column == 'MARKING_PERIOD_ID')
-        $column = 'TITLE';
-
-    if (!$_openSIS['GetMP']) {
-
-        $_openSIS['GetMP'] = DBGet(DBQuery('SELECT MARKING_PERIOD_ID,TITLE,POST_START_DATE,POST_END_DATE,\'school_quarters\' AS `TABLE`,\'SEMESTER_ID\' AS `PA_ID`,SORT_ORDER,SHORT_NAME,START_DATE,END_DATE,DOES_GRADES,DOES_EXAM,DOES_COMMENTS FROM school_quarters         WHERE SYEAR=\'' . $syear . '\' AND SCHOOL_ID=\'' . $school . '\'
-					UNION      SELECT MARKING_PERIOD_ID,TITLE,POST_START_DATE,POST_END_DATE,\'school_semesters\' AS `TABLE`,\'YEAR_ID\' AS `PA_ID`,SORT_ORDER,SHORT_NAME,START_DATE,END_DATE,DOES_GRADES,DOES_EXAM,DOES_COMMENTS FROM school_semesters        WHERE SYEAR=\'' . $syear . '\' AND SCHOOL_ID=\'' . $school . '\'
-					UNION      SELECT MARKING_PERIOD_ID,TITLE,POST_START_DATE,POST_END_DATE,\'school_years\' AS `TABLE`, \'-1\' AS `PA_ID`,SORT_ORDER,SHORT_NAME,START_DATE,END_DATE,DOES_GRADES,DOES_EXAM,DOES_COMMENTS FROM school_years            WHERE SYEAR=\'' . $syear . '\' AND SCHOOL_ID=\'' . $school . '\'
-					UNION      SELECT MARKING_PERIOD_ID,TITLE,POST_START_DATE,POST_END_DATE,\'school_progress_periods\' AS `TABLE`, \'-1\' AS `PA_ID`,SORT_ORDER,SHORT_NAME,START_DATE,END_DATE,DOES_GRADES,DOES_EXAM,DOES_COMMENTS FROM school_progress_periods WHERE SYEAR=\'' . $syear . '\' AND SCHOOL_ID=\'' . $school . '\''), array(), array('MARKING_PERIOD_ID'));
-    }
+function GetMP($mp='',$column='TITLE',$syear,$school)
+{	global $_openSIS;
+	// mab - need to translate marking_period_id to title to be useful as a function call from dbget
+	// also, it doesn't make sense to ask for same thing you give
+	if($column=='MARKING_PERIOD_ID')
+		$column='TITLE';
+
+	if(!$_openSIS['GetMP'])
+	{
+           
+		$_openSIS['GetMP'] = DBGet(DBQuery('SELECT MARKING_PERIOD_ID,TITLE,POST_START_DATE,POST_END_DATE,\'school_quarters\' AS `TABLE`,\'SEMESTER_ID\' AS `PA_ID`,SORT_ORDER,SHORT_NAME,START_DATE,END_DATE,DOES_GRADES,DOES_EXAM,DOES_COMMENTS FROM school_quarters         WHERE SYEAR=\''.$syear.'\' AND SCHOOL_ID=\''.$school.'\'
+					UNION      SELECT MARKING_PERIOD_ID,TITLE,POST_START_DATE,POST_END_DATE,\'school_semesters\' AS `TABLE`,\'YEAR_ID\' AS `PA_ID`,SORT_ORDER,SHORT_NAME,START_DATE,END_DATE,DOES_GRADES,DOES_EXAM,DOES_COMMENTS FROM school_semesters        WHERE SYEAR=\''.$syear.'\' AND SCHOOL_ID=\''.$school.'\'
+					UNION      SELECT MARKING_PERIOD_ID,TITLE,POST_START_DATE,POST_END_DATE,\'school_years\' AS `TABLE`, \'-1\' AS `PA_ID`,SORT_ORDER,SHORT_NAME,START_DATE,END_DATE,DOES_GRADES,DOES_EXAM,DOES_COMMENTS FROM school_years            WHERE SYEAR=\''.$syear.'\' AND SCHOOL_ID=\''.$school.'\'
+					UNION      SELECT MARKING_PERIOD_ID,TITLE,POST_START_DATE,POST_END_DATE,\'school_progress_periods\' AS `TABLE`, \'-1\' AS `PA_ID`,SORT_ORDER,SHORT_NAME,START_DATE,END_DATE,DOES_GRADES,DOES_EXAM,DOES_COMMENTS FROM school_progress_periods WHERE SYEAR=\''.$syear.'\' AND SCHOOL_ID=\''.$school.'\''),array(),array('MARKING_PERIOD_ID'));
 
-    if (substr($mp, 0, 1) == 'E') {
-        if ($column == 'TITLE' || $column == 'SHORT_NAME')
-            $suffix = ' Exam';
-        $mp = substr($mp, 1);
-    }
-    if ($mp == '') {
-        return 'Custom';
-    } else {
-
-        if ($mp == 0 && $column == 'TITLE')
-
-            return 'Full Year' . $suffix;
-        else {
-            return $_openSIS['GetMP'][$mp][1][$column] . $suffix;
         }
-    }
-}
-function _makeLetterGrade($percent, $course_period_id = 0, $staff_id = 0, $ret = '')
+        
+	if(substr($mp,0,1)=='E')
+	{
+		if($column=='TITLE' || $column=='SHORT_NAME')
+			$suffix = ' Exam';
+		$mp = substr($mp,1);
+	}
+if($mp=='')
 {
-    global $programconfig, $_openSIS;
-
-
-
-    $cp = DBGet(DBQuery('SELECT * FROM course_periods WHERE COURSE_PERIOD_ID=' . $course_period_id));
-    if (!$programconfig[$staff_id]) {
-        $config_RET = DBGet(DBQuery('SELECT TITLE,VALUE FROM program_user_config WHERE USER_ID=\'' . $staff_id . '\' AND PROGRAM=\'Gradebook\' AND VALUE LIKE \'%_' . $course_period_id . '\''), array(), array('TITLE'));
-        if (count($config_RET))
-            foreach ($config_RET as $title => $value) {
-                $unused_var = explode('_', $value[1]['VALUE']);
-                $programconfig[$staff_id][$title] = $unused_var[0];
-                //				$programconfig[$staff_id][$title] = rtrim($value[1]['VALUE'],'_'.$course_period_id);
-            }
-        else
-            $programconfig[$staff_id] = true;
-    }
-    if (!$_openSIS['_makeLetterGrade']['courses'][$course_period_id])
-        $_openSIS['_makeLetterGrade']['courses'][$course_period_id] = DBGet(DBQuery('SELECT DOES_BREAKOFF,GRADE_SCALE_ID FROM course_periods WHERE COURSE_PERIOD_ID=\'' . $course_period_id . '\''));
-    $does_breakoff = $_openSIS['_makeLetterGrade']['courses'][$course_period_id][1]['DOES_BREAKOFF'];
-    $grade_scale_id = $_openSIS['_makeLetterGrade']['courses'][$course_period_id][1]['GRADE_SCALE_ID'];
-
-    $percent *= 100;
-
-    if ($programconfig[$staff_id]['ROUNDING'] == 'UP') {
-        $percent = ceil($percent);
-    } elseif ($programconfig[$staff_id]['ROUNDING'] == 'DOWN') {
-        $percent = floor($percent);
-    } elseif ($programconfig[$staff_id]['ROUNDING'] == 'NORMAL') {
-        $percent = round($percent, 0);
-    } else {
-        $percent = round($percent, 2); // school default
-    }
-    if ($ret == '%')
-        return $percent;
-
-    if (!$_openSIS['_makeLetterGrade']['grades'][$grade_scale_id])
-        $_openSIS['_makeLetterGrade']['grades'][$grade_scale_id] = DBGet(DBQuery('SELECT TITLE,ID,BREAK_OFF FROM report_card_grades WHERE SYEAR=\'' . $cp[1]['SYEAR'] . '\' AND SCHOOL_ID=\'' . $cp[1]['SCHOOL_ID'] . '\' AND GRADE_SCALE_ID=\'' . $grade_scale_id . '\' ORDER BY BREAK_OFF IS NOT NULL DESC,BREAK_OFF DESC,SORT_ORDER'));
-
-    foreach ($_openSIS['_makeLetterGrade']['grades'][$grade_scale_id] as $grade) {
-        if ($does_breakoff == 'Y' ? $percent >= $programconfig[$staff_id][$course_period_id . '-' . $grade['ID']] && is_numeric($programconfig[$staff_id][$course_period_id . '-' . $grade['ID']]) : $percent >= $grade['BREAK_OFF'])
-            return $ret == 'ID' ? $grade['ID'] : $grade['TITLE'];
-    }
+    return 'Custom';
+}
+ else {
+   
+  if($mp==0 && $column=='TITLE')
+      
+		return 'Full Year'.$suffix;
+	else
+        {
+		return $_openSIS['GetMP'][$mp][1][$column].$suffix;  
+        }
+}
+	
+}
+function _makeLetterGrade($percent,$course_period_id=0,$staff_id=0,$ret='')
+{	
+    global $programconfig,$_openSIS;
+	
+
+	
+$cp=DBGet(DBQuery('SELECT * FROM course_periods WHERE COURSE_PERIOD_ID='.$course_period_id));
+	if(!$programconfig[$staff_id])
+	{
+		$config_RET = DBGet(DBQuery('SELECT TITLE,VALUE FROM program_user_config WHERE USER_ID=\''.$staff_id.'\' AND PROGRAM=\'Gradebook\' AND VALUE LIKE \'%_'.$course_period_id.'\''),array(),array('TITLE'));
+		if(count($config_RET))
+			foreach($config_RET as $title=>$value)
+                        {
+                                $unused_var=explode('_',$value[1]['VALUE']);
+                                $programconfig[$staff_id][$title] =$unused_var[0];
+//				$programconfig[$staff_id][$title] = rtrim($value[1]['VALUE'],'_'.$course_period_id);
+                        }
+		else
+			$programconfig[$staff_id] = true;
+	}
+	if(!$_openSIS['_makeLetterGrade']['courses'][$course_period_id])
+		$_openSIS['_makeLetterGrade']['courses'][$course_period_id] = DBGet(DBQuery('SELECT DOES_BREAKOFF,GRADE_SCALE_ID FROM course_periods WHERE COURSE_PERIOD_ID=\''.$course_period_id.'\''));
+	$does_breakoff = $_openSIS['_makeLetterGrade']['courses'][$course_period_id][1]['DOES_BREAKOFF'];
+	$grade_scale_id = $_openSIS['_makeLetterGrade']['courses'][$course_period_id][1]['GRADE_SCALE_ID'];
+
+	$percent *= 100;
+
+		if($programconfig[$staff_id]['ROUNDING']=='UP')
+                {
+			$percent = ceil($percent);
+                }
+		elseif($programconfig[$staff_id]['ROUNDING']=='DOWN')
+                {
+			$percent = floor($percent);
+                }
+		elseif($programconfig[$staff_id]['ROUNDING']=='NORMAL')
+                {
+			$percent = round($percent,0);
+                }
+                else
+                {
+		$percent = round($percent,2); // school default
+                }
+	if($ret=='%')
+		return $percent;
+
+	if(!$_openSIS['_makeLetterGrade']['grades'][$grade_scale_id])
+		$_openSIS['_makeLetterGrade']['grades'][$grade_scale_id] = DBGet(DBQuery('SELECT TITLE,ID,BREAK_OFF FROM report_card_grades WHERE SYEAR=\''.$cp[1]['SYEAR'].'\' AND SCHOOL_ID=\''.$cp[1]['SCHOOL_ID'].'\' AND GRADE_SCALE_ID=\''.$grade_scale_id.'\' ORDER BY BREAK_OFF IS NOT NULL DESC,BREAK_OFF DESC,SORT_ORDER'));
+	
+	foreach($_openSIS['_makeLetterGrade']['grades'][$grade_scale_id] as $grade)
+	{
+		if($does_breakoff=='Y' ? $percent>=$programconfig[$staff_id][$course_period_id.'-'.$grade['ID']] && is_numeric($programconfig[$staff_id][$course_period_id.'-'.$grade['ID']]) : $percent>=$grade['BREAK_OFF'])
+			return $ret=='ID' ? $grade['ID'] : $grade['TITLE'];
+	}
 }
 
-$connection = new mysqli($DatabaseServer, $DatabaseUsername, $DatabasePassword, $DatabaseName, $DatabasePort);
+$connection = new mysqli($DatabaseServer, $DatabaseUsername, $DatabasePassword, $DatabaseName);
 
-$format     =   mysqli_real_escape_string($connection, strtolower(optional_param('format', '', PARAM_RAW)));
-$api_key    =   mysqli_real_escape_string($connection, optional_param('api_key', '', PARAM_RAW));
+$format     =   mysqli_real_escape_string($connection,strtolower(optional_param('format', '', PARAM_RAW)));
+$api_key    =   mysqli_real_escape_string($connection,optional_param('api_key', '', PARAM_RAW));
 $api_secret =   mysqli_real_escape_string($connection, optional_param('api_secret', '', PARAM_RAW));
 
 $api_key    =   sqlSecurityFilter($api_key);
 $api_secret =   sqlSecurityFilter($api_secret);
 
-$validate = DBGet(DBQuery('SELECT * FROM api_info WHERE API_KEY=\'' . $api_key . '\' AND API_SECRET=\'' . $api_secret . '\''));
-if (count($validate) > 0) {
-    //    $school_id=$_REQUEST['sch_id'];
-    $school_info = DBGet(DBQuery('SELECT * FROM schools'));
-
+$validate= DBGet(DBQuery('SELECT * FROM api_info WHERE API_KEY=\''.$api_key.'\' AND API_SECRET=\''.$api_secret.'\''));
+if(count($validate) > 0)
+{
+//    $school_id=$_REQUEST['sch_id'];
+    $school_info=DBGet(DBQuery('SELECT * FROM schools'));
+    
 
-    if ($format == 'json') {
+    if($format == 'json') 
+    {
         header('Content-type: application/json');
-        $data = array();
-        if (count($school_info) > 0) {
-            $i = 1;
-            foreach ($school_info as $key => $value) {
-                foreach ($value as $k => $val) {
-                    if ($k != 'LAST_UPDATED') {
-                        if ($k != 'UPDATED_BY') {
-                            if ($k == 'ID')
-                                $data['data'][$i]['SCHOOL_ID'] = $val;
-                            else if ($k == 'SYEAR')
-                                $data['data'][$i]['SCHOOL_YEAR'] = $val;
-                            else if ($k == 'TITLE')
-                                $data['data'][$i]['SCHOOL_NAME'] = $val;
-                            else if ($k == 'WWW_ADDRESS')
-                                $data['data'][$i]['URL'] = $val;
-                            else
-                                $data['data'][$i][$k] = $val;
+        $data=array();
+        if(count($school_info)>0)
+        {
+            $i=1;
+            foreach($school_info as $key=>$value)
+            {
+                foreach($value as $k=>$val)
+                {
+                    if($k!='LAST_UPDATED')
+                    {
+                        if($k!='UPDATED_BY')
+                        {
+                            if($k=='ID')
+                                $data['data'][$i]['SCHOOL_ID']=$val;
+                            else if($k=='SYEAR')
+                                $data['data'][$i]['SCHOOL_YEAR']=$val;
+                             else if($k=='TITLE')
+                                $data['data'][$i]['SCHOOL_NAME']=$val;
+                             else if($k=='WWW_ADDRESS')
+                                $data['data'][$i]['URL']=$val;
+                             else
+                                 $data['data'][$i][$k]=$val;
                         }
                     }
                 }
                 $i++;
             }
-            echo json_encode($data);
-        }
+             echo json_encode($data);
+        }               
     }
-    if ($format == 'xml') {
+    if($format == 'xml')
+    {
         header('Content-type: text/xml');
-        if (count($school_info) > 0) {
+        if(count($school_info)> 0)
+        {
             echo '<data>';
-            $i = 1;
-            foreach ($school_info as $key => $val) {
-                echo '<SCHOOL_' . $i . '>';
+            $i=1;
+            foreach($school_info as $key=>$val)
+            {
+                echo'<SCHOOL_'.$i.'>';
                 foreach ($val as $vkey => $value) {
-                    if ($vkey != 'LAST_UPDATED') {
-                        if ($vkey != 'UPDATED_BY') {
-                            if ($vkey == 'ID')
-                                echo '<SCHOOL_ID>' . htmlentities($value) . '</SCHOOL_ID>';
-                            else if ($vkey == 'SYEAR')
-                                echo '<SCHOOL_YEAR>' . htmlentities($value) . '</SCHOOL_YEAR>';
-                            else if ($vkey == 'TITLE')
-                                echo '<SCHOOL_NAME>' . htmlentities($value) . '</SCHOOL_NAME>';
-                            else if ($vkey == 'WWW_ADDRESS')
-                                echo '<URL>' . htmlentities($value) . '</URL>';
+                    if($vkey!='LAST_UPDATED')
+                    {
+                        if($vkey!='UPDATED_BY')
+                        {
+                            if($vkey=='ID')
+                                 echo '<SCHOOL_ID>'.htmlentities($value).'</SCHOOL_ID>';
+                            else if($vkey=='SYEAR')
+                                 echo '<SCHOOL_YEAR>'.htmlentities($value).'</SCHOOL_YEAR>';
+                            else if($vkey=='TITLE')
+                                 echo '<SCHOOL_NAME>'.htmlentities($value).'</SCHOOL_NAME>';
+                            else if($vkey=='WWW_ADDRESS')
+                                 echo '<URL>'.htmlentities($value).'</URL>';
                             else
-                                echo '<' . $vkey . '>' . htmlentities($value) . '</' . $vkey . '>';
+                    echo '<'.$vkey.'>'.htmlentities($value).'</'.$vkey.'>';
                         }
                     }
                 }
-                echo '</SCHOOL_' . $i . '>';
-                $i++;
+                 echo'</SCHOOL_'.$i.'>';
+                 $i++;
             }
             echo '</data>';
         }
     }
-} else {
-    $data['error'] = 'Invalid Credentials.';
-    if ($format == 'json') {
-        header('Content-type: application/json');
+}
 
-        if (count($data) > 0) {
-            echo  json_encode($data);
+else
+{
+    $data['error']='Invalid Credentials.';
+    if($format == 'json') 
+    {
+        header('Content-type: application/json');
+        
+        if(count($data)>0)
+        {
+             echo  json_encode($data);
         }
+                      
     }
-    if ($format == 'xml') {
+    if($format == 'xml')
+    {
         header('Content-type: text/xml');
         echo '<error>Invalid Credentials.</error>';
     }
 }
+
+
+
+
+?>
+

--- api/StaffInfo.php ---
@@ -11,13 +11,12 @@
 require_once("../functions/PragRepFnc.php");
 ini_set('memory_limit', '1200000000M');
 ini_set('max_execution_time', '500000');
-function db_start()
-{
+function db_start() {
     global $DatabaseServer, $DatabaseUsername, $DatabasePassword, $DatabaseName, $DatabasePort, $DatabaseType;
 
     switch ($DatabaseType) {
         case 'mysqli':
-            $connection = new mysqli($DatabaseServer, $DatabaseUsername, $DatabasePassword, $DatabaseName, $DatabasePort);
+            $connection = new mysqli($DatabaseServer, $DatabaseUsername, $DatabasePassword, $DatabaseName);
             break;
     }
 
@@ -28,16 +27,15 @@ function db_start()
                 $errormessage = mysqli_error($connection);
                 break;
         }
-        db_show_error("", "" . _couldNotConnectToDatabase . ": $DatabaseServer", $errormessage);
+        db_show_error("", ""._couldNotConnectToDatabase.": $DatabaseServer", $errstring);
     }
     return $connection;
 }
 
 // This function connects, and does the passed query, then returns a connection identifier.
 // Not receiving the return == unusable search.
 //		ie, $processable_results = DBQuery("select * from students");
-function DBQuery($sql)
-{
+function DBQuery($sql) {
     global $DatabaseType, $_openSIS;
 
     $connection = db_start();
@@ -76,8 +74,7 @@ function DBQuery($sql)
 }
 
 // return next row.
-function db_fetch_row($result)
-{
+function db_fetch_row($result) {
     global $DatabaseType;
 
     switch ($DatabaseType) {
@@ -95,8 +92,7 @@ function db_fetch_row($result)
 }
 
 // returns code to go into SQL statement for accessing the next value of a sequence function db_seq_nextval($seqname)
-function db_seq_nextval($seqname)
-{
+function db_seq_nextval($seqname) {
     global $DatabaseType;
 
     if ($DatabaseType == 'mysqli')
@@ -105,8 +101,7 @@ function db_seq_nextval($seqname)
     return $seq;
 }
 
-function db_case($array)
-{
+function db_case($array) {
     global $DatabaseType;
 
     $counter = 0;
@@ -123,24 +118,23 @@ function db_case($array)
                 $string = substr($string, 0, -1);
             }
 
-            $string .= "$value";
+            $string.="$value";
             if ($counter == ($array_count - 2) && $array_count % 2 == 0)
-                $string .= " ELSE ";
+                $string.=" ELSE ";
             elseif ($counter == ($array_count - 1))
-                $string .= " END ";
+                $string.=" END ";
             elseif ($counter % 2 == 0)
-                $string .= " WHEN $array[0]=";
+                $string.=" WHEN $array[0]=";
             elseif ($counter % 2 == 1)
-                $string .= " THEN ";
+                $string.=" THEN ";
 
             $counter++;
         }
     }
     return $string;
 }
 
-function db_properties($table)
-{
+function db_properties($table) {
     global $DatabaseType, $DatabaseUsername;
 
     switch ($DatabaseType) {
@@ -164,50 +158,55 @@ function db_properties($table)
     }
     return $properties;
 }
-function singleQuoteReplace($param1 = false, $param2 = false, $param3)
+function singleQuoteReplace($param1=false,$param2=false,$param3)
 {
-    return str_replace("'", "''", str_replace("\'", "'", $param3));
+    return str_replace("'","''",str_replace("\'","'",$param3));
 }
-function DBGet($QI, $functions = array(), $index = array())
-{
-    global $THIS_RET;
-
-    $index_count = count($index);
-    $tmp_THIS_RET = $THIS_RET;
-    $results = array();
-    while ($RET = db_fetch_row($QI)) {
-        $THIS_RET = $RET;
-
-        if ($index_count) {
-            $ind = '';
-            foreach ($index as $col)
-                $ind .= "['" . singleQuoteReplace("'", "\'", $THIS_RET[$col]) . "']";
-            eval('$s' . $ind . '++;$this_ind=$s' . $ind . ';');
-        } else
-            $s++; // 1-based if no index specified
-        foreach ($RET as $key => $value) {
-            if (strlen($value) == strlen(strip_tags($value)))
-                $value =  htmlentities($value);
-            if ($functions[$key] && function_exists($functions[$key])) {
-                if ($index_count)
-                    eval('$results' . $ind . '[$this_ind][$key] = $functions[$key]($value,$key);');
-                else
-                    $results[$s][$key] = $functions[$key]($value, $key);
-            } else {
-                if ($index_count)
-                    eval('$results' . $ind . '[$this_ind][$key] = $value;');
-                else
-                    $results[$s][$key] = $value;
-            }
-        }
-    }
-
-    $THIS_RET = $tmp_THIS_RET;
-    return $results;
+function DBGet($QI,$functions=array(),$index=array())
+{	global $THIS_RET;
+
+	$index_count = count($index);
+	$tmp_THIS_RET = $THIS_RET;
+	$results = array();
+	while($RET=db_fetch_row($QI))
+	{
+		$THIS_RET = $RET;
+
+		if($index_count)
+		{
+			$ind = '';
+			foreach($index as $col)
+				$ind .= "['".singleQuoteReplace("'","\'",$THIS_RET[$col])."']";
+			eval('$s'.$ind.'++;$this_ind=$s'.$ind.';');
+		}
+		else
+			$s++; // 1-based if no index specified
+		foreach($RET as $key=>$value)
+		{                    
+                    if(strlen($value) == strlen(strip_tags($value)))
+                    $value=  htmlentities($value);
+			if($functions[$key] && function_exists($functions[$key]))
+			{
+				if($index_count)
+					eval('$results'.$ind.'[$this_ind][$key] = $functions[$key]($value,$key);');
+				else
+					$results[$s][$key] = $functions[$key]($value,$key);
+			}
+			else
+			{
+				if($index_count)
+					eval('$results'.$ind.'[$this_ind][$key] = $value;');
+				else
+					$results[$s][$key] = $value;
+			}
+		}
+	}
+
+	$THIS_RET = $tmp_THIS_RET;
+	return $results;
 }
 
-function db_show_error($sql, $failnote, $additional = '')
-{
+function db_show_error($sql, $failnote, $additional = '') {
     global $openSISTitle, $openSISVersion, $openSISNotifyAddress, $openSISMode;
 
     $tb = debug_backtrace();
@@ -270,267 +269,325 @@ function db_show_error($sql, $failnote, $additional = '')
 
     die();
 }
-function GetMP($mp = '', $column = 'TITLE', $syear, $school)
-{
-    global $_openSIS;
-    // mab - need to translate marking_period_id to title to be useful as a function call from dbget
-    // also, it doesn't make sense to ask for same thing you give
-    if ($column == 'MARKING_PERIOD_ID')
-        $column = 'TITLE';
-
-    if (!$_openSIS['GetMP']) {
-
-        $_openSIS['GetMP'] = DBGet(DBQuery('SELECT MARKING_PERIOD_ID,TITLE,POST_START_DATE,POST_END_DATE,\'school_quarters\' AS `TABLE`,\'SEMESTER_ID\' AS `PA_ID`,SORT_ORDER,SHORT_NAME,START_DATE,END_DATE,DOES_GRADES,DOES_EXAM,DOES_COMMENTS FROM school_quarters         WHERE SYEAR=\'' . $syear . '\' AND SCHOOL_ID=\'' . $school . '\'
-					UNION      SELECT MARKING_PERIOD_ID,TITLE,POST_START_DATE,POST_END_DATE,\'school_semesters\' AS `TABLE`,\'YEAR_ID\' AS `PA_ID`,SORT_ORDER,SHORT_NAME,START_DATE,END_DATE,DOES_GRADES,DOES_EXAM,DOES_COMMENTS FROM school_semesters        WHERE SYEAR=\'' . $syear . '\' AND SCHOOL_ID=\'' . $school . '\'
-					UNION      SELECT MARKING_PERIOD_ID,TITLE,POST_START_DATE,POST_END_DATE,\'school_years\' AS `TABLE`, \'-1\' AS `PA_ID`,SORT_ORDER,SHORT_NAME,START_DATE,END_DATE,DOES_GRADES,DOES_EXAM,DOES_COMMENTS FROM school_years            WHERE SYEAR=\'' . $syear . '\' AND SCHOOL_ID=\'' . $school . '\'
-					UNION      SELECT MARKING_PERIOD_ID,TITLE,POST_START_DATE,POST_END_DATE,\'school_progress_periods\' AS `TABLE`, \'-1\' AS `PA_ID`,SORT_ORDER,SHORT_NAME,START_DATE,END_DATE,DOES_GRADES,DOES_EXAM,DOES_COMMENTS FROM school_progress_periods WHERE SYEAR=\'' . $syear . '\' AND SCHOOL_ID=\'' . $school . '\''), array(), array('MARKING_PERIOD_ID'));
-    }
-
-    if (substr($mp, 0, 1) == 'E') {
-        if ($column == 'TITLE' || $column == 'SHORT_NAME')
-            $suffix = ' Exam';
-        $mp = substr($mp, 1);
-    }
-    if ($mp == '') {
-        return 'Custom';
-    } else {
-
-        if ($mp == 0 && $column == 'TITLE')
+function GetMP($mp='',$column='TITLE',$syear,$school)
+{	global $_openSIS;
+	// mab - need to translate marking_period_id to title to be useful as a function call from dbget
+	// also, it doesn't make sense to ask for same thing you give
+	if($column=='MARKING_PERIOD_ID')
+		$column='TITLE';
+
+	if(!$_openSIS['GetMP'])
+	{
+           
+		$_openSIS['GetMP'] = DBGet(DBQuery('SELECT MARKING_PERIOD_ID,TITLE,POST_START_DATE,POST_END_DATE,\'school_quarters\' AS `TABLE`,\'SEMESTER_ID\' AS `PA_ID`,SORT_ORDER,SHORT_NAME,START_DATE,END_DATE,DOES_GRADES,DOES_EXAM,DOES_COMMENTS FROM school_quarters         WHERE SYEAR=\''.$syear.'\' AND SCHOOL_ID=\''.$school.'\'
+					UNION      SELECT MARKING_PERIOD_ID,TITLE,POST_START_DATE,POST_END_DATE,\'school_semesters\' AS `TABLE`,\'YEAR_ID\' AS `PA_ID`,SORT_ORDER,SHORT_NAME,START_DATE,END_DATE,DOES_GRADES,DOES_EXAM,DOES_COMMENTS FROM school_semesters        WHERE SYEAR=\''.$syear.'\' AND SCHOOL_ID=\''.$school.'\'
+					UNION      SELECT MARKING_PERIOD_ID,TITLE,POST_START_DATE,POST_END_DATE,\'school_years\' AS `TABLE`, \'-1\' AS `PA_ID`,SORT_ORDER,SHORT_NAME,START_DATE,END_DATE,DOES_GRADES,DOES_EXAM,DOES_COMMENTS FROM school_years            WHERE SYEAR=\''.$syear.'\' AND SCHOOL_ID=\''.$school.'\'
+					UNION      SELECT MARKING_PERIOD_ID,TITLE,POST_START_DATE,POST_END_DATE,\'school_progress_periods\' AS `TABLE`, \'-1\' AS `PA_ID`,SORT_ORDER,SHORT_NAME,START_DATE,END_DATE,DOES_GRADES,DOES_EXAM,DOES_COMMENTS FROM school_progress_periods WHERE SYEAR=\''.$syear.'\' AND SCHOOL_ID=\''.$school.'\''),array(),array('MARKING_PERIOD_ID'));
 
-            return 'Full Year' . $suffix;
-        else {
-            return $_openSIS['GetMP'][$mp][1][$column] . $suffix;
         }
-    }
-}
-function _makeLetterGrade($percent, $course_period_id = 0, $staff_id = 0, $ret = '')
+        
+	if(substr($mp,0,1)=='E')
+	{
+		if($column=='TITLE' || $column=='SHORT_NAME')
+			$suffix = ' Exam';
+		$mp = substr($mp,1);
+	}
+if($mp=='')
 {
-    global $programconfig, $_openSIS;
-
-
-
-    $cp = DBGet(DBQuery('SELECT * FROM course_periods WHERE COURSE_PERIOD_ID=' . $course_period_id));
-    if (!$programconfig[$staff_id]) {
-        $config_RET = DBGet(DBQuery('SELECT TITLE,VALUE FROM program_user_config WHERE USER_ID=\'' . $staff_id . '\' AND PROGRAM=\'Gradebook\' AND VALUE LIKE \'%_' . $course_period_id . '\''), array(), array('TITLE'));
-        if (count($config_RET))
-            foreach ($config_RET as $title => $value) {
-                $unused_var = explode('_', $value[1]['VALUE']);
-                $programconfig[$staff_id][$title] = $unused_var[0];
-                //				$programconfig[$staff_id][$title] = rtrim($value[1]['VALUE'],'_'.$course_period_id);
-            }
-        else
-            $programconfig[$staff_id] = true;
-    }
-    if (!$_openSIS['_makeLetterGrade']['courses'][$course_period_id])
-        $_openSIS['_makeLetterGrade']['courses'][$course_period_id] = DBGet(DBQuery('SELECT DOES_BREAKOFF,GRADE_SCALE_ID FROM course_periods WHERE COURSE_PERIOD_ID=\'' . $course_period_id . '\''));
-    $does_breakoff = $_openSIS['_makeLetterGrade']['courses'][$course_period_id][1]['DOES_BREAKOFF'];
-    $grade_scale_id = $_openSIS['_makeLetterGrade']['courses'][$course_period_id][1]['GRADE_SCALE_ID'];
-
-    $percent *= 100;
-
-    if ($programconfig[$staff_id]['ROUNDING'] == 'UP') {
-        $percent = ceil($percent);
-    } elseif ($programconfig[$staff_id]['ROUNDING'] == 'DOWN') {
-        $percent = floor($percent);
-    } elseif ($programconfig[$staff_id]['ROUNDING'] == 'NORMAL') {
-        $percent = round($percent, 0);
-    } else {
-        $percent = round($percent, 2); // school default
-    }
-    if ($ret == '%')
-        return $percent;
-
-    if (!$_openSIS['_makeLetterGrade']['grades'][$grade_scale_id])
-        $_openSIS['_makeLetterGrade']['grades'][$grade_scale_id] = DBGet(DBQuery('SELECT TITLE,ID,BREAK_OFF FROM report_card_grades WHERE SYEAR=\'' . $cp[1]['SYEAR'] . '\' AND SCHOOL_ID=\'' . $cp[1]['SCHOOL_ID'] . '\' AND GRADE_SCALE_ID=\'' . $grade_scale_id . '\' ORDER BY BREAK_OFF IS NOT NULL DESC,BREAK_OFF DESC,SORT_ORDER'));
-
-    foreach ($_openSIS['_makeLetterGrade']['grades'][$grade_scale_id] as $grade) {
-        if ($does_breakoff == 'Y' ? $percent >= $programconfig[$staff_id][$course_period_id . '-' . $grade['ID']] && is_numeric($programconfig[$staff_id][$course_period_id . '-' . $grade['ID']]) : $percent >= $grade['BREAK_OFF'])
-            return $ret == 'ID' ? $grade['ID'] : $grade['TITLE'];
-    }
+    return 'Custom';
+}
+ else {
+   
+  if($mp==0 && $column=='TITLE')
+      
+		return 'Full Year'.$suffix;
+	else
+        {
+		return $_openSIS['GetMP'][$mp][1][$column].$suffix;  
+        }
+}
+	
+}
+function _makeLetterGrade($percent,$course_period_id=0,$staff_id=0,$ret='')
+{	
+    global $programconfig,$_openSIS;
+	
+
+	
+$cp=DBGet(DBQuery('SELECT * FROM course_periods WHERE COURSE_PERIOD_ID='.$course_period_id));
+	if(!$programconfig[$staff_id])
+	{
+		$config_RET = DBGet(DBQuery('SELECT TITLE,VALUE FROM program_user_config WHERE USER_ID=\''.$staff_id.'\' AND PROGRAM=\'Gradebook\' AND VALUE LIKE \'%_'.$course_period_id.'\''),array(),array('TITLE'));
+		if(count($config_RET))
+			foreach($config_RET as $title=>$value)
+                        {
+                                $unused_var=explode('_',$value[1]['VALUE']);
+                                $programconfig[$staff_id][$title] =$unused_var[0];
+//				$programconfig[$staff_id][$title] = rtrim($value[1]['VALUE'],'_'.$course_period_id);
+                        }
+		else
+			$programconfig[$staff_id] = true;
+	}
+	if(!$_openSIS['_makeLetterGrade']['courses'][$course_period_id])
+		$_openSIS['_makeLetterGrade']['courses'][$course_period_id] = DBGet(DBQuery('SELECT DOES_BREAKOFF,GRADE_SCALE_ID FROM course_periods WHERE COURSE_PERIOD_ID=\''.$course_period_id.'\''));
+	$does_breakoff = $_openSIS['_makeLetterGrade']['courses'][$course_period_id][1]['DOES_BREAKOFF'];
+	$grade_scale_id = $_openSIS['_makeLetterGrade']['courses'][$course_period_id][1]['GRADE_SCALE_ID'];
+
+	$percent *= 100;
+
+		if($programconfig[$staff_id]['ROUNDING']=='UP')
+                {
+			$percent = ceil($percent);
+                }
+		elseif($programconfig[$staff_id]['ROUNDING']=='DOWN')
+                {
+			$percent = floor($percent);
+                }
+		elseif($programconfig[$staff_id]['ROUNDING']=='NORMAL')
+                {
+			$percent = round($percent,0);
+                }
+                else
+                {
+		$percent = round($percent,2); // school default
+                }
+	if($ret=='%')
+		return $percent;
+
+	if(!$_openSIS['_makeLetterGrade']['grades'][$grade_scale_id])
+		$_openSIS['_makeLetterGrade']['grades'][$grade_scale_id] = DBGet(DBQuery('SELECT TITLE,ID,BREAK_OFF FROM report_card_grades WHERE SYEAR=\''.$cp[1]['SYEAR'].'\' AND SCHOOL_ID=\''.$cp[1]['SCHOOL_ID'].'\' AND GRADE_SCALE_ID=\''.$grade_scale_id.'\' ORDER BY BREAK_OFF IS NOT NULL DESC,BREAK_OFF DESC,SORT_ORDER'));
+	
+	foreach($_openSIS['_makeLetterGrade']['grades'][$grade_scale_id] as $grade)
+	{
+		if($does_breakoff=='Y' ? $percent>=$programconfig[$staff_id][$course_period_id.'-'.$grade['ID']] && is_numeric($programconfig[$staff_id][$course_period_id.'-'.$grade['ID']]) : $percent>=$grade['BREAK_OFF'])
+			return $ret=='ID' ? $grade['ID'] : $grade['TITLE'];
+	}
 }
 
 
 
-$connection = new mysqli($DatabaseServer, $DatabaseUsername, $DatabasePassword, $DatabaseName, $DatabasePort);
-
-$format = mysqli_real_escape_string($connection, strtolower(optional_param('format', '', PARAM_RAW)));
-$api_key = mysqli_real_escape_string($connection, optional_param('api_key', '', PARAM_RAW));
-$api_secret = mysqli_real_escape_string($connection, optional_param('api_secret', '', PARAM_RAW));
-
-$validate = DBGet(DBQuery('SELECT * FROM api_info WHERE API_KEY=\'' . $api_key . '\' AND API_SECRET=\'' . $api_secret . '\''));
-if (count($validate) > 0) {
-    $syear = mysqli_real_escape_string($connection, strtolower(optional_param('sch_year', '', PARAM_RAW)));
-
-    $all_stf_ids = DBGet(DBQuery('SELECT GROUP_CONCAT(DISTINCT(STAFF_ID)) as STAFF_IDS FROM staff_school_relationship WHERE STAFF_ID IS NOT NULL AND SYEAR = ' . $syear));
-
-
-    $sch_arr = array();
-    $sch = DBGet(DBQuery('SELECT * FROM schools'));
-    foreach ($sch as $school_details)
-        $sch_arr[$school_details['ID']] = $school_details['TITLE'];
-    //    $all_sch_ids=DBGet(DBQuery('SELECT DISTINCT SCHOOL_ID AS SCHOOL_ID FROM school_years WHERE SCHOOL_ID=1 AND SYEAR = '.$syear));
-    $data = array();
-
-    if (count($all_stf_ids) > 0) {
-        $user_profile_arr = array();
-        $user_profile = DBGet(DBQuery('SELECT * FROM user_profiles'));
-        foreach ($user_profile as $upa)
-            $user_profile_arr[$upa['ID']] = $upa['TITLE'];
-
-        $staff = DBGet(DBQuery('SELECT * FROM staff WHERE STAFF_ID IN (' . $all_stf_ids[1]['STAFF_IDS'] . ')'));
-        foreach ($staff as $sd) {
-            if ($sd['STAFF_ID'] != '') {
-                $data['data'][$syear][$sd['STAFF_ID']]['STAFF_ID'] = $sd['STAFF_ID'];
-                //$data['data'][$syear][$sd['STAFF_ID']]['TITLE']=($sd['TITLE']==''?'':$sd['TITLE']);
-                $data['data'][$syear][$sd['STAFF_ID']]['FIRST_NAME'] = ($sd['FIRST_NAME'] == '' ? '' : $sd['FIRST_NAME']);
-                $data['data'][$syear][$sd['STAFF_ID']]['MIDDLE_NAME'] = ($sd['MIDDLE_NAME'] == '' ? '' : $sd['MIDDLE_NAME']);
-                $data['data'][$syear][$sd['STAFF_ID']]['LAST_NAME'] = ($sd['LAST_NAME'] == '' ? '' : $sd['LAST_NAME']);
-                $data['data'][$syear][$sd['STAFF_ID']]['GENDER'] = ($sd['GENDER'] == '' ? '' : $sd['GENDER']);
-                $data['data'][$syear][$sd['STAFF_ID']]['DOB'] = ($sd['BIRTHDATE'] == '' ? '' : $sd['BIRTHDATE']);
-                $data['data'][$syear][$sd['STAFF_ID']]['PHONE'] = ($sd['PHONE'] == '' ? '' : $sd['PHONE']);
-                $data['data'][$syear][$sd['STAFF_ID']]['EMAIL'] = ($sd['EMAIL'] == '' ? '' : $sd['EMAIL']);
-
-                if ($sd['ETHNICITY_ID'] != '') {
-                    $pri_eth = DBGet(DBQuery('SELECT ETHNICITY_NAME FROM ethnicity WHERE ETHNICITY_ID=' . $sd['ETHNICITY_ID']));
-                    $data['data'][$syear][$sd['STAFF_ID']]['ETHNICITY'] = $pri_eth[1]['ETHNICITY_NAME'];
-                } else
-                    $data['data'][$syear][$sd['STAFF_ID']]['ETHNICITY'] = '';
-                if ($sd['PRIMARY_LANGUAGE_ID'] != '') {
-                    $pri_lang = DBGet(DBQuery('SELECT LANGUAGE_NAME FROM language WHERE LANGUAGE_ID=' . $sd['PRIMARY_LANGUAGE_ID']));
-                    $data['data'][$syear][$sd['STAFF_ID']]['PRIMARY LANGUAGE'] = $pri_lang[1]['LANGUAGE_NAME'];
-                } else
-                    $data['data'][$syear][$sd['STAFF_ID']]['PRIMARY_LANGUAGE'] = '';
-                $stf_oth_info = DBGet(DBQuery('SELECT * FROM staff_school_info WHERE STAFF_ID=' . $sd['STAFF_ID']));
-                $data['data'][$syear][$sd['STAFF_ID']]['CATEGORY'] = $stf_oth_info[1]['CATEGORY'];
-                $data['data'][$syear][$sd['STAFF_ID']]['JOB_TITLE'] = $stf_oth_info[1]['JOB_TITLE'];
-                $data['data'][$syear][$sd['STAFF_ID']]['JOINING_DATE'] = $stf_oth_info[1]['JOINING_DATE'];
-                $data['data'][$syear][$sd['STAFF_ID']]['END_DATE'] = $stf_oth_info[1]['END_DATE'];
-                $data['data'][$syear][$sd['STAFF_ID']]['PROFILE_ID'] = ($sd['PROFILE_ID'] == '' ? '' : $sd['PROFILE_ID']);
-                $data['data'][$syear][$sd['STAFF_ID']]['PROFILE'] = $user_profile_arr[$sd['PROFILE_ID']];
-                $data['data'][$syear][$sd['STAFF_ID']]['CURRENT_SCHOOL_ID'] = ($sd['CURRENT_SCHOOL_ID'] == '' ? '' : $sd['CURRENT_SCHOOL_ID']);
-                $i = 1;
-                $certificate = DBGet(DBQuery('SELECT * FROM staff_certification WHERE STAFF_ID=' . $sd['STAFF_ID']));
-                foreach ($certificate as $cd) {
-                    $data['data'][$syear][$sd['STAFF_ID']]['CERTIFICATE'][$i]['STAFF_CERTIFICATION_DATE'] = ($cd['STAFF_CERTIFICATION_DATE'] == '' ? '' : $cd['STAFF_CERTIFICATION_DATE']);
-                    $data['data'][$syear][$sd['STAFF_ID']]['CERTIFICATE'][$i]['STAFF_CERTIFICATION_EXPIRY_DATE'] = ($cd['STAFF_CERTIFICATION_EXPIRY_DATE'] == '' ? '' : $cd['STAFF_CERTIFICATION_EXPIRY_DATE']);
-                    $data['data'][$syear][$sd['STAFF_ID']]['CERTIFICATE'][$i]['STAFF_CERTIFICATION_CODE'] = ($cd['STAFF_CERTIFICATION_CODE'] == '' ? '' : $cd['STAFF_CERTIFICATION_CODE']);
-                    $data['data'][$syear][$sd['STAFF_ID']]['CERTIFICATE'][$i]['STAFF_CERTIFICATION_SHORT_NAME'] = ($cd['STAFF_CERTIFICATION_SHORT_NAME'] == '' ? '' : $cd['STAFF_CERTIFICATION_SHORT_NAME']);
-                    $data['data'][$syear][$sd['STAFF_ID']]['CERTIFICATE'][$i]['STAFF_CERTIFICATION_NAME'] = ($cd['STAFF_CERTIFICATION_NAME'] == '' ? '' : $cd['STAFF_CERTIFICATION_NAME']);
-                    $data['data'][$syear][$sd['STAFF_ID']]['CERTIFICATE'][$i]['STAFF_PRIMARY_CERTIFICATION_INDICATOR'] = ($cd['STAFF_PRIMARY_CERTIFICATION_INDICATOR'] == '' ? '' : $cd['STAFF_PRIMARY_CERTIFICATION_INDICATOR']);
-                    $data['data'][$syear][$sd['STAFF_ID']]['CERTIFICATE'][$i]['STAFF_CERTIFICATION_DESCRIPTION'] = ($cd['STAFF_CERTIFICATION_DESCRIPTION'] == '' ? '' : $cd['STAFF_CERTIFICATION_DESCRIPTION']);
-                    $i++;
-                }
+$connection = new mysqli($DatabaseServer, $DatabaseUsername, $DatabasePassword, $DatabaseName);
 
-                $enrollment = DBGet(DBQuery('SELECT * FROM staff_school_relationship WHERE STAFF_ID=' . $sd['STAFF_ID'] . ' AND SYEAR=' . $syear));
-                foreach ($enrollment as $e) {
-                    $data['data'][$syear][$sd['STAFF_ID']]['SCHOOL ACCESS'][$e['SCHOOL_ID']]['SCHOOL_ID'] = $e['SCHOOL_ID'];
-                    $data['data'][$syear][$sd['STAFF_ID']]['SCHOOL ACCESS'][$e['SCHOOL_ID']]['SCHOOL_NAME'] = $sch_arr[$e['SCHOOL_ID']];
-                    $data['data'][$syear][$sd['STAFF_ID']]['SCHOOL ACCESS'][$e['SCHOOL_ID']]['START_DATE'] = $e['START_DATE'];
-                    $data['data'][$syear][$sd['STAFF_ID']]['SCHOOL ACCESS'][$e['SCHOOL_ID']]['END_DATE'] = $e['END_DATE'];
-                }
+$format = mysqli_real_escape_string($connection,strtolower(optional_param('format', '', PARAM_RAW)));
+$api_key= mysqli_real_escape_string($connection,optional_param('api_key', '', PARAM_RAW));
+$api_secret= mysqli_real_escape_string($connection, optional_param('api_secret', '', PARAM_RAW));
+
+$validate= DBGet(DBQuery('SELECT * FROM api_info WHERE API_KEY=\''.$api_key.'\' AND API_SECRET=\''.$api_secret.'\''));
+if(count($validate) > 0)
+{
+    $syear=mysqli_real_escape_string($connection,strtolower(optional_param('sch_year', '', PARAM_RAW)));
+    
+    $all_stf_ids=DBGet(DBQuery('SELECT GROUP_CONCAT(DISTINCT(STAFF_ID)) as STAFF_IDS FROM staff_school_relationship WHERE STAFF_ID IS NOT NULL AND SYEAR = '.$syear));
+    
+    
+    $sch_arr=array();
+    $sch=DBGet(DBQuery('SELECT * FROM schools'));
+    foreach($sch as $school_details)
+       $sch_arr[$school_details['ID']]=$school_details['TITLE']; 
+//    $all_sch_ids=DBGet(DBQuery('SELECT DISTINCT SCHOOL_ID AS SCHOOL_ID FROM school_years WHERE SCHOOL_ID=1 AND SYEAR = '.$syear));
+    $data=array();
+    
+    if(count($all_stf_ids)>0)
+    {
+        $user_profile_arr=array();
+        $user_profile=DBGet(DBQuery('SELECT * FROM user_profiles'));
+        foreach($user_profile as $upa)
+           $user_profile_arr[$upa['ID']]=$upa['TITLE'];
+        
+        $staff=DBGet(DBQuery('SELECT * FROM staff WHERE STAFF_ID IN ('.$all_stf_ids[1]['STAFF_IDS'].')'));
+        foreach($staff as $sd)
+        {
+            if($sd['STAFF_ID']!='')
+            {
+            $data['data'][$syear][$sd['STAFF_ID']]['STAFF_ID']=$sd['STAFF_ID'];    
+            //$data['data'][$syear][$sd['STAFF_ID']]['TITLE']=($sd['TITLE']==''?'':$sd['TITLE']);
+            $data['data'][$syear][$sd['STAFF_ID']]['FIRST_NAME']=($sd['FIRST_NAME']==''?'':$sd['FIRST_NAME']);
+            $data['data'][$syear][$sd['STAFF_ID']]['MIDDLE_NAME']=($sd['MIDDLE_NAME']==''?'':$sd['MIDDLE_NAME']);
+            $data['data'][$syear][$sd['STAFF_ID']]['LAST_NAME']=($sd['LAST_NAME']==''?'':$sd['LAST_NAME']);
+            $data['data'][$syear][$sd['STAFF_ID']]['GENDER']=($sd['GENDER']==''?'':$sd['GENDER']);
+            $data['data'][$syear][$sd['STAFF_ID']]['DOB']=($sd['BIRTHDATE']==''?'':$sd['BIRTHDATE']);
+            $data['data'][$syear][$sd['STAFF_ID']]['PHONE']=($sd['PHONE']==''?'':$sd['PHONE']);
+            $data['data'][$syear][$sd['STAFF_ID']]['EMAIL']=($sd['EMAIL']==''?'':$sd['EMAIL']);
+            
+            if($sd['ETHNICITY_ID']!='')
+            {
+                $pri_eth=DBGet(DBQuery('SELECT ETHNICITY_NAME FROM ethnicity WHERE ETHNICITY_ID='.$sd['ETHNICITY_ID']));
+                $data['data'][$syear][$sd['STAFF_ID']]['ETHNICITY']=$pri_eth[1]['ETHNICITY_NAME'];
+            }
+            else
+                $data['data'][$syear][$sd['STAFF_ID']]['ETHNICITY']='';
+            if($sd['PRIMARY_LANGUAGE_ID']!='')
+            {
+                $pri_lang=DBGet(DBQuery('SELECT LANGUAGE_NAME FROM language WHERE LANGUAGE_ID='.$sd['PRIMARY_LANGUAGE_ID']));
+                $data['data'][$syear][$sd['STAFF_ID']]['PRIMARY LANGUAGE']=$pri_lang[1]['LANGUAGE_NAME'];
+            }
+            else
+                $data['data'][$syear][$sd['STAFF_ID']]['PRIMARY_LANGUAGE']='';
+            $stf_oth_info=DBGet(DBQuery('SELECT * FROM staff_school_info WHERE STAFF_ID='.$sd['STAFF_ID']));
+            $data['data'][$syear][$sd['STAFF_ID']]['CATEGORY']=$stf_oth_info[1]['CATEGORY'];
+            $data['data'][$syear][$sd['STAFF_ID']]['JOB_TITLE']=$stf_oth_info[1]['JOB_TITLE'];
+            $data['data'][$syear][$sd['STAFF_ID']]['JOINING_DATE']=$stf_oth_info[1]['JOINING_DATE'];
+            $data['data'][$syear][$sd['STAFF_ID']]['END_DATE']=$stf_oth_info[1]['END_DATE'];
+            $data['data'][$syear][$sd['STAFF_ID']]['PROFILE_ID']=($sd['PROFILE_ID']==''?'':$sd['PROFILE_ID']);
+            $data['data'][$syear][$sd['STAFF_ID']]['PROFILE']=$user_profile_arr[$sd['PROFILE_ID']];
+            $data['data'][$syear][$sd['STAFF_ID']]['CURRENT_SCHOOL_ID']=($sd['CURRENT_SCHOOL_ID']==''?'':$sd['CURRENT_SCHOOL_ID']);
+            $i=1;
+            $certificate=DBGet(DBQuery('SELECT * FROM staff_certification WHERE STAFF_ID='.$sd['STAFF_ID']));
+            foreach($certificate as $cd)
+            {
+                $data['data'][$syear][$sd['STAFF_ID']]['CERTIFICATE'][$i]['STAFF_CERTIFICATION_DATE']=($cd['STAFF_CERTIFICATION_DATE']==''?'':$cd['STAFF_CERTIFICATION_DATE']);
+                $data['data'][$syear][$sd['STAFF_ID']]['CERTIFICATE'][$i]['STAFF_CERTIFICATION_EXPIRY_DATE']=($cd['STAFF_CERTIFICATION_EXPIRY_DATE']==''?'':$cd['STAFF_CERTIFICATION_EXPIRY_DATE']);
+                $data['data'][$syear][$sd['STAFF_ID']]['CERTIFICATE'][$i]['STAFF_CERTIFICATION_CODE']=($cd['STAFF_CERTIFICATION_CODE']==''?'':$cd['STAFF_CERTIFICATION_CODE']);
+                $data['data'][$syear][$sd['STAFF_ID']]['CERTIFICATE'][$i]['STAFF_CERTIFICATION_SHORT_NAME']=($cd['STAFF_CERTIFICATION_SHORT_NAME']==''?'':$cd['STAFF_CERTIFICATION_SHORT_NAME']);
+                $data['data'][$syear][$sd['STAFF_ID']]['CERTIFICATE'][$i]['STAFF_CERTIFICATION_NAME']=($cd['STAFF_CERTIFICATION_NAME']==''?'':$cd['STAFF_CERTIFICATION_NAME']);
+                $data['data'][$syear][$sd['STAFF_ID']]['CERTIFICATE'][$i]['STAFF_PRIMARY_CERTIFICATION_INDICATOR']=($cd['STAFF_PRIMARY_CERTIFICATION_INDICATOR']==''?'':$cd['STAFF_PRIMARY_CERTIFICATION_INDICATOR']);
+                $data['data'][$syear][$sd['STAFF_ID']]['CERTIFICATE'][$i]['STAFF_CERTIFICATION_DESCRIPTION']=($cd['STAFF_CERTIFICATION_DESCRIPTION']==''?'':$cd['STAFF_CERTIFICATION_DESCRIPTION']);
+                $i++;
+                
+            }
+            
+            $enrollment=DBGet(DBQuery('SELECT * FROM staff_school_relationship WHERE STAFF_ID='.$sd['STAFF_ID'].' AND SYEAR='.$syear));
+            foreach($enrollment as $e)
+            {
+                $data['data'][$syear][$sd['STAFF_ID']]['SCHOOL ACCESS'][$e['SCHOOL_ID']]['SCHOOL_ID']=$e['SCHOOL_ID'];
+                $data['data'][$syear][$sd['STAFF_ID']]['SCHOOL ACCESS'][$e['SCHOOL_ID']]['SCHOOL_NAME']=$sch_arr[$e['SCHOOL_ID']];
+                $data['data'][$syear][$sd['STAFF_ID']]['SCHOOL ACCESS'][$e['SCHOOL_ID']]['START_DATE']=$e['START_DATE'];
+                $data['data'][$syear][$sd['STAFF_ID']]['SCHOOL ACCESS'][$e['SCHOOL_ID']]['END_DATE']=$e['END_DATE'];
+            }
+            
             }
         }
+        
+        
+ 
     }
-    if ($format == 'json') {
+    if($format == 'json') 
+    {
         header('Content-type: application/json');
-
-        if (count($data) > 0) {
-            echo  json_encode($data);
+        
+        if(count($data)>0)
+        {
+             echo  json_encode($data);
         }
+                      
     }
-    if ($format == 'xml') {
-        //        echo '<pre>';
-        //        print_r($data);
-        //        echo '</pre>';exit;
+    if($format == 'xml')
+    {
+//        echo '<pre>';
+//        print_r($data);
+//        echo '</pre>';exit;
         header('Content-type: text/xml');
-        if (count($data) > 0) {
+        if(count($data)> 0)
+        {
             echo '<data>';
-            foreach ($data['data'] as $key => $val) {
-
-                echo '<YEAR_' . htmlentities($key) . '>';
-                $j = 1;
+            foreach($data['data'] as $key=>$val)
+            {
+                
+                echo '<YEAR_'.htmlentities($key).'>';
+                $j=1;
                 foreach ($val as $vkey => $value) {
-                    echo '<STAFF_' . htmlentities($j) . '>';
-
-                    //                foreach ($value as $value_key => $value_arr) {
-                    //                    echo '<pre>';
-                    //        print_r($value);
-                    //        echo '</pre>';
-                    echo '<STAFF_ID>' . htmlentities($value['STAFF_ID']) . '</STAFF_ID>';
-                    echo '<TITLE>' . htmlentities($value['TITLE']) . '</TITLE>';
-                    echo '<FIRST_NAME>' . htmlentities($value['FIRST_NAME']) . '</FIRST_NAME>';
-                    echo '<MIDDLE_NAME>' . htmlentities($value['MIDDLE_NAME']) . '</MIDDLE_NAME>';
-                    echo '<LAST_NAME>' . htmlentities($value['LAST_NAME']) . '</LAST_NAME>';
-                    echo '<DOB>' . htmlentities($value['DOB']) . '</DOB>';
-
-                    echo '<GENDER>' . htmlentities($value['GENDER']) . '</GENDER>';
-                    echo '<PHONE>' . htmlentities($value['PHONE']) . '</PHONE>';
-                    echo '<EMAIL>' . htmlentities($value['EMAIL']) . '</EMAIL>';
-                    if ($value['ETHNICITY_ID'] != '') {
-                        $pri_eth = DBGet(DBQuery('SELECT ETHNICITY_NAME FROM  ethnicity WHERE ETHNICITY_ID=' . $value['ETHNICITY_ID']));
-                        echo '<ETHNICITY>' . htmlentities($pri_eth[1]['ETHNICITY_NAME']) . '</ETHNICITY>';
-                    } else
+                echo '<STAFF_'.htmlentities($j).'>';
+
+//                foreach ($value as $value_key => $value_arr) {
+//                    echo '<pre>';
+//        print_r($value);
+//        echo '</pre>';
+                    echo '<STAFF_ID>'.htmlentities($value['STAFF_ID']).'</STAFF_ID>';
+                    echo '<TITLE>'.htmlentities($value['TITLE']).'</TITLE>';
+                    echo '<FIRST_NAME>'.htmlentities($value['FIRST_NAME']).'</FIRST_NAME>';
+                    echo '<MIDDLE_NAME>'.htmlentities($value['MIDDLE_NAME']).'</MIDDLE_NAME>';
+                    echo '<LAST_NAME>'.htmlentities($value['LAST_NAME']).'</LAST_NAME>';
+                    echo '<DOB>'.htmlentities($value['DOB']).'</DOB>';
+                    
+                    echo '<GENDER>'.htmlentities($value['GENDER']).'</GENDER>';
+                    echo '<PHONE>'.htmlentities($value['PHONE']).'</PHONE>';
+                    echo '<EMAIL>'.htmlentities($value['EMAIL']).'</EMAIL>';
+                    if($value['ETHNICITY_ID']!='')
+                    {
+                        $pri_eth=DBGet(DBQuery('SELECT ETHNICITY_NAME FROM  ethnicity WHERE ETHNICITY_ID='.$value['ETHNICITY_ID']));
+                        echo '<ETHNICITY>'.htmlentities($pri_eth[1]['ETHNICITY_NAME']).'</ETHNICITY>';
+                        
+                    }
+                    else
                         echo '<ETHNICITY></ETHNICITY>';
-                    if ($value['PRIMARY_LANGUAGE_ID'] != '') {
-                        $pri_lang = DBGet(DBQuery('SELECT LANGUAGE_NAME FROM language WHERE LANGUAGE_ID=' . $value['PRIMARY_LANGUAGE_ID']));
-                        echo '<PRIMARY_LANGUAGE>' . htmlentities($pri_lang[1]['LANGUAGE_NAME']) . '</PRIMARY_LANGUAGE>';
-                    } else
-                        echo '<PRIMARY_LANGUAGE></PRIMARY_LANGUAGE>';
-                    $stf_oth_info = DBGet(DBQuery('SELECT * FROM staff_school_info WHERE STAFF_ID=' . $value['STAFF_ID']));
-                    echo '<CATEGORY>' . htmlentities($stf_oth_info[1]['CATEGORY']) . '</CATEGORY>';
-                    echo '<JOB_TITLE>' . htmlentities($stf_oth_info[1]['JOB_TITLE']) . '</JOB_TITLE>';
-                    echo '<JOINING_DATE>' . htmlentities($stf_oth_info[1]['JOINING_DATE']) . '</JOINING_DATE>';
-                    echo '<END_DATE>' . htmlentities($stf_oth_info[1]['END_DATE']) . '</END_DATE>';
-                    echo '<PROFILE_ID>' . htmlentities($value['PROFILE_ID']) . '</PROFILE_ID>';
-                    echo '<PROFILE>' . htmlentities($value['PROFILE']) . '</PROFILE>';
-                    echo '<CURRENT_SCHOOL_ID>' . htmlentities($value['CURRENT_SCHOOL_ID']) . '</CURRENT_SCHOOL_ID>';
-                    //                    
-                    //                     
-                    foreach ($value['CERTIFICATE'] as $eid => $ed) {
-                        echo '<CERTIFICATE_' . htmlentities($eid) . '>';
-                        echo '<STAFF_CERTIFICATION_DATE>' . htmlentities($ed['STAFF_CERTIFICATION_DATE']) . '</STAFF_CERTIFICATION_DATE>';
-                        echo '<STAFF_CERTIFICATION_EXPIRY_DATE>' . htmlentities($ed['STAFF_CERTIFICATION_EXPIRY_DATE']) . '</STAFF_CERTIFICATION_EXPIRY_DATE>';
-                        echo '<STAFF_CERTIFICATION_CODE>' . htmlentities($ed['STAFF_CERTIFICATION_CODE']) . '</STAFF_CERTIFICATION_CODE>';
-                        echo '<STAFF_CERTIFICATION_SHORT_NAME>' . htmlentities($ed['STAFF_CERTIFICATION_SHORT_NAME']) . '</STAFF_CERTIFICATION_SHORT_NAME>';
-                        echo '<STAFF_CERTIFICATION_NAME>' . htmlentities($ed['STAFF_CERTIFICATION_NAME']) . '</STAFF_CERTIFICATION_NAME>';
-                        echo '<STAFF_PRIMARY_CERTIFICATION_INDICATOR>' . htmlentities($ed['STAFF_PRIMARY_CERTIFICATION_INDICATOR']) . '</STAFF_PRIMARY_CERTIFICATION_INDICATOR>';
-                        echo '<STAFF_CERTIFICATION_DESCRIPTION>' . htmlentities($ed['STAFF_CERTIFICATION_DESCRIPTION']) . '</STAFF_CERTIFICATION_DESCRIPTION>';
-                        echo '</CERTIFICATE__' . htmlentities($eid) . '>';
+                    if($value['PRIMARY_LANGUAGE_ID']!='')
+                    {
+                        $pri_lang=DBGet(DBQuery('SELECT LANGUAGE_NAME FROM language WHERE LANGUAGE_ID='.$value['PRIMARY_LANGUAGE_ID']));
+                        echo '<PRIMARY_LANGUAGE>'.htmlentities($pri_lang[1]['LANGUAGE_NAME']).'</PRIMARY_LANGUAGE>';
+                        
                     }
-                    //                  
-                    $i = 1;
+                    else
+                         echo '<PRIMARY_LANGUAGE></PRIMARY_LANGUAGE>';
+                    $stf_oth_info=DBGet(DBQuery('SELECT * FROM staff_school_info WHERE STAFF_ID='.$value['STAFF_ID']));
+                    echo '<CATEGORY>'.htmlentities($stf_oth_info[1]['CATEGORY']).'</CATEGORY>';
+                    echo '<JOB_TITLE>'.htmlentities($stf_oth_info[1]['JOB_TITLE']).'</JOB_TITLE>';
+                    echo '<JOINING_DATE>'.htmlentities($stf_oth_info[1]['JOINING_DATE']).'</JOINING_DATE>';
+                    echo '<END_DATE>'.htmlentities($stf_oth_info[1]['END_DATE']).'</END_DATE>';
+                    echo '<PROFILE_ID>'.htmlentities($value['PROFILE_ID']).'</PROFILE_ID>';
+                    echo '<PROFILE>'.htmlentities($value['PROFILE']).'</PROFILE>';
+                    echo '<CURRENT_SCHOOL_ID>'.htmlentities($value['CURRENT_SCHOOL_ID']).'</CURRENT_SCHOOL_ID>';
+//                    
+//                     
+                    foreach($value['CERTIFICATE'] as $eid=>$ed)
+                    {
+                        echo '<CERTIFICATE_'.htmlentities($eid).'>';
+                        echo '<STAFF_CERTIFICATION_DATE>'.htmlentities($ed['STAFF_CERTIFICATION_DATE']).'</STAFF_CERTIFICATION_DATE>';
+                        echo '<STAFF_CERTIFICATION_EXPIRY_DATE>'.htmlentities($ed['STAFF_CERTIFICATION_EXPIRY_DATE']).'</STAFF_CERTIFICATION_EXPIRY_DATE>';
+                        echo '<STAFF_CERTIFICATION_CODE>'.htmlentities($ed['STAFF_CERTIFICATION_CODE']).'</STAFF_CERTIFICATION_CODE>';
+                        echo '<STAFF_CERTIFICATION_SHORT_NAME>'.htmlentities($ed['STAFF_CERTIFICATION_SHORT_NAME']).'</STAFF_CERTIFICATION_SHORT_NAME>';
+                        echo '<STAFF_CERTIFICATION_NAME>'.htmlentities($ed['STAFF_CERTIFICATION_NAME']).'</STAFF_CERTIFICATION_NAME>';
+                        echo '<STAFF_PRIMARY_CERTIFICATION_INDICATOR>'.htmlentities($ed['STAFF_PRIMARY_CERTIFICATION_INDICATOR']).'</STAFF_PRIMARY_CERTIFICATION_INDICATOR>';
+                        echo '<STAFF_CERTIFICATION_DESCRIPTION>'.htmlentities($ed['STAFF_CERTIFICATION_DESCRIPTION']).'</STAFF_CERTIFICATION_DESCRIPTION>';
+                        echo '</CERTIFICATE__'.htmlentities($eid).'>';
+                    }
+//                  
+                    $i=1;
                     echo '<SCHOOL_ACCESS>';
-                    foreach ($value['SCHOOLS'] as $school_id => $school_d) {
-                        echo '<SCHOOL_' . htmlentities($i) . '>';
-                        echo '<SCHOOL_ID>' . htmlentities($school_d['SCHOOL_ID']) . '</SCHOOL_ID>';
-                        echo '<SCHOOL_NAME>' . htmlentities($school_d['SCHOOL_NAME']) . '</SCHOOL_NAME>';
-                        echo '<START_DATE>' . htmlentities($school_d['START_DATE']) . '</START_DATE>';
-                        echo '<END_DATE>' . htmlentities($school_d['END_DATE']) . '</END_DATE>';
-                        echo '</SCHOOL_' . htmlentities($i) . '>';
+                    foreach($value['SCHOOLS'] as $school_id=>$school_d)
+                    {
+                        echo '<SCHOOL_'.htmlentities($i).'>';
+                        echo '<SCHOOL_ID>'.htmlentities($school_d['SCHOOL_ID']).'</SCHOOL_ID>';
+                        echo '<SCHOOL_NAME>'.htmlentities($school_d['SCHOOL_NAME']).'</SCHOOL_NAME>';
+                        echo '<START_DATE>'.htmlentities($school_d['START_DATE']).'</START_DATE>';
+                        echo '<END_DATE>'.htmlentities($school_d['END_DATE']).'</END_DATE>';
+                        echo '</SCHOOL_'.htmlentities($i).'>';
                         $i++;
                     }
                     echo '</SCHOOL_ACCESS>';
-                    //                }
-                    echo '</STAFF_' . htmlentities($j) . '>';
-                    $j++;
+//                }
+                 echo '</STAFF_'.htmlentities($j).'>';
+                 $j++;
                 }
-
-                echo '</YEAR_' . htmlentities($key) . '>';
+                
+                echo '</YEAR_'.htmlentities($key).'>';
             }
             echo '</data>';
         }
     }
-} else {
-    $data['error'] = 'Invalid Credentials.';
-    if ($format == 'json') {
-        header('Content-type: application/json');
+}
 
-        if (count($data) > 0) {
-            echo  json_encode($data);
+else
+{
+    $data['error']='Invalid Credentials.';
+    if($format == 'json') 
+    {
+        header('Content-type: application/json');
+        
+        if(count($data)>0)
+        {
+             echo  json_encode($data);
         }
+                      
     }
-    if ($format == 'xml') {
+    if($format == 'xml')
+    {
         header('Content-type: text/xml');
         echo '<error>Invalid Credentials.</error>';
     }
 }
+
+
+
+
+?>
+

--- api/StudentEnrollmentInfo.php ---
@@ -11,13 +11,12 @@
 require_once("../functions/PragRepFnc.php");
 ini_set('memory_limit', '1200000000M');
 ini_set('max_execution_time', '500000');
-function db_start()
-{
+function db_start() {
     global $DatabaseServer, $DatabaseUsername, $DatabasePassword, $DatabaseName, $DatabasePort, $DatabaseType;
 
     switch ($DatabaseType) {
         case 'mysqli':
-            $connection = new mysqli($DatabaseServer, $DatabaseUsername, $DatabasePassword, $DatabaseName, $DatabasePort);
+            $connection = new mysqli($DatabaseServer, $DatabaseUsername, $DatabasePassword, $DatabaseName);
             break;
     }
 
@@ -28,16 +27,15 @@ function db_start()
                 $errormessage = mysqli_error($connection);
                 break;
         }
-        db_show_error("", "" . _couldNotConnectToDatabase . ": $DatabaseServer", $errormessage);
+        db_show_error("", ""._couldNotConnectToDatabase.": $DatabaseServer", $errstring);
     }
     return $connection;
 }
 
 // This function connects, and does the passed query, then returns a connection identifier.
 // Not receiving the return == unusable search.
 //		ie, $processable_results = DBQuery("select * from students");
-function DBQuery($sql)
-{
+function DBQuery($sql) {
     global $DatabaseType, $_openSIS;
 
     $connection = db_start();
@@ -76,8 +74,7 @@ function DBQuery($sql)
 }
 
 // return next row.
-function db_fetch_row($result)
-{
+function db_fetch_row($result) {
     global $DatabaseType;
 
     switch ($DatabaseType) {
@@ -95,8 +92,7 @@ function db_fetch_row($result)
 }
 
 // returns code to go into SQL statement for accessing the next value of a sequence function db_seq_nextval($seqname)
-function db_seq_nextval($seqname)
-{
+function db_seq_nextval($seqname) {
     global $DatabaseType;
 
     if ($DatabaseType == 'mysqli')
@@ -105,8 +101,7 @@ function db_seq_nextval($seqname)
     return $seq;
 }
 
-function db_case($array)
-{
+function db_case($array) {
     global $DatabaseType;
 
     $counter = 0;
@@ -123,24 +118,23 @@ function db_case($array)
                 $string = substr($string, 0, -1);
             }
 
-            $string .= "$value";
+            $string.="$value";
             if ($counter == ($array_count - 2) && $array_count % 2 == 0)
-                $string .= " ELSE ";
+                $string.=" ELSE ";
             elseif ($counter == ($array_count - 1))
-                $string .= " END ";
+                $string.=" END ";
             elseif ($counter % 2 == 0)
-                $string .= " WHEN $array[0]=";
+                $string.=" WHEN $array[0]=";
             elseif ($counter % 2 == 1)
-                $string .= " THEN ";
+                $string.=" THEN ";
 
             $counter++;
         }
     }
     return $string;
 }
 
-function db_properties($table)
-{
+function db_properties($table) {
     global $DatabaseType, $DatabaseUsername;
 
     switch ($DatabaseType) {
@@ -164,50 +158,55 @@ function db_properties($table)
     }
     return $properties;
 }
-function singleQuoteReplace($param1 = false, $param2 = false, $param3)
+function singleQuoteReplace($param1=false,$param2=false,$param3)
 {
-    return str_replace("'", "''", str_replace("\'", "'", $param3));
+    return str_replace("'","''",str_replace("\'","'",$param3));
 }
-function DBGet($QI, $functions = array(), $index = array())
-{
-    global $THIS_RET;
-
-    $index_count = count($index);
-    $tmp_THIS_RET = $THIS_RET;
-    $results = array();
-    while ($RET = db_fetch_row($QI)) {
-        $THIS_RET = $RET;
-
-        if ($index_count) {
-            $ind = '';
-            foreach ($index as $col)
-                $ind .= "['" . singleQuoteReplace("'", "\'", $THIS_RET[$col]) . "']";
-            eval('$s' . $ind . '++;$this_ind=$s' . $ind . ';');
-        } else
-            $s++; // 1-based if no index specified
-        foreach ($RET as $key => $value) {
-            if (strlen($value) == strlen(strip_tags($value)))
-                $value =  htmlentities($value);
-            if ($functions[$key] && function_exists($functions[$key])) {
-                if ($index_count)
-                    eval('$results' . $ind . '[$this_ind][$key] = $functions[$key]($value,$key);');
-                else
-                    $results[$s][$key] = $functions[$key]($value, $key);
-            } else {
-                if ($index_count)
-                    eval('$results' . $ind . '[$this_ind][$key] = $value;');
-                else
-                    $results[$s][$key] = $value;
-            }
-        }
-    }
-
-    $THIS_RET = $tmp_THIS_RET;
-    return $results;
+function DBGet($QI,$functions=array(),$index=array())
+{	global $THIS_RET;
+
+	$index_count = count($index);
+	$tmp_THIS_RET = $THIS_RET;
+	$results = array();
+	while($RET=db_fetch_row($QI))
+	{
+		$THIS_RET = $RET;
+
+		if($index_count)
+		{
+			$ind = '';
+			foreach($index as $col)
+				$ind .= "['".singleQuoteReplace("'","\'",$THIS_RET[$col])."']";
+			eval('$s'.$ind.'++;$this_ind=$s'.$ind.';');
+		}
+		else
+			$s++; // 1-based if no index specified
+		foreach($RET as $key=>$value)
+		{                    
+                    if(strlen($value) == strlen(strip_tags($value)))
+                    $value=  htmlentities($value);
+			if($functions[$key] && function_exists($functions[$key]))
+			{
+				if($index_count)
+					eval('$results'.$ind.'[$this_ind][$key] = $functions[$key]($value,$key);');
+				else
+					$results[$s][$key] = $functions[$key]($value,$key);
+			}
+			else
+			{
+				if($index_count)
+					eval('$results'.$ind.'[$this_ind][$key] = $value;');
+				else
+					$results[$s][$key] = $value;
+			}
+		}
+	}
+
+	$THIS_RET = $tmp_THIS_RET;
+	return $results;
 }
 
-function db_show_error($sql, $failnote, $additional = '')
-{
+function db_show_error($sql, $failnote, $additional = '') {
     global $openSISTitle, $openSISVersion, $openSISNotifyAddress, $openSISMode;
 
     $tb = debug_backtrace();
@@ -270,258 +269,304 @@ function db_show_error($sql, $failnote, $additional = '')
 
     die();
 }
-function GetMP($mp = '', $column = 'TITLE', $syear, $school)
-{
-    global $_openSIS;
-    // mab - need to translate marking_period_id to title to be useful as a function call from dbget
-    // also, it doesn't make sense to ask for same thing you give
-    if ($column == 'MARKING_PERIOD_ID')
-        $column = 'TITLE';
-
-    if (!$_openSIS['GetMP']) {
-
-        $_openSIS['GetMP'] = DBGet(DBQuery('SELECT MARKING_PERIOD_ID,TITLE,POST_START_DATE,POST_END_DATE,\'school_quarters\' AS `TABLE`,\'SEMESTER_ID\' AS `PA_ID`,SORT_ORDER,SHORT_NAME,START_DATE,END_DATE,DOES_GRADES,DOES_EXAM,DOES_COMMENTS FROM school_quarters         WHERE SYEAR=\'' . $syear . '\' AND SCHOOL_ID=\'' . $school . '\'
-					UNION      SELECT MARKING_PERIOD_ID,TITLE,POST_START_DATE,POST_END_DATE,\'school_semesters\' AS `TABLE`,\'YEAR_ID\' AS `PA_ID`,SORT_ORDER,SHORT_NAME,START_DATE,END_DATE,DOES_GRADES,DOES_EXAM,DOES_COMMENTS FROM school_semesters        WHERE SYEAR=\'' . $syear . '\' AND SCHOOL_ID=\'' . $school . '\'
-					UNION      SELECT MARKING_PERIOD_ID,TITLE,POST_START_DATE,POST_END_DATE,\'school_years\' AS `TABLE`, \'-1\' AS `PA_ID`,SORT_ORDER,SHORT_NAME,START_DATE,END_DATE,DOES_GRADES,DOES_EXAM,DOES_COMMENTS FROM school_years            WHERE SYEAR=\'' . $syear . '\' AND SCHOOL_ID=\'' . $school . '\'
-					UNION      SELECT MARKING_PERIOD_ID,TITLE,POST_START_DATE,POST_END_DATE,\'school_progress_periods\' AS `TABLE`, \'-1\' AS `PA_ID`,SORT_ORDER,SHORT_NAME,START_DATE,END_DATE,DOES_GRADES,DOES_EXAM,DOES_COMMENTS FROM school_progress_periods WHERE SYEAR=\'' . $syear . '\' AND SCHOOL_ID=\'' . $school . '\''), array(), array('MARKING_PERIOD_ID'));
-    }
-
-    if (substr($mp, 0, 1) == 'E') {
-        if ($column == 'TITLE' || $column == 'SHORT_NAME')
-            $suffix = ' Exam';
-        $mp = substr($mp, 1);
-    }
-    if ($mp == '') {
-        return 'Custom';
-    } else {
+function GetMP($mp='',$column='TITLE',$syear,$school)
+{	global $_openSIS;
+	// mab - need to translate marking_period_id to title to be useful as a function call from dbget
+	// also, it doesn't make sense to ask for same thing you give
+	if($column=='MARKING_PERIOD_ID')
+		$column='TITLE';
+
+	if(!$_openSIS['GetMP'])
+	{
+           
+		$_openSIS['GetMP'] = DBGet(DBQuery('SELECT MARKING_PERIOD_ID,TITLE,POST_START_DATE,POST_END_DATE,\'school_quarters\' AS `TABLE`,\'SEMESTER_ID\' AS `PA_ID`,SORT_ORDER,SHORT_NAME,START_DATE,END_DATE,DOES_GRADES,DOES_EXAM,DOES_COMMENTS FROM school_quarters         WHERE SYEAR=\''.$syear.'\' AND SCHOOL_ID=\''.$school.'\'
+					UNION      SELECT MARKING_PERIOD_ID,TITLE,POST_START_DATE,POST_END_DATE,\'school_semesters\' AS `TABLE`,\'YEAR_ID\' AS `PA_ID`,SORT_ORDER,SHORT_NAME,START_DATE,END_DATE,DOES_GRADES,DOES_EXAM,DOES_COMMENTS FROM school_semesters        WHERE SYEAR=\''.$syear.'\' AND SCHOOL_ID=\''.$school.'\'
+					UNION      SELECT MARKING_PERIOD_ID,TITLE,POST_START_DATE,POST_END_DATE,\'school_years\' AS `TABLE`, \'-1\' AS `PA_ID`,SORT_ORDER,SHORT_NAME,START_DATE,END_DATE,DOES_GRADES,DOES_EXAM,DOES_COMMENTS FROM school_years            WHERE SYEAR=\''.$syear.'\' AND SCHOOL_ID=\''.$school.'\'
+					UNION      SELECT MARKING_PERIOD_ID,TITLE,POST_START_DATE,POST_END_DATE,\'school_progress_periods\' AS `TABLE`, \'-1\' AS `PA_ID`,SORT_ORDER,SHORT_NAME,START_DATE,END_DATE,DOES_GRADES,DOES_EXAM,DOES_COMMENTS FROM school_progress_periods WHERE SYEAR=\''.$syear.'\' AND SCHOOL_ID=\''.$school.'\''),array(),array('MARKING_PERIOD_ID'));
 
-        if ($mp == 0 && $column == 'TITLE')
-
-            return 'Full Year' . $suffix;
-        else {
-            return $_openSIS['GetMP'][$mp][1][$column] . $suffix;
         }
-    }
-}
-function _makeLetterGrade($percent, $course_period_id = 0, $staff_id = 0, $ret = '')
+        
+	if(substr($mp,0,1)=='E')
+	{
+		if($column=='TITLE' || $column=='SHORT_NAME')
+			$suffix = ' Exam';
+		$mp = substr($mp,1);
+	}
+if($mp=='')
 {
-    global $programconfig, $_openSIS;
-
-
-
-    $cp = DBGet(DBQuery('SELECT * FROM course_periods WHERE COURSE_PERIOD_ID=' . $course_period_id));
-    if (!$programconfig[$staff_id]) {
-        $config_RET = DBGet(DBQuery('SELECT TITLE,VALUE FROM program_user_config WHERE USER_ID=\'' . $staff_id . '\' AND PROGRAM=\'Gradebook\' AND VALUE LIKE \'%_' . $course_period_id . '\''), array(), array('TITLE'));
-        if (count($config_RET))
-            foreach ($config_RET as $title => $value) {
-                $unused_var = explode('_', $value[1]['VALUE']);
-                $programconfig[$staff_id][$title] = $unused_var[0];
-                //				$programconfig[$staff_id][$title] = rtrim($value[1]['VALUE'],'_'.$course_period_id);
-            }
-        else
-            $programconfig[$staff_id] = true;
-    }
-    if (!$_openSIS['_makeLetterGrade']['courses'][$course_period_id])
-        $_openSIS['_makeLetterGrade']['courses'][$course_period_id] = DBGet(DBQuery('SELECT DOES_BREAKOFF,GRADE_SCALE_ID FROM course_periods WHERE COURSE_PERIOD_ID=\'' . $course_period_id . '\''));
-    $does_breakoff = $_openSIS['_makeLetterGrade']['courses'][$course_period_id][1]['DOES_BREAKOFF'];
-    $grade_scale_id = $_openSIS['_makeLetterGrade']['courses'][$course_period_id][1]['GRADE_SCALE_ID'];
-
-    $percent *= 100;
-
-    if ($programconfig[$staff_id]['ROUNDING'] == 'UP') {
-        $percent = ceil($percent);
-    } elseif ($programconfig[$staff_id]['ROUNDING'] == 'DOWN') {
-        $percent = floor($percent);
-    } elseif ($programconfig[$staff_id]['ROUNDING'] == 'NORMAL') {
-        $percent = round($percent, 0);
-    } else {
-        $percent = round($percent, 2); // school default
-    }
-    if ($ret == '%')
-        return $percent;
-
-    if (!$_openSIS['_makeLetterGrade']['grades'][$grade_scale_id])
-        $_openSIS['_makeLetterGrade']['grades'][$grade_scale_id] = DBGet(DBQuery('SELECT TITLE,ID,BREAK_OFF FROM report_card_grades WHERE SYEAR=\'' . $cp[1]['SYEAR'] . '\' AND SCHOOL_ID=\'' . $cp[1]['SCHOOL_ID'] . '\' AND GRADE_SCALE_ID=\'' . $grade_scale_id . '\' ORDER BY BREAK_OFF IS NOT NULL DESC,BREAK_OFF DESC,SORT_ORDER'));
-
-    foreach ($_openSIS['_makeLetterGrade']['grades'][$grade_scale_id] as $grade) {
-        if ($does_breakoff == 'Y' ? $percent >= $programconfig[$staff_id][$course_period_id . '-' . $grade['ID']] && is_numeric($programconfig[$staff_id][$course_period_id . '-' . $grade['ID']]) : $percent >= $grade['BREAK_OFF'])
-            return $ret == 'ID' ? $grade['ID'] : $grade['TITLE'];
-    }
+    return 'Custom';
+}
+ else {
+   
+  if($mp==0 && $column=='TITLE')
+      
+		return 'Full Year'.$suffix;
+	else
+        {
+		return $_openSIS['GetMP'][$mp][1][$column].$suffix;  
+        }
+}
+	
+}
+function _makeLetterGrade($percent,$course_period_id=0,$staff_id=0,$ret='')
+{	
+    global $programconfig,$_openSIS;
+	
+
+	
+$cp=DBGet(DBQuery('SELECT * FROM course_periods WHERE COURSE_PERIOD_ID='.$course_period_id));
+	if(!$programconfig[$staff_id])
+	{
+		$config_RET = DBGet(DBQuery('SELECT TITLE,VALUE FROM program_user_config WHERE USER_ID=\''.$staff_id.'\' AND PROGRAM=\'Gradebook\' AND VALUE LIKE \'%_'.$course_period_id.'\''),array(),array('TITLE'));
+		if(count($config_RET))
+			foreach($config_RET as $title=>$value)
+                        {
+                                $unused_var=explode('_',$value[1]['VALUE']);
+                                $programconfig[$staff_id][$title] =$unused_var[0];
+//				$programconfig[$staff_id][$title] = rtrim($value[1]['VALUE'],'_'.$course_period_id);
+                        }
+		else
+			$programconfig[$staff_id] = true;
+	}
+	if(!$_openSIS['_makeLetterGrade']['courses'][$course_period_id])
+		$_openSIS['_makeLetterGrade']['courses'][$course_period_id] = DBGet(DBQuery('SELECT DOES_BREAKOFF,GRADE_SCALE_ID FROM course_periods WHERE COURSE_PERIOD_ID=\''.$course_period_id.'\''));
+	$does_breakoff = $_openSIS['_makeLetterGrade']['courses'][$course_period_id][1]['DOES_BREAKOFF'];
+	$grade_scale_id = $_openSIS['_makeLetterGrade']['courses'][$course_period_id][1]['GRADE_SCALE_ID'];
+
+	$percent *= 100;
+
+		if($programconfig[$staff_id]['ROUNDING']=='UP')
+                {
+			$percent = ceil($percent);
+                }
+		elseif($programconfig[$staff_id]['ROUNDING']=='DOWN')
+                {
+			$percent = floor($percent);
+                }
+		elseif($programconfig[$staff_id]['ROUNDING']=='NORMAL')
+                {
+			$percent = round($percent,0);
+                }
+                else
+                {
+		$percent = round($percent,2); // school default
+                }
+	if($ret=='%')
+		return $percent;
+
+	if(!$_openSIS['_makeLetterGrade']['grades'][$grade_scale_id])
+		$_openSIS['_makeLetterGrade']['grades'][$grade_scale_id] = DBGet(DBQuery('SELECT TITLE,ID,BREAK_OFF FROM report_card_grades WHERE SYEAR=\''.$cp[1]['SYEAR'].'\' AND SCHOOL_ID=\''.$cp[1]['SCHOOL_ID'].'\' AND GRADE_SCALE_ID=\''.$grade_scale_id.'\' ORDER BY BREAK_OFF IS NOT NULL DESC,BREAK_OFF DESC,SORT_ORDER'));
+	
+	foreach($_openSIS['_makeLetterGrade']['grades'][$grade_scale_id] as $grade)
+	{
+		if($does_breakoff=='Y' ? $percent>=$programconfig[$staff_id][$course_period_id.'-'.$grade['ID']] && is_numeric($programconfig[$staff_id][$course_period_id.'-'.$grade['ID']]) : $percent>=$grade['BREAK_OFF'])
+			return $ret=='ID' ? $grade['ID'] : $grade['TITLE'];
+	}
 }
 
 
-$connection = new mysqli($DatabaseServer, $DatabaseUsername, $DatabasePassword, $DatabaseName, $DatabasePort);
-
-$format = mysqli_real_escape_string($connection, strtolower(optional_param('format', '', PARAM_RAW)));
-$api_key = mysqli_real_escape_string($connection, optional_param('api_key', '', PARAM_RAW));
-$api_secret = mysqli_real_escape_string($connection, optional_param('api_secret', '', PARAM_RAW));
-
-$validate = DBGet(DBQuery('SELECT * FROM api_info WHERE API_KEY=\'' . $api_key . '\' AND API_SECRET=\'' . $api_secret . '\''));
-if (count($validate) > 0) {
-    $syear = mysqli_real_escape_string($connection, strtolower(optional_param('sch_year', '', PARAM_RAW)));
-    $all_sch_ids = DBGet(DBQuery('SELECT DISTINCT SCHOOL_ID AS SCHOOL_ID FROM school_years WHERE SYEAR = ' . $syear));
-    //    $all_sch_ids=DBGet(DBQuery('SELECT DISTINCT SCHOOL_ID AS SCHOOL_ID FROM school_years WHERE SCHOOL_ID=1 AND SYEAR = '.$syear));
-    $data = array();
-
-    if (count($all_sch_ids) > 0) {
-
-        $stu_grade = DBGet(DBQuery('SELECT * FROM school_gradelevels'));
-        $stu_grade_arr = array();
-        foreach ($stu_grade as $sg)
-            $stu_grade_arr[$sg['ID']] = $sg['TITLE'];
-
-        $stu_sec = DBGet(DBQuery('SELECT * FROM school_gradelevel_sections'));
-        $stu_sec_arr = array();
-        foreach ($stu_sec as $sg)
-            $stu_sec_arr[$sg['ID']] = $sg['NAME'];
-
-        $stu_cal = DBGet(DBQuery('SELECT * FROM school_calendars WHERE SYEAR=' . $syear));
-        $stu_cal_arr = array();
-        foreach ($stu_cal as $sg)
-            $stu_cal_arr[$sg['CALENDAR_ID']] = $sg['TITLE'];
-
-
-        $stu_enr = DBGet(DBQuery('SELECT * FROM student_enrollment_codes WHERE SYEAR=' . $syear));
-        $stu_enr_arr = array();
-        foreach ($stu_enr as $sg)
-            $stu_enr_arr[$sg['ID']] = $sg['TITLE'];
+$connection = new mysqli($DatabaseServer, $DatabaseUsername, $DatabasePassword, $DatabaseName);
 
+$format = mysqli_real_escape_string($connection,strtolower(optional_param('format', '', PARAM_RAW)));
+$api_key= mysqli_real_escape_string($connection,optional_param('api_key', '', PARAM_RAW));
+$api_secret= mysqli_real_escape_string($connection, optional_param('api_secret', '', PARAM_RAW));
 
+$validate= DBGet(DBQuery('SELECT * FROM api_info WHERE API_KEY=\''.$api_key.'\' AND API_SECRET=\''.$api_secret.'\''));
+if(count($validate) > 0)
+{
+    $syear=mysqli_real_escape_string($connection,strtolower(optional_param('sch_year', '', PARAM_RAW)));
+    $all_sch_ids=DBGet(DBQuery('SELECT DISTINCT SCHOOL_ID AS SCHOOL_ID FROM school_years WHERE SYEAR = '.$syear));
+//    $all_sch_ids=DBGet(DBQuery('SELECT DISTINCT SCHOOL_ID AS SCHOOL_ID FROM school_years WHERE SCHOOL_ID=1 AND SYEAR = '.$syear));
+    $data=array();
+    
+    if(count($all_sch_ids)>0)
+    {
+        
+        $stu_grade=DBGet(DBQuery('SELECT * FROM school_gradelevels'));
+        $stu_grade_arr=array();
+        foreach($stu_grade as $sg)
+           $stu_grade_arr[$sg['ID']]=$sg['TITLE']; 
+
+        $stu_sec=DBGet(DBQuery('SELECT * FROM school_gradelevel_sections'));
+        $stu_sec_arr=array();
+        foreach($stu_sec as $sg)
+           $stu_sec_arr[$sg['ID']]=$sg['NAME'];
+
+        $stu_cal=DBGet(DBQuery('SELECT * FROM school_calendars WHERE SYEAR='.$syear));
+        $stu_cal_arr=array();
+        foreach($stu_cal as $sg)
+           $stu_cal_arr[$sg['CALENDAR_ID']]=$sg['TITLE'];
+        
+        
+        $stu_enr=DBGet(DBQuery('SELECT * FROM student_enrollment_codes WHERE SYEAR='.$syear));
+        $stu_enr_arr=array();
+        foreach($stu_enr as $sg)
+           $stu_enr_arr[$sg['ID']]=$sg['TITLE'];
+        
+        
         foreach ($all_sch_ids as $key => $value) {
+            
+            $sch_name=DBGet(DBQuery('SELECT TITLE FROM schools WHERE ID='.$value['SCHOOL_ID']));
+            
+            
+            $stu_enroll=DBGet(DBQuery('SELECT DISTINCT STUDENT_ID AS STUDENT_ID FROM student_enrollment WHERE SYEAR='.$syear.' AND SCHOOL_ID='.$value['SCHOOL_ID']));
+            foreach($stu_enroll as $stu_key=>$stu_val)
+            {
+
+                $stuinfo= DBGet(DBQuery('SELECT * FROM students WHERE STUDENT_ID='.$stu_val['STUDENT_ID']));
+
+//                $data[$syear][$sch_name[1]['TITLE']][$stu_val['STUDENT_ID']]=$stuinfo[1];
+                $data['data'][$syear][$sch_name[1]['TITLE']][$stu_val['STUDENT_ID']]['STUDENT_ID']=($stuinfo[1]['STUDENT_ID']==''?'':$stuinfo[1]['STUDENT_ID']);
+                $data['data'][$syear][$sch_name[1]['TITLE']][$stu_val['STUDENT_ID']]['ALT_ID']=($stuinfo[1]['ALT_ID']==''?'':$stuinfo[1]['ALT_ID']);
+                $data['data'][$syear][$sch_name[1]['TITLE']][$stu_val['STUDENT_ID']]['FIRST_NAME']=($stuinfo[1]['FIRST_NAME']==''?'':$stuinfo[1]['FIRST_NAME']);
+                $data['data'][$syear][$sch_name[1]['TITLE']][$stu_val['STUDENT_ID']]['MIDDLE_NAME']=($stuinfo[1]['MIDDLE_NAME']==''?'':$stuinfo[1]['MIDDLE_NAME']);
+                $data['data'][$syear][$sch_name[1]['TITLE']][$stu_val['STUDENT_ID']]['LAST_NAME']=($stuinfo[1]['LAST_NAME']==''?'':$stuinfo[1]['LAST_NAME']);
+                $data['data'][$syear][$sch_name[1]['TITLE']][$stu_val['STUDENT_ID']]['COMMON_NAME']=($stuinfo[1]['COMMON_NAME']==''?'':$stuinfo[1]['COMMON_NAME']);
+                $data['data'][$syear][$sch_name[1]['TITLE']][$stu_val['STUDENT_ID']]['ESTIMATED_GRAD_DATE']=($stuinfo[1]['ESTIMATED_GRAD_DATE']==''?'':$stuinfo[1]['ESTIMATED_GRAD_DATE']);
+                
+                
+                $data['data'][$syear][$sch_name[1]['TITLE']][$stu_val['STUDENT_ID']]['EMAIL']=($stuinfo[1]['EMAIL']==''?'':$stuinfo[1]['EMAIL']);
+                $data['data'][$syear][$sch_name[1]['TITLE']][$stu_val['STUDENT_ID']]['PHONE']=($stuinfo[1]['PHONE']==''?'':$stuinfo[1]['PHONE']);
+                $data['data'][$syear][$sch_name[1]['TITLE']][$stu_val['STUDENT_ID']]['GENDER']=($stuinfo[1]['GENDER']==''?'':$stuinfo[1]['GENDER']);
+                $data['data'][$syear][$sch_name[1]['TITLE']][$stu_val['STUDENT_ID']]['DOB']=($stuinfo[1]['BIRTHDATE']==''?'':$stuinfo[1]['BIRTHDATE']);
+                $data['data'][$syear][$sch_name[1]['TITLE']][$stu_val['STUDENT_ID']]['ETHNICITY']=($stuinfo[1]['ETHNICITY']==''?'':$stuinfo[1]['ETHNICITY']);
+                $data['data'][$syear][$sch_name[1]['TITLE']][$stu_val['STUDENT_ID']]['LANGUAGE']=($stuinfo[1]['LANGUAGE']==''?'':$stuinfo[1]['LANGUAGE']);
+                
+                $stu_ern_info=DBGet(DBQuery('SELECT * FROM student_enrollment WHERE SYEAR='.$syear.' AND SCHOOL_ID='.$value['SCHOOL_ID'].' AND STUDENT_ID='.$stu_val['STUDENT_ID']));
+                $i=1;
+                foreach($stu_ern_info as $skey=>$sval)
+                {
+                  $data['data'][$syear][$sch_name[1]['TITLE']][$stu_val['STUDENT_ID']]['ENROLLMENT_INFO'][$i]['SCHOOL_ID']=$sval['SCHOOL_ID'];  
+                  if($sval['CALENDAR_ID']!='')
+                    $data['data'][$syear][$sch_name[1]['TITLE']][$stu_val['STUDENT_ID']]['ENROLLMENT_INFO'][$i]['CALENDAR']=$stu_cal_arr[$sval['CALENDAR_ID']];
+                else
+                    $data['data'][$syear][$sch_name[1]['TITLE']][$stu_val['STUDENT_ID']]['ENROLLMENT_INFO'][$i]['CALENDAR']='';    
+                    
+                    
+                if($sval['GRADE_ID']!='')
+                    $data['data'][$syear][$sch_name[1]['TITLE']][$stu_val['STUDENT_ID']]['ENROLLMENT_INFO'][$i]['GRADE']=$stu_grade_arr[$sval['GRADE_ID']];
+                else
+                    $data['data'][$syear][$sch_name[1]['TITLE']][$stu_val['STUDENT_ID']]['ENROLLMENT_INFO'][$i]['GRADE']='';
 
-            $sch_name = DBGet(DBQuery('SELECT TITLE FROM schools WHERE ID=' . $value['SCHOOL_ID']));
-
-
-            $stu_enroll = DBGet(DBQuery('SELECT DISTINCT STUDENT_ID AS STUDENT_ID FROM student_enrollment WHERE SYEAR=' . $syear . ' AND SCHOOL_ID=' . $value['SCHOOL_ID']));
-            foreach ($stu_enroll as $stu_key => $stu_val) {
-
-                $stuinfo = DBGet(DBQuery('SELECT * FROM students WHERE STUDENT_ID=' . $stu_val['STUDENT_ID']));
-
-                //                $data[$syear][$sch_name[1]['TITLE']][$stu_val['STUDENT_ID']]=$stuinfo[1];
-                $data['data'][$syear][$sch_name[1]['TITLE']][$stu_val['STUDENT_ID']]['STUDENT_ID'] = ($stuinfo[1]['STUDENT_ID'] == '' ? '' : $stuinfo[1]['STUDENT_ID']);
-                $data['data'][$syear][$sch_name[1]['TITLE']][$stu_val['STUDENT_ID']]['ALT_ID'] = ($stuinfo[1]['ALT_ID'] == '' ? '' : $stuinfo[1]['ALT_ID']);
-                $data['data'][$syear][$sch_name[1]['TITLE']][$stu_val['STUDENT_ID']]['FIRST_NAME'] = ($stuinfo[1]['FIRST_NAME'] == '' ? '' : $stuinfo[1]['FIRST_NAME']);
-                $data['data'][$syear][$sch_name[1]['TITLE']][$stu_val['STUDENT_ID']]['MIDDLE_NAME'] = ($stuinfo[1]['MIDDLE_NAME'] == '' ? '' : $stuinfo[1]['MIDDLE_NAME']);
-                $data['data'][$syear][$sch_name[1]['TITLE']][$stu_val['STUDENT_ID']]['LAST_NAME'] = ($stuinfo[1]['LAST_NAME'] == '' ? '' : $stuinfo[1]['LAST_NAME']);
-                $data['data'][$syear][$sch_name[1]['TITLE']][$stu_val['STUDENT_ID']]['COMMON_NAME'] = ($stuinfo[1]['COMMON_NAME'] == '' ? '' : $stuinfo[1]['COMMON_NAME']);
-                $data['data'][$syear][$sch_name[1]['TITLE']][$stu_val['STUDENT_ID']]['ESTIMATED_GRAD_DATE'] = ($stuinfo[1]['ESTIMATED_GRAD_DATE'] == '' ? '' : $stuinfo[1]['ESTIMATED_GRAD_DATE']);
-
-
-                $data['data'][$syear][$sch_name[1]['TITLE']][$stu_val['STUDENT_ID']]['EMAIL'] = ($stuinfo[1]['EMAIL'] == '' ? '' : $stuinfo[1]['EMAIL']);
-                $data['data'][$syear][$sch_name[1]['TITLE']][$stu_val['STUDENT_ID']]['PHONE'] = ($stuinfo[1]['PHONE'] == '' ? '' : $stuinfo[1]['PHONE']);
-                $data['data'][$syear][$sch_name[1]['TITLE']][$stu_val['STUDENT_ID']]['GENDER'] = ($stuinfo[1]['GENDER'] == '' ? '' : $stuinfo[1]['GENDER']);
-                $data['data'][$syear][$sch_name[1]['TITLE']][$stu_val['STUDENT_ID']]['DOB'] = ($stuinfo[1]['BIRTHDATE'] == '' ? '' : $stuinfo[1]['BIRTHDATE']);
-                $data['data'][$syear][$sch_name[1]['TITLE']][$stu_val['STUDENT_ID']]['ETHNICITY'] = ($stuinfo[1]['ETHNICITY'] == '' ? '' : $stuinfo[1]['ETHNICITY']);
-                $data['data'][$syear][$sch_name[1]['TITLE']][$stu_val['STUDENT_ID']]['LANGUAGE'] = ($stuinfo[1]['LANGUAGE'] == '' ? '' : $stuinfo[1]['LANGUAGE']);
-
-                $stu_ern_info = DBGet(DBQuery('SELECT * FROM student_enrollment WHERE SYEAR=' . $syear . ' AND SCHOOL_ID=' . $value['SCHOOL_ID'] . ' AND STUDENT_ID=' . $stu_val['STUDENT_ID']));
-                $i = 1;
-                foreach ($stu_ern_info as $skey => $sval) {
-                    $data['data'][$syear][$sch_name[1]['TITLE']][$stu_val['STUDENT_ID']]['ENROLLMENT_INFO'][$i]['SCHOOL_ID'] = $sval['SCHOOL_ID'];
-                    if ($sval['CALENDAR_ID'] != '')
-                        $data['data'][$syear][$sch_name[1]['TITLE']][$stu_val['STUDENT_ID']]['ENROLLMENT_INFO'][$i]['CALENDAR'] = $stu_cal_arr[$sval['CALENDAR_ID']];
-                    else
-                        $data['data'][$syear][$sch_name[1]['TITLE']][$stu_val['STUDENT_ID']]['ENROLLMENT_INFO'][$i]['CALENDAR'] = '';
-
-
-                    if ($sval['GRADE_ID'] != '')
-                        $data['data'][$syear][$sch_name[1]['TITLE']][$stu_val['STUDENT_ID']]['ENROLLMENT_INFO'][$i]['GRADE'] = $stu_grade_arr[$sval['GRADE_ID']];
-                    else
-                        $data['data'][$syear][$sch_name[1]['TITLE']][$stu_val['STUDENT_ID']]['ENROLLMENT_INFO'][$i]['GRADE'] = '';
-
-                    if ($sval['SECTION_ID'] != '')
-                        $data['data'][$syear][$sch_name[1]['TITLE']][$stu_val['STUDENT_ID']]['ENROLLMENT_INFO'][$i]['SECTION'] = $stu_sec_arr[$sval['SECTION_ID']];
-                    else
-                        $data['data'][$syear][$sch_name[1]['TITLE']][$stu_val['STUDENT_ID']]['ENROLLMENT_INFO'][$i]['SECTION'] = '';
-
-
-                    $data['data'][$syear][$sch_name[1]['TITLE']][$stu_val['STUDENT_ID']]['ENROLLMENT_INFO'][$i]['START_DATE'] = $sval['START_DATE'];
-                    $data['data'][$syear][$sch_name[1]['TITLE']][$stu_val['STUDENT_ID']]['ENROLLMENT_INFO'][$i]['DROP_DATE'] = $sval['END_DATE'];
-
-
+                if($sval['SECTION_ID']!='')
+                    $data['data'][$syear][$sch_name[1]['TITLE']][$stu_val['STUDENT_ID']]['ENROLLMENT_INFO'][$i]['SECTION']=$stu_sec_arr[$sval['SECTION_ID']];
+                else
+                    $data['data'][$syear][$sch_name[1]['TITLE']][$stu_val['STUDENT_ID']]['ENROLLMENT_INFO'][$i]['SECTION']='';
+                
+                
+                $data['data'][$syear][$sch_name[1]['TITLE']][$stu_val['STUDENT_ID']]['ENROLLMENT_INFO'][$i]['START_DATE']=$sval['START_DATE'];
+                $data['data'][$syear][$sch_name[1]['TITLE']][$stu_val['STUDENT_ID']]['ENROLLMENT_INFO'][$i]['DROP_DATE']=$sval['END_DATE'];
 
-                    if ($sval['ENROLLMENT_CODE'] != '')
-                        $data['data'][$syear][$sch_name[1]['TITLE']][$stu_val['STUDENT_ID']]['ENROLLMENT_INFO'][$i]['ENROLLMENT_CODE'] = $stu_enr_arr[$sval['ENROLLMENT_CODE']];
-                    else
-                        $data['data'][$syear][$sch_name[1]['TITLE']][$stu_val['STUDENT_ID']]['ENROLLMENT_INFO'][$i]['ENROLLMENT_CODE'] = '';
-                    if ($sval['DROP_CODE'] != '')
-                        $data['data'][$syear][$sch_name[1]['TITLE']][$stu_val['STUDENT_ID']]['ENROLLMENT_INFO'][$i]['DROP_CODE'] = $stu_enr_arr[$sval['DROP_CODE']];
-                    else
-                        $data['data'][$syear][$sch_name[1]['TITLE']][$stu_val['STUDENT_ID']]['ENROLLMENT_INFO'][$i]['DROP_CODE'] = '';
-                    //                
-                    $i++;
+              
 
-                    ////                break 3;
+                if($sval['ENROLLMENT_CODE']!='')
+                    $data['data'][$syear][$sch_name[1]['TITLE']][$stu_val['STUDENT_ID']]['ENROLLMENT_INFO'][$i]['ENROLLMENT_CODE']=$stu_enr_arr[$sval['ENROLLMENT_CODE']];
+                else
+                    $data['data'][$syear][$sch_name[1]['TITLE']][$stu_val['STUDENT_ID']]['ENROLLMENT_INFO'][$i]['ENROLLMENT_CODE']='';
+                if($sval['DROP_CODE']!='')
+                    $data['data'][$syear][$sch_name[1]['TITLE']][$stu_val['STUDENT_ID']]['ENROLLMENT_INFO'][$i]['DROP_CODE']=$stu_enr_arr[$sval['DROP_CODE']];
+                else
+                    $data['data'][$syear][$sch_name[1]['TITLE']][$stu_val['STUDENT_ID']]['ENROLLMENT_INFO'][$i]['DROP_CODE']='';
+//                
+                $i++;
+                
+////                break 3;
                 }
+                
+                
             }
+            
+            
         }
+ 
     }
-    if ($format == 'json') {
+    if($format == 'json') 
+    {
         header('Content-type: application/json');
-
-        if (count($data) > 0) {
-            echo  json_encode($data);
+        
+        if(count($data)>0)
+        {
+             echo  json_encode($data);
         }
+                      
     }
-    if ($format == 'xml') {
+    if($format == 'xml')
+    {
         header('Content-type: text/xml');
-        if (count($data) > 0) {
+        if(count($data)> 0)
+        {
             echo '<data>';
-            foreach ($data['data'] as $key => $val) {
-
-                echo '<YEAR_' . htmlentities($key) . '>';
+            foreach($data['data'] as $key=>$val)
+            {
+                
+                echo '<YEAR_'.htmlentities($key).'>';
                 foreach ($val as $vkey => $value) {
-                    echo '<SCHOOL>';
-                    echo '<SCHOOL_NAME>' . htmlentities($vkey) . '</SCHOOL_NAME>';
-                    foreach ($value as $value_key => $value_arr) {
-                        echo '<STUDENT>';
-                        echo '<STUDENT_ID>' . htmlentities($value_key) . '</STUDENT_ID>';
-                        echo '<ALT_ID>' . htmlentities($value_arr['ALT_ID']) . '</ALT_ID>';
-                        echo '<FIRST_NAME>' . htmlentities($value_arr['FIRST_NAME']) . '</FIRST_NAME>';
-                        echo '<MIDDLE_NAME>' . htmlentities($value_arr['MIDDLE_NAME']) . '</MIDDLE_NAME>';
-                        echo '<LAST_NAME>' . htmlentities($value_arr['LAST_NAME']) . '</LAST_NAME>';
-                        echo '<COMMON_NAME>' . htmlentities($value_arr['COMMON_NAME']) . '</COMMON_NAME>';
-                        echo '<ESTIMATED_GRAD_DATE>' . htmlentities($value_arr['ESTIMATED_GRAD_DATE']) . '</ESTIMATED_GRAD_DATE>';
-
-                        echo '<EMAIL>' . htmlentities($value_arr['EMAIL']) . '</EMAIL>';
-                        echo '<PHONE>' . htmlentities($value_arr['PHONE']) . '</PHONE>';
-                        echo '<GENDER>' . htmlentities($value_arr['GENDER']) . '</GENDER>';
-                        echo '<DOB>' . htmlentities($value_arr['DOB']) . '</DOB>';
-                        echo '<ETHNICITY>' . htmlentities($value_arr['ETHNICITY']) . '</ETHNICITY>';
-                        echo '<LANGUAGE>' . htmlentities($value_arr['LANGUAGE']) . '</LANGUAGE>';
-                        foreach ($value_arr['ENROLLMENT_INFO'] as $eid => $ed) {
-                            echo '<ENROLLMENT_INFO_' . htmlentities($eid) . '>';
-                            echo '<SCHOOL_ID>' . htmlentities($ed['SCHOOL_ID']) . '</SCHOOL_ID>';
-                            echo '<CALENDAR>' . htmlentities($ed['CALENDAR']) . '</CALENDAR>';
-                            echo '<GRADE>' . htmlentities($ed['GRADE']) . '</GRADE>';
-                            echo '<SECTION>' . htmlentities($ed['SECTION']) . '</SECTION>';
-                            echo '<START_DATE>' . htmlentities($ed['START_DATE']) . '</START_DATE>';
-                            echo '<DROP_DATE>' . htmlentities($ed['DROP_DATE']) . '</DROP_DATE>';
-                            echo '<ENROLLMENT_CODE>' . htmlentities($ed['ENROLLMENT_CODE']) . '</ENROLLMENT_CODE>';
-                            echo '<DROP_CODE>' . htmlentities($ed['DROP_CODE']) . '</DROP_CODE>';
-                            echo '</ENROLLMENT_INFO_' . htmlentities($eid) . '>';
-                        }
-                        echo '</STUDENT>';
+                echo '<SCHOOL>';
+                echo '<SCHOOL_NAME>'.htmlentities($vkey).'</SCHOOL_NAME>';
+                foreach ($value as $value_key => $value_arr) {
+                    echo '<STUDENT>';
+                    echo '<STUDENT_ID>'.htmlentities($value_key).'</STUDENT_ID>';
+                    echo '<ALT_ID>'.htmlentities($value_arr['ALT_ID']).'</ALT_ID>';
+                    echo '<FIRST_NAME>'.htmlentities($value_arr['FIRST_NAME']).'</FIRST_NAME>';
+                    echo '<MIDDLE_NAME>'.htmlentities($value_arr['MIDDLE_NAME']).'</MIDDLE_NAME>';
+                    echo '<LAST_NAME>'.htmlentities($value_arr['LAST_NAME']).'</LAST_NAME>';
+                    echo '<COMMON_NAME>'.htmlentities($value_arr['COMMON_NAME']).'</COMMON_NAME>';
+                    echo '<ESTIMATED_GRAD_DATE>'.htmlentities($value_arr['ESTIMATED_GRAD_DATE']).'</ESTIMATED_GRAD_DATE>';
+                   
+                    echo '<EMAIL>'.htmlentities($value_arr['EMAIL']).'</EMAIL>';
+                    echo '<PHONE>'.htmlentities($value_arr['PHONE']).'</PHONE>';
+                    echo '<GENDER>'.htmlentities($value_arr['GENDER']).'</GENDER>';
+                    echo '<DOB>'.htmlentities($value_arr['DOB']).'</DOB>';
+                    echo '<ETHNICITY>'.htmlentities($value_arr['ETHNICITY']).'</ETHNICITY>';
+                    echo '<LANGUAGE>'.htmlentities($value_arr['LANGUAGE']).'</LANGUAGE>';
+                    foreach($value_arr['ENROLLMENT_INFO'] as $eid=>$ed)
+                    {
+                        echo '<ENROLLMENT_INFO_'.htmlentities($eid).'>';
+                        echo '<SCHOOL_ID>'.htmlentities($ed['SCHOOL_ID']).'</SCHOOL_ID>';
+                        echo '<CALENDAR>'.htmlentities($ed['CALENDAR']).'</CALENDAR>';
+                        echo '<GRADE>'.htmlentities($ed['GRADE']).'</GRADE>';
+                        echo '<SECTION>'.htmlentities($ed['SECTION']).'</SECTION>';
+                        echo '<START_DATE>'.htmlentities($ed['START_DATE']).'</START_DATE>';
+                        echo '<DROP_DATE>'.htmlentities($ed['DROP_DATE']).'</DROP_DATE>';
+                        echo '<ENROLLMENT_CODE>'.htmlentities($ed['ENROLLMENT_CODE']).'</ENROLLMENT_CODE>';
+                        echo '<DROP_CODE>'.htmlentities($ed['DROP_CODE']).'</DROP_CODE>';
+                        echo '</ENROLLMENT_INFO_'.htmlentities($eid).'>';
+                        
                     }
-                    echo '</SCHOOL>';
+                    echo '</STUDENT>';
                 }
-
-                echo '</YEAR_' . htmlentities($key) . '>';
+                 echo '</SCHOOL>';
+                }
+                
+                echo '</YEAR_'.htmlentities($key).'>';
             }
             echo '</data>';
         }
     }
-} else {
-    $data['error'] = 'Invalid Credentials.';
-    if ($format == 'json') {
-        header('Content-type: application/json');
+}
 
-        if (count($data) > 0) {
-            echo  json_encode($data);
+else
+{
+    $data['error']='Invalid Credentials.';
+    if($format == 'json') 
+    {
+        header('Content-type: application/json');
+        
+        if(count($data)>0)
+        {
+             echo  json_encode($data);
         }
+                      
     }
-    if ($format == 'xml') {
+    if($format == 'xml')
+    {
         header('Content-type: text/xml');
         echo '<error>Invalid Credentials.</error>';
     }
 }
+
+
+
+
+?>
+

--- assets/css/custom.css ---
@@ -390,6 +390,15 @@ ul[id*="select2-period-"] {
 }
 /* Schoolwide Schedule Reports - End */
 
+.ajax-loading {
+    text-align: center;
+    display: none;
+}
+
+.ajax-loading img {
+    height: 40px;
+}
+
 .btn-undo {
     background-color: #fff;
     padding: 6px 8px;

--- functions/ArrayRwalkFnc.php ---
@@ -28,19 +28,28 @@
 
 function array_rwalk(&$array, $function)
 {
-	global $DatabaseServer, $DatabaseUsername, $DatabasePassword, $DatabaseName, $DatabasePort, $DatabaseType, $connection;
-	$connection = new mysqli($DatabaseServer, $DatabaseUsername, $DatabasePassword, $DatabaseName, $DatabasePort);
-	if ($connection->connect_errno > 0)
-		die('Not connected');
+    global $DatabaseServer,$DatabaseUsername,$DatabasePassword,$DatabaseName,$DatabasePort,$DatabaseType,$connection ;
+    $connection = new mysqli($DatabaseServer,$DatabaseUsername,$DatabasePassword,$DatabaseName);
+	if($connection->connect_errno>0)
+    die('Not connected');
+    
+    foreach($array as $key => $value)
+	{
 
-	foreach ($array as $key => $value) {
-
-		if (is_array($value)) {
+		if(is_array($value))
+		{
 			array_rwalk($value, $function);
-			$array[$key] = $value;
-		} else {
-			$val = mysqli_real_escape_string($connection, $value);
-			$array[$key] = $function($val);
+                        $array[$key] = $value;
 		}
+		else
+                {
+                    $val=mysqli_real_escape_string($connection,$value);
+			$array[$key] = $function($val);
+                }
+
+                 
 	}
+        
 }
+
+?>
\ No newline at end of file

--- functions/ButtonFnc.php ---
@@ -78,7 +78,11 @@ function button($type, $text = '', $link = '', $width = '', $extra = '', $button
             $button .= '</A>';
         }
         if ($text) {
-            $button .= "</div>";
+            if ($link) {
+                $button .= '';
+            } else {
+                $button .= "</div>";
+            }
         }
     }
 

--- functions/HackingLogFnc.php ---
@@ -26,33 +26,38 @@
 #
 #***************************************************************************************
 
-function HackingLog()
-{
-	echo "" . _youReNotAllowedToUseThisProgram . "! " . _thisAttemptedViolationHasBeenLoggedAndYourIpAddressWasCaptured . ".";
-	Warehouse('footer');
-
-	if ($_SERVER['HTTP_X_FORWARDED_FOR']) {
-		$ip = $_SERVER['HTTP_X_FORWARDED_FOR'];
-	} else {
-		$ip = $_SERVER['REMOTE_ADDR'];
-	}
-
-	if ($openSISNotifyAddress)
-		mail($openSISNotifyAddress, 'HACKING ATTEMPT', "INSERT INTO hacking_log (HOST_NAME,IP_ADDRESS,LOGIN_DATE,VERSION,PHP_SELF,DOCUMENT_ROOT,SCRIPT_NAME,MODNAME,USERNAME) values('$_SERVER[SERVER_NAME]','$ip','" . date('Y-m-d') . "','$openSISVersion','$_SERVER[PHP_SELF]','$_SERVER[DOCUMENT_ROOT]','$_SERVER[SCRIPT_NAME]','$_REQUEST[modname]','" . User('USERNAME') . "')");
-
-
-
-	if (false && function_exists('query')) {
-
-		if ($_SERVER['HTTP_X_FORWARDED_FOR']) {
-			$ip = $_SERVER['HTTP_X_FORWARDED_FOR'];
-		} else {
-			$ip = $_SERVER['REMOTE_ADDR'];
-		}
-
-		$connection = new mysqli('os4ed.com', 'openSIS_log', 'openSIS_log', 'openSIS_log');
-
-		$connection->query("INSERT INTO hacking_log (HOST_NAME,IP_ADDRESS,LOGIN_DATE,VERSION,PHP_SELF,DOCUMENT_ROOT,SCRIPT_NAME,MODNAME,USERNAME) values('$_SERVER[SERVER_NAME]','$ip','" . date('Y-m-d') . "','$openSISVersion','$_SERVER[PHP_SELF]','$_SERVER[DOCUMENT_ROOT]','$_SERVER[SCRIPT_NAME]','" . optional_param('modname', '', PARAM_CLEAN) . "','" . User('USERNAME') . "')");
-		mysqli_close($link);
-	}
-}
+		function HackingLog()
+        {
+        echo ""._youReNotAllowedToUseThisProgram."! "._thisAttemptedViolationHasBeenLoggedAndYourIpAddressWasCaptured.".";
+			Warehouse('footer');
+			
+			if ($_SERVER['HTTP_X_FORWARDED_FOR']){
+				$ip = $_SERVER['HTTP_X_FORWARDED_FOR'];
+			} else {
+				$ip = $_SERVER['REMOTE_ADDR'];
+			}
+			
+			if($openSISNotifyAddress)
+				mail($openSISNotifyAddress,'HACKING ATTEMPT',"INSERT INTO hacking_log (HOST_NAME,IP_ADDRESS,LOGIN_DATE,VERSION,PHP_SELF,DOCUMENT_ROOT,SCRIPT_NAME,MODNAME,USERNAME) values('$_SERVER[SERVER_NAME]','$ip','".date('Y-m-d')."','$openSISVersion','$_SERVER[PHP_SELF]','$_SERVER[DOCUMENT_ROOT]','$_SERVER[SCRIPT_NAME]','$_REQUEST[modname]','".User('USERNAME')."')");
+			
+			
+		
+			if(false && function_exists('query'))
+			{
+				
+				if ($_SERVER['HTTP_X_FORWARDED_FOR']){
+					$ip = $_SERVER['HTTP_X_FORWARDED_FOR'];
+				} else {
+					$ip = $_SERVER['REMOTE_ADDR'];
+				}
+			
+                                $connection = new mysqli('os4ed.com','openSIS_log','openSIS_log','openSIS_log');
+				
+			$connection->query("INSERT INTO hacking_log (HOST_NAME,IP_ADDRESS,LOGIN_DATE,VERSION,PHP_SELF,DOCUMENT_ROOT,SCRIPT_NAME,MODNAME,USERNAME) values('$_SERVER[SERVER_NAME]','$ip','".date('Y-m-d')."','$openSISVersion','$_SERVER[PHP_SELF]','$_SERVER[DOCUMENT_ROOT]','$_SERVER[SCRIPT_NAME]','".optional_param('modname','',PARAM_CLEAN)."','".User('USERNAME')."')");	
+			mysqli_close($link);
+				
+				
+			}
+      
+        }
+?>
\ No newline at end of file

--- functions/PragRepFnc.php ---
@@ -22,3 +22,4 @@ function par_rep_cb($match='',$exp='',$sub='')
     return preg_replace_callback($match,$exp,$sub);
 }
 ?>
+

--- functions/VerifyAvailabilityFnc.php ---
@@ -1,19 +1,19 @@
 <?php
 #**************************************************************************
-#  openSIS is a free student information system for public and non-public 
+#  openSIS is a free student information system for public and non-public
 #  schools from Open Solutions for Education, Inc. web: www.os4ed.com
 #
-#  openSIS is  web-based, open source, and comes packed with features that 
-#  include student demographic info, scheduling, grade book, attendance, 
-#  report cards, eligibility, transcripts, parent portal, 
-#  student portal and more.   
+#  openSIS is  web-based, open source, and comes packed with features that
+#  include student demographic info, scheduling, grade book, attendance,
+#  report cards, eligibility, transcripts, parent portal,
+#  student portal and more.
 #
 #  Visit the openSIS web site at http://www.opensis.com to learn more.
-#  If you have question regarding this system or the license, please send 
+#  If you have question regarding this system or the license, please send
 #  an email to info@os4ed.com.
 #
-#  This program is released under the terms of the GNU General Public License as  
-#  published by the Free Software Foundation, version 2 of the License. 
+#  This program is released under the terms of the GNU General Public License as
+#  published by the Free Software Foundation, version 2 of the License.
 #  See license.txt.
 #
 #  This program is distributed in the hope that it will be useful,
@@ -26,534 +26,528 @@
 #
 #***************************************************************************************
 //================course varification=============================
-function VerifyFixedSchedule($columns,$columns_var,$update=false)
+function VerifyFixedSchedule($columns, $columns_var, $update = false)
 {
-   
-    $qr_teachers=  DBGet(DBQuery('select TEACHER_ID,SECONDARY_TEACHER_ID from course_periods where course_period_id=\''.$_REQUEST['course_period_id'].'\''));
-    $teacher=($_REQUEST['tables']['course_periods'][$_REQUEST['course_period_id']]['TEACHER_ID']!=''?$_REQUEST['tables']['course_periods'][$_REQUEST['course_period_id']]['TEACHER_ID']:$qr_teachers[1]['TEACHER_ID']);
-    $secteacher=($_REQUEST['tables']['course_periods'][$_REQUEST['course_period_id']]['SECONDARY_TEACHER_ID']!=''?$_REQUEST['tables']['course_periods'][$_REQUEST['course_period_id']]['SECONDARY_TEACHER_ID']:$qr_teachers[1]['SECONDARY_TEACHER_ID']);
-//    $secteacher=$qr_teachers[1]['SECONDARY_TEACHER_ID'];
-    
-    if($_REQUEST['tables']['course_periods'][$_REQUEST['course_period_id']]['TEACHER_ID']!='')
-     $all_teacher=$teacher.($secteacher!=''?','.$secteacher:'');
-    elseif($secteacher!='')
-        $all_teacher=($secteacher!=''?$secteacher:'');
-    else
-        $all_teacher=$teacher;
-//    $all_teacher=$teacher.($secteacher!=''?','.$secteacher:'');
-    $mp_id=$columns['MARKING_PERIOD_ID'];
-    $start_date=$columns['BEGIN_DATE'];
-    $end_date=$columns['END_DATE'];
-    $days=$columns_var['DAYS'];
-    $period=$columns_var['PERIOD_ID'];
-    $room=$columns_var['ROOM_ID'];
-    $min_start_dt_chk_qr=DBGet(DBQuery("SELECT min(start_date) as start_date from  staff_school_relationship where staff_id in($all_teacher)"));
-    $min_start_dt_chk_pr=DBGet(DBQuery("SELECT min(start_date) as start_date from  staff_school_relationship where staff_id in($teacher)"));
- 
-    if($update)
+
+    $qr_teachers = DBGet(DBQuery('select TEACHER_ID,SECONDARY_TEACHER_ID from course_periods where course_period_id=\'' . $_REQUEST['course_period_id'] . '\''));
+    $teacher = ($_REQUEST['tables']['course_periods'][$_REQUEST['course_period_id']]['TEACHER_ID'] != '' ? $_REQUEST['tables']['course_periods'][$_REQUEST['course_period_id']]['TEACHER_ID'] : $qr_teachers[1]['TEACHER_ID']);
+    $secteacher = ($_REQUEST['tables']['course_periods'][$_REQUEST['course_period_id']]['SECONDARY_TEACHER_ID'] != '' ? $_REQUEST['tables']['course_periods'][$_REQUEST['course_period_id']]['SECONDARY_TEACHER_ID'] : $qr_teachers[1]['SECONDARY_TEACHER_ID']);
+    //    $secteacher=$qr_teachers[1]['SECONDARY_TEACHER_ID'];
+    if ($_REQUEST['tables']['course_periods'][$_REQUEST['course_period_id']]['TEACHER_ID'] != '') $all_teacher = $teacher . ($secteacher != '' ? ',' . $secteacher : '');
+    elseif ($secteacher != '') $all_teacher = ($secteacher != '' ? $secteacher : '');
+    else $all_teacher = $teacher;
+    //    $all_teacher=$teacher.($secteacher!=''?','.$secteacher:'');
+    $mp_id = $columns['MARKING_PERIOD_ID'];
+    $start_date = $columns['BEGIN_DATE'];
+    $end_date = $columns['END_DATE'];
+    $days = $columns_var['DAYS'];
+    $period = $columns_var['PERIOD_ID'];
+    $room = $columns_var['ROOM_ID'];
+    $min_start_dt_chk_qr = DBGet(DBQuery("SELECT min(start_date) as start_date from  staff_school_relationship where staff_id in($all_teacher)"));
+    $min_start_dt_chk_pr = DBGet(DBQuery("SELECT min(start_date) as start_date from  staff_school_relationship where staff_id in($teacher)"));
+
+    if ($update)
     {
-        $check_cp=  DBGet(DBQuery("SELECT * FROM course_periods cp,course_period_var cpv WHERE cp.course_period_id=cpv.course_period_id AND cp.course_period_id='".$columns['COURSE_PERIOD_ID']."'"));
+        $check_cp = DBGet(DBQuery("SELECT * FROM course_periods cp,course_period_var cpv WHERE cp.course_period_id=cpv.course_period_id AND cp.course_period_id='" . $columns['COURSE_PERIOD_ID'] . "'"));
 
-        $check_cp=$check_cp[1];
-        
-        if($check_cp['TEACHER_ID']==$teacher && $check_cp['SECONDARY_TEACHER_ID']==$secteacher && $check_cp['BEGIN_DATE']==$start_date && $check_cp['END_DATE']==$end_date && $check_cp['DAYS']==$days && $check_cp['PERIOD_ID']==$period && $check_cp['ROOM_ID']==$room)
+        $check_cp = $check_cp[1];
+
+        if ($check_cp['TEACHER_ID'] == $teacher && $check_cp['SECONDARY_TEACHER_ID'] == $secteacher && $check_cp['BEGIN_DATE'] == $start_date && $check_cp['END_DATE'] == $end_date && $check_cp['DAYS'] == $days && $check_cp['PERIOD_ID'] == $period && $check_cp['ROOM_ID'] == $room)
         {
             return true;
         }
     }
-    if($columns_var['DAYS']=='' || $columns_var['PERIOD_ID']=='' || $columns_var['ROOM_ID']=='')
+    if ($columns_var['DAYS'] == '' || $columns_var['PERIOD_ID'] == '' || $columns_var['ROOM_ID'] == '')
     {
         return 'Input valid details';
     }
-    $period_time =  DBGet(DBQuery("SELECT START_TIME, END_TIME FROM school_periods WHERE period_id={$period}"));
-    $period_time=$period_time[1];
-    $start_time=$period_time['START_TIME'];
-    $end_time=$period_time['END_TIME'];
-    if($mp_id!='')
+    $period_time = DBGet(DBQuery("SELECT START_TIME, END_TIME ,IGNORE_SCHEDULING FROM school_periods WHERE period_id={$period}"));
+    $period_time = $period_time[1];
+    $start_time = $period_time['START_TIME'];
+    $end_time = $period_time['END_TIME'];
+    $pre_ing = $period_time['IGNORE_SCHEDULING'];
+    if ($mp_id != '')
     {
-        $mp_date=  DBGet(DBQuery("SELECT START_DATE,END_DATE FROM marking_periods where marking_period_id ={$mp_id}"));
-        $mp_date=$mp_date[1];
-        $end_date=$mp_date[END_DATE];
-        $start_date=$mp_date[START_DATE];
+        $mp_date = DBGet(DBQuery("SELECT START_DATE,END_DATE FROM marking_periods where marking_period_id ={$mp_id}"));
+        $mp_date = $mp_date[1];
+        $end_date = $mp_date[END_DATE];
+        $start_date = $mp_date[START_DATE];
     }
-    $mp_append_sql=" AND begin_date<='$end_date' AND '$start_date'<=end_date AND IF (schedule_type='BLOCKED',course_period_date BETWEEN '$start_date' AND '$end_date','1')";
+    $mp_append_sql = " AND begin_date<='$end_date' AND '$start_date'<=end_date AND IF (schedule_type='BLOCKED',course_period_date BETWEEN '$start_date' AND '$end_date','1')";
 
-    $period_append_sql=" AND period_id IN(SELECT period_id from school_periods WHERE start_time<='$end_time' AND '$start_time'<=end_time)";
-    $days_append_sql=' AND (';
-    $days_room_append_sql=' AND (';
-    $days_arr=str_split($days);
-    foreach($days_arr as $day)
+    $period_append_sql = " AND period_id IN(SELECT period_id from school_periods WHERE start_time<='$end_time' AND '$start_time'<=end_time)";
+    $days_append_sql = ' AND (';
+    $days_room_append_sql = ' AND (';
+    $days_arr = str_split($days);
+    foreach ($days_arr as $day)
     {
-        $days_append_sql.="DAYS LIKE '%$day%' OR ";
-        $days_room_append_sql.="(DAYS LIKE '%$day%' AND room_id=$room) OR ";
+        $days_append_sql .= "DAYS LIKE '%$day%' OR ";
+        $days_room_append_sql .= "(DAYS LIKE '%$day%' AND room_id=$room) OR ";
     }
-   $days_append_sql=  substr($days_append_sql,0,-4).')';
-   $days_room_append_sql=  substr($days_room_append_sql,0,-4).')';
-    if($update)
-        $cp_id=" AND cp.COURSE_PERIOD_ID!={$columns['COURSE_PERIOD_ID']}";
-        else
-            $cp_id='';
-    $cp_RET=  DBGet(DBQuery("SELECT cp.COURSE_PERIOD_ID FROM course_periods cp,course_period_var cpv WHERE cp.course_period_id=cpv.course_period_id AND (secondary_teacher_id IN ($all_teacher) OR teacher_id IN ($all_teacher)){$mp_append_sql}{$period_append_sql}{$days_append_sql}{$cp_id}"));
-    if($cp_RET)
-        return 'Teacher Not Available';
-    elseif(strtotime($min_start_dt_chk_pr[1]['START_DATE'])> strtotime($start_date))
-        return 'Teacher\'s start date cannot be after course period\'s start date.';
+    $days_append_sql = substr($days_append_sql, 0, -4) . ')';
+    $days_room_append_sql = substr($days_room_append_sql, 0, -4) . ')';
+    if ($update) $cp_id = " AND cp.COURSE_PERIOD_ID!={$columns['COURSE_PERIOD_ID']}";
+    else $cp_id = '';
+    if ($pre_ing != 'Y')
+    {
+    $cp_RET = DBGet(DBQuery("SELECT cp.COURSE_PERIOD_ID FROM course_periods cp,course_period_var cpv WHERE cp.course_period_id=cpv.course_period_id AND (secondary_teacher_id IN ($all_teacher) OR teacher_id IN ($all_teacher)){$mp_append_sql}{$period_append_sql}{$days_append_sql}{$cp_id}"));
+    if ($cp_RET) return 'Teacher Not Available';
+        else return true;
+    }
+    elseif (strtotime($min_start_dt_chk_pr[1]['START_DATE']) > strtotime($start_date)) return 'Teacher\'s start date cannot be after course period\'s start date.';
     else
     {
-        $room_RET=  DBGet(DBQuery("SELECT cp.COURSE_PERIOD_ID FROM course_periods cp,course_period_var cpv WHERE cp.course_period_id=cpv.course_period_id{$mp_append_sql}{$period_append_sql}{$days_room_append_sql}{$cp_id}"));
-        if($room_RET && $_REQUEST['tables']['course_period_var'][$_REQUEST['course_period_id']]['ROOM_ID']!='')
+        if ($pre_ing != 'Y')
+        {
+        $room_RET = DBGet(DBQuery("SELECT cp.COURSE_PERIOD_ID FROM course_periods cp,course_period_var cpv WHERE cp.course_period_id=cpv.course_period_id{$mp_append_sql}{$period_append_sql}{$days_room_append_sql}{$cp_id}"));
+        if ($room_RET && $_REQUEST['tables']['course_period_var'][$_REQUEST['course_period_id']]['ROOM_ID'] != '')
         {
             return 'Room Not Available';
         }
+        }
         return true;
     }
 }
 
 function VerifyVariableSchedule($columns)
 {
-//    $teacher=$columns['TEACHER_ID'];
-//    $secteacher=$columns['SECONDARY_TEACHER_ID'];
-//     if($_REQUEST['tables']['course_periods'][$_REQUEST['course_period_id']]['TEACHER_ID']!='')
-//     $all_teacher=$teacher.($secteacher!=''?','.$secteacher:'');
-//    else
-//        $all_teacher=($secteacher!=''?$secteacher:'');
-    
-    
-    $teacher=($_REQUEST['tables']['course_periods'][$_REQUEST['course_period_id']]['TEACHER_ID']!=''?$_REQUEST['tables']['course_periods'][$_REQUEST['course_period_id']]['TEACHER_ID']:$columns['TEACHER_ID']);
-    $secteacher=($_REQUEST['tables']['course_periods'][$_REQUEST['course_period_id']]['SECONDARY_TEACHER_ID']!=''?$_REQUEST['tables']['course_periods'][$_REQUEST['course_period_id']]['SECONDARY_TEACHER_ID']:$columns['SECONDARY_TEACHER_ID']);
+    //    $teacher=$columns['TEACHER_ID'];
+    //    $secteacher=$columns['SECONDARY_TEACHER_ID'];
+    //     if($_REQUEST['tables']['course_periods'][$_REQUEST['course_period_id']]['TEACHER_ID']!='')
+    //     $all_teacher=$teacher.($secteacher!=''?','.$secteacher:'');
+    //    else
+    //        $all_teacher=($secteacher!=''?$secteacher:'');
+    $flag = 0;
+    $teacher = ($_REQUEST['tables']['course_periods'][$_REQUEST['course_period_id']]['TEACHER_ID'] != '' ? $_REQUEST['tables']['course_periods'][$_REQUEST['course_period_id']]['TEACHER_ID'] : $columns['TEACHER_ID']);
+    $secteacher = ($_REQUEST['tables']['course_periods'][$_REQUEST['course_period_id']]['SECONDARY_TEACHER_ID'] != '' ? $_REQUEST['tables']['course_periods'][$_REQUEST['course_period_id']]['SECONDARY_TEACHER_ID'] : $columns['SECONDARY_TEACHER_ID']);
     //    $secteacher=$qr_teachers[1]['SECONDARY_TEACHER_ID'];
-
-    if($_REQUEST['tables']['course_periods'][$_REQUEST['course_period_id']]['TEACHER_ID']!='')
-    $all_teacher=$teacher.($secteacher!=''?','.$secteacher:'');
-    elseif($secteacher!='')
-       $all_teacher=($secteacher!=''?$secteacher:'');
-    else
-       $all_teacher=$teacher;
-    
-    
-//    $all_teacher=$teacher.($secteacher!=''?','.$secteacher:'');
-    $mp_id=$columns['MARKING_PERIOD_ID'];
-    $start_date=$columns['BEGIN_DATE'];
-    $end_date=$columns['END_DATE'];
-     $min_start_dt_chk_qr=DBGet(DBQuery("SELECT min(start_date) as start_date from  staff_school_relationship where staff_id in($all_teacher)"));
-     $min_start_dt_chk_pr=DBGet(DBQuery("SELECT min(start_date) as start_date from  staff_school_relationship where staff_id in($teacher)"));
- 
-    if(!$_REQUEST['course_period_variable'])
-        return 'Please input valid data';
-    if($mp_id!='')
+    if ($_REQUEST['tables']['course_periods'][$_REQUEST['course_period_id']]['TEACHER_ID'] != '') $all_teacher = $teacher . ($secteacher != '' ? ',' . $secteacher : '');
+    elseif ($secteacher != '') $all_teacher = ($secteacher != '' ? $secteacher : '');
+    else $all_teacher = $teacher;
+
+    //    $all_teacher=$teacher.($secteacher!=''?','.$secteacher:'');
+    $mp_id = $columns['MARKING_PERIOD_ID'];
+    $start_date = $columns['BEGIN_DATE'];
+    $end_date = $columns['END_DATE'];
+    $min_start_dt_chk_qr = DBGet(DBQuery("SELECT min(start_date) as start_date from  staff_school_relationship where staff_id in($all_teacher)"));
+    $min_start_dt_chk_pr = DBGet(DBQuery("SELECT min(start_date) as start_date from  staff_school_relationship where staff_id in($teacher)"));
+
+    if (!$_REQUEST['course_period_variable']) return 'Please input valid data';
+    if ($mp_id != '')
     {
-        $mp_date=  DBGet(DBQuery("SELECT START_DATE,END_DATE FROM marking_periods where marking_period_id ={$mp_id}"));
-        $mp_date=$mp_date[1];
-        $end_date=$mp_date[END_DATE];
-        $start_date=$mp_date[START_DATE];
+        $mp_date = DBGet(DBQuery("SELECT START_DATE,END_DATE FROM marking_periods where marking_period_id ={$mp_id}"));
+        $mp_date = $mp_date[1];
+        $end_date = $mp_date[END_DATE];
+        $start_date = $mp_date[START_DATE];
     }
-    $mp_append_sql=" AND begin_date<='$end_date' AND '$start_date'<=end_date";
-    
-    $days_append_sql=' AND (';
-    $days_room_append_sql=' AND (';
+    $mp_append_sql = " AND begin_date<='$end_date' AND '$start_date'<=end_date";
 
-    foreach($_REQUEST['course_period_variable'] as $cp_id=>$days)
+    $days_append_sql = ' AND (';
+    $days_room_append_sql = ' AND (';
+    $err_msg = '';
+    foreach ($_REQUEST['course_period_variable'] as $cp_id => $days)
     {
 
-            if($days['DAYS']=='' || ($days['PERIOD_ID']=='' || $days['ROOM_ID']==''))
-                return 'Please input valid data';
-            
-            if($cp_id=='new')
-            {
-                $days_append_sql .="(days like '%$days[DAYS]%' AND start_time<='".$days['n']['END_TIME']."' AND '".$days['n']['START_TIME']."'<=end_time) OR ";
-                $days_room_append_sql .="(days like '%$days[DAYS]%' AND room_id=$days[ROOM_ID] AND start_time<='".$days['n']['END_TIME']."' AND '".$days['n']['START_TIME']."'<=end_time) OR ";
+        if ($days['DAYS'] == '' || ($days['PERIOD_ID'] == '' || $days['ROOM_ID'] == '')) return 'Please input valid data';
+        $period_time = DBGet(DBQuery("SELECT TITLE,IGNORE_SCHEDULING FROM school_periods WHERE period_id={$days['PERIOD_ID']}"));
+        $period_time = $period_time[1];
+
+        $pre_ing = $period_time['IGNORE_SCHEDULING'];
+        //            $same_periods=DBGet(DBQuery("SELECT cp.COURSE_PERIOD_ID FROM course_periods cp,course_period_var cpv WHERE cp.course_period_id=cpv.course_period_id AND (secondary_teacher_id IN ($all_teacher) OR teacher_id IN ($all_teacher)){$mp_append_sql} AND cpv.ROOM_ID={$days['ROOM_ID']} AND cpv.PERIOD_ID={$days['PERIOD_ID']} AND days LIKE '%$days[DAYS]%'"));
+        //            if($same_periods)
+        //            {
+        //                $err_msg.='Teacher Already Scheduled to '.$period_time['TITLE'].',';
+        //                continue;
+        //            }
+        if ($pre_ing != 'Y')
+        {
+            $flag = 1;
+        if ($cp_id == 'new')
+        {
+            $days_append_sql .= "(days like '%$days[DAYS]%' AND start_time<='" . $days['n']['END_TIME'] . "' AND '" . $days['n']['START_TIME'] . "'<=end_time) OR ";
+            $days_room_append_sql .= "(days like '%$days[DAYS]%' AND room_id=$days[ROOM_ID] AND start_time<='" . $days['n']['END_TIME'] . "' AND '" . $days['n']['START_TIME'] . "'<=end_time) OR ";
+        }
+        else
+        {
+            $days_append_sql .= "(days like '%$days[DAYS]%' AND start_time<='$days[END_TIME]' AND '$days[START_TIME]'<=end_time) OR ";
+            $days_room_append_sql .= "(days like '%$days[DAYS]%' AND room_id=$days[ROOM_ID] AND start_time<='$days[END_TIME]' AND '$days[START_TIME]'<=end_time) OR ";
+        }
         }
-            else
-            {
-                $days_append_sql .="(days like '%$days[DAYS]%' AND start_time<='$days[END_TIME]' AND '$days[START_TIME]'<=end_time) OR ";
-                $days_room_append_sql .="(days like '%$days[DAYS]%' AND room_id=$days[ROOM_ID] AND start_time<='$days[END_TIME]' AND '$days[START_TIME]'<=end_time) OR ";
     }
-            
+    $days_append_sql = substr($days_append_sql, 0, -4) . ')';
+    $days_room_append_sql = substr($days_room_append_sql, 0, -4) . ')';
+    if ($err_msg != '')
+    {
+        return substr($err_msg, 0, -1);
+    }
+    if ($flag == 1)
+    {
+    $sql_ch = "SELECT cp.COURSE_PERIOD_ID FROM course_periods  cp LEFT JOIN course_period_var cpv ON (cp.course_period_id=cpv.course_period_id) WHERE (secondary_teacher_id IN ($all_teacher) OR teacher_id IN ($all_teacher)){$mp_append_sql}{$days_append_sql}";
 
+    $cp_RET = DBGet(DBQuery($sql_ch));
+    if ($cp_RET) return 'Teacher Not Available';
+        else return true;
     }
-    $days_append_sql =  substr($days_append_sql,0,-4).')';
-    $days_room_append_sql =  substr($days_room_append_sql,0,-4).')';
-    
-     $sql_ch="SELECT cp.COURSE_PERIOD_ID FROM course_periods  cp LEFT JOIN course_period_var cpv ON (cp.course_period_id=cpv.course_period_id) WHERE (secondary_teacher_id IN ($all_teacher) OR teacher_id IN ($all_teacher)){$mp_append_sql}{$days_append_sql}";
-
-    $cp_RET=  DBGet(DBQuery($sql_ch));
-    if($cp_RET)
-        return 'Teacher Not Available';
-     elseif(strtotime($min_start_dt_chk_pr[1]['START_DATE'])> strtotime($start_date))
-        return 'Teacher\'s start date cannot be after course period\'s start date.';
-    elseif($day_RET)
-            return 'Day Not Available';
+    elseif (strtotime($min_start_dt_chk_pr[1]['START_DATE']) > strtotime($start_date)) return 'Teacher\'s start date cannot be after course period\'s start date.';
+    elseif ($day_RET) return 'Day Not Available';
     else
     {
-        $room_RET=  DBGet(DBQuery("SELECT cp.COURSE_PERIOD_ID FROM course_periods  cp LEFT JOIN course_period_var cpv ON (cp.course_period_id=cpv.course_period_id) WHERE 1{$mp_append_sql}{$days_room_append_sql}"));
-        if($room_RET)
+        if ($flag == 1)
+        {
+        $room_RET = DBGet(DBQuery("SELECT cp.COURSE_PERIOD_ID FROM course_periods  cp LEFT JOIN course_period_var cpv ON (cp.course_period_id=cpv.course_period_id) WHERE 1{$mp_append_sql}{$days_room_append_sql}"));
+        if ($room_RET)
         {
             return 'Room Not Available';
         }
+        }
         return true;
     }
 }
 
 function VerifyVariableSchedule_Update($columns)
 {
 
-
-//    $teacher=$columns['TEACHER_ID'];
-//    $secteacher=$columns['SECONDARY_TEACHER_ID'];
-//     if($_REQUEST['tables']['course_periods'][$_REQUEST['course_period_id']]['TEACHER_ID']!='')
-//     {
-//     $all_teacher=$teacher.($secteacher!=''?','.$secteacher:'');
-//     }
-//    else
-//        //$all_teacher=($secteacher!=''?$secteacher:'');
-//    $all_teacher=$teacher.($secteacher!=''?','.$secteacher:'');
-    
+    //    $teacher=$columns['TEACHER_ID'];
+    //    $secteacher=$columns['SECONDARY_TEACHER_ID'];
+    //     if($_REQUEST['tables']['course_periods'][$_REQUEST['course_period_id']]['TEACHER_ID']!='')
+    //     {
+    //     $all_teacher=$teacher.($secteacher!=''?','.$secteacher:'');
+    //     }
+    //    else
+    //        //$all_teacher=($secteacher!=''?$secteacher:'');
+    //    $all_teacher=$teacher.($secteacher!=''?','.$secteacher:'');
     
-    
-    $teacher=($_REQUEST['tables']['course_periods'][$_REQUEST['course_period_id']]['TEACHER_ID']!=''?$_REQUEST['tables']['course_periods'][$_REQUEST['course_period_id']]['TEACHER_ID']:$columns['TEACHER_ID']);
-    $secteacher=($_REQUEST['tables']['course_periods'][$_REQUEST['course_period_id']]['SECONDARY_TEACHER_ID']!=''?$_REQUEST['tables']['course_periods'][$_REQUEST['course_period_id']]['SECONDARY_TEACHER_ID']:$columns['SECONDARY_TEACHER_ID']);
-    //    $secteacher=$qr_teachers[1]['SECONDARY_TEACHER_ID'];
 
-    if($_REQUEST['tables']['course_periods'][$_REQUEST['course_period_id']]['TEACHER_ID']!='')
-    $all_teacher=$teacher.($secteacher!=''?','.$secteacher:'');
-    elseif($secteacher!='')
-       $all_teacher=($secteacher!=''?$secteacher:'');
-    else
-       $all_teacher=$teacher;
-    
-    
-    $mp_id=$columns['MARKING_PERIOD_ID'];
-    $start_date=$columns['BEGIN_DATE'];
-    $end_date=$columns['END_DATE'];
-    $id=$columns['ID'];
-    $per_id=$columns['PERIOD_ID'];
-    $min_start_dt_chk_qr=DBGet(DBQuery("SELECT min(start_date) as start_date from  staff_school_relationship where staff_id in($all_teacher)"));
-    $min_start_dt_chk_pr=DBGet(DBQuery("SELECT min(start_date) as start_date from  staff_school_relationship where staff_id in($teacher)"));
- 
-    if(!$_REQUEST['course_period_variable'] ||  $columns['PERIOD_ID']='' ||  $columns['ROOM_ID']=='')
-        return 'Please input valid data';
-    if($columns['CP_SECTION']=='cpv')
-    {
-        if($mp_id!='')
+    $teacher = ($_REQUEST['tables']['course_periods'][$_REQUEST['course_period_id']]['TEACHER_ID'] != '' ? $_REQUEST['tables']['course_periods'][$_REQUEST['course_period_id']]['TEACHER_ID'] : $columns['TEACHER_ID']);
+    $secteacher = ($_REQUEST['tables']['course_periods'][$_REQUEST['course_period_id']]['SECONDARY_TEACHER_ID'] != '' ? $_REQUEST['tables']['course_periods'][$_REQUEST['course_period_id']]['SECONDARY_TEACHER_ID'] : $columns['SECONDARY_TEACHER_ID']);
+    //    $secteacher=$qr_teachers[1]['SECONDARY_TEACHER_ID'];
+    if ($_REQUEST['tables']['course_periods'][$_REQUEST['course_period_id']]['TEACHER_ID'] != '') $all_teacher = $teacher . ($secteacher != '' ? ',' . $secteacher : '');
+    elseif ($secteacher != '') $all_teacher = ($secteacher != '' ? $secteacher : '');
+    else $all_teacher = $teacher;
+
+    $mp_id = $columns['MARKING_PERIOD_ID'];
+    $start_date = $columns['BEGIN_DATE'];
+    $end_date = $columns['END_DATE'];
+    $id = $columns['ID'];
+    $per_id = $columns['PERIOD_ID'];
+    $period_time = DBGet(DBQuery("SELECT IGNORE_SCHEDULING FROM school_periods WHERE period_id={$per_id}"));
+    $period_time = $period_time[1];
+    $pre_ing = $period_time['IGNORE_SCHEDULING'];
+    $min_start_dt_chk_qr = DBGet(DBQuery("SELECT min(start_date) as start_date from  staff_school_relationship where staff_id in($all_teacher)"));
+    $min_start_dt_chk_pr = DBGet(DBQuery("SELECT min(start_date) as start_date from  staff_school_relationship where staff_id in($teacher)"));
+
+    if (!$_REQUEST['course_period_variable'] || $columns['PERIOD_ID'] = '' || $columns['ROOM_ID'] == '') return 'Please input valid data';
+    if ($columns['CP_SECTION'] == 'cpv')
     {
-        $mp_date=  DBGet(DBQuery("SELECT START_DATE,END_DATE FROM marking_periods where marking_period_id ={$mp_id}"));
-        $mp_date=$mp_date[1];
-        $end_date=$mp_date[END_DATE];
-        $start_date=$mp_date[START_DATE];
-    }
-        $mp_append_sql=" AND begin_date<='$end_date' AND '$start_date'<=end_date";
-
-        $days_append_sql=' AND (';
-        $days_room_append_sql=' AND (';
+        if ($mp_id != '')
+        {
+            $mp_date = DBGet(DBQuery("SELECT START_DATE,END_DATE FROM marking_periods where marking_period_id ={$mp_id}"));
+            $mp_date = $mp_date[1];
+            $end_date = $mp_date[END_DATE];
+            $start_date = $mp_date[START_DATE];
+        }
+        $mp_append_sql = " AND begin_date<='$end_date' AND '$start_date'<=end_date";
 
-                if($columns['SELECT_DAYS']=='' && ($columns['PERIOD_ID']=='' || $columns['ROOM_ID']==''))
-                    return 'Please input valid data';
+        $days_append_sql = ' AND (';
+        $days_room_append_sql = ' AND (';
 
-                $days_append_sql .="(days like '%$columns[DAYS]%' AND start_time<='$columns[END_TIME]' AND '$columns[START_TIME]'<=end_time) OR ";
-                $days_room_append_sql .="(days like '%$columns[DAYS]%' AND room_id=$columns[ROOM_ID] AND start_time<='$columns[END_TIME]' AND '$columns[START_TIME]'<=end_time) OR ";
+        if ($columns['SELECT_DAYS'] == '' && ($columns['PERIOD_ID'] == '' || $columns['ROOM_ID'] == '')) return 'Please input valid data';
 
+        $days_append_sql .= "(days like '%$columns[DAYS]%' AND start_time<='$columns[END_TIME]' AND '$columns[START_TIME]'<=end_time) OR ";
+        $days_room_append_sql .= "(days like '%$columns[DAYS]%' AND room_id=$columns[ROOM_ID] AND start_time<='$columns[END_TIME]' AND '$columns[START_TIME]'<=end_time) OR ";
 
-        $days_append_sql =  substr($days_append_sql,0,-4).')';
-        $days_room_append_sql =  substr($days_room_append_sql,0,-4).')';
+        $days_append_sql = substr($days_append_sql, 0, -4) . ')';
+        $days_room_append_sql = substr($days_room_append_sql, 0, -4) . ')';
 
-    $sql_same_period="SELECT cp.COURSE_PERIOD_ID FROM course_periods cp,course_period_var cpv  WHERE  days = '".$columns[DAYS]."' AND period_id='".$per_id."' AND ROOM_ID=$columns[ROOM_ID] AND TEACHER_ID=$teacher {$mp_append_sql} AND cpv.course_period_id = cp.course_period_id AND cp.COURSE_PERIOD_ID!={$_REQUEST['cp_id']}";
-    $same_cp_RET=DBGet(DBQuery($sql_same_period));
-    if(count($same_cp_RET)>0)
-    {
-        return 'Same meeting days already exists.';
-    }
-    else
-    {
-//     $sql_op="SELECT cp.COURSE_PERIOD_ID  FROM course_periods  cp LEFT JOIN course_period_var cpv ON (cp.course_period_id=cpv.course_period_id) WHERE cpv.PERIOD_ID='".$per_id."'  AND (secondary_teacher_id IN ($all_teacher) OR teacher_id IN ($all_teacher)) AND cp.COURSE_PERIOD_ID!={$_REQUEST['cp_id']}{$mp_append_sql}{$days_append_sql}";
-     $sql_op="SELECT cp.COURSE_PERIOD_ID  FROM course_periods  cp LEFT JOIN course_period_var cpv ON (cp.course_period_id=cpv.course_period_id) WHERE (secondary_teacher_id IN ($all_teacher) OR teacher_id IN ($all_teacher)){$mp_append_sql}{$days_append_sql}";
-
-       $cp_RET=  DBGet(DBQuery($sql_op));
-        if(count($cp_RET)>0)
-            return 'Teacher Not Available';
-         elseif(strtotime($min_start_dt_chk_pr[1]['START_DATE'])> strtotime($start_date))
-        return 'Teacher\'s start date cannot be after course period\'s start date.';
-        else
+        // $sql_same_period = "SELECT cp.COURSE_PERIOD_ID FROM course_periods cp,course_period_var cpv  WHERE  days = '" . $columns[DAYS] . "' AND period_id='" . $per_id . "' AND ROOM_ID=$columns[ROOM_ID] AND TEACHER_ID=$teacher {$mp_append_sql} AND cpv.course_period_id = cp.course_period_id AND cp.COURSE_PERIOD_ID!={$_REQUEST['cp_id']}";
+        // $same_cp_RET = DBGet(DBQuery($sql_same_period));
+        // if (count($same_cp_RET) > 0) {
+        //     return 'Same meeting days already exists.';
+        // } else {
+        //     $sql_op="SELECT cp.COURSE_PERIOD_ID  FROM course_periods  cp LEFT JOIN course_period_var cpv ON (cp.course_period_id=cpv.course_period_id) WHERE cpv.PERIOD_ID='".$per_id."'  AND (secondary_teacher_id IN ($all_teacher) OR teacher_id IN ($all_teacher)) AND cp.COURSE_PERIOD_ID!={$_REQUEST['cp_id']}{$mp_append_sql}{$days_append_sql}";
+        if ($pre_ing != 'Y')
         {
-            $room_RET=  DBGet(DBQuery("SELECT cp.COURSE_PERIOD_ID FROM course_periods  cp LEFT JOIN course_period_var cpv ON (cp.course_period_id=cpv.course_period_id) WHERE 1{$mp_append_sql}{$days_room_append_sql} AND cp.course_period_id!={$columns['COURSE_PERIOD_ID']}"));
-            if($room_RET)
+            $sql_op = "SELECT cp.COURSE_PERIOD_ID  FROM course_periods  cp LEFT JOIN course_period_var cpv ON (cp.course_period_id=cpv.course_period_id) WHERE (secondary_teacher_id IN ($all_teacher) OR teacher_id IN ($all_teacher)){$mp_append_sql}{$days_append_sql}";
+
+            $cp_RET = DBGet(DBQuery($sql_op));
+            if (count($cp_RET) > 0) return 'Teacher Not Available';
+            else return true;
+        }
+            elseif (strtotime($min_start_dt_chk_pr[1]['START_DATE']) > strtotime($start_date)) return 'Teacher\'s start date cannot be after course period\'s start date.';
+            else
             {
-                return 'Room Not Available';
+            if ($pre_ing != 'Y')
+            {
+                $room_RET = DBGet(DBQuery("SELECT cp.COURSE_PERIOD_ID FROM course_periods  cp LEFT JOIN course_period_var cpv ON (cp.course_period_id=cpv.course_period_id) WHERE 1{$mp_append_sql}{$days_room_append_sql} AND cp.course_period_id!={$columns['COURSE_PERIOD_ID']}"));
+                if ($room_RET)
+                {
+                    return 'Room Not Available';
+                }
             }
-            return true;
-        }
-    }
+                return true;
+            }
+        //}
+        
     }
     else
     {
-        if($mp_id!='')
-    {
-        $mp_date=  DBGet(DBQuery("SELECT START_DATE,END_DATE FROM marking_periods where marking_period_id ={$mp_id}"));
-        $mp_date=$mp_date[1];
-        $end_date=$mp_date[END_DATE];
-        $start_date=$mp_date[START_DATE];
-    }
-        $mp_append_sql=" AND begin_date<='$end_date' AND '$start_date'<=end_date";
-        
-        if($columns[DAYS]!='n' && $columns[END_TIME]!='' && $columns[START_TIME]!='')
+        if ($mp_id != '')
         {
-        $days_append_sql=' AND (';
-     
-        
-                $days_append_sql .="(days like '%$columns[DAYS]%' AND start_time<='$columns[END_TIME]' AND '$columns[START_TIME]'<=end_time) OR ";
+            $mp_date = DBGet(DBQuery("SELECT START_DATE,END_DATE FROM marking_periods where marking_period_id ={$mp_id}"));
+            $mp_date = $mp_date[1];
+            $end_date = $mp_date[END_DATE];
+            $start_date = $mp_date[START_DATE];
+        }
+        $mp_append_sql = " AND begin_date<='$end_date' AND '$start_date'<=end_date";
 
-        
+        if ($columns[DAYS] != 'n' && $columns[END_TIME] != '' && $columns[START_TIME] != '')
+        {
+            $days_append_sql = ' AND (';
 
-        $days_append_sql =  substr($days_append_sql,0,-4).')';
+            $days_append_sql .= "(days like '%$columns[DAYS]%' AND start_time<='$columns[END_TIME]' AND '$columns[START_TIME]'<=end_time) OR ";
 
+            $days_append_sql = substr($days_append_sql, 0, -4) . ')';
         }
-        
-        $cp_RET=  DBGet(DBQuery("SELECT cp.COURSE_PERIOD_ID FROM course_periods  cp LEFT JOIN course_period_var cpv ON (cp.course_period_id=cpv.course_period_id) WHERE (secondary_teacher_id IN ($all_teacher) OR teacher_id IN ($all_teacher)){$mp_append_sql}{$days_append_sql} AND cpv.PERIOD_ID='".$per_id."' AND cpv.DAYS='".$columns['SELECT_DAYS']."' AND cpv.ROOM_ID='".$columns['ROOM_ID']."' AND cp.COURSE_PERIOD_ID!={$_REQUEST['cp_id']}"));
-        if($cp_RET)
-            return "Teacher Not Available";
-         elseif(strtotime($min_start_dt_chk_pr[1]['START_DATE'])> strtotime($start_date))
-        return 'Teacher\'s start date cannot be after course period\'s start date.';
-        else 
-            return true;
-
-        
+        if ($pre_ing != 'Y')
+        {
+        $cp_RET = DBGet(DBQuery("SELECT cp.COURSE_PERIOD_ID FROM course_periods  cp LEFT JOIN course_period_var cpv ON (cp.course_period_id=cpv.course_period_id) WHERE (secondary_teacher_id IN ($all_teacher) OR teacher_id IN ($all_teacher)){$mp_append_sql}{$days_append_sql} AND cpv.PERIOD_ID='" . $per_id . "' AND cpv.DAYS='" . $columns['SELECT_DAYS'] . "' AND cpv.ROOM_ID='" . $columns['ROOM_ID'] . "' AND cp.COURSE_PERIOD_ID!={$_REQUEST['cp_id']}"));
+        if ($cp_RET) return "Teacher Not Available";
+            else return true;
+        }
+        elseif (strtotime($min_start_dt_chk_pr[1]['START_DATE']) > strtotime($start_date)) return 'Teacher\'s start date cannot be after course period\'s start date.';
+        else return true;
     }
 }
-function VerifyBlockedSchedule($columns,$course_period_id,$sec,$edit=false)
+
+function VerifyBlockedSchedule($columns, $course_period_id, $sec, $edit = false)
 {
-    if($course_period_id!='new')
+    if ($course_period_id != 'new')
     {
-    $cp_det_RET=  DBGet(DBQuery("SELECT * FROM course_periods WHERE course_period_id=$course_period_id"));
+        $cp_det_RET = DBGet(DBQuery("SELECT * FROM course_periods WHERE course_period_id=$course_period_id"));
 
-        $cp_det_RET=$cp_det_RET[1];
-        $teacher=$cp_det_RET['TEACHER_ID'];
-        $secteacher=$cp_det_RET['SECONDARY_TEACHER_ID'];
-         $all_teacher=$teacher.($secteacher!=''?$secteacher:'');
+        $cp_det_RET = $cp_det_RET[1];
+        $teacher = $cp_det_RET['TEACHER_ID'];
+        $secteacher = $cp_det_RET['SECONDARY_TEACHER_ID'];
+        $all_teacher = $teacher . ($secteacher != '' ? $secteacher : '');
     }
- else {
-        
-              if($_REQUEST['tables']['course_periods'][$_REQUEST['course_period_id']]['TEACHER_ID']!='')
-     $all_teacher=$teacher.($secteacher!=''?','.$secteacher:'');
     else
-        $all_teacher=($secteacher!=''?$secteacher:'');
-    
-     
-    }
+    {
 
+        if ($_REQUEST['tables']['course_periods'][$_REQUEST['course_period_id']]['TEACHER_ID'] != '') $all_teacher = $teacher . ($secteacher != '' ? ',' . $secteacher : '');
+        else $all_teacher = ($secteacher != '' ? $secteacher : '');
+    }
 
-//        $all_teacher=$teacher.($secteacher!=''?','.$secteacher:'');
-        $mp_id=$cp_det_RET['MARKING_PERIOD_ID'];
-        $start_date=$cp_det_RET['BEGIN_DATE'];
-        $end_date=$cp_det_RET['END_DATE'];
-     $min_start_dt_chk_qr=DBGet(DBQuery("SELECT min(start_date) as start_date from  staff_school_relationship where staff_id in($all_teacher)"));
-     $min_start_dt_chk_pr=DBGet(DBQuery("SELECT min(start_date) as start_date from  staff_school_relationship where staff_id in($teacher)"));
+    //        $all_teacher=$teacher.($secteacher!=''?','.$secteacher:'');
+    $mp_id = $cp_det_RET['MARKING_PERIOD_ID'];
+    $start_date = $cp_det_RET['BEGIN_DATE'];
+    $end_date = $cp_det_RET['END_DATE'];
+    $min_start_dt_chk_qr = DBGet(DBQuery("SELECT min(start_date) as start_date from  staff_school_relationship where staff_id in($all_teacher)"));
+    $min_start_dt_chk_pr = DBGet(DBQuery("SELECT min(start_date) as start_date from  staff_school_relationship where staff_id in($teacher)"));
 
-    if($sec=='cpv')
+    if ($sec == 'cpv')
     {
-        if($edit)
+        if ($edit)
         {
-           $period=$columns['PERIOD_ID'];
-            $room=$columns['ROOM_ID']; 
-            $cp_id=" AND cp.COURSE_PERIOD_ID!={$course_period_id}";
+            $period = $columns['PERIOD_ID'];
+            $room = $columns['ROOM_ID'];
+            $cp_id = " AND cp.COURSE_PERIOD_ID!={$course_period_id}";
         }
         else
         {
-            $cp_id='';
-            $period=$_REQUEST['values']['PERIOD_ID'];
-            $room=$_REQUEST['values']['ROOM_ID'];
+            $cp_id = '';
+            $period = $_REQUEST['values']['PERIOD_ID'];
+            $room = $_REQUEST['values']['ROOM_ID'];
         }
-        $period_time =  DBGet(DBQuery("SELECT START_TIME, END_TIME FROM school_periods WHERE period_id={$period}"));
-        $period_time=$period_time[1];
-        $start_time=$period_time['START_TIME'];
-        $end_time=$period_time['END_TIME'];
-
-        if($mp_id!='')
+        $period_time = DBGet(DBQuery("SELECT START_TIME, END_TIME ,IGNORE_SCHEDULING FROM school_periods WHERE period_id={$period}"));
+        $period_time = $period_time[1];
+        $start_time = $period_time['START_TIME'];
+        $end_time = $period_time['END_TIME'];
+        $pre_ing = $period_time['IGNORE_SCHEDULING'];
+        if ($mp_id != '')
         {
-            $mp_date=  DBGet(DBQuery("SELECT START_DATE,END_DATE FROM marking_periods where marking_period_id ={$mp_id}"));
-            $mp_date=$mp_date[1];
-            $end_date=$mp_date[END_DATE];
-            $start_date=$mp_date[START_DATE];
+            $mp_date = DBGet(DBQuery("SELECT START_DATE,END_DATE FROM marking_periods where marking_period_id ={$mp_id}"));
+            $mp_date = $mp_date[1];
+            $end_date = $mp_date[END_DATE];
+            $start_date = $mp_date[START_DATE];
         }
-        $mp_append_sql=" AND begin_date<='$end_date' AND '$start_date'<=end_date";
+        $mp_append_sql = " AND begin_date<='$end_date' AND '$start_date'<=end_date";
 
-        $days_append_sql .=" AND IF (schedule_type='BLOCKED', course_period_date ='".$_REQUEST['meet_date']."' AND start_time<='$end_time' AND '$start_time'<=end_time,'$_REQUEST[meet_date]' BETWEEN begin_date AND end_date AND days like '%".conv_day(date('D',strtotime($_REQUEST['meet_date'])),'key')."%' AND start_time<='$end_time' AND '$start_time'<=end_time)";
-        $days_room_append_sql .=" AND IF (schedule_type='BLOCKED', course_period_date ='".$_REQUEST['meet_date']."' AND room_id=$room AND start_time<='$end_time' AND '$start_time'<=end_time,'$_REQUEST[meet_date]' BETWEEN begin_date AND end_date AND days like '%".conv_day(date('D',strtotime($_REQUEST['meet_date'])),'key')."%' AND room_id=$room AND start_time<='$end_time' AND '$start_time'<=end_time)";
-
-        $cp_RET=  DBGet(DBQuery("SELECT cp.COURSE_PERIOD_ID FROM course_periods  cp LEFT JOIN course_period_var cpv ON (cp.course_period_id=cpv.course_period_id) WHERE (secondary_teacher_id IN ($all_teacher) OR teacher_id IN ($all_teacher)){$mp_append_sql}{$days_append_sql}{$cp_id}"));
-        if($cp_RET)
-            return 'Teacher Not Available';
-         elseif(strtotime($min_start_dt_chk_pr[1]['START_DATE'])> strtotime($start_date))
-        return 'Teacher\'s start date cannot be after course period\'s start date.';
+        $days_append_sql .= " AND IF (schedule_type='BLOCKED', course_period_date ='" . $_REQUEST['meet_date'] . "' AND start_time<='$end_time' AND '$start_time'<=end_time,'$_REQUEST[meet_date]' BETWEEN begin_date AND end_date AND days like '%" . conv_day(date('D', strtotime($_REQUEST['meet_date'])) , 'key') . "%' AND start_time<='$end_time' AND '$start_time'<=end_time)";
+        $days_room_append_sql .= " AND IF (schedule_type='BLOCKED', course_period_date ='" . $_REQUEST['meet_date'] . "' AND room_id=$room AND start_time<='$end_time' AND '$start_time'<=end_time,'$_REQUEST[meet_date]' BETWEEN begin_date AND end_date AND days like '%" . conv_day(date('D', strtotime($_REQUEST['meet_date'])) , 'key') . "%' AND room_id=$room AND start_time<='$end_time' AND '$start_time'<=end_time)";
+        if ($pre_ing != 'Y')
+        {
+        $cp_RET = DBGet(DBQuery("SELECT cp.COURSE_PERIOD_ID FROM course_periods  cp LEFT JOIN course_period_var cpv ON (cp.course_period_id=cpv.course_period_id) WHERE (secondary_teacher_id IN ($all_teacher) OR teacher_id IN ($all_teacher)){$mp_append_sql}{$days_append_sql}{$cp_id}"));
+        if ($cp_RET) return 'Teacher Not Available';
+        }
+        elseif (strtotime($min_start_dt_chk_pr[1]['START_DATE']) > strtotime($start_date)) return 'Teacher\'s start date cannot be after course period\'s start date.';
         else
         {
-            $room_RET=  DBGet(DBQuery("SELECT cp.COURSE_PERIOD_ID FROM course_periods  cp LEFT JOIN course_period_var cpv ON (cp.course_period_id=cpv.course_period_id) WHERE 1{$mp_append_sql}{$days_room_append_sql}{$cp_id}"));
-            if($room_RET)
+            if ($pre_ing != 'Y')
+            {
+            $room_RET = DBGet(DBQuery("SELECT cp.COURSE_PERIOD_ID FROM course_periods  cp LEFT JOIN course_period_var cpv ON (cp.course_period_id=cpv.course_period_id) WHERE 1{$mp_append_sql}{$days_room_append_sql}{$cp_id}"));
+            if ($room_RET)
             {
                 return 'Room Not Available';
             }
+            }
             return true;
         }
     }
     else
     {
-        $cp_dates=DBGet(DBQuery("SELECT COURSE_PERIOD_DATE,START_TIME,END_TIME,ROOM_ID FROM course_period_var WHERE COURSE_PERIOD_ID='$course_period_id'"));
-        $teacher=$columns['TEACHER_ID'];
-        $secteacher=$columns['SECONDARY_TEACHER_ID'];
-         if($_REQUEST['tables']['course_periods'][$_REQUEST['course_period_id']]['TEACHER_ID']!='')
-     $all_teacher=$teacher.($secteacher!=''?','.$secteacher:'');
-    else
-        $all_teacher=($secteacher!=''?$secteacher:'');
-//        $all_teacher=$teacher.($secteacher!=''?','.$secteacher:'');
-        $start_date=$columns['BEGIN_DATE'];
-        if($columns['MARKING_PERIOD_ID'])
-            $mp_id=$columns['MARKING_PERIOD_ID'];
-        else
-            $mp_id='';
-        $end_date=$columns['END_DATE'];
-        if($mp_id!='')
+        $cp_dates = DBGet(DBQuery("SELECT COURSE_PERIOD_DATE,START_TIME,END_TIME,ROOM_ID FROM course_period_var WHERE COURSE_PERIOD_ID='$course_period_id'"));
+        $teacher = $columns['TEACHER_ID'];
+        $secteacher = $columns['SECONDARY_TEACHER_ID'];
+        if ($_REQUEST['tables']['course_periods'][$_REQUEST['course_period_id']]['TEACHER_ID'] != '') $all_teacher = $teacher . ($secteacher != '' ? ',' . $secteacher : '');
+        else $all_teacher = ($secteacher != '' ? $secteacher : '');
+        //        $all_teacher=$teacher.($secteacher!=''?','.$secteacher:'');
+        $start_date = $columns['BEGIN_DATE'];
+        if ($columns['MARKING_PERIOD_ID']) $mp_id = $columns['MARKING_PERIOD_ID'];
+        else $mp_id = '';
+        $end_date = $columns['END_DATE'];
+        if ($mp_id != '')
         {
-            $mp_date=  DBGet(DBQuery("SELECT START_DATE,END_DATE FROM marking_periods where marking_period_id ={$mp_id}"));
-            $mp_date=$mp_date[1];
-            $end_date=$mp_date[END_DATE];
-            $start_date=$mp_date[START_DATE];
+            $mp_date = DBGet(DBQuery("SELECT START_DATE,END_DATE FROM marking_periods where marking_period_id ={$mp_id}"));
+            $mp_date = $mp_date[1];
+            $end_date = $mp_date[END_DATE];
+            $start_date = $mp_date[START_DATE];
         }
-        foreach($cp_dates as $key=>$cp)
+        foreach ($cp_dates as $key => $cp)
         {
-            $period=$cp['PERIOD_ID'];
-            $room=$cp['ROOM_ID']; 
-            $meet_date=$cp['COURSE_PERIOD_DATE'];
-            $start_time=$cp['START_TIME'];
-            $end_time=$cp['END_TIME'];
-            $mp_append_sql=" AND begin_date<='$end_date' AND '$start_date'<=end_date";
-
-            $days_append_sql =" AND IF (schedule_type='BLOCKED', course_period_date ='$meet_date' AND start_time<='$end_time' AND '$start_time'<=end_time,'$meet_date' BETWEEN begin_date AND end_date AND days like '%".conv_day(date('D',strtotime($meet_date)),'key')."%' AND start_time<='$end_time' AND '$start_time'<=end_time)";
-            $days_room_append_sql =" AND IF (schedule_type='BLOCKED', course_period_date ='$meet_date' AND room_id=$room AND start_time<='$end_time' AND '$start_time'<=end_time,'$meet_date' BETWEEN begin_date AND end_date AND days like '%".conv_day(date('D',strtotime($meet_date)),'key')."%' AND room_id=$room AND start_time<='$end_time' AND '$start_time'<=end_time)";
-            $cp_id=" AND cp.COURSE_PERIOD_ID!={$course_period_id}";
-            
-            $cp_RET=  DBGet(DBQuery("SELECT cp.COURSE_PERIOD_ID FROM course_periods  cp LEFT JOIN course_period_var cpv ON (cp.course_period_id=cpv.course_period_id) WHERE (secondary_teacher_id IN ($all_teacher) OR teacher_id IN ($all_teacher)){$mp_append_sql}{$days_append_sql}{$cp_id}"));
-            if($cp_RET)
-                return 'Teacher Not Available';
-              elseif(strtotime($min_start_dt_chk_pr[1]['START_DATE'])> strtotime($start_date))
-        return 'Teacher\'s start date cannot be after course period\'s start date.';
+            $period = $cp['PERIOD_ID'];
+            $room = $cp['ROOM_ID'];
+            $meet_date = $cp['COURSE_PERIOD_DATE'];
+            $start_time = $cp['START_TIME'];
+            $end_time = $cp['END_TIME'];
+            $period_time = DBGet(DBQuery("SELECT IGNORE_SCHEDULING FROM school_periods WHERE period_id={$period}"));
+            $period_time = $period_time[1];
+
+            $pre_ing = $period_time['IGNORE_SCHEDULING'];
+            $mp_append_sql = " AND begin_date<='$end_date' AND '$start_date'<=end_date";
+
+            $days_append_sql = " AND IF (schedule_type='BLOCKED', course_period_date ='$meet_date' AND start_time<='$end_time' AND '$start_time'<=end_time,'$meet_date' BETWEEN begin_date AND end_date AND days like '%" . conv_day(date('D', strtotime($meet_date)) , 'key') . "%' AND start_time<='$end_time' AND '$start_time'<=end_time)";
+            $days_room_append_sql = " AND IF (schedule_type='BLOCKED', course_period_date ='$meet_date' AND room_id=$room AND start_time<='$end_time' AND '$start_time'<=end_time,'$meet_date' BETWEEN begin_date AND end_date AND days like '%" . conv_day(date('D', strtotime($meet_date)) , 'key') . "%' AND room_id=$room AND start_time<='$end_time' AND '$start_time'<=end_time)";
+            $cp_id = " AND cp.COURSE_PERIOD_ID!={$course_period_id}";
+            if ($pre_ing != 'Y')
+            {
+            $cp_RET = DBGet(DBQuery("SELECT cp.COURSE_PERIOD_ID FROM course_periods  cp LEFT JOIN course_period_var cpv ON (cp.course_period_id=cpv.course_period_id) WHERE (secondary_teacher_id IN ($all_teacher) OR teacher_id IN ($all_teacher)){$mp_append_sql}{$days_append_sql}{$cp_id}"));
+            if ($cp_RET) return 'Teacher Not Available';
+            }
+            elseif (strtotime($min_start_dt_chk_pr[1]['START_DATE']) > strtotime($start_date)) return 'Teacher\'s start date cannot be after course period\'s start date.';
             else
             {
-                $room_RET=  DBGet(DBQuery("SELECT cp.COURSE_PERIOD_ID FROM course_periods  cp LEFT JOIN course_period_var cpv ON (cp.course_period_id=cpv.course_period_id) WHERE 1{$mp_append_sql}{$days_room_append_sql}{$cp_id}"));
-                if($room_RET)
+                if ($pre_ing != 'Y')
+                {
+                $room_RET = DBGet(DBQuery("SELECT cp.COURSE_PERIOD_ID FROM course_periods  cp LEFT JOIN course_period_var cpv ON (cp.course_period_id=cpv.course_period_id) WHERE 1{$mp_append_sql}{$days_room_append_sql}{$cp_id}"));
+                if ($room_RET)
                 {
                     return 'Room Not Available';
                 }
             }
         }
-        $total_days=DBGet(DBQuery("SELECT COUNT(course_period_date) AS CP_DATES FROM course_period_var WHERE COURSE_PERIOD_ID={$course_period_id}"));
-        $mp_RET=DBGet(DBQuery("SELECT COUNT(course_period_date) AS CP_DATES FROM course_period_var WHERE COURSE_PERIOD_ID={$course_period_id} AND course_period_date BETWEEN '$start_date' AND '$end_date'"));
-        if($total_days[1]['CP_DATES']!=$mp_RET[1]['CP_DATES'])
+        }
+        $total_days = DBGet(DBQuery("SELECT COUNT(course_period_date) AS CP_DATES FROM course_period_var WHERE COURSE_PERIOD_ID={$course_period_id}"));
+        $mp_RET = DBGet(DBQuery("SELECT COUNT(course_period_date) AS CP_DATES FROM course_period_var WHERE COURSE_PERIOD_ID={$course_period_id} AND course_period_date BETWEEN '$start_date' AND '$end_date'"));
+        if ($total_days[1]['CP_DATES'] != $mp_RET[1]['CP_DATES'])
         {
-            if($mp_id!='')
-                return 'Marking Period Cannot be Changed.';
-            else
-                return 'Begin or End Date Cannot be Changed.';
+            if ($mp_id != '') return 'Marking Period Cannot be Changed.';
+            else return 'Begin or End Date Cannot be Changed.';
         }
 
         return true;
     }
-    
 }
-//================Course varification ends=============================
 
+//================Course varification ends=============================
 //================ Student schedule varification=============================
-
-function VerifyStudentSchedule($course_RET,$student_id='')
+function VerifyStudentSchedule($course_RET, $student_id = '')
 {
-    if($student_id=='')
-        $student_id=  UserStudentID ();
-    if(!$course_RET)
+    if ($student_id == '') $student_id = UserStudentID();
+    if (!$course_RET)
     {
         return 'Incomplete course period';
     }
-    if(count($course_RET)>0)
+    if (count($course_RET) > 0)
     {
-        $schedule_exist = DBGet(DBQuery("SELECT *  FROM `schedule` WHERE `syear` =".$course_RET[1]['SYEAR']." AND `school_id` =".$course_RET[1]['SCHOOL_ID']." AND `student_id` =".$student_id." AND `course_id` =".$course_RET[1]['COURSE_ID']." AND `course_period_id` = ".$course_RET[1]['COURSE_PERIOD_ID'].' AND (END_DATE>="'.date('Y-m-d').'" OR END_DATE IS NULL OR END_DATE="0000-00-00")'));
-        if(count($schedule_exist)>0)
+        $schedule_exist = DBGet(DBQuery("SELECT *  FROM `schedule` WHERE `syear` =" . $course_RET[1]['SYEAR'] . " AND `school_id` =" . $course_RET[1]['SCHOOL_ID'] . " AND `student_id` =" . $student_id . " AND `course_id` =" . $course_RET[1]['COURSE_ID'] . " AND `course_period_id` = " . $course_RET[1]['COURSE_PERIOD_ID'] . ' AND (END_DATE>="' . date('Y-m-d') . '" OR END_DATE IS NULL OR END_DATE="0000-00-00")'));
+        if (count($schedule_exist) > 0)
         {
             return 'Course period already scheduled';
         }
     }
-    $check_parent_schedule=DBGet(DBQuery('SELECT PARENT_ID FROM course_periods WHERE COURSE_PERIOD_ID='.$course_RET[1]['COURSE_PERIOD_ID']));
-    if($check_parent_schedule[1]['PARENT_ID']!='' && $check_parent_schedule[1]['PARENT_ID']!=$course_RET[1]['COURSE_PERIOD_ID'])
+    $check_parent_schedule = DBGet(DBQuery('SELECT PARENT_ID FROM course_periods WHERE COURSE_PERIOD_ID=' . $course_RET[1]['COURSE_PERIOD_ID']));
+    if ($check_parent_schedule[1]['PARENT_ID'] != '' && $check_parent_schedule[1]['PARENT_ID'] != $course_RET[1]['COURSE_PERIOD_ID'])
     {
-        $check_stu_schedule=DBGet(DBQuery('SELECT COUNT(*) as REC_EX FROM schedule WHERE COURSE_PERIOD_ID='.$check_parent_schedule[1]['PARENT_ID'].' AND STUDENT_ID='.$student_id.' AND (END_DATE>="'.date('Y-m-d').'" OR END_DATE IS NULL OR END_DATE="0000-00-00")'));
-        if($check_stu_schedule[1]['REC_EX']==0)
-            return 'Course period has parent course restriction';
-
+        $check_stu_schedule = DBGet(DBQuery('SELECT COUNT(*) as REC_EX FROM schedule WHERE COURSE_PERIOD_ID=' . $check_parent_schedule[1]['PARENT_ID'] . ' AND STUDENT_ID=' . $student_id . ' AND (END_DATE>="' . date('Y-m-d') . '" OR END_DATE IS NULL OR END_DATE="0000-00-00")'));
+        if ($check_stu_schedule[1]['REC_EX'] == 0) return 'Course period has parent course restriction';
     }
-    if($course_RET[1]['TOTAL_SEATS']-$course_RET[1]['FILLED_SEATS']<=0)
+    if ($course_RET[1]['TOTAL_SEATS'] - $course_RET[1]['FILLED_SEATS'] <= 0)
     {
         return 'Seat not available';
     }
-    $student_RET=DBGet(DBQuery("SELECT LEFT(GENDER,1) AS GENDER FROM students WHERE STUDENT_ID='".$student_id."'"));
-    $student=$student_RET[1];
-    if($course_RET[1]['GENDER_RESTRICTION']!='N' && $course_RET[1]['GENDER_RESTRICTION']!=$student['GENDER'])
+    $student_RET = DBGet(DBQuery("SELECT LEFT(GENDER,1) AS GENDER FROM students WHERE STUDENT_ID='" . $student_id . "'"));
+    $student = $student_RET[1];
+    if ($course_RET[1]['GENDER_RESTRICTION'] != 'N' && $course_RET[1]['GENDER_RESTRICTION'] != $student['GENDER'])
     {
         return 'There is gender restriction';
     }
-    $do_check= false;
-    foreach($course_RET as $course)
+    $do_check = false;
+    foreach ($course_RET as $course)
     {
-        if($course['IGNORE_SCHEDULING']!='Y')
+        if ($course['IGNORE_SCHEDULING'] != 'Y')
         {
-            $do_check= true;
+            $do_check = true;
             break;
         }
     }
-    if($do_check==false)
-        return true;
+    if ($do_check == false) return true;
 
-    $teacher=$course_RET[1]['TEACHER_ID'];
-    $mp_id=$course_RET[1]['MARKING_PERIOD_ID'];
-    $end_date=$course_RET[1]['END_DATE'];
-    $start_date=date('Y-m-d');
-    $mp_append_sql=" AND s.start_date<='$end_date' AND ('$start_date'<=s.end_date OR s.end_date IS NULL)";
-    
-    if($course_RET[1]['SCHEDULE_TYPE']=='FIXED')
+    $teacher = $course_RET[1]['TEACHER_ID'];
+    $mp_id = $course_RET[1]['MARKING_PERIOD_ID'];
+    $end_date = $course_RET[1]['END_DATE'];
+    $start_date = date('Y-m-d');
+    $mp_append_sql = " AND s.start_date<='$end_date' AND ('$start_date'<=s.end_date OR s.end_date IS NULL)";
+
+    if ($course_RET[1]['SCHEDULE_TYPE'] == 'FIXED')
     {
-        $days=$course_RET[1]['DAYS'];
-        $start_time=$course_RET[1]['START_TIME'];
-        $end_time=$course_RET[1]['END_TIME'];
-    
-        $period_days_append_sql=" AND course_period_id IN(SELECT course_period_id from course_period_var cpv,school_periods sp WHERE cpv.period_id=sp.period_id AND ignore_scheduling IS NULL AND sp.start_time<='$end_time' AND '$start_time'<=sp.end_time AND (";
-        $days_arr=str_split($days);
-        foreach($days_arr as $day)
+        $days = $course_RET[1]['DAYS'];
+        $start_time = $course_RET[1]['START_TIME'];
+        $end_time = $course_RET[1]['END_TIME'];
+
+        $period_days_append_sql = " AND course_period_id IN(SELECT course_period_id from course_period_var cpv,school_periods sp WHERE cpv.period_id=sp.period_id AND ignore_scheduling IS NULL AND sp.start_time<='$end_time' AND '$start_time'<=sp.end_time AND (";
+        $days_arr = str_split($days);
+        foreach ($days_arr as $day)
         {
-            $period_days_append_sql.="DAYS LIKE '%$day%' OR ";
+            $period_days_append_sql .= "DAYS LIKE '%$day%' OR ";
         }
-        $period_days_append_sql=  substr($period_days_append_sql,0,-4).'))';
+        $period_days_append_sql = substr($period_days_append_sql, 0, -4) . '))';
     }
-    elseif($course_RET[1]['SCHEDULE_TYPE']=='VARIABLE')
+    elseif ($course_RET[1]['SCHEDULE_TYPE'] == 'VARIABLE')
     {
-        $period_days_append_sql=" AND course_period_id IN(SELECT course_period_id from course_period_var cpv,school_periods sp WHERE cpv.period_id=sp.period_id AND ignore_scheduling IS NULL AND (";
-        foreach($course_RET as $period_day)
+        $period_days_append_sql = " AND course_period_id IN(SELECT course_period_id from course_period_var cpv,school_periods sp WHERE cpv.period_id=sp.period_id AND ignore_scheduling IS NULL AND (";
+        foreach ($course_RET as $period_day)
         {
-            $period_days_append_sql .="(sp.start_time<='$period_day[END_TIME]' AND '$period_day[START_TIME]'<=sp.end_time AND DAYS LIKE '%$period_day[DAYS]%') OR ";
+            $period_days_append_sql .= "(sp.start_time<='$period_day[END_TIME]' AND '$period_day[START_TIME]'<=sp.end_time AND DAYS LIKE '%$period_day[DAYS]%') OR ";
         }
-        $period_days_append_sql=  substr($period_days_append_sql,0,-4).'))';
+        $period_days_append_sql = substr($period_days_append_sql, 0, -4) . '))';
     }
-    elseif($course_RET[1]['SCHEDULE_TYPE']=='BLOCKED')
+    elseif ($course_RET[1]['SCHEDULE_TYPE'] == 'BLOCKED')
     {
-        $period_days_append_sql=" AND course_period_id IN(SELECT course_period_id from course_period_var cpv,school_periods sp WHERE cpv.period_id=sp.period_id AND ignore_scheduling IS NULL AND (";
-        foreach($course_RET as $period_date)
+        $period_days_append_sql = " AND course_period_id IN(SELECT course_period_id from course_period_var cpv,school_periods sp WHERE cpv.period_id=sp.period_id AND ignore_scheduling IS NULL AND (";
+        foreach ($course_RET as $period_date)
         {
             // $period_days_append_sql .="(sp.start_time<='$period_date[END_TIME]' AND '$period_date[START_TIME]'<=sp.end_time AND IF(course_period_date IS NULL, course_period_date='$period_date[COURSE_PERIOD_DATE]',DAYS LIKE '%$period_date[DAYS]%')) OR ";
-              $period_days_append_sql .="(sp.start_time<='$period_date[END_TIME]' AND '$period_date[START_TIME]'<=sp.end_time AND (cpv.course_period_date IS NULL OR cpv.course_period_date='$period_date[COURSE_PERIOD_DATE]') AND cpv.DAYS LIKE '%$period_date[DAYS]%') OR ";
-
+            $period_days_append_sql .= "(sp.start_time<='$period_date[END_TIME]' AND '$period_date[START_TIME]'<=sp.end_time AND (cpv.course_period_date IS NULL OR cpv.course_period_date='$period_date[COURSE_PERIOD_DATE]') AND cpv.DAYS LIKE '%$period_date[DAYS]%') OR ";
         }
-        $period_days_append_sql=  substr($period_days_append_sql,0,-4).'))';
+        $period_days_append_sql = substr($period_days_append_sql, 0, -4) . '))';
     }
-   
-    $exist_RET=  DBGet(DBQuery("SELECT s.ID FROM schedule s WHERE student_id=".  $student_id." AND s.syear='".UserSyear()."' {$mp_append_sql}{$period_days_append_sql} UNION SELECT s.ID FROM temp_schedule s WHERE student_id=".  $student_id."{$mp_append_sql}{$period_days_append_sql}"));
-    if($exist_RET)
-        return 'There is a Period Conflict ('.$course_RET[1]['CP_TITLE'].')';
+
+    $exist_RET = DBGet(DBQuery("SELECT s.ID FROM schedule s WHERE student_id=" . $student_id . " AND s.syear='" . UserSyear() . "' {$mp_append_sql}{$period_days_append_sql} UNION SELECT s.ID FROM temp_schedule s WHERE student_id=" . $student_id . "{$mp_append_sql}{$period_days_append_sql}"));
+    if ($exist_RET) return 'There is a Period Conflict (' . $course_RET[1]['CP_TITLE'] . ')';
     else
     {
         return true;
     }
 }
 ?>
+

--- index.php ---
@@ -27,6 +27,7 @@
 #
 #***************************************************************************************
 error_reporting(0);
+ini_set('session.cookie_httponly', 1);
 include_once("functions/DelDirectoryFnc.php");
 include_once("functions/ParamLibFnc.php");
 require_once("functions/PragRepFnc.php");
@@ -77,21 +78,34 @@
     db_start();
     
     $username = mysqli_real_escape_string($connection,optional_param('USERNAME', '', PARAM_RAW));
+
+    $arr_cookie_options = array (
+        'expires' => time() + 60*60*24*100,
+        'path' => '/',
+        'secure' => true,     // or false
+        'httponly' => true,    // or false
+        'samesite' => 'None' // None || Lax  || Strict
+    );
+
     if($_REQUEST['remember']) 
-      {
-      $cName='remember_me_name';
-      $cPwd='remember_me_pwd';
-      $cLang='remember_me_lang';
-      setcookie($cName, $username, time()+60*60*24*100, "/");
-      setcookie($cPwd, optional_param('PASSWORD','',PARAM_RAW), time()+60*60*24*100, "/");
-      setcookie($cLang, optional_param('language','',PARAM_RAW), time()+60*60*24*100, "/");
-      }
-      else
-      {
-      setcookie('remember_me_name', 'gone', time()-60*60*24*100, "/");
-      setcookie('remember_me_pwd', 'gone', time()-60*60*24*100, "/");
-      setcookie('remember_me_lang', 'gone', time()-60*60*24*100, "/");
-      } 
+    {
+        include_once "./AuthCryp.php";
+        
+        $cName='remember_me_name';
+        $cPwd='remember_me_pwd';
+        $cLang='remember_me_lang';
+        
+        setcookie($cName, cryptor($username, 'ENC'), $arr_cookie_options);
+        setcookie($cPwd, cryptor(optional_param('PASSWORD','',PARAM_RAW), 'ENC'), $arr_cookie_options);
+        setcookie($cLang, optional_param('language','',PARAM_RAW), time()+60*60*24*100, "/");
+    }
+    else
+    {
+        setcookie('remember_me_name', 'gone', time()-60*60*24*100, "/");
+        setcookie('remember_me_pwd', 'gone', time()-60*60*24*100, "/");
+        setcookie('remember_me_lang', 'gone', time()-60*60*24*100, "/");
+    }
+
     if ($password == optional_param('PASSWORD', '', PARAM_RAW))
         $password = str_replace("\'", "", md5(mysqli_real_escape_string($connection,optional_param('PASSWORD', '', PARAM_RAW))));
     $password = str_replace("&", "", md5(mysqli_real_escape_string($connection,optional_param('PASSWORD', '', PARAM_RAW))));
@@ -304,7 +318,6 @@
     }
 
     if ($login_RET && $login_RET[1]['IS_DISABLE'] != 'Y') {
-        
         $_SESSION['STAFF_ID'] = $login_RET[1]['STAFF_ID'];
         $_SESSION['LAST_LOGIN'] = $login_RET[1]['LAST_LOGIN'];
 

--- install/OpensisSchemaMysqlInc.sql ---
@@ -2124,6 +2124,7 @@ CREATE TABLE `user_file_upload` (
   `profile_id` int(11) NOT NULL,
   `school_id` int(11) NOT NULL,
   `syear` int(11) NOT NULL,
+  `download_id` varchar(50) NOT NULL DEFAULT UUID(),
   `name` varchar(255) NOT NULL,
   `size` int(11) NOT NULL,
   `type` varchar(255) NOT NULL,

--- install/OpensisUpdateSchemaMysql.sql ---
@@ -1933,6 +1933,7 @@ CREATE TABLE `user_file_upload` (
   `profile_id` int(11) NOT NULL,
   `school_id` int(11) NOT NULL,
   `syear` int(11) NOT NULL,
+  `download_id` varchar(50) NOT NULL DEFAULT UUID(),
   `name` varchar(255) NOT NULL,
   `size` int(11) NOT NULL,
   `type` varchar(255) NOT NULL,

--- install/Upgrade.php ---
@@ -214,6 +214,7 @@
                                       `profile_id` int(11) NOT NULL,
                                       `school_id` int(11) NOT NULL,
                                       `syear` int(11) NOT NULL,
+                                      `download_id` varchar(50) NOT NULL DEFAULT UUID(),
                                       `name` varchar(255) NOT NULL,
                                       `size` int(11) NOT NULL,
                                       `type` varchar(255) NOT NULL,
@@ -418,6 +419,8 @@
 
                                     ### for Keys - End ###
 
+                                    $dbconn->query('ALTER TABLE `user_file_upload` ADD `download_id` VARCHAR(50) NOT NULL DEFAULT UUID() AFTER `syear`');
+
                                     $_SESSION['mod'] = 'upgrade';
                                     header('Location: Step5.php');
                                     // $_SESSION['mod'] = 'upgrade';
@@ -499,6 +502,8 @@
 
                                     ### for Keys - End ###
 
+                                    $dbconn->query('ALTER TABLE `user_file_upload` ADD `download_id` VARCHAR(50) NOT NULL DEFAULT UUID() AFTER `syear`');
+
                                     $_SESSION['mod'] = 'upgrade';
                                     header('Location: Step5.php');
                                     // $_SESSION['mod'] = 'upgrade';
@@ -598,6 +603,8 @@
 
                                     ### for Keys - End ###
 
+                                    $dbconn->query('ALTER TABLE `user_file_upload` ADD `download_id` VARCHAR(50) NOT NULL DEFAULT UUID() AFTER `syear`');
+
                                     $_SESSION['mod'] = 'upgrade';
                                     header('Location: Step5.php');
                                     // $_SESSION['mod'] = 'upgrade';
@@ -697,6 +704,8 @@
 
                                     ### for Keys - End ###
 
+                                    $dbconn->query('ALTER TABLE `user_file_upload` ADD `download_id` VARCHAR(50) NOT NULL DEFAULT UUID() AFTER `syear`');
+
                                     $_SESSION['mod'] = 'upgrade';
                                     header('Location: Step5.php');
                                     // $_SESSION['mod'] = 'upgrade';

--- js/Ajaxload.js ---
@@ -872,7 +872,7 @@ function rollover_callback(roll_data)
     }
 
     if (total_data[0] == 'users') {
-        document.getElementById("staff").innerHTML = total_data[0] + " " + total_data[1] + " " + total_data[2] + " " + total_data[3];
+        document.getElementById("staff").innerHTML = total_data[4] + " " + total_data[1] + " " + total_data[2] + " " + total_data[3];
         document.getElementById("staff").setAttribute("class", rollover_class);
         document.getElementById("staff").setAttribute("className", rollover_class);
         if (document.getElementById("chk_school_periods").value == 'Y')
@@ -884,13 +884,13 @@ function rollover_callback(roll_data)
         }
     } else if (total_data[0] == 'School Periods')
     {
-        document.getElementById("school_periods").innerHTML = total_data[0] + " " + total_data[1] + " " + total_data[2] + " " + total_data[3];
+        document.getElementById("school_periods").innerHTML = total_data[4] + " " + total_data[1] + " " + total_data[2] + " " + total_data[3];
         document.getElementById("school_periods").setAttribute("class", rollover_class);
         document.getElementById("school_periods").setAttribute("className", rollover_class);
         ajax_rollover('school_years');
     } else if (total_data[0] == 'Marking Periods')
     {
-        document.getElementById("school_years").innerHTML = total_data[0] + " " + total_data[1] + " " + total_data[2] + " " + total_data[3];
+        document.getElementById("school_years").innerHTML = total_data[4] + " " + total_data[1] + " " + total_data[2] + " " + total_data[3];
         document.getElementById("school_years").setAttribute("class", rollover_class);
         document.getElementById("school_years").setAttribute("className", rollover_class);
 
@@ -916,13 +916,13 @@ function rollover_callback(roll_data)
 
     } else if (total_data[0] == 'Calendars')
     {
-        document.getElementById("attendance_calendars").innerHTML = total_data[0] + " " + total_data[1] + " " + total_data[2] + " " + total_data[3];
+        document.getElementById("attendance_calendars").innerHTML = total_data[4] + " " + total_data[1] + " " + total_data[2] + " " + total_data[3];
         document.getElementById("attendance_calendars").setAttribute("class", rollover_class);
         document.getElementById("attendance_calendars").setAttribute("className", rollover_class);
         ajax_rollover('report_card_grade_scales');
     } else if (total_data[0] == 'Report Card Grade Codes')
     {
-        document.getElementById("report_card_grade_scales").innerHTML = total_data[0] + " " + total_data[1] + " " + total_data[2] + " " + total_data[3];
+        document.getElementById("report_card_grade_scales").innerHTML = total_data[4] + " " + total_data[1] + " " + total_data[2] + " " + total_data[3];
         document.getElementById("report_card_grade_scales").setAttribute("class", rollover_class);
         document.getElementById("report_card_grade_scales").setAttribute("className", rollover_class);
         if (document.getElementById('chk_course_subjects').value == 'Y')
@@ -935,7 +935,7 @@ function rollover_callback(roll_data)
             ajax_rollover('student_enrollment_codes');
     } else if (total_data[0] == 'Subjects')
     {
-        document.getElementById("course_subjects").innerHTML = total_data[0] + " " + total_data[1] + " " + total_data[2] + " " + total_data[3];
+        document.getElementById("course_subjects").innerHTML = total_data[4] + " " + total_data[1] + " " + total_data[2] + " " + total_data[3];
         document.getElementById("course_subjects").setAttribute("class", rollover_class);
         document.getElementById("course_subjects").setAttribute("className", rollover_class);
         if (document.getElementById('chk_courses').value == 'Y')
@@ -946,7 +946,7 @@ function rollover_callback(roll_data)
             ajax_rollover('student_enrollment_codes');
     } else if (total_data[0] == 'Courses')
     {
-        document.getElementById("courses").innerHTML = total_data[0] + " " + total_data[1] + " " + total_data[2] + " " + total_data[3];
+        document.getElementById("courses").innerHTML = total_data[4] + " " + total_data[1] + " " + total_data[2] + " " + total_data[3];
         document.getElementById("courses").setAttribute("class", rollover_class);
         document.getElementById("courses").setAttribute("className", rollover_class);
         if (document.getElementById('chk_course_periods').value == 'Y')
@@ -955,19 +955,19 @@ function rollover_callback(roll_data)
             ajax_rollover('student_enrollment_codes');
     } else if (total_data[0] == 'Course Periods')
     {
-        document.getElementById("course_periods").innerHTML = total_data[0] + " " + total_data[1] + " " + total_data[2] + " " + total_data[3];
+        document.getElementById("course_periods").innerHTML = total_data[4] + " " + total_data[1] + " " + total_data[2] + " " + total_data[3];
         document.getElementById("course_periods").setAttribute("class", rollover_class);
         document.getElementById("course_periods").setAttribute("className", rollover_class);
         ajax_rollover('student_enrollment_codes');
     } else if (total_data[0] == 'Student Enrollment Codes')
     {
-        document.getElementById("student_enrollment_codes").innerHTML = total_data[0] + " " + total_data[1] + " " + total_data[2] + " " + total_data[3];
+        document.getElementById("student_enrollment_codes").innerHTML = total_data[4] + " " + total_data[1] + " " + total_data[2] + " " + total_data[3];
         document.getElementById("student_enrollment_codes").setAttribute("class", rollover_class);
         document.getElementById("student_enrollment_codes").setAttribute("className", rollover_class);
         ajax_rollover('student_enrollment');
     } else if (total_data[0] == 'Students')
     {
-        document.getElementById("student_enrollment").innerHTML = total_data[0] + " " + total_data[1] + " " + total_data[2] + " " + total_data[3];
+        document.getElementById("student_enrollment").innerHTML = total_data[4] + " " + total_data[1] + " " + total_data[2] + " " + total_data[3];
         document.getElementById("student_enrollment").setAttribute("class", rollover_class);
         document.getElementById("student_enrollment").setAttribute("className", rollover_class);
         if (document.getElementById("chk_honor_roll").value == 'Y')
@@ -985,7 +985,7 @@ function rollover_callback(roll_data)
         }
     } else if (total_data[0] == 'Honor Roll Setup')
     {
-        document.getElementById("honor_roll").innerHTML = total_data[0] + " " + total_data[1] + " " + total_data[2] + " " + total_data[3];
+        document.getElementById("honor_roll").innerHTML = total_data[4] + " " + total_data[1] + " " + total_data[2] + " " + total_data[3];
         document.getElementById("honor_roll").setAttribute("class", rollover_class);
         document.getElementById("honor_roll").setAttribute("className", rollover_class);
         if (document.getElementById("chk_attendance_codes").value == 'Y')
@@ -1001,7 +1001,7 @@ function rollover_callback(roll_data)
 
     } else if (total_data[0] == 'Attendance Codes')
     {
-        document.getElementById("attendance_codes").innerHTML = total_data[0] + " " + total_data[1] + " " + total_data[2] + " " + total_data[3];
+        document.getElementById("attendance_codes").innerHTML = total_data[4] + " " + total_data[1] + " " + total_data[2] + " " + total_data[3];
         document.getElementById("attendance_codes").setAttribute("class", rollover_class);
         document.getElementById("attendance_codes").setAttribute("className", rollover_class);
 
@@ -1014,7 +1014,7 @@ function rollover_callback(roll_data)
         }
     } else if (total_data[0] == 'Report Card Comment Codes')
     {
-        document.getElementById("report_card_comments").innerHTML = total_data[0] + " " + total_data[1] + " " + total_data[2] + " " + total_data[3];
+        document.getElementById("report_card_comments").innerHTML = total_data[4] + " " + total_data[1] + " " + total_data[2] + " " + total_data[3];
         document.getElementById("report_card_comments").setAttribute("class", rollover_class);
         document.getElementById("report_card_comments").setAttribute("className", rollover_class);
         ajax_rollover('NONE');
@@ -3281,4 +3281,26 @@ function getSchoolScheduleReport(this_INC)
     }
 
     console.log(this_DATE);
+}
+
+function loadFilterList()
+{
+    window.$("#stuf_loader").show();
+
+    ajax_call("StudentFilterList.php", loadFilterListCallback, loadFilterListErrors);
+}
+
+function loadFilterListCallback(check_return)
+{
+    window.$("#stuf_loader").hide();
+
+    console.log(check_return);
+    window.$("#view_resp").html(check_return);
+}
+
+function loadFilterListErrors(exceptions)
+{
+    window.$("#stuf_loader").hide();
+    
+    console.log(exceptions);
 }
\ No newline at end of file

--- js/DivControl.js ---
@@ -697,6 +697,7 @@ function addseccheck_button(){
     }
 
 }
+
 function hide_filter_modal()
 {
     window.$('#modal_filter_edit').modal('toggle');
@@ -709,3 +710,52 @@ function closeThisModal(modal_ID = false)
         window.$('#'+modal_ID).modal('toggle');
     }
 }
+
+function clickOnFileInput () {
+    document.getElementById("upfile").click();
+}
+
+function selectedFilesRail(inputFileID) {
+
+    var fileobj = [];
+    if(inputFileID && inputFileID != '') {
+        setFilesRail(document.getElementById(inputFileID).files);
+    }
+}
+
+function setFilesRail(files) {
+    fileobj = fileobj.concat(...files);
+
+    printFilesRail();
+}
+
+function printFilesRail() {
+    var fileListElement = document.querySelector("#areaFileRail ul");
+    
+    var fileList = '';
+    var storeFiles = '';
+    var fileCounter = 0;
+
+    fileobj.map((file, index) => {
+        // fileList += `<li class="m-t-5"><button class="btn btn-danger btn-icon btn-xs m-r-10" type="button" onclick="removeFromFilesRail(${index})"><i class="fa fa-times"></i></button>${file.name}</li>`;
+        fileList += `<li class="m-t-10"><i class="fa fa-file-o text-primary m-r-10"></i>${file.name}</li>`;
+
+        fileCounter++;
+    });
+    console.log(fileobj);
+
+    fileListElement.innerHTML = fileList;
+
+    if(fileCounter > 0) {
+        $("#nofiles").hide();
+    } else {
+        $("#nofiles").show();
+    }
+    fileobj = [];
+}
+
+function removeFromFilesRail(index) {
+    fileobj.splice(index, 1);
+
+    printFilesRail();
+}

--- js/Validation.js ---
@@ -1,7 +1,7 @@
 function formcheck_school_setup_school(this_DET) {
   var this_button_id = this_DET.id;
 
-  var frmvalidator = new Validator("school", this_button_id);
+  var frmvalidator = new Validator("school");
 
   frmvalidator.addValidation("values[TITLE]", "req", "Please enter the title");
   frmvalidator.addValidation(
@@ -2664,6 +2664,63 @@ function validate_course_period(this_DET = false) {
   return true;
 }
 
+
+function validate_cp_teacher_fields()
+{
+  var hd_cp_id = document.getElementById("hidden_cp_id").value;
+  if(hd_cp_id != 'new')
+  {
+    if(document.getElementsByName("tables[course_periods][" + hd_cp_id + "][SECONDARY_TEACHER_ID]")[0] && document.getElementsByName("tables[course_periods][" + hd_cp_id + "][SECONDARY_TEACHER_ID]")[0].value!="")
+    {
+        var secondary_teacher = document.getElementsByName("tables[course_periods][" + hd_cp_id + "][SECONDARY_TEACHER_ID]")[0].value;
+    }
+    else
+    {
+        var secondary_teacher = document.getElementById("hidden_secondary_teacher_id").value;
+    }
+
+    if(document.getElementsByName("tables[course_periods][" + hd_cp_id + "][TEACHER_ID]")[0] && document.getElementsByName("tables[course_periods][" + hd_cp_id + "][TEACHER_ID]")[0].value!="")
+    {
+        var primary_teacher = document.getElementsByName("tables[course_periods][" + hd_cp_id + "][TEACHER_ID]")[0].value;
+    }
+    else
+    {
+        var primary_teacher = document.getElementById("hidden_primary_teacher_id").value;
+    }
+    //alert(primary_teacher + "=====" + secondary_teacher);
+    if(primary_teacher == secondary_teacher)
+    {
+        document.getElementById("divErr").innerHTML = '<div class="alert alert-danger no-border"><i class="fa fa-info-circle"></i> Primary and Secondary teacher cannot be same</div>';
+        window.$("#save_cp").attr("disabled", true);
+        window.$("#save_cps").attr("disabled", true);
+    }
+    else
+    {
+        document.getElementById("divErr").innerHTML = '';
+        window.$("#save_cp").attr("disabled", false);
+        window.$("#save_cps").attr("disabled", false);
+    }
+  }
+  else
+  {
+    var primary_teacher = document.getElementsByName("tables[course_periods][new][TEACHER_ID]")[0].value;
+    var secondary_teacher = document.getElementsByName("tables[course_periods][new][SECONDARY_TEACHER_ID]")[0].value;
+    if(primary_teacher == secondary_teacher)
+    {
+        document.getElementById("divErr").innerHTML = '<div class="alert alert-danger no-border"><i class="fa fa-info-circle"></i> Primary and Secondary teacher cannot be same</div>';
+        window.$("#save_cp").attr("disabled", true);
+        window.$("#save_cps").attr("disabled", true);
+    }
+    else
+    {
+        document.getElementById("divErr").innerHTML = '';
+        window.$("#save_cp").attr("disabled", false);
+        window.$("#save_cps").attr("disabled", false);
+    }
+  }
+}
+
+
 function validate_block_schedule(option) {
   if (document.getElementById("hidden_period_block").value == "") {
     document.getElementById("block_error").innerHTML =
@@ -4322,8 +4379,8 @@ function formcheck_Timetable_course_F4(this_DET) {
     );
     frmvalidator.addValidation(
       "tables[course_subjects][new][TITLE]",
-      "maxlen=100",
-      "Max length for subject is 100 characters"
+      "maxlen=50",
+      "Max length for subject is 50 characters"
     );
   } else {
     frmvalidator.addValidation(
@@ -4333,8 +4390,8 @@ function formcheck_Timetable_course_F4(this_DET) {
     );
     frmvalidator.addValidation(
       "inputtables[course_subjects][" + subject_id + "][TITLE]",
-      "maxlen=100",
-      "Max length for course title is 100 characters"
+      "maxlen=50",
+      "Max length for course title is 50 characters"
     );
   }
 }
@@ -4378,8 +4435,8 @@ function formcheck_Timetable_course_F3(this_DET) {
     );
     frmvalidator.addValidation(
       "tables[courses][new][TITLE]",
-      "maxlen=100",
-      "Max length for course title is 100 characters "
+      "maxlen=50",
+      "Max length for course title is 50 characters "
     );
 
     frmvalidator.addValidation(
@@ -4395,8 +4452,8 @@ function formcheck_Timetable_course_F3(this_DET) {
     );
     frmvalidator.addValidation(
       "inputtables[courses][" + course_id + "][TITLE]",
-      "maxlen=100",
-      "Max length for course title is 100 characters"
+      "maxlen=50",
+      "Max length for course title is 50 characters"
     );
 
     frmvalidator.addValidation(
@@ -4446,8 +4503,8 @@ function formcheck_enrollment_code(this_DET) {
     );
     frmvalidator.addValidation(
       "values[new][TITLE]",
-      "maxlen=100",
-      "Max length for title is 100 characters"
+      "maxlen=50",
+      "Max length for title is 50 characters"
     );
   } else {
     frmvalidator.clearAllValidations();
@@ -4486,8 +4543,8 @@ function formcheck_enrollment_code(this_DET) {
       );
       frmvalidator.addValidation(
         "values[" + ar_id[i] + "][TITLE]",
-        "maxlen=100",
-        "Max length for title is 100 characters"
+        "maxlen=50",
+        "Max length for title is 50 characters"
       );
       frmvalidator.addValidation(
         "values[" + ar_id[i] + "][SHORT_NAME]",
@@ -4948,6 +5005,48 @@ function save_student_filters() {
   }
 }
 
+function clearSearching()
+{
+    var formName = 'search';
+
+    var elements = document.forms[formName].elements;
+    for (i=0; i < elements.length; i++)
+    {
+        var this_input_type =   elements[i].type;
+        var this_input_tag  =   elements[i].tagName;
+
+        if(this_input_tag == 'INPUT')
+        {
+            if(this_input_type != 'hidden')
+            {
+                if(this_input_type == 'text')
+                {
+                    elements[i].value = '';
+                }
+                else if(this_input_type == 'checkbox' || this_input_type == 'radio')
+                {
+                    elements[i].checked = false;
+                }
+            }
+        }
+        else if(this_input_tag == 'SELECT')
+        {
+            // elements[i].selected = false;
+            elements[i].value = '';
+        }
+        else if(this_input_tag == 'TEXTAREA')
+        {
+            elements[i].innerHTML = '';
+        }
+
+        // console.log(elements[i]);
+        // console.log(this_input_type);
+        // console.log(this_input_tag);
+    }
+
+    document.getElementById(formName). submit();
+}
+
 function self_disable(this_DET) {
   /* Directl triggering "self disable" when on button click no JS validation is occuring. */
 

--- js/Validator.js ---
@@ -102,7 +102,9 @@ function vdesc_validate()
 
     if(typeof submitBtn !== 'undefined' && submitBtn != '')
     {
-        document.getElementById(submitBtn).disabled =  true;
+        setTimeout(function () {
+            document.getElementById(submitBtn).disabled =  true;
+        }, 10);
     }
     
     return true;

--- lang/lang_en.php ---
@@ -12,7 +12,7 @@
 
 // translate
 define("_enterUsername", "Enter Username");
-define("_enterPassword", "Entrer Password");
+define("_enterPassword", "Enter Password");
 define("_rememberMe", "Remember Me");
 define("_forgotUsernamePassword", "Forgot Username / Password");
 define("_login", "Login");
@@ -36,7 +36,7 @@
 define("_day", "Day");
 define("_week", "Week");
 define("_month", "Month");
-define("_notPresent", "Not present");
+define("_notPresent", "Pas présent");
 define("_noteWasFound", "Note was found");
 define("_notesWereFound", "Notes were found");
 define("_datePosted", "Date Posted");
@@ -493,12 +493,17 @@
 define("_reAssignmentRecord", "Re-Assignment Record");
 define("_reAssignmentRecords", "Re-Assignment Records");
 //STUDENTS
+define("_allFilesAreSuccessfullyUploaded", "All files are successfully uploaded");
+define("_1File", "1 File");
+define("_cannotBeUploadedBecauseOfInvalidFileType", "cannot be uploaded because of invalid file type");
+define("_cannotBeUploadedBecauseOfInvalidPermission", "cannot be uploaded because of invalid permission");
+define("_toUploadAdditionalFilesClickBrowseSelectFileAndClickSave", "To upload additional files click browse, select file and click save");
+define("_browse", "Browse");
 define("_custom", "Custom");
 define("_disabilityDescription", "Disability Description");
 define("_streetAddress", "Street Address");
 define("_find", "Find");
 define("_any", "Any");
-define("_rollingRetentionOptions", "Rolling Retention / Options");
 define("_selectedStudentsAreSuccessfullyReEnrolled", "Selected students are successfully re enrolled");
 define("_additionalInfo", "Additional Info");
 define("_requestArray", "Request Array");
@@ -508,6 +513,7 @@
 define("_selectMultipleChoices", "Select Multiple Choices");
 define("_filter", "filter");
 define("_filters", "filters");
+define("_edit", "Edit");
 define("_goal", "goal");
 define("_progress", "Progress");
 define("_progresses", "Progresses");
@@ -880,6 +886,7 @@
 define("_cannotBeReenrolledBecauseReenrollDateAndDropDateAreSameOrReenrollmentDateIsBeforeEndDate", "cannot be reenrolled because reenroll date and drop date are same or reenrollment date is before end date.");
 define("_selectImageFile", "Select image file");
 define("_wellDone", "Well done");
+define("_fileUploadedSuccessfully", "File uploaded successfully");
 define("_maximumUploadFileSize_10Mb", "Maximum upload file size 10 MB");
 define("_pleaseSelectAStudentFirst", "Please select a student first");
 define("_removeParent", "Remove Parent");
@@ -979,7 +986,7 @@
 define("_findAStaff", "FIND A STAFF");
 define("_addAUser", "Add a User");
 define("_demographicInfo", "DEMOGRAPHIC INFO");
-define("_upload", "UPLOAD"); 
+define("_upload", "UPLOAD");
 define("_uploadStaffSPhoto", "Upload Staff's Photo");
 define("_includeDisabledStaff", "Include Disabled Staff");
 define("_cirtificationInformation", "CIRTIFICATION INFORMATION");
@@ -1207,22 +1214,17 @@
 //ATTENDANCE
 define("_attendanceIsAlreadyTakenForTheStudentsOnSelectedDayAndPeriod", "Attendance is already taken for the students on selected day and period.");
 define("_thisStudentHasNoContactInformation", "This student has no contact information");
-define("_openSisStudentInformationSystem", "openSIS Student Information System");
 define("_studentGrades", "Student Grades");
 define("_configuration", "Configuration");
 define("_associatedParents", "Associated Parents");
 define("_backToMissingAttendanceList", "Back to Missing Attendance List");
-define("_student", "Student");
-define("_studentId", "Student ID");
-define("_grade", "Grade");
 define("_teachersHaveMissingAttendanceData", "Teachers have missing attendance data");
 define("_youHaveTakenAttendanceTodayForThisPeriod", "You have taken attendance today for this period");
 define("_secondaryTeacherHasTakenAttendanceTodayForThisPeriod", "Secondary teacher has taken attendance today for this period");
 define("_primaryTeacherHasTakenAttendanceTodayForThisPeriod", "Primary teacher has taken attendance today for this period");
 define("_youAreNotCurrentlyInAMarkingPeriod", "You are not currently in a marking period");
 define("_thereIsAConflict", "There is a conflict");
 define("_youCannotAddThisCoursePeriod", "You cannot add this course period");
-define("_checkingSchedulePleaseWait", "Checking schedule Please Wait");
 define("_officialInformation", "Official Information");
 define("_useLastYearsIfMissing", "Use Last Years If Missing");
 define("_allTheGradesWithRespectToThisAssignmentWillBeDeleted", "All the grades with respect to this Assignment will be deleted");
@@ -1231,14 +1233,12 @@
 define("_duplicateStudentFound", "Duplicate student found");
 define("_thereIsAlreadyAStudentWithTheSameInformation", "There is already a student with the same information");
 define("_doYouWantToProceed", "Do you want to proceed");
-define("_duplicateFileFound", "Duplicate file found");
 define("_thereIsAlreadyAFileWithTheSameName", "There is already a file with the same name");
 define("_addGroupMember", "Add Group Member");
 define("_member", "Member");
 define("_selectSubject", "Select Subject");
 define("_selectCourse", "Select Course");
 define("_noRecordsWereFound", "No Records were found");
-define("_date", "Date");
 define("_present", "Present");
 define("_adminOfficeComment", "Admin & Office Comment");
 define("_teacherComment", "Teacher Comment");
@@ -1248,10 +1248,8 @@
 define("_addNewContact", "Add New Contact");
 define("_cannotDeleteBecauseAttendanceCodesAreAssociated", "Cannot delete because attendance codes are associated");
 define("_studentsList", "students list");
-define('LANG_RECORDS_ADDED_CONFIRMATION', 'Absence records were added for the selected students.');
-define('LANG_CHOOSE_STUDENT_ERROR', 'You must choose at least one period and one student.');
-define('LANG_ABSENCE_CODE', 'Absence Code');
-define('LANG_ABSENCE_REASON', 'Absence Reason');
+define("_absenceRecordsWereAddedForTheSelectedStudents", "Absence records were added for the selected students.");
+define("_youMustChooseAtLeastOnePeriodAndOneStudent", "You must choose at least one period and one student.");
 define("_attendanceRecords", "Attendance records");
 define("_attendanceRecord", "Attendance record");
 define("_avgAttendance", "Avg Attendance");
@@ -1276,7 +1274,6 @@
 define("_recalculateDailyAttendance", "Recalculate Daily Attendance");
 define("_deleteDuplicateAttendance", "Delete Duplicate Attendance");
 define("_teachersEntry", "Teacher\'s Entry");
-define("_thisStudentHasNoContactInformation", "This student has no contact information");
 define("_unableToAddAbsenceRecordsFor", "Unable to add absence records for");
 define("_addAbsenceToPeriods", "Add absence to periods");
 define("_absenceCode", "Absence code");
@@ -1299,7 +1296,6 @@
 define("_attendanceStatus", "Attendance Status");
 define("_totalAttendance", "Total Attendance");
 define("_daysPossible", "Days Possible");
-define("_present", "Present");
 define("_absent", "Absent");
 define("_ada", "ADA");
 define("_absences", "Absences");
@@ -1387,6 +1383,7 @@
 define("_asTheyDonTExist", "as they don't exist");
 define("_doesnTExist", "doesn't exist");
 //TOOLS
+define("_savingDatabaseForBackupBeforeRolloverPleaseDonotClickAnywhere", "Saving database for backup before rollover, please donot click anywhere");
 define("_customFieldType", "Custom Field Type");
 define("_customFieldName", "Custom Field Name");
 define("_options", "Options");
@@ -1883,12 +1880,9 @@
 define("_eC", "E/C");
 define("_whoHasCompletedAllTheAcademic", "Who has completed all the academic");
 define("_requirementsFor", "requirements for");
-define("_honorRoll", "Honor Roll");
-define("_total", "Total");
-define("_academicProbationPleaseBeRemindedOfSectionOfTheAcademicHandbooKIfStudentsFailToRaiseTheirCGPAAboveForTwoConsecutiveSemestersTheDefaultActionIsDismissalFromTheProgram", "ACADEMIC PROBATION
-         Please be reminded of Section 2.3.6 of the Academic Handbook:
-         If students fail to raise their CGPA above 3.0 for two consecutive semesters
-         the default action is dismissal from the Program");
+define("_academicProbation", "ACADEMIC PROBATION");
+define("_pleaseBeRemindedOfSection_2_3_6OfTheAcademicHandbook", "Please be reminded of Section 2.3.6 of the Academic Handbook:");
+define("_ifStudentsFailToRaiseTheirCgpaAbove_3_0ForTwoConsecutiveSemestersTheDefaultActionIsDismissalFromTheProgram", "If students fail to raise their CGPA above 3.0 for two consecutive semesters the default action is dismissal from the Program");
 
 define("_dateOfBirthh", "Date of Birth");
 define("_notRequested", "Not Requested");
@@ -1931,4 +1925,8 @@
 define("_yourCurrentPasswordWasIncorrect", "Your current password was incorrect");
 define("_yourCurrentPasswordCanNotBeBlank", "Your current password can not be blank");
 define("_yourNewPasswordWasSaved", "Your new password was saved");
+
+define("_cannotGeneratePagination", "Cannot generate pagination!");
+define("_outOf", "out of");
+define("_entries", "entries");
 ?>
\ No newline at end of file

--- lang/lang_es.php ---
@@ -493,12 +493,17 @@
 define("_reAssignmentRecord", "Registro de reasignación");
 define("_reAssignmentRecords", "Registros de reasignación");
 //STUDENTS
+define("_allFilesAreSuccessfullyUploaded", "Todos los archivos se cargan con éxito");
+define("_1File", "1 archivo");
+define("_cannotBeUploadedBecauseOfInvalidFileType", "No se puede cargar a causa de tipo de archivo no válido");
+define("_cannotBeUploadedBecauseOfInvalidPermission", "No se puede cargar debido permiso no válido");
+define("_toUploadAdditionalFilesClickBrowseSelectFileAndClickSave", "Para cargar archivos adicionales, haga clic en Examinar, seleccione el archivo y haga clic en Guardar");
+define("_browse", "Vistazo");
 define("_custom", "Personalizado");
 define("_disabilityDescription", "Descripción de la discapacidad");
 define("_streetAddress", "Dirección");
 define("_find", "Encontrar");
 define("_any", "Alguno");
-define("_rollingRetentionOptions", "Opciones / retención rodante");
 define("_selectedStudentsAreSuccessfullyReEnrolled", "Los estudiantes seleccionados se vuelven a inscribir con éxito");
 define("_additionalInfo", "Información adicional");
 define("_requestArray", "Solicitar matriz");
@@ -508,6 +513,7 @@
 define("_selectMultipleChoices", "Seleccionar múltiples opciones");
 define("_filter", "filtrar");
 define("_filters", "filtros");
+define("_edit", "Editar");
 define("_goal", "objetivo");
 define("_progress", "Progreso");
 define("_progresses", "Progresos");
@@ -880,6 +886,7 @@
 define("_cannotBeReenrolledBecauseReenrollDateAndDropDateAreSameOrReenrollmentDateIsBeforeEndDate", "no se puede reinscribir porque la fecha de reinscripción y la fecha de baja son las mismas o la fecha de reinscripción es anterior a la fecha de finalización. ");
 define ("_ selectImageFile", "Seleccionar archivo de imagen");
 define("_wellDone", "Bien hecho");
+define("_fileUploadedSuccessfull", "Documento cargado exitosamente");
 define("_maximumUploadFileSize_10Mb", "Tamaño máximo de archivo de carga 10 MB");
 define("_pleaseSelectAStudentFirst", "Primero seleccione un estudiante");
 define("_removeParent", "Eliminar padre");
@@ -1207,13 +1214,10 @@
 //ATTENDANCE
 define("_attendanceIsAlreadyTakenForTheStudentsOnSelectedDayAndPeriod", "La asistencia de los estudiantes ya está tomada en el día y período seleccionados.");
 define("_thisStudentHasNoContactInformation", "Este estudiante no tiene información de contacto");
-define("_openSisStudentInformationSystem", "Sistema de información del estudiante openSIS");
 define("_studentGrades", "Calificaciones de los estudiantes");
 define("_configuration", "Configuración");
 define("_associatedParents", "Padres asociados");
 define("_backToMissingAttendanceList", "Volver a la lista de asistencia faltante");
-define("_student", "Alumno");
-define("_studentId", "Identificación del Estudiante");
 define("_grade", "Grade");
 define("_teachersHaveMissingAttendanceData", "Teachers have missing attendance data");
 define("_youHaveTakenAttendanceTodayForThisPeriod", "You have taken attendance today for this period");
@@ -1231,15 +1235,13 @@
 define("_duplicateStudentFound", "Estudiante duplicado encontrado");
 define("_thereIsAlreadyAStudentWithTheSameInformation", "Ya existe un alumno con la misma información");
 define("_doYouWantToProceed", "Quieres proceder");
-define("_duplicateFileFound", "Se encontró un archivo duplicado");
 define("_thereIsAlreadyAFileWithTheSameName", "Ya existe un archivo con el mismo nombre");
 define("_assignmentType", "tipo de asignación");
 define("_addGroupMember", "Add Group Member");
 define("_member", "Miembro");
 define("_selectSubject", "Seleccionar asunto");
 define("_selectCourse", "Seleccionar curso");
 define("_noRecordsWereFound", "No se encontraron registros");
-define("_date", "Fecha");
 define("_present", "Presente");
 define("_adminOfficeComment", "Comentario del administrador y la oficina");
 define("_teacherComment", "Comentario del maestroComentario del maestro");
@@ -1249,10 +1251,8 @@
 define("_addNewContact", "Añadir nuevo contacto");
 define("_cannotDeleteBecauseAttendanceCodesAreAssociated", "No se puede eliminar porque los códigos de asistencia están asociados");
 define("_studentsList", "lista de estudiantes");
-define('LANG_RECORDS_ADDED_CONFIRMATION', 'Se agregaron registros de ausencia para los estudiantes seleccionados.');
-define('LANG_CHOOSE_STUDENT_ERROR', 'Debes elegir al menos un período y un alumno.');
-define('LANG_ABSENCE_CODE', 'Código de ausencia');
-define('LANG_ABSENCE_REASON', 'Razón de la ausencia');
+define("_absenceRecordsWereAddedForTheSelectedStudents", "Se agregaron registros de ausencia para los estudiantes seleccionados.");
+define("_youMustChooseAtLeastOnePeriodAndOneStudent", "Debes elegir al menos un período y un alumno.");
 define("_attendanceRecords", "Registros de asistencia");
 define("_attendanceRecord", "Registro de asistencia");
 define("_avgAttendance", "Asistencia promedio");
@@ -1277,7 +1277,6 @@
 define("_recalculateDailyAttendance", "Recalcular la asistencia diaria");
 define("_deleteDuplicateAttendance", "Eliminar asistencia duplicada");
 define("_teachersEntry", "Entrada del profesor");
-define("_thisStudentHasNoContactInformation", "Este estudiante no tiene información de contacto");
 define("_unableToAddAbsenceRecordsFor", "No se pueden agregar registros de ausencia para");
 define("_addAbsenceToPeriods", "Agregar ausencia a períodos");
 define("_absenceCode", "Código de ausencia");
@@ -1300,7 +1299,6 @@
 define("_attendanceStatus", "Estado de asistencia");
 define("_totalAttendance", "Asistencia total");
 define("_daysPossible", "Días posibles");
-define("_present", "Presente");
 define("_absent", "Ausente");
 define("_ada", "ADA");
 define("_absences", "Ausencias");
@@ -1388,6 +1386,7 @@
 define("_asTheyDonTExist", "Como ellos no existen");
 define("_doesnTExist", "no existe");
 //TOOLS
+define("_savingDatabaseForBackupBeforeRolloverPleaseDonotClickAnywhere", "Ahorro de la base de datos de copia de seguridad antes de vuelco, por favor haga clic en cualquier DONOT");
 define("_customFieldType", "Tipo de campo personalizado");
 define("_customFieldName", "Nombre de campo personalizado");
 define("_options", "Opciones");
@@ -1637,7 +1636,6 @@
 define("_availableSchoolFields", "Campos escolares disponibles");
 define("_creatReportForInstitutes", "CREAR INFORME PARA INSTITUTOS");
 define("_noCustomFieldsWereFound", "No se encontraron campos personalizados");
-define("_customFields", "Campos Personalizados");
 define("_homeroom", "Salón principal");
 define("_secondaryLanguage", "Idioma secundario");
 //----------------------------------------------------------------------------------------------------------
@@ -1661,7 +1659,6 @@
 define("_ageSearch", "Búsqueda por edad");
 define("_advancedFilter", "Filtro avanzado");
 define("_closeAdvancedFilter", "Cerrar filtro avanzado");
-define("_didNotRecieve", "No lo recibí");
 define("_toStudent", "Al estudiante");
 define("_toPrimaryEmergencyContact", "Al contacto de emergencia primario");
 define("_toSecondaryEmergencyContact", "Al contacto de emergencia secundario");
@@ -1883,12 +1880,10 @@
 define("_eC", "CE");
 define("_whoHasCompletedAllTheAcademic", "Quién ha completado todos los estudios académicos");
 define("_requirementsFor", "requisitos para");
-define("_honorRoll", "Cuadro de honor");
-define("_total", "Total");
-define("_academicProbationPleaseBeRemindedOfSectionOfTheAcademicHandbooKIfStudentsFailToRaiseTheirCGPAAboveForTwoConsecutiveSemestersTheDefaultActionIsDismissalFromTheProgram", "PERÍODO ACADÉMICO DE PRUEBA
-         Please be reminded of Section 2.3.6 of the Academic Handbook:
-         If students fail to raise their CGPA above 3.0 for two consecutive semesters
-         the default action is dismissal from the Program");
+define("_academicProbation", "PERÍODO ACADÉMICO DE PRUEBA");
+define("_pleaseBeRemindedOfSection_2_3_6OfTheAcademicHandbook", "Por favor avisen de la Sección 2.3.6 de la Guía Académica:");
+define("_ifStudentsFailToRaiseTheirCgpaAbove_3_0ForTwoConsecutiveSemestersTheDefaultActionIsDismissalFromTheProgram", "Si los estudiantes no elevar su CGPA por encima de 3,0 durante dos semestres consecutivos la acción predeterminada es baja en el Programa");
+
 
 define("_dateOfBirthh", "Fecha de nacimiento");
 define("_notRequested", "No solicitado");
@@ -1931,4 +1926,8 @@
 define("_yourCurrentPasswordWasIncorrect", "Tu contraseña actual es incorrecta");
 define("_yourCurrentPasswordCanNotBeBlank", "Tu contraseña actual no puede estar en blanco");
 define("_yourNewPasswordWasSaved", "Tu nuevo pord fue savedassw");
+
+define("_cannotGeneratePagination", "No se puede generar la paginación!");
+define("_outOf", "fuera de");
+define("_entries", "entradas");
 ?>
\ No newline at end of file

--- lang/lang_fr.php ---
@@ -372,7 +372,7 @@
 define("_to", "À");
 define("_assignedDate", "date de Assigned");
 define("_ueDated", "UeDated");
-
+define("_powered By", "Powered By");
 define("_listOfEvents", "Liste des événements");
 define("_noCalendarsWereFound", "Aucun calendrier n'a été trouvé.");
 define("_weekdays", "Jours de la semaine");
@@ -478,7 +478,7 @@
 define("_studentSchedulesReport", "Rapport sur les horaires des étudiants");
 //PRINT CATALOG TERM
 define("_noCoursesAreFoundInThisTerm", "Aucun cours n'est trouvé dans ce terme");
-
+define("_printt", "Impression");
 define("_reportGeneratedFor", "Rapport généré pour");
 define("_term", "Terme");
 //Print ALL COURSES
@@ -493,12 +493,17 @@
 define("_reAssignmentRecord", "Dossier de réaffectation");
 define("_reAssignmentRecords", "Registres de réaffectation");
 //STUDENTS
+define("_allFilesAreSuccessfullyUploaded", "Tous les fichiers sont téléchargés avec succès");
+define("_1File", "1 fichier");
+define("_cannotBeUploadedBecauseOfInvalidFileType", "ne peut pas être téléchargé en raison du type de fichier non valide");
+define("_cannotBeUploadedBecauseOfInvalidPermission", "ne peut pas être téléchargé à cause de l'autorisation non valide");
+define("_toUploadAdditionalFilesClickBrowseSelectFileAndClickSave", "Pour télécharger des fichiers supplémentaires, cliquez sur Parcourir, sélectionnez le fichier et cliquez sur Enregistrer");
+define("_browse", "Feuilleter");
 define("_custom", "Douane");
 define("_disabilityDescription", "description de l'invalidité");
 define("_streetAddress", "Adresse de rue");
 define("_find", "Trouver");
 define("_any", "Tout");
-define("_rollingRetentionOptions", "Roulement de rétention / Options");
 define("_selectedStudentsAreSuccessfullyReEnrolled", "Les étudiants sélectionnés sont re avec succès inscrits");
 define("_additionalInfo", "Information additionnelle");
 define("_requestArray", "demande tableau");
@@ -508,6 +513,7 @@
 define("_selectMultipleChoices", "Sélectionnez Choix multiples");
 define("_filter", "filtre");
 define("_filters", "filtres");
+define("_edit", "Éditer");
 define("_goal", "objectif");
 define("_progress", "Le progrès");
 define("_progresses", "progresse");
@@ -715,7 +721,6 @@
 define("_birthdate", "Date de naissance");
 define("_primaryLanguage", "Langue principale");
 define("_custodyOfStudent", "La garde des étudiants");
-
 define("_dateMedicalNotes", "Date (Notes médicales)");
 define("_typeImmunizations", "Type (immunisations)");
 define("_dateImmunizations", "Date (immunisations)");
@@ -880,6 +885,7 @@
 define("_cannotBeReenrolledBecauseReenrollDateAndDropDateAreSameOrReenrollmentDateIsBeforeEndDate", "ne peut pas être réincorporés parce que la date de réinscrire et la date de dépôt sont les mêmes ou la date de réinscription est avant la date de fin.");
 define("_selectImageFile", "Sélectionnez le fichier d'image");
 define("_wellDone", "Bien joué");
+define("_fileUploadedSuccessfull", "Fichier téléchargé avec succès");
 define("_maximumUploadFileSize_10Mb", "Taille du fichier de téléchargement maximum 10 Mo");
 define("_pleaseSelectAStudentFirst", "S'il vous plaît choisir un étudiant de première");
 define("_removeParent", "Supprimer Parent");
@@ -904,6 +910,9 @@
 define("_nurseVisits", "Visites infirmières");
 //USERS
 define("_forDatesYyyyMmDdForCheckboxesYAmpForLongTextItWillBeIgnored", "pour les dates: AAAA-MM-JJ, pour les cases à cocher: O et pour le texte long, il sera ignoré");
+define("_newStaffField", "Nouveau personnel de terrain");
+define("_includeShouldBeLeftBlankForMostCategories", "Inclure (doit être laissée en blanc pour la plupart des catégories)");
+define("_forDatesYyyyMmDdForCheckboxesYAmpForLongTextItWillBeIgnored", "pour les dates: AAAA-MM-JJ, pour: Y & cases à cocher pour long texte, il sera ignoré");
 define("_newUserField", "Nouveau champ utilisateur");
 define("_staffs", "personnel");
 define("_newStaffFieldCategory", "Nouvelle catégorie de champ de personnel");
@@ -1004,9 +1013,6 @@
 define("_enterExtracurricular", "Entrez parascolaire");
 define("_noAccess", "Pas d accès");
 //SCHEDULING
-define("_forDatesYyyyMmDdForCheckboxesY", "pour les dates: AAAA-MM-JJ, pour les cases à cocher: O");
-define("_newStaffField", "Nouveau champ de personnel");
-define("_includeShouldBeLeftBlankForMostCategories", "Inclure (doit être laissé vide pour la plupart des catégories)");
 define("_assignedDateCanNotBeLesserThanTodaysDate", "date assignée ne peut être inférieure à la date d'aujourd'hui");
 define("_hello", "Bonjour");
 define("_youReNotAllowedToUseThisProgram", "Vous n'êtes pas autorisé à utiliser ce programme");
@@ -1128,7 +1134,7 @@
 //*****REPORTS*****//
 define("_noSubjectWasFound", "Aucun sujet n'a été trouvé.");
 define("_1SubjectWasFound", "1 Objet a été trouvé.");
-
+define("_subjectsWereFound.", "Les sujets ont été trouvés.");
 define("_schoolwideScheduleReport", "Rapport Schoolwide annexe");
 define("_subjectTeacher", "Professeur de matières");
 define("_noCoursePeriodFound", "Non Période cours trouvé.");
@@ -1207,22 +1213,17 @@
 //ATTENDANCE
 define("_attendanceIsAlreadyTakenForTheStudentsOnSelectedDayAndPeriod", "La fréquentation est déjà prise pour les étudiants le jour et la période sélectionnés.");
 define("_thisStudentHasNoContactInformation", "Cet étudiant n'a pas d'informations de contact");
-define("_openSisStudentInformationSystem", "openSIS Système d'information scolaire");
 define("_studentGrades", "Grades étudiants");
 define("_configuration", "Configuration");
 define("_associatedParents", "Les parents associés");
 define("_backToMissingAttendanceList", "Retour à la liste de présence manquante");
-define("_student", "Étudiant");
-define("_studentId", "Carte d'étudiant");
-define("_grade", "Classe");
 define("_teachersHaveMissingAttendanceData", "Les enseignants ont les données manquantes de fréquentation");
 define("_youHaveTakenAttendanceTodayForThisPeriod", "Vous avez pris aujourd'hui la participation pour cette période");
 define("_secondaryTeacherHasTakenAttendanceTodayForThisPeriod", "enseignant du secondaire a pris aujourd'hui la participation pour cette période");
 define("_primaryTeacherHasTakenAttendanceTodayForThisPeriod", "enseignant primaire a pris aujourd'hui la participation pour cette période");
 define("_youAreNotCurrentlyInAMarkingPeriod", "Vous n'êtes pas actuellement dans une période de notation");
 define("_thereIsAConflict", "Il y a un conflit");
 define("_youCannotAddThisCoursePeriod", "Vous ne pouvez pas ajouter cette période de cours");
-define("_checkingSchedulePleaseWait", "Vérification de calendrier Attendez S'il vous plaît");
 define("_officialInformation", "Informations officielles");
 define("_useLastYearsIfMissing", "Utilisez dernières années manquantes Si");
 define("_allTheGradesWithRespectToThisAssignmentWillBeDeleted", "Tous les grades par rapport à cette cession seront supprimés");
@@ -1231,14 +1232,12 @@
 define("_duplicateStudentFound", "Trouvé étudiant en double");
 define("_thereIsAlreadyAStudentWithTheSameInformation", "Il existe déjà un étudiant avec les mêmes informations");
 define("_doYouWantToProceed", "Voulez-vous poursuivre");
-define("_duplicateFileFound", "Les fichiers en double Trouvées");
 define("_thereIsAlreadyAFileWithTheSameName", "Il existe déjà un fichier avec le même nom");
 define("_addGroupMember", "Ajouter un membre Groupe");
 define("_member", "Membre");
 define("_selectSubject", "Sélectionnez Objet");
 define("_selectCourse", "Sélectionnez Cours");
 define("_noRecordsWereFound", "Aucun enregistrement n'a été trouvé");
-define("_date", "Date");
 define("_present", "Présent");
 define("_adminOfficeComment", "Admin & Office Commentaire");
 define("_teacherComment", "Commentaire enseignant");
@@ -1248,10 +1247,8 @@
 define("_addNewContact", "Ajouter un nouveau contact");
 define("_cannotDeleteBecauseAttendanceCodesAreAssociated", "Impossible de supprimer car les codes de présence sont associés");
 define("_studentsList", "liste des étudiants");
-define('LANG_RECORDS_ADDED_CONFIRMATION', 'Absence records were added for the selected students.');
-define('LANG_CHOOSE_STUDENT_ERROR', 'You must choose at least one period and one student.');
-define('LANG_ABSENCE_CODE', 'Absence Code');
-define('LANG_ABSENCE_REASON', 'Absence Reason');
+define("_absenceRecordsWereAddedForTheSelectedStudents", "Des enregistrements d'absence ont été ajoutés pour les étudiants sélectionnés.");
+define("_youMustChooseAtLeastOnePeriodAndOneStudent", "Vous devez choisir au moins une période et un étudiant.");
 define("_attendanceRecords", "Records de fréquentation");
 define("_attendanceRecord", "Registre de présence");
 define("_avgAttendance", "La fréquentation moyenne");
@@ -1276,7 +1273,6 @@
 define("_recalculateDailyAttendance", "La fréquentation quotidienne recalcul");
 define("_deleteDuplicateAttendance", "Supprimer présence en double");
 define("_teacherSEntry", "Enseignant 'entrée s");
-define("_thisStudentHasNoContactInformation", "Cet étudiant n'a pas d'informations de contact");
 define("_unableToAddAbsenceRecordsFor", "Impossible d'ajouter des enregistrements d'absence pour");
 define("_addAbsenceToPeriods", "Ajouter absence aux périodes");
 define("_absenceCode", "Code d'absence");
@@ -1299,7 +1295,6 @@
 define("_attendanceStatus", "Statut de présence");
 define("_totalAttendance", "La fréquentation totale");
 define("_daysPossible", "jours possibles");
-define("_present", "Présent");
 define("_absent", "Absent");
 define("_ada", "ADA");
 define("_absences", "Absences");
@@ -1387,6 +1382,7 @@
 define("_asTheyDonTExist", "car ils n'existent pas");
 define("_doesnTExist", "n'existe pas");
 //TOOLS
+define("_savingDatabaseForBackupBeforeRolloverPleaseDonotClickAnywhere", "base de données pour l'enregistrement de sauvegarde avant de survol, s'il vous plaît DONOT Cliquez avec le bouton");
 define("_customFieldType", "Type de champ personnalisé");
 define("_customFieldName", "Champ Personnalisable Nom");
 define("_options", "options");
@@ -1488,12 +1484,12 @@
 define("_gradeReportingIsOpenForThisMarkingPeriodYouCanEditTheseGrades", "rapport qualité est ouvert pour cette période de marquage. Vous pouvez modifier ces notes.");
 define("_assignPercents", "ASSIGN POURCENTS");
 define("_getGradebookGrades", "Obtenir les notes du carnet de notes");
+define("_get", "Avoir");
 define("_clearAll", "TOUT EFFACER");
 define("_percent", "Pour cent");
 define("_assignGrade", "Assigner année");
 define("_noAssignmentsWereFound", "Aucune missions ont été trouvés.");
 define("_progresReports", "Rapports Progres");
-
 define("_excludeUngradedECAssignments", "Exclure de missions non classés E / C");
 define("_excludeUngradedAssignmentsNotDue", "Exclure ungraded missions non échu");
 define("_theSelectedDateIsNotInASchoolQuarter", "La date choisie est pas dans un quartier de l'école.");
@@ -1560,7 +1556,6 @@
 define("_thu", "Jeu");
 define("_fri", "Ven");
 define("_sat", "Sam");
-define("_youMustChooseAtLeastOnePeriodAndOneStudent", "Vous devez choisir au moins une période et un étudiant.");
 define("_tryAgain", "RÉESSAYER");
 define("_noAttendanceRecordsWereFound", "Aucun enregistrement de présence n'a été trouvé.");
 define("_attendancePossible", "participation possible");
@@ -1636,11 +1631,9 @@
 define("_availableSchoolFields", "Champs disponibles école");
 define("_creatReportForInstitutes", "CREAT RAPPORT POUR LES INSTITUTS");
 define("_noCustomFieldsWereFound", "Non Les champs personnalisés ont été trouvés.");
-define("_customFields", "Les champs personnalisés");
 define("_homeroom", "Homeroom");
 define("_secondaryLanguage", "Langue secondaire");
 //----------------------------------------------------------------------------------------------------------
-define("_première", "première");
 define("_disableUser", "Désactiver l'utilisateur");
 define("_includeDisabledUser", "Inclure les personnes handicapées utilisateur");
 define("_thisStaffIsNotScheduledToAnyCoursePeriodAndThereforeNoScheduleDataIsAvailable", "Ce personnel ne devrait une période de cours et, par conséquent, aucune donnée est disponible calendrier");
@@ -1660,7 +1653,7 @@
 define("_ageSearch", "âge Recherche");
 define("_advancedFilter", "Filtre avancé");
 define("_closeAdvancedFilter", "Fermer Filtre avancé");
-
+define("_didNotRecieve", "N'a pas reçu");
 define("_toStudent", "pour l'étudiant");
 define("_toPrimaryEmergencyContact", "En cas d'urgence à l'enseignement primaire");
 define("_toSecondaryEmergencyContact", "En cas d'urgence au secondaire");
@@ -1856,7 +1849,6 @@
 define("_noContactsWereFound", "Aucun contact n'a été trouvé");
 define("_goalDetails", "Détails de l'objectif");
 define("_las", "Las");
-
 define("_nonTeachingStaff", "Non personnel enseignant");
 define("_custodian", "Gardien");
 define("_clerk", "Employé de bureau");
@@ -1882,12 +1874,9 @@
 define("_eC", "E/C");
 define("_whoHasCompletedAllTheAcademic", "Qui a terminé tous les universitaires");
 define("_requirementsFor", "exigences pour");
-define("_honorRoll", "Tableau d'honneur");
-define("_total", "Total");
-define("_academicProbationPleaseBeRemindedOfSectionOfTheAcademicHandbooKIfStudentsFailToRaiseTheirCGPAAboveForTwoConsecutiveSemestersTheDefaultActionIsDismissalFromTheProgram", "PROBATION ACADÉMIQUE
-         Veuillez vous rappeler la section 2.3.6 du manuel académique:
-         Si les étudiants ne parviennent pas à augmenter leur MPC au-dessus de 3,0 pendant deux semestres consécutifs
-         l'action par défaut est le rejet du programme");
+define("_academicProbation", "PROBATION ACADÉMIQUE");
+define("_pleaseBeRemindedOfSection_2_3_6OfTheAcademicHandbook", "S'il vous plaît être rappelé de la section 2.3.6 du manuel scolaire:");
+define("_ifStudentsFailToRaiseTheirCgpaAbove_3_0ForTwoConsecutiveSemestersTheDefaultActionIsDismissalFromTheProgram", "Si les élèves ne parviennent pas à élever leur ACMG au-dessus de 3,0 pour deux semestres consécutifs l'action par défaut est le renvoi du programme");
 
 define("_dateOfBirthh", "Date de naissance");
 define("_notRequested", "Non demandé");
@@ -1930,4 +1919,8 @@
 define("_yourCurrentPasswordWasIncorrect", "Votre mot de passe actuel est incorrect");
 define("_yourCurrentPasswordCanNotBeBlank", "Votre mot de passe actuel ne peut pas être vide");
 define("_yourNewPasswordWasSaved", "Votre nouveau mot de passe a été enregistré");
+
+define("_cannotGeneratePagination", "Impossible de générer la pagination!");
+define("_outOf", "hors de");
+define("_entries", "entrées");
 ?>
\ No newline at end of file

--- libraries/htmlpurifier/.gitattributes ---
@@ -0,0 +1,23 @@
+/.gitattributes export-ignore
+/.gitignore export-ignore
+/.travis.yml export-ignore
+/art export-ignore
+/benchmarks export-ignore
+/configdoc export-ignore
+/configdoc/usage.xml -crlf
+/docs export-ignore
+/Doxyfile export-ignore
+/extras export-ignore
+/INSTALL* export-ignore
+/maintenance export-ignore
+/NEWS export-ignore
+/package.php export-ignore
+/plugins export-ignore
+/phpdoc.ini export-ignore
+/smoketests export-ignore
+/test-* export-ignore
+/tests export-ignore
+/TODO export-ignore
+/update-for-release export-ignore
+/WHATSNEW export-ignore
+/WYSIWYG export-ignore

--- libraries/htmlpurifier/.gitignore ---
@@ -0,0 +1,28 @@
+tags
+conf/
+test-settings.php
+config-schema.php
+library/HTMLPurifier/DefinitionCache/Serializer/*/
+library/standalone/
+library/HTMLPurifier.standalone.php
+library/HTMLPurifier*.tgz
+library/package*.xml
+smoketests/test-schema.html
+configdoc/*.html
+configdoc/configdoc.xml
+docs/doxygen*
+*.phpt.diff
+*.phpt.exp
+*.phpt.log
+*.phpt.out
+*.phpt.php
+*.phpt.skip.php
+*.htmlt.ini
+*.patch
+/*.php
+vendor
+composer.lock
+*.rej
+*.orig
+*.bak
+core

--- libraries/htmlpurifier/.travis.yml ---
@@ -0,0 +1,19 @@
+language: php
+php:
+    - '5.6'
+    - '7.0'
+    - '7.1'
+    - '7.2'
+    - '7.3'
+    - '7.4'
+matrix:
+    include:
+        - php: '5.4'
+          dist: trusty
+        - php: '5.5'
+          dist: trusty
+before_script:
+    - git clone --depth=50 https://github.com/ezyang/simpletest.git
+    - cp test-settings.travis.php test-settings.php
+script:
+    - php tests/index.php

--- libraries/htmlpurifier/CREDITS ---
@@ -0,0 +1,9 @@
+
+CREDITS
+
+Almost everything written by Edward Z. Yang (Ambush Commander).  Lots of thanks
+to the DevNetwork Community for their help (see docs/ref-devnetwork.html for
+more details), Feyd especially (namely IPv6 and optimization).  Thanks to RSnake
+for letting me package his fantastic XSS cheatsheet for a smoketest.
+
+    vim: et sw=4 sts=4

--- libraries/htmlpurifier/Doxyfile ---
@@ -0,0 +1,1317 @@
+# Doxyfile 1.5.3
+
+# This file describes the settings to be used by the documentation system
+# doxygen (www.doxygen.org) for a project
+#
+# All text after a hash (#) is considered a comment and will be ignored
+# The format is:
+#       TAG = value [value, ...]
+# For lists items can also be appended using:
+#       TAG += value [value, ...]
+# Values that contain spaces should be placed between quotes (" ")
+
+#---------------------------------------------------------------------------
+# Project related configuration options
+#---------------------------------------------------------------------------
+
+# This tag specifies the encoding used for all characters in the config file that
+# follow. The default is UTF-8 which is also the encoding used for all text before
+# the first occurrence of this tag. Doxygen uses libiconv (or the iconv built into
+# libc) for the transcoding. See http://www.gnu.org/software/libiconv for the list of
+# possible encodings.
+
+DOXYFILE_ENCODING      = UTF-8
+
+# The PROJECT_NAME tag is a single word (or a sequence of words surrounded
+# by quotes) that should identify the project.
+
+PROJECT_NAME           = HTMLPurifier
+
+# The PROJECT_NUMBER tag can be used to enter a project or revision number.
+# This could be handy for archiving the generated documentation or
+# if some version control system is used.
+
+PROJECT_NUMBER         = 4.13.0
+
+# The OUTPUT_DIRECTORY tag is used to specify the (relative or absolute)
+# base path where the generated documentation will be put.
+# If a relative path is entered, it will be relative to the location
+# where doxygen was started. If left blank the current directory will be used.
+
+OUTPUT_DIRECTORY       = "docs/doxygen "
+
+# If the CREATE_SUBDIRS tag is set to YES, then doxygen will create
+# 4096 sub-directories (in 2 levels) under the output directory of each output
+# format and will distribute the generated files over these directories.
+# Enabling this option can be useful when feeding doxygen a huge amount of
+# source files, where putting all generated files in the same directory would
+# otherwise cause performance problems for the file system.
+
+CREATE_SUBDIRS         = NO
+
+# The OUTPUT_LANGUAGE tag is used to specify the language in which all
+# documentation generated by doxygen is written. Doxygen will use this
+# information to generate all constant output in the proper language.
+# The default language is English, other supported languages are:
+# Afrikaans, Arabic, Brazilian, Catalan, Chinese, Chinese-Traditional,
+# Croatian, Czech, Danish, Dutch, Finnish, French, German, Greek, Hungarian,
+# Italian, Japanese, Japanese-en (Japanese with English messages), Korean,
+# Korean-en, Lithuanian, Norwegian, Polish, Portuguese, Romanian, Russian,
+# Serbian, Slovak, Slovene, Spanish, Swedish, and Ukrainian.
+
+OUTPUT_LANGUAGE        = English
+
+# If the BRIEF_MEMBER_DESC tag is set to YES (the default) Doxygen will
+# include brief member descriptions after the members that are listed in
+# the file and class documentation (similar to JavaDoc).
+# Set to NO to disable this.
+
+BRIEF_MEMBER_DESC      = YES
+
+# If the REPEAT_BRIEF tag is set to YES (the default) Doxygen will prepend
+# the brief description of a member or function before the detailed description.
+# Note: if both HIDE_UNDOC_MEMBERS and BRIEF_MEMBER_DESC are set to NO, the
+# brief descriptions will be completely suppressed.
+
+REPEAT_BRIEF           = YES
+
+# This tag implements a quasi-intelligent brief description abbreviator
+# that is used to form the text in various listings. Each string
+# in this list, if found as the leading text of the brief description, will be
+# stripped from the text and the result after processing the whole list, is
+# used as the annotated text. Otherwise, the brief description is used as-is.
+# If left blank, the following values are used ("$name" is automatically
+# replaced with the name of the entity): "The $name class" "The $name widget"
+# "The $name file" "is" "provides" "specifies" "contains"
+# "represents" "a" "an" "the"
+
+ABBREVIATE_BRIEF       = "The $name class " \
+                         "The $name widget " \
+                         "The $name file " \
+                         is \
+                         provides \
+                         specifies \
+                         contains \
+                         represents \
+                         a \
+                         an \
+                         the
+
+# If the ALWAYS_DETAILED_SEC and REPEAT_BRIEF tags are both set to YES then
+# Doxygen will generate a detailed section even if there is only a brief
+# description.
+
+ALWAYS_DETAILED_SEC    = NO
+
+# If the INLINE_INHERITED_MEMB tag is set to YES, doxygen will show all
+# inherited members of a class in the documentation of that class as if those
+# members were ordinary class members. Constructors, destructors and assignment
+# operators of the base classes will not be shown.
+
+INLINE_INHERITED_MEMB  = NO
+
+# If the FULL_PATH_NAMES tag is set to YES then Doxygen will prepend the full
+# path before files name in the file list and in the header files. If set
+# to NO the shortest path that makes the file name unique will be used.
+
+FULL_PATH_NAMES        = YES
+
+# If the FULL_PATH_NAMES tag is set to YES then the STRIP_FROM_PATH tag
+# can be used to strip a user-defined part of the path. Stripping is
+# only done if one of the specified strings matches the left-hand part of
+# the path. The tag can be used to show relative paths in the file list.
+# If left blank the directory from which doxygen is run is used as the
+# path to strip.
+
+STRIP_FROM_PATH        = "C:/Users/Edward/Webs/htmlpurifier " \
+                         "C:/Documents and Settings/Edward/My Documents/My Webs/htmlpurifier "
+
+# The STRIP_FROM_INC_PATH tag can be used to strip a user-defined part of
+# the path mentioned in the documentation of a class, which tells
+# the reader which header file to include in order to use a class.
+# If left blank only the name of the header file containing the class
+# definition is used. Otherwise one should specify the include paths that
+# are normally passed to the compiler using the -I flag.
+
+STRIP_FROM_INC_PATH    =
+
+# If the SHORT_NAMES tag is set to YES, doxygen will generate much shorter
+# (but less readable) file names. This can be useful is your file systems
+# doesn't support long names like on DOS, Mac, or CD-ROM.
+
+SHORT_NAMES            = NO
+
+# If the JAVADOC_AUTOBRIEF tag is set to YES then Doxygen
+# will interpret the first line (until the first dot) of a JavaDoc-style
+# comment as the brief description. If set to NO, the JavaDoc
+# comments will behave just like regular Qt-style comments
+# (thus requiring an explicit @brief command for a brief description.)
+
+JAVADOC_AUTOBRIEF      = YES
+
+# If the QT_AUTOBRIEF tag is set to YES then Doxygen will
+# interpret the first line (until the first dot) of a Qt-style
+# comment as the brief description. If set to NO, the comments
+# will behave just like regular Qt-style comments (thus requiring
+# an explicit \brief command for a brief description.)
+
+QT_AUTOBRIEF           = NO
+
+# The MULTILINE_CPP_IS_BRIEF tag can be set to YES to make Doxygen
+# treat a multi-line C++ special comment block (i.e. a block of //! or ///
+# comments) as a brief description. This used to be the default behaviour.
+# The new default is to treat a multi-line C++ comment block as a detailed
+# description. Set this tag to YES if you prefer the old behaviour instead.
+
+MULTILINE_CPP_IS_BRIEF = NO
+
+# If the DETAILS_AT_TOP tag is set to YES then Doxygen
+# will output the detailed description near the top, like JavaDoc.
+# If set to NO, the detailed description appears after the member
+# documentation.
+
+DETAILS_AT_TOP         = NO
+
+# If the INHERIT_DOCS tag is set to YES (the default) then an undocumented
+# member inherits the documentation from any documented member that it
+# re-implements.
+
+INHERIT_DOCS           = YES
+
+# If the SEPARATE_MEMBER_PAGES tag is set to YES, then doxygen will produce
+# a new page for each member. If set to NO, the documentation of a member will
+# be part of the file/class/namespace that contains it.
+
+SEPARATE_MEMBER_PAGES  = NO
+
+# The TAB_SIZE tag can be used to set the number of spaces in a tab.
+# Doxygen uses this value to replace tabs by spaces in code fragments.
+
+TAB_SIZE               = 4
+
+# This tag can be used to specify a number of aliases that acts
+# as commands in the documentation. An alias has the form "name=value".
+# For example adding "sideeffect=\par Side Effects:\n" will allow you to
+# put the command \sideeffect (or @sideeffect) in the documentation, which
+# will result in a user-defined paragraph with heading "Side Effects:".
+# You can put \n's in the value part of an alias to insert newlines.
+
+ALIASES                =
+
+# Set the OPTIMIZE_OUTPUT_FOR_C tag to YES if your project consists of C
+# sources only. Doxygen will then generate output that is more tailored for C.
+# For instance, some of the names that are used will be different. The list
+# of all members will be omitted, etc.
+
+OPTIMIZE_OUTPUT_FOR_C  = NO
+
+# Set the OPTIMIZE_OUTPUT_JAVA tag to YES if your project consists of Java
+# sources only. Doxygen will then generate output that is more tailored for Java.
+# For instance, namespaces will be presented as packages, qualified scopes
+# will look different, etc.
+
+OPTIMIZE_OUTPUT_JAVA   = NO
+
+# If you use STL classes (i.e. std::string, std::vector, etc.) but do not want to
+# include (a tag file for) the STL sources as input, then you should
+# set this tag to YES in order to let doxygen match functions declarations and
+# definitions whose arguments contain STL classes (e.g. func(std::string); v.s.
+# func(std::string) {}). This also make the inheritance and collaboration
+# diagrams that involve STL classes more complete and accurate.
+
+BUILTIN_STL_SUPPORT    = NO
+
+# If you use Microsoft's C++/CLI language, you should set this option to YES to
+# enable parsing support.
+
+CPP_CLI_SUPPORT        = NO
+
+# If member grouping is used in the documentation and the DISTRIBUTE_GROUP_DOC
+# tag is set to YES, then doxygen will reuse the documentation of the first
+# member in the group (if any) for the other members of the group. By default
+# all members of a group must be documented explicitly.
+
+DISTRIBUTE_GROUP_DOC   = NO
+
+# Set the SUBGROUPING tag to YES (the default) to allow class member groups of
+# the same type (for instance a group of public functions) to be put as a
+# subgroup of that type (e.g. under the Public Functions section). Set it to
+# NO to prevent subgrouping. Alternatively, this can be done per class using
+# the \nosubgrouping command.
+
+SUBGROUPING            = YES
+
+#---------------------------------------------------------------------------
+# Build related configuration options
+#---------------------------------------------------------------------------
+
+# If the EXTRACT_ALL tag is set to YES doxygen will assume all entities in
+# documentation are documented, even if no documentation was available.
+# Private class members and static file members will be hidden unless
+# the EXTRACT_PRIVATE and EXTRACT_STATIC tags are set to YES
+
+EXTRACT_ALL            = YES
+
+# If the EXTRACT_PRIVATE tag is set to YES all private members of a class
+# will be included in the documentation.
+
+EXTRACT_PRIVATE        = YES
+
+# If the EXTRACT_STATIC tag is set to YES all static members of a file
+# will be included in the documentation.
+
+EXTRACT_STATIC         = YES
+
+# If the EXTRACT_LOCAL_CLASSES tag is set to YES classes (and structs)
+# defined locally in source files will be included in the documentation.
+# If set to NO only classes defined in header files are included.
+
+EXTRACT_LOCAL_CLASSES  = YES
+
+# This flag is only useful for Objective-C code. When set to YES local
+# methods, which are defined in the implementation section but not in
+# the interface are included in the documentation.
+# If set to NO (the default) only methods in the interface are included.
+
+EXTRACT_LOCAL_METHODS  = NO
+
+# If this flag is set to YES, the members of anonymous namespaces will be extracted
+# and appear in the documentation as a namespace called 'anonymous_namespace{file}',
+# where file will be replaced with the base name of the file that contains the anonymous
+# namespace. By default anonymous namespace are hidden.
+
+EXTRACT_ANON_NSPACES   = NO
+
+# If the HIDE_UNDOC_MEMBERS tag is set to YES, Doxygen will hide all
+# undocumented members of documented classes, files or namespaces.
+# If set to NO (the default) these members will be included in the
+# various overviews, but no documentation section is generated.
+# This option has no effect if EXTRACT_ALL is enabled.
+
+HIDE_UNDOC_MEMBERS     = NO
+
+# If the HIDE_UNDOC_CLASSES tag is set to YES, Doxygen will hide all
+# undocumented classes that are normally visible in the class hierarchy.
+# If set to NO (the default) these classes will be included in the various
+# overviews. This option has no effect if EXTRACT_ALL is enabled.
+
+HIDE_UNDOC_CLASSES     = NO
+
+# If the HIDE_FRIEND_COMPOUNDS tag is set to YES, Doxygen will hide all
+# friend (class|struct|union) declarations.
+# If set to NO (the default) these declarations will be included in the
+# documentation.
+
+HIDE_FRIEND_COMPOUNDS  = NO
+
+# If the HIDE_IN_BODY_DOCS tag is set to YES, Doxygen will hide any
+# documentation blocks found inside the body of a function.
+# If set to NO (the default) these blocks will be appended to the
+# function's detailed documentation block.
+
+HIDE_IN_BODY_DOCS      = NO
+
+# The INTERNAL_DOCS tag determines if documentation
+# that is typed after a \internal command is included. If the tag is set
+# to NO (the default) then the documentation will be excluded.
+# Set it to YES to include the internal documentation.
+
+INTERNAL_DOCS          = NO
+
+# If the CASE_SENSE_NAMES tag is set to NO then Doxygen will only generate
+# file names in lower-case letters. If set to YES upper-case letters are also
+# allowed. This is useful if you have classes or files whose names only differ
+# in case and if your file system supports case sensitive file names. Windows
+# and Mac users are advised to set this option to NO.
+
+CASE_SENSE_NAMES       = YES
+
+# If the HIDE_SCOPE_NAMES tag is set to NO (the default) then Doxygen
+# will show members with their full class and namespace scopes in the
+# documentation. If set to YES the scope will be hidden.
+
+HIDE_SCOPE_NAMES       = NO
+
+# If the SHOW_INCLUDE_FILES tag is set to YES (the default) then Doxygen
+# will put a list of the files that are included by a file in the documentation
+# of that file.
+
+SHOW_INCLUDE_FILES     = YES
+
+# If the INLINE_INFO tag is set to YES (the default) then a tag [inline]
+# is inserted in the documentation for inline members.
+
+INLINE_INFO            = YES
+
+# If the SORT_MEMBER_DOCS tag is set to YES (the default) then doxygen
+# will sort the (detailed) documentation of file and class members
+# alphabetically by member name. If set to NO the members will appear in
+# declaration order.
+
+SORT_MEMBER_DOCS       = YES
+
+# If the SORT_BRIEF_DOCS tag is set to YES then doxygen will sort the
+# brief documentation of file, namespace and class members alphabetically
+# by member name. If set to NO (the default) the members will appear in
+# declaration order.
+
+SORT_BRIEF_DOCS        = NO
+
+# If the SORT_BY_SCOPE_NAME tag is set to YES, the class list will be
+# sorted by fully-qualified names, including namespaces. If set to
+# NO (the default), the class list will be sorted only by class name,
+# not including the namespace part.
+# Note: This option is not very useful if HIDE_SCOPE_NAMES is set to YES.
+# Note: This option applies only to the class list, not to the
+# alphabetical list.
+
+SORT_BY_SCOPE_NAME     = NO
+
+# The GENERATE_TODOLIST tag can be used to enable (YES) or
+# disable (NO) the todo list. This list is created by putting \todo
+# commands in the documentation.
+
+GENERATE_TODOLIST      = YES
+
+# The GENERATE_TESTLIST tag can be used to enable (YES) or
+# disable (NO) the test list. This list is created by putting \test
+# commands in the documentation.
+
+GENERATE_TESTLIST      = YES
+
+# The GENERATE_BUGLIST tag can be used to enable (YES) or
+# disable (NO) the bug list. This list is created by putting \bug
+# commands in the documentation.
+
+GENERATE_BUGLIST       = YES
+
+# The GENERATE_DEPRECATEDLIST tag can be used to enable (YES) or
+# disable (NO) the deprecated list. This list is created by putting
+# \deprecated commands in the documentation.
+
+GENERATE_DEPRECATEDLIST= YES
+
+# The ENABLED_SECTIONS tag can be used to enable conditional
+# documentation sections, marked by \if sectionname ... \endif.
+
+ENABLED_SECTIONS       =
+
+# The MAX_INITIALIZER_LINES tag determines the maximum number of lines
+# the initial value of a variable or define consists of for it to appear in
+# the documentation. If the initializer consists of more lines than specified
+# here it will be hidden. Use a value of 0 to hide initializers completely.
+# The appearance of the initializer of individual variables and defines in the
+# documentation can be controlled using \showinitializer or \hideinitializer
+# command in the documentation regardless of this setting.
+
+MAX_INITIALIZER_LINES  = 30
+
+# Set the SHOW_USED_FILES tag to NO to disable the list of files generated
+# at the bottom of the documentation of classes and structs. If set to YES the
+# list will mention the files that were used to generate the documentation.
+
+SHOW_USED_FILES        = YES
+
+# If the sources in your project are distributed over multiple directories
+# then setting the SHOW_DIRECTORIES tag to YES will show the directory hierarchy
+# in the documentation. The default is NO.
+
+SHOW_DIRECTORIES       = NO
+
+# The FILE_VERSION_FILTER tag can be used to specify a program or script that
+# doxygen should invoke to get the current version for each file (typically from the
+# version control system). Doxygen will invoke the program by executing (via
+# popen()) the command <command> <input-file>, where <command> is the value of
+# the FILE_VERSION_FILTER tag, and <input-file> is the name of an input file
+# provided by doxygen. Whatever the program writes to standard output
+# is used as the file version. See the manual for examples.
+
+FILE_VERSION_FILTER    =
+
+#---------------------------------------------------------------------------
+# configuration options related to warning and progress messages
+#---------------------------------------------------------------------------
+
+# The QUIET tag can be used to turn on/off the messages that are generated
+# by doxygen. Possible values are YES and NO. If left blank NO is used.
+
+QUIET                  = NO
+
+# The WARNINGS tag can be used to turn on/off the warning messages that are
+# generated by doxygen. Possible values are YES and NO. If left blank
+# NO is used.
+
+WARNINGS               = YES
+
+# If WARN_IF_UNDOCUMENTED is set to YES, then doxygen will generate warnings
+# for undocumented members. If EXTRACT_ALL is set to YES then this flag will
+# automatically be disabled.
+
+WARN_IF_UNDOCUMENTED   = YES
+
+# If WARN_IF_DOC_ERROR is set to YES, doxygen will generate warnings for
+# potential errors in the documentation, such as not documenting some
+# parameters in a documented function, or documenting parameters that
+# don't exist or using markup commands wrongly.
+
+WARN_IF_DOC_ERROR      = YES
+
+# This WARN_NO_PARAMDOC option can be abled to get warnings for
+# functions that are documented, but have no documentation for their parameters
+# or return value. If set to NO (the default) doxygen will only warn about
+# wrong or incomplete parameter documentation, but not about the absence of
+# documentation.
+
+WARN_NO_PARAMDOC       = NO
+
+# The WARN_FORMAT tag determines the format of the warning messages that
+# doxygen can produce. The string should contain the $file, $line, and $text
+# tags, which will be replaced by the file and line number from which the
+# warning originated and the warning text. Optionally the format may contain
+# $version, which will be replaced by the version of the file (if it could
+# be obtained via FILE_VERSION_FILTER)
+
+WARN_FORMAT            = "$file:$line: $text "
+
+# The WARN_LOGFILE tag can be used to specify a file to which warning
+# and error messages should be written. If left blank the output is written
+# to stderr.
+
+WARN_LOGFILE           =
+
+#---------------------------------------------------------------------------
+# configuration options related to the input files
+#---------------------------------------------------------------------------
+
+# The INPUT tag can be used to specify the files and/or directories that contain
+# documented source files. You may enter file names like "myfile.cpp" or
+# directories like "/usr/src/myproject". Separate the files or directories
+# with spaces.
+
+INPUT                  = ". "
+
+# This tag can be used to specify the character encoding of the source files that
+# doxygen parses. Internally doxygen uses the UTF-8 encoding, which is also the default
+# input encoding. Doxygen uses libiconv (or the iconv built into libc) for the transcoding.
+# See http://www.gnu.org/software/libiconv for the list of possible encodings.
+
+INPUT_ENCODING         = UTF-8
+
+# If the value of the INPUT tag contains directories, you can use the
+# FILE_PATTERNS tag to specify one or more wildcard pattern (like *.cpp
+# and *.h) to filter out the source-files in the directories. If left
+# blank the following patterns are tested:
+# *.c *.cc *.cxx *.cpp *.c++ *.java *.ii *.ixx *.ipp *.i++ *.inl *.h *.hh *.hxx
+# *.hpp *.h++ *.idl *.odl *.cs *.php *.php3 *.inc *.m *.mm *.py
+
+FILE_PATTERNS          = *.php
+
+# The RECURSIVE tag can be used to turn specify whether or not subdirectories
+# should be searched for input files as well. Possible values are YES and NO.
+# If left blank NO is used.
+
+RECURSIVE              = YES
+
+# The EXCLUDE tag can be used to specify files and/or directories that should
+# excluded from the INPUT source files. This way you can easily exclude a
+# subdirectory from a directory tree whose root is specified with the INPUT tag.
+
+EXCLUDE                =
+
+# The EXCLUDE_SYMLINKS tag can be used select whether or not files or
+# directories that are symbolic links (a Unix filesystem feature) are excluded
+# from the input.
+
+EXCLUDE_SYMLINKS       = NO
+
+# If the value of the INPUT tag contains directories, you can use the
+# EXCLUDE_PATTERNS tag to specify one or more wildcard patterns to exclude
+# certain files from those directories. Note that the wildcards are matched
+# against the file with absolute path, so to exclude all test directories
+# for example use the pattern */test/*
+
+EXCLUDE_PATTERNS       = */tests/* \
+                         */benchmarks/* \
+                         */docs/* \
+                         */test-settings.php \
+                         */configdoc/* \
+                         */test-settings.php \
+                         */maintenance/* \
+                         */smoketests/* \
+                         */library/standalone/* \
+                         */.svn* \
+                         */conf/*
+
+# The EXCLUDE_SYMBOLS tag can be used to specify one or more symbol names
+# (namespaces, classes, functions, etc.) that should be excluded from the output.
+# The symbol name can be a fully qualified name, a word, or if the wildcard * is used,
+# a substring. Examples: ANamespace, AClass, AClass::ANamespace, ANamespace::*Test
+
+EXCLUDE_SYMBOLS        =
+
+# The EXAMPLE_PATH tag can be used to specify one or more files or
+# directories that contain example code fragments that are included (see
+# the \include command).
+
+EXAMPLE_PATH           =
+
+# If the value of the EXAMPLE_PATH tag contains directories, you can use the
+# EXAMPLE_PATTERNS tag to specify one or more wildcard pattern (like *.cpp
+# and *.h) to filter out the source-files in the directories. If left
+# blank all files are included.
+
+EXAMPLE_PATTERNS       = *
+
+# If the EXAMPLE_RECURSIVE tag is set to YES then subdirectories will be
+# searched for input files to be used with the \include or \dontinclude
+# commands irrespective of the value of the RECURSIVE tag.
+# Possible values are YES and NO. If left blank NO is used.
+
+EXAMPLE_RECURSIVE      = NO
+
+# The IMAGE_PATH tag can be used to specify one or more files or
+# directories that contain image that are included in the documentation (see
+# the \image command).
+
+IMAGE_PATH             =
+
+# The INPUT_FILTER tag can be used to specify a program that doxygen should
+# invoke to filter for each input file. Doxygen will invoke the filter program
+# by executing (via popen()) the command <filter> <input-file>, where <filter>
+# is the value of the INPUT_FILTER tag, and <input-file> is the name of an
+# input file. Doxygen will then use the output that the filter program writes
+# to standard output.  If FILTER_PATTERNS is specified, this tag will be
+# ignored.
+
+INPUT_FILTER           =
+
+# The FILTER_PATTERNS tag can be used to specify filters on a per file pattern
+# basis.  Doxygen will compare the file name with each pattern and apply the
+# filter if there is a match.  The filters are a list of the form:
+# pattern=filter (like *.cpp=my_cpp_filter). See INPUT_FILTER for further
+# info on how filters are used. If FILTER_PATTERNS is empty, INPUT_FILTER
+# is applied to all files.
+
+FILTER_PATTERNS        =
+
+# If the FILTER_SOURCE_FILES tag is set to YES, the input filter (if set using
+# INPUT_FILTER) will be used to filter the input files when producing source
+# files to browse (i.e. when SOURCE_BROWSER is set to YES).
+
+FILTER_SOURCE_FILES    = NO
+
+#---------------------------------------------------------------------------
+# configuration options related to source browsing
+#---------------------------------------------------------------------------
+
+# If the SOURCE_BROWSER tag is set to YES then a list of source files will
+# be generated. Documented entities will be cross-referenced with these sources.
+# Note: To get rid of all source code in the generated output, make sure also
+# VERBATIM_HEADERS is set to NO. If you have enabled CALL_GRAPH or CALLER_GRAPH
+# then you must also enable this option. If you don't then doxygen will produce
+# a warning and turn it on anyway
+
+SOURCE_BROWSER         = YES
+
+# Setting the INLINE_SOURCES tag to YES will include the body
+# of functions and classes directly in the documentation.
+
+INLINE_SOURCES         = NO
+
+# Setting the STRIP_CODE_COMMENTS tag to YES (the default) will instruct
+# doxygen to hide any special comment blocks from generated source code
+# fragments. Normal C and C++ comments will always remain visible.
+
+STRIP_CODE_COMMENTS    = YES
+
+# If the REFERENCED_BY_RELATION tag is set to YES (the default)
+# then for each documented function all documented
+# functions referencing it will be listed.
+
+REFERENCED_BY_RELATION = YES
+
+# If the REFERENCES_RELATION tag is set to YES (the default)
+# then for each documented function all documented entities
+# called/used by that function will be listed.
+
+REFERENCES_RELATION    = YES
+
+# If the REFERENCES_LINK_SOURCE tag is set to YES (the default)
+# and SOURCE_BROWSER tag is set to YES, then the hyperlinks from
+# functions in REFERENCES_RELATION and REFERENCED_BY_RELATION lists will
+# link to the source code.  Otherwise they will link to the documentstion.
+
+REFERENCES_LINK_SOURCE = YES
+
+# If the USE_HTAGS tag is set to YES then the references to source code
+# will point to the HTML generated by the htags(1) tool instead of doxygen
+# built-in source browser. The htags tool is part of GNU's global source
+# tagging system (see http://www.gnu.org/software/global/global.html). You
+# will need version 4.8.6 or higher.
+
+USE_HTAGS              = NO
+
+# If the VERBATIM_HEADERS tag is set to YES (the default) then Doxygen
+# will generate a verbatim copy of the header file for each class for
+# which an include is specified. Set to NO to disable this.
+
+VERBATIM_HEADERS       = YES
+
+#---------------------------------------------------------------------------
+# configuration options related to the alphabetical class index
+#---------------------------------------------------------------------------
+
+# If the ALPHABETICAL_INDEX tag is set to YES, an alphabetical index
+# of all compounds will be generated. Enable this if the project
+# contains a lot of classes, structs, unions or interfaces.
+
+ALPHABETICAL_INDEX     = NO
+
+# If the alphabetical index is enabled (see ALPHABETICAL_INDEX) then
+# the COLS_IN_ALPHA_INDEX tag can be used to specify the number of columns
+# in which this list will be split (can be a number in the range [1..20])
+
+COLS_IN_ALPHA_INDEX    = 5
+
+# In case all classes in a project start with a common prefix, all
+# classes will be put under the same header in the alphabetical index.
+# The IGNORE_PREFIX tag can be used to specify one or more prefixes that
+# should be ignored while generating the index headers.
+
+IGNORE_PREFIX          =
+
+#---------------------------------------------------------------------------
+# configuration options related to the HTML output
+#---------------------------------------------------------------------------
+
+# If the GENERATE_HTML tag is set to YES (the default) Doxygen will
+# generate HTML output.
+
+GENERATE_HTML          = YES
+
+# The HTML_OUTPUT tag is used to specify where the HTML docs will be put.
+# If a relative path is entered the value of OUTPUT_DIRECTORY will be
+# put in front of it. If left blank `html' will be used as the default path.
+
+HTML_OUTPUT            = html
+
+# The HTML_FILE_EXTENSION tag can be used to specify the file extension for
+# each generated HTML page (for example: .htm,.php,.asp). If it is left blank
+# doxygen will generate files with .html extension.
+
+HTML_FILE_EXTENSION    = .html
+
+# The HTML_HEADER tag can be used to specify a personal HTML header for
+# each generated HTML page. If it is left blank doxygen will generate a
+# standard header.
+
+HTML_HEADER            =
+
+# The HTML_FOOTER tag can be used to specify a personal HTML footer for
+# each generated HTML page. If it is left blank doxygen will generate a
+# standard footer.
+
+HTML_FOOTER            =
+
+# The HTML_STYLESHEET tag can be used to specify a user-defined cascading
+# style sheet that is used by each HTML page. It can be used to
+# fine-tune the look of the HTML output. If the tag is left blank doxygen
+# will generate a default style sheet. Note that doxygen will try to copy
+# the style sheet file to the HTML output directory, so don't put your own
+# stylesheet in the HTML output directory as well, or it will be erased!
+
+HTML_STYLESHEET        =
+
+# If the HTML_ALIGN_MEMBERS tag is set to YES, the members of classes,
+# files or namespaces will be aligned in HTML using tables. If set to
+# NO a bullet list will be used.
+
+HTML_ALIGN_MEMBERS     = YES
+
+# If the GENERATE_HTMLHELP tag is set to YES, additional index files
+# will be generated that can be used as input for tools like the
+# Microsoft HTML help workshop to generate a compressed HTML help file (.chm)
+# of the generated HTML documentation.
+
+GENERATE_HTMLHELP      = NO
+
+# If the HTML_DYNAMIC_SECTIONS tag is set to YES then the generated HTML
+# documentation will contain sections that can be hidden and shown after the
+# page has loaded. For this to work a browser that supports
+# JavaScript and DHTML is required (for instance Mozilla 1.0+, Firefox
+# Netscape 6.0+, Internet explorer 5.0+, Konqueror, or Safari).
+
+HTML_DYNAMIC_SECTIONS  = NO
+
+# If the GENERATE_HTMLHELP tag is set to YES, the CHM_FILE tag can
+# be used to specify the file name of the resulting .chm file. You
+# can add a path in front of the file if the result should not be
+# written to the html output directory.
+
+CHM_FILE               =
+
+# If the GENERATE_HTMLHELP tag is set to YES, the HHC_LOCATION tag can
+# be used to specify the location (absolute path including file name) of
+# the HTML help compiler (hhc.exe). If non-empty doxygen will try to run
+# the HTML help compiler on the generated index.hhp.
+
+HHC_LOCATION           =
+
+# If the GENERATE_HTMLHELP tag is set to YES, the GENERATE_CHI flag
+# controls if a separate .chi index file is generated (YES) or that
+# it should be included in the master .chm file (NO).
+
+GENERATE_CHI           = NO
+
+# If the GENERATE_HTMLHELP tag is set to YES, the BINARY_TOC flag
+# controls whether a binary table of contents is generated (YES) or a
+# normal table of contents (NO) in the .chm file.
+
+BINARY_TOC             = NO
+
+# The TOC_EXPAND flag can be set to YES to add extra items for group members
+# to the contents of the HTML help documentation and to the tree view.
+
+TOC_EXPAND             = NO
+
+# The DISABLE_INDEX tag can be used to turn on/off the condensed index at
+# top of each HTML page. The value NO (the default) enables the index and
+# the value YES disables it.
+
+DISABLE_INDEX          = NO
+
+# This tag can be used to set the number of enum values (range [1..20])
+# that doxygen will group on one line in the generated HTML documentation.
+
+ENUM_VALUES_PER_LINE   = 4
+
+# If the GENERATE_TREEVIEW tag is set to YES, a side panel will be
+# generated containing a tree-like index structure (just like the one that
+# is generated for HTML Help). For this to work a browser that supports
+# JavaScript, DHTML, CSS and frames is required (for instance Mozilla 1.0+,
+# Netscape 6.0+, Internet explorer 5.0+, or Konqueror). Windows users are
+# probably better off using the HTML help feature.
+
+GENERATE_TREEVIEW      = YES
+
+# If the treeview is enabled (see GENERATE_TREEVIEW) then this tag can be
+# used to set the initial width (in pixels) of the frame in which the tree
+# is shown.
+
+TREEVIEW_WIDTH         = 250
+
+#---------------------------------------------------------------------------
+# configuration options related to the LaTeX output
+#---------------------------------------------------------------------------
+
+# If the GENERATE_LATEX tag is set to YES (the default) Doxygen will
+# generate Latex output.
+
+GENERATE_LATEX         = NO
+
+# The LATEX_OUTPUT tag is used to specify where the LaTeX docs will be put.
+# If a relative path is entered the value of OUTPUT_DIRECTORY will be
+# put in front of it. If left blank `latex' will be used as the default path.
+
+LATEX_OUTPUT           = latex
+
+# The LATEX_CMD_NAME tag can be used to specify the LaTeX command name to be
+# invoked. If left blank `latex' will be used as the default command name.
+
+LATEX_CMD_NAME         = latex
+
+# The MAKEINDEX_CMD_NAME tag can be used to specify the command name to
+# generate index for LaTeX. If left blank `makeindex' will be used as the
+# default command name.
+
+MAKEINDEX_CMD_NAME     = makeindex
+
+# If the COMPACT_LATEX tag is set to YES Doxygen generates more compact
+# LaTeX documents. This may be useful for small projects and may help to
+# save some trees in general.
+
+COMPACT_LATEX          = NO
+
+# The PAPER_TYPE tag can be used to set the paper type that is used
+# by the printer. Possible values are: a4, a4wide, letter, legal and
+# executive. If left blank a4wide will be used.
+
+PAPER_TYPE             = a4wide
+
+# The EXTRA_PACKAGES tag can be to specify one or more names of LaTeX
+# packages that should be included in the LaTeX output.
+
+EXTRA_PACKAGES         =
+
+# The LATEX_HEADER tag can be used to specify a personal LaTeX header for
+# the generated latex document. The header should contain everything until
+# the first chapter. If it is left blank doxygen will generate a
+# standard header. Notice: only use this tag if you know what you are doing!
+
+LATEX_HEADER           =
+
+# If the PDF_HYPERLINKS tag is set to YES, the LaTeX that is generated
+# is prepared for conversion to pdf (using ps2pdf). The pdf file will
+# contain links (just like the HTML output) instead of page references
+# This makes the output suitable for online browsing using a pdf viewer.
+
+PDF_HYPERLINKS         = YES
+
+# If the USE_PDFLATEX tag is set to YES, pdflatex will be used instead of
+# plain latex in the generated Makefile. Set this option to YES to get a
+# higher quality PDF documentation.
+
+USE_PDFLATEX           = YES
+
+# If the LATEX_BATCHMODE tag is set to YES, doxygen will add the \\batchmode.
+# command to the generated LaTeX files. This will instruct LaTeX to keep
+# running if errors occur, instead of asking the user for help.
+# This option is also used when generating formulas in HTML.
+
+LATEX_BATCHMODE        = NO
+
+# If LATEX_HIDE_INDICES is set to YES then doxygen will not
+# include the index chapters (such as File Index, Compound Index, etc.)
+# in the output.
+
+LATEX_HIDE_INDICES     = NO
+
+#---------------------------------------------------------------------------
+# configuration options related to the RTF output
+#---------------------------------------------------------------------------
+
+# If the GENERATE_RTF tag is set to YES Doxygen will generate RTF output
+# The RTF output is optimized for Word 97 and may not look very pretty with
+# other RTF readers or editors.
+
+GENERATE_RTF           = NO
+
+# The RTF_OUTPUT tag is used to specify where the RTF docs will be put.
+# If a relative path is entered the value of OUTPUT_DIRECTORY will be
+# put in front of it. If left blank `rtf' will be used as the default path.
+
+RTF_OUTPUT             = rtf
+
+# If the COMPACT_RTF tag is set to YES Doxygen generates more compact
+# RTF documents. This may be useful for small projects and may help to
+# save some trees in general.
+
+COMPACT_RTF            = NO
+
+# If the RTF_HYPERLINKS tag is set to YES, the RTF that is generated
+# will contain hyperlink fields. The RTF file will
+# contain links (just like the HTML output) instead of page references.
+# This makes the output suitable for online browsing using WORD or other
+# programs which support those fields.
+# Note: wordpad (write) and others do not support links.
+
+RTF_HYPERLINKS         = NO
+
+# Load stylesheet definitions from file. Syntax is similar to doxygen's
+# config file, i.e. a series of assignments. You only have to provide
+# replacements, missing definitions are set to their default value.
+
+RTF_STYLESHEET_FILE    =
+
+# Set optional variables used in the generation of an rtf document.
+# Syntax is similar to doxygen's config file.
+
+RTF_EXTENSIONS_FILE    =
+
+#---------------------------------------------------------------------------
+# configuration options related to the man page output
+#---------------------------------------------------------------------------
+
+# If the GENERATE_MAN tag is set to YES (the default) Doxygen will
+# generate man pages
+
+GENERATE_MAN           = NO
+
+# The MAN_OUTPUT tag is used to specify where the man pages will be put.
+# If a relative path is entered the value of OUTPUT_DIRECTORY will be
+# put in front of it. If left blank `man' will be used as the default path.
+
+MAN_OUTPUT             = man
+
+# The MAN_EXTENSION tag determines the extension that is added to
+# the generated man pages (default is the subroutine's section .3)
+
+MAN_EXTENSION          = .3
+
+# If the MAN_LINKS tag is set to YES and Doxygen generates man output,
+# then it will generate one additional man file for each entity
+# documented in the real man page(s). These additional files
+# only source the real man page, but without them the man command
+# would be unable to find the correct page. The default is NO.
+
+MAN_LINKS              = NO
+
+#---------------------------------------------------------------------------
+# configuration options related to the XML output
+#---------------------------------------------------------------------------
+
+# If the GENERATE_XML tag is set to YES Doxygen will
+# generate an XML file that captures the structure of
+# the code including all documentation.
+
+GENERATE_XML           = NO
+
+# The XML_OUTPUT tag is used to specify where the XML pages will be put.
+# If a relative path is entered the value of OUTPUT_DIRECTORY will be
+# put in front of it. If left blank `xml' will be used as the default path.
+
+XML_OUTPUT             = xml
+
+# The XML_SCHEMA tag can be used to specify an XML schema,
+# which can be used by a validating XML parser to check the
+# syntax of the XML files.
+
+XML_SCHEMA             =
+
+# The XML_DTD tag can be used to specify an XML DTD,
+# which can be used by a validating XML parser to check the
+# syntax of the XML files.
+
+XML_DTD                =
+
+# If the XML_PROGRAMLISTING tag is set to YES Doxygen will
+# dump the program listings (including syntax highlighting
+# and cross-referencing information) to the XML output. Note that
+# enabling this will significantly increase the size of the XML output.
+
+XML_PROGRAMLISTING     = YES
+
+#---------------------------------------------------------------------------
+# configuration options for the AutoGen Definitions output
+#---------------------------------------------------------------------------
+
+# If the GENERATE_AUTOGEN_DEF tag is set to YES Doxygen will
+# generate an AutoGen Definitions (see autogen.sf.net) file
+# that captures the structure of the code including all
+# documentation. Note that this feature is still experimental
+# and incomplete at the moment.
+
+GENERATE_AUTOGEN_DEF   = NO
+
+#---------------------------------------------------------------------------
+# configuration options related to the Perl module output
+#---------------------------------------------------------------------------
+
+# If the GENERATE_PERLMOD tag is set to YES Doxygen will
+# generate a Perl module file that captures the structure of
+# the code including all documentation. Note that this
+# feature is still experimental and incomplete at the
+# moment.
+
+GENERATE_PERLMOD       = NO
+
+# If the PERLMOD_LATEX tag is set to YES Doxygen will generate
+# the necessary Makefile rules, Perl scripts and LaTeX code to be able
+# to generate PDF and DVI output from the Perl module output.
+
+PERLMOD_LATEX          = NO
+
+# If the PERLMOD_PRETTY tag is set to YES the Perl module output will be
+# nicely formatted so it can be parsed by a human reader.  This is useful
+# if you want to understand what is going on.  On the other hand, if this
+# tag is set to NO the size of the Perl module output will be much smaller
+# and Perl will parse it just the same.
+
+PERLMOD_PRETTY         = YES
+
+# The names of the make variables in the generated doxyrules.make file
+# are prefixed with the string contained in PERLMOD_MAKEVAR_PREFIX.
+# This is useful so different doxyrules.make files included by the same
+# Makefile don't overwrite each other's variables.
+
+PERLMOD_MAKEVAR_PREFIX =
+
+#---------------------------------------------------------------------------
+# Configuration options related to the preprocessor
+#---------------------------------------------------------------------------
+
+# If the ENABLE_PREPROCESSING tag is set to YES (the default) Doxygen will
+# evaluate all C-preprocessor directives found in the sources and include
+# files.
+
+ENABLE_PREPROCESSING   = YES
+
+# If the MACRO_EXPANSION tag is set to YES Doxygen will expand all macro
+# names in the source code. If set to NO (the default) only conditional
+# compilation will be performed. Macro expansion can be done in a controlled
+# way by setting EXPAND_ONLY_PREDEF to YES.
+
+MACRO_EXPANSION        = NO
+
+# If the EXPAND_ONLY_PREDEF and MACRO_EXPANSION tags are both set to YES
+# then the macro expansion is limited to the macros specified with the
+# PREDEFINED and EXPAND_AS_DEFINED tags.
+
+EXPAND_ONLY_PREDEF     = NO
+
+# If the SEARCH_INCLUDES tag is set to YES (the default) the includes files
+# in the INCLUDE_PATH (see below) will be search if a #include is found.
+
+SEARCH_INCLUDES        = YES
+
+# The INCLUDE_PATH tag can be used to specify one or more directories that
+# contain include files that are not input files but should be processed by
+# the preprocessor.
+
+INCLUDE_PATH           =
+
+# You can use the INCLUDE_FILE_PATTERNS tag to specify one or more wildcard
+# patterns (like *.h and *.hpp) to filter out the header-files in the
+# directories. If left blank, the patterns specified with FILE_PATTERNS will
+# be used.
+
+INCLUDE_FILE_PATTERNS  =
+
+# The PREDEFINED tag can be used to specify one or more macro names that
+# are defined before the preprocessor is started (similar to the -D option of
+# gcc). The argument of the tag is a list of macros of the form: name
+# or name=definition (no spaces). If the definition and the = are
+# omitted =1 is assumed. To prevent a macro definition from being
+# undefined via #undef or recursively expanded use the := operator
+# instead of the = operator.
+
+PREDEFINED             =
+
+# If the MACRO_EXPANSION and EXPAND_ONLY_PREDEF tags are set to YES then
+# this tag can be used to specify a list of macro names that should be expanded.
+# The macro definition that is found in the sources will be used.
+# Use the PREDEFINED tag if you want to use a different macro definition.
+
+EXPAND_AS_DEFINED      =
+
+# If the SKIP_FUNCTION_MACROS tag is set to YES (the default) then
+# doxygen's preprocessor will remove all function-like macros that are alone
+# on a line, have an all uppercase name, and do not end with a semicolon. Such
+# function macros are typically used for boiler-plate code, and will confuse
+# the parser if not removed.
+
+SKIP_FUNCTION_MACROS   = YES
+
+#---------------------------------------------------------------------------
+# Configuration::additions related to external references
+#---------------------------------------------------------------------------
+
+# The TAGFILES option can be used to specify one or more tagfiles.
+# Optionally an initial location of the external documentation
+# can be added for each tagfile. The format of a tag file without
+# this location is as follows:
+#   TAGFILES = file1 file2 ...
+# Adding location for the tag files is done as follows:
+#   TAGFILES = file1=loc1 "file2 = loc2" ...
+# where "loc1" and "loc2" can be relative or absolute paths or
+# URLs. If a location is present for each tag, the installdox tool
+# does not have to be run to correct the links.
+# Note that each tag file must have a unique name
+# (where the name does NOT include the path)
+# If a tag file is not located in the directory in which doxygen
+# is run, you must also specify the path to the tagfile here.
+
+TAGFILES               =
+
+# When a file name is specified after GENERATE_TAGFILE, doxygen will create
+# a tag file that is based on the input files it reads.
+
+GENERATE_TAGFILE       =
+
+# If the ALLEXTERNALS tag is set to YES all external classes will be listed
+# in the class index. If set to NO only the inherited external classes
+# will be listed.
+
+ALLEXTERNALS           = NO
+
+# If the EXTERNAL_GROUPS tag is set to YES all external groups will be listed
+# in the modules index. If set to NO, only the current project's groups will
+# be listed.
+
+EXTERNAL_GROUPS        = YES
+
+# The PERL_PATH should be the absolute path and name of the perl script
+# interpreter (i.e. the result of `which perl').
+
+PERL_PATH              = /usr/bin/perl
+
+#---------------------------------------------------------------------------
+# Configuration options related to the dot tool
+#---------------------------------------------------------------------------
+
+# If the CLASS_DIAGRAMS tag is set to YES (the default) Doxygen will
+# generate a inheritance diagram (in HTML, RTF and LaTeX) for classes with base
+# or super classes. Setting the tag to NO turns the diagrams off. Note that
+# this option is superseded by the HAVE_DOT option below. This is only a
+# fallback. It is recommended to install and use dot, since it yields more
+# powerful graphs.
+
+CLASS_DIAGRAMS         = YES
+
+# You can define message sequence charts within doxygen comments using the \msc
+# command. Doxygen will then run the mscgen tool (see http://www.mcternan.me.uk/mscgen/) to
+# produce the chart and insert it in the documentation. The MSCGEN_PATH tag allows you to
+# specify the directory where the mscgen tool resides. If left empty the tool is assumed to
+# be found in the default search path.
+
+MSCGEN_PATH            =
+
+# If set to YES, the inheritance and collaboration graphs will hide
+# inheritance and usage relations if the target is undocumented
+# or is not a class.
+
+HIDE_UNDOC_RELATIONS   = YES
+
+# If you set the HAVE_DOT tag to YES then doxygen will assume the dot tool is
+# available from the path. This tool is part of Graphviz, a graph visualization
+# toolkit from AT&T and Lucent Bell Labs. The other options in this section
+# have no effect if this option is set to NO (the default)
+
+HAVE_DOT               = NO
+
+# If the CLASS_GRAPH and HAVE_DOT tags are set to YES then doxygen
+# will generate a graph for each documented class showing the direct and
+# indirect inheritance relations. Setting this tag to YES will force the
+# the CLASS_DIAGRAMS tag to NO.
+
+CLASS_GRAPH            = YES
+
+# If the COLLABORATION_GRAPH and HAVE_DOT tags are set to YES then doxygen
+# will generate a graph for each documented class showing the direct and
+# indirect implementation dependencies (inheritance, containment, and
+# class references variables) of the class with other documented classes.
+
+COLLABORATION_GRAPH    = YES
+
+# If the GROUP_GRAPHS and HAVE_DOT tags are set to YES then doxygen
+# will generate a graph for groups, showing the direct groups dependencies
+
+GROUP_GRAPHS           = YES
+
+# If the UML_LOOK tag is set to YES doxygen will generate inheritance and
+# collaboration diagrams in a style similar to the OMG's Unified Modeling
+# Language.
+
+UML_LOOK               = NO
+
+# If set to YES, the inheritance and collaboration graphs will show the
+# relations between templates and their instances.
+
+TEMPLATE_RELATIONS     = NO
+
+# If the ENABLE_PREPROCESSING, SEARCH_INCLUDES, INCLUDE_GRAPH, and HAVE_DOT
+# tags are set to YES then doxygen will generate a graph for each documented
+# file showing the direct and indirect include dependencies of the file with
+# other documented files.
+
+INCLUDE_GRAPH          = YES
+
+# If the ENABLE_PREPROCESSING, SEARCH_INCLUDES, INCLUDED_BY_GRAPH, and
+# HAVE_DOT tags are set to YES then doxygen will generate a graph for each
+# documented header file showing the documented files that directly or
+# indirectly include this file.
+
+INCLUDED_BY_GRAPH      = YES
+
+# If the CALL_GRAPH, SOURCE_BROWSER and HAVE_DOT tags are set to YES then doxygen will
+# generate a call dependency graph for every global function or class method.
+# Note that enabling this option will significantly increase the time of a run.
+# So in most cases it will be better to enable call graphs for selected
+# functions only using the \callgraph command.
+
+CALL_GRAPH             = NO
+
+# If the CALLER_GRAPH, SOURCE_BROWSER and HAVE_DOT tags are set to YES then doxygen will
+# generate a caller dependency graph for every global function or class method.
+# Note that enabling this option will significantly increase the time of a run.
+# So in most cases it will be better to enable caller graphs for selected
+# functions only using the \callergraph command.
+
+CALLER_GRAPH           = NO
+
+# If the GRAPHICAL_HIERARCHY and HAVE_DOT tags are set to YES then doxygen
+# will graphical hierarchy of all classes instead of a textual one.
+
+GRAPHICAL_HIERARCHY    = YES
+
+# If the DIRECTORY_GRAPH, SHOW_DIRECTORIES and HAVE_DOT tags are set to YES
+# then doxygen will show the dependencies a directory has on other directories
+# in a graphical way. The dependency relations are determined by the #include
+# relations between the files in the directories.
+
+DIRECTORY_GRAPH        = YES
+
+# The DOT_IMAGE_FORMAT tag can be used to set the image format of the images
+# generated by dot. Possible values are png, jpg, or gif
+# If left blank png will be used.
+
+DOT_IMAGE_FORMAT       = png
+
+# The tag DOT_PATH can be used to specify the path where the dot tool can be
+# found. If left blank, it is assumed the dot tool can be found in the path.
+
+DOT_PATH               =
+
+# The DOTFILE_DIRS tag can be used to specify one or more directories that
+# contain dot files that are included in the documentation (see the
+# \dotfile command).
+
+DOTFILE_DIRS           =
+
+# The MAX_DOT_GRAPH_MAX_NODES tag can be used to set the maximum number of
+# nodes that will be shown in the graph. If the number of nodes in a graph
+# becomes larger than this value, doxygen will truncate the graph, which is
+# visualized by representing a node as a red box. Note that doxygen if the number
+# of direct children of the root node in a graph is already larger than
+# MAX_DOT_GRAPH_NOTES then the graph will not be shown at all. Also note
+# that the size of a graph can be further restricted by MAX_DOT_GRAPH_DEPTH.
+
+DOT_GRAPH_MAX_NODES    = 50
+
+# The MAX_DOT_GRAPH_DEPTH tag can be used to set the maximum depth of the
+# graphs generated by dot. A depth value of 3 means that only nodes reachable
+# from the root by following a path via at most 3 edges will be shown. Nodes
+# that lay further from the root node will be omitted. Note that setting this
+# option to 1 or 2 may greatly reduce the computation time needed for large
+# code bases. Also note that the size of a graph can be further restricted by
+# DOT_GRAPH_MAX_NODES. Using a depth of 0 means no depth restriction.
+
+MAX_DOT_GRAPH_DEPTH    = 1000
+
+# Set the DOT_TRANSPARENT tag to YES to generate images with a transparent
+# background. This is disabled by default, which results in a white background.
+# Warning: Depending on the platform used, enabling this option may lead to
+# badly anti-aliased labels on the edges of a graph (i.e. they become hard to
+# read).
+
+DOT_TRANSPARENT        = NO
+
+# Set the DOT_MULTI_TARGETS tag to YES allow dot to generate multiple output
+# files in one run (i.e. multiple -o and -T options on the command line). This
+# makes dot run faster, but since only newer versions of dot (>1.8.10)
+# support this, this feature is disabled by default.
+
+DOT_MULTI_TARGETS      = NO
+
+# If the GENERATE_LEGEND tag is set to YES (the default) Doxygen will
+# generate a legend page explaining the meaning of the various boxes and
+# arrows in the dot generated graphs.
+
+GENERATE_LEGEND        = YES
+
+# If the DOT_CLEANUP tag is set to YES (the default) Doxygen will
+# remove the intermediate dot files that are used to generate
+# the various graphs.
+
+DOT_CLEANUP            = YES
+
+#---------------------------------------------------------------------------
+# Configuration::additions related to the search engine
+#---------------------------------------------------------------------------
+
+# The SEARCHENGINE tag specifies whether or not a search engine should be
+# used. If set to NO the values of all tags below this one will be ignored.
+
+SEARCHENGINE           = NO
+
+# vim: et sw=4 sts=4

--- libraries/htmlpurifier/INSTALL ---
@@ -0,0 +1,341 @@
+
+Install
+    How to install HTML Purifier
+
+HTML Purifier is designed to run out of the box, so actually using the
+library is extremely easy.  (Although... if you were looking for a
+step-by-step installation GUI, you've downloaded the wrong software!)
+
+While the impatient can get going immediately with some of the sample
+code at the bottom of this library, it's well worth reading this entire
+document--most of the other documentation assumes that you are familiar
+with these contents.
+
+
+---------------------------------------------------------------------------
+1.  Compatibility
+
+HTML Purifier is PHP 5 and PHP 7, and is actively tested from PHP 5.3
+and up. It has no core dependencies with other libraries.
+
+These optional extensions can enhance the capabilities of HTML Purifier:
+
+    * iconv  : Converts text to and from non-UTF-8 encodings
+    * bcmath : Used for unit conversion and imagecrash protection
+    * tidy   : Used for pretty-printing HTML
+
+These optional libraries can enhance the capabilities of HTML Purifier:
+
+    * CSSTidy : Clean CSS stylesheets using %Core.ExtractStyleBlocks
+        Note: You should use the modernized fork of CSSTidy available
+        at https://github.com/Cerdic/CSSTidy
+    * Net_IDNA2 (PEAR) : IRI support using %Core.EnableIDNA
+        Note: This is not necessary for PHP 5.3 or later
+
+---------------------------------------------------------------------------
+2.  Reconnaissance
+
+A big plus of HTML Purifier is its inerrant support of standards, so
+your web-pages should be standards-compliant.  (They should also use
+semantic markup, but that's another issue altogether, one HTML Purifier
+cannot fix without reading your mind.)
+
+HTML Purifier can process these doctypes:
+
+* XHTML 1.0 Transitional (default)
+* XHTML 1.0 Strict
+* HTML 4.01 Transitional
+* HTML 4.01 Strict
+* XHTML 1.1
+
+...and these character encodings:
+
+* UTF-8 (default)
+* Any encoding iconv supports (with crippled internationalization support)
+
+These defaults reflect what my choices would be if I were authoring an
+HTML document, however, what you choose depends on the nature of your
+codebase.  If you don't know what doctype you are using, you can determine
+the doctype from this identifier at the top of your source code:
+
+    <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
+        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
+
+...and the character encoding from this code:
+
+    <meta http-equiv="Content-type" content="text/html;charset=ENCODING">
+
+If the character encoding declaration is missing, STOP NOW, and
+read 'docs/enduser-utf8.html' (web accessible at
+http://htmlpurifier.org/docs/enduser-utf8.html).  In fact, even if it is
+present, read this document anyway, as many websites specify their
+document's character encoding incorrectly.
+
+
+---------------------------------------------------------------------------
+3.  Including the library
+
+The procedure is quite simple:
+
+    require_once '/path/to/library/HTMLPurifier.auto.php';
+
+This will setup an autoloader, so the library's files are only included
+when you use them.
+
+Only the contents in the library/ folder are necessary, so you can remove
+everything else when using HTML Purifier in a production environment.
+
+If you installed HTML Purifier via PEAR, all you need to do is:
+
+    require_once 'HTMLPurifier.auto.php';
+
+Please note that the usual PEAR practice of including just the classes you
+want will not work with HTML Purifier's autoloading scheme.
+
+Advanced users, read on; other users can skip to section 4.
+
+Autoload compatibility
+----------------------
+
+    HTML Purifier attempts to be as smart as possible when registering an
+    autoloader, but there are some cases where you will need to change
+    your own code to accomodate HTML Purifier. These are those cases:
+
+    AN __autoload FUNCTION IS DECLARED AFTER OUR AUTOLOADER IS REGISTERED
+        spl_autoload_register() has the curious behavior of disabling
+        the existing __autoload() handler. Users need to explicitly
+        spl_autoload_register('__autoload'). Because we use SPL when it
+        is available, __autoload() will ALWAYS be disabled. If __autoload()
+        is declared before HTML Purifier is loaded, this is not a problem:
+        HTML Purifier will register the function for you. But if it is
+        declared afterwards, it will mysteriously not work. This
+        snippet of code (after your autoloader is defined) will fix it:
+
+            spl_autoload_register('__autoload')
+
+
+For better performance
+----------------------
+
+    Opcode caches, which greatly speed up PHP initialization for scripts
+    with large amounts of code (HTML Purifier included), don't like
+    autoloaders. We offer an include file that includes all of HTML Purifier's
+    files in one go in an opcode cache friendly manner:
+
+        // If /path/to/library isn't already in your include path, uncomment
+        // the below line:
+        // require '/path/to/library/HTMLPurifier.path.php';
+
+        require 'HTMLPurifier.includes.php';
+
+    Optional components still need to be included--you'll know if you try to
+    use a feature and you get a class doesn't exists error! The autoloader
+    can be used in conjunction with this approach to catch classes that are
+    missing. Simply add this afterwards:
+
+        require 'HTMLPurifier.autoload.php';
+
+Standalone version
+------------------
+
+    HTML Purifier has a standalone distribution; you can also generate
+    a standalone file from the full version by running the script
+    maintenance/generate-standalone.php . The standalone version has the
+    benefit of having most of its code in one file, so parsing is much
+    faster and the library is easier to manage.
+
+    If HTMLPurifier.standalone.php exists in the library directory, you
+    can use it like this:
+
+        require '/path/to/HTMLPurifier.standalone.php';
+
+    This is equivalent to including HTMLPurifier.includes.php, except that
+    the contents of standalone/ will be added to your path. To override this
+    behavior, specify a new HTMLPURIFIER_PREFIX where standalone files can
+    be found (usually, this will be one directory up, the "true" library
+    directory in full distributions). Don't forget to set your path too!
+
+    The autoloader can be added to the end to ensure the classes are
+    loaded when necessary; otherwise you can manually include them.
+    To use the autoloader, use this:
+
+        require 'HTMLPurifier.autoload.php';
+
+For advanced users
+------------------
+
+    HTMLPurifier.auto.php performs a number of operations that can be done
+    individually. These are:
+
+        HTMLPurifier.path.php
+            Puts /path/to/library in the include path. For high performance,
+            this should be done in php.ini.
+
+        HTMLPurifier.autoload.php
+            Registers our autoload handler HTMLPurifier_Bootstrap::autoload($class).
+
+    You can do these operations by yourself, if you like.
+
+
+---------------------------------------------------------------------------
+4. Configuration
+
+HTML Purifier is designed to run out-of-the-box, but occasionally HTML
+Purifier needs to be told what to do.  If you answer no to any of these
+questions, read on; otherwise, you can skip to the next section (or, if you're
+into configuring things just for the heck of it, skip to 4.3).
+
+* Am I using UTF-8?
+* Am I using XHTML 1.0 Transitional?
+
+If you answered no to any of these questions, instantiate a configuration
+object and read on:
+
+    $config = HTMLPurifier_Config::createDefault();
+
+
+4.1. Setting a different character encoding
+
+You really shouldn't use any other encoding except UTF-8, especially if you
+plan to support multilingual websites (read section three for more details).
+However, switching to UTF-8 is not always immediately feasible, so we can
+adapt.
+
+HTML Purifier uses iconv to support other character encodings, as such,
+any encoding that iconv supports <http://www.gnu.org/software/libiconv/>
+HTML Purifier supports with this code:
+
+    $config->set('Core.Encoding', /* put your encoding here */);
+
+An example usage for Latin-1 websites (the most common encoding for English
+websites):
+
+    $config->set('Core.Encoding', 'ISO-8859-1');
+
+Note that HTML Purifier's support for non-Unicode encodings is crippled by the
+fact that any character not supported by that encoding will be silently
+dropped, EVEN if it is ampersand escaped.  If you want to work around
+this, you are welcome to read docs/enduser-utf8.html for a fix,
+but please be cognizant of the issues the "solution" creates (for this
+reason, I do not include the solution in this document).
+
+
+4.2. Setting a different doctype
+
+For those of you using HTML 4.01 Transitional, you can disable
+XHTML output like this:
+
+    $config->set('HTML.Doctype', 'HTML 4.01 Transitional');
+
+Other supported doctypes include:
+
+    * HTML 4.01 Strict
+    * HTML 4.01 Transitional
+    * XHTML 1.0 Strict
+    * XHTML 1.0 Transitional
+    * XHTML 1.1
+
+
+4.3. Other settings
+
+There are more configuration directives which can be read about
+here: <http://htmlpurifier.org/live/configdoc/plain.html>  They're a bit boring,
+but they can help out for those of you who like to exert maximum control over
+your code.  Some of the more interesting ones are configurable at the
+demo <http://htmlpurifier.org/demo.php> and are well worth looking into
+for your own system.
+
+For example, you can fine tune allowed elements and attributes, convert
+relative URLs to absolute ones, and even autoparagraph input text! These
+are, respectively, %HTML.Allowed, %URI.MakeAbsolute and %URI.Base, and
+%AutoFormat.AutoParagraph. The %Namespace.Directive naming convention
+translates to:
+
+    $config->set('Namespace.Directive', $value);
+
+E.g.
+
+    $config->set('HTML.Allowed', 'p,b,a[href],i');
+    $config->set('URI.Base', 'http://www.example.com');
+    $config->set('URI.MakeAbsolute', true);
+    $config->set('AutoFormat.AutoParagraph', true);
+
+
+---------------------------------------------------------------------------
+5. Caching
+
+HTML Purifier generates some cache files (generally one or two) to speed up
+its execution. For maximum performance, make sure that
+library/HTMLPurifier/DefinitionCache/Serializer is writeable by the webserver.
+
+If you are in the library/ folder of HTML Purifier, you can set the
+appropriate permissions using:
+
+    chmod -R 0755 HTMLPurifier/DefinitionCache/Serializer
+
+If the above command doesn't work, you may need to assign write permissions
+to group:
+
+    chmod -R 0775 HTMLPurifier/DefinitionCache/Serializer
+
+You can also chmod files via your FTP client; this option
+is usually accessible by right clicking the corresponding directory and
+then selecting "chmod" or "file permissions".
+
+Starting with 2.0.1, HTML Purifier will generate friendly error messages
+that will tell you exactly what you have to chmod the directory to, if in doubt,
+follow its advice.
+
+If you are unable or unwilling to give write permissions to the cache
+directory, you can either disable the cache (and suffer a performance
+hit):
+
+    $config->set('Core.DefinitionCache', null);
+
+Or move the cache directory somewhere else (no trailing slash):
+
+    $config->set('Cache.SerializerPath', '/home/user/absolute/path');
+
+
+---------------------------------------------------------------------------
+6.   Using the code
+
+The interface is mind-numbingly simple:
+
+    $purifier = new HTMLPurifier($config);
+    $clean_html = $purifier->purify( $dirty_html );
+
+That's it!  For more examples, check out docs/examples/ (they aren't very
+different though).  Also, docs/enduser-slow.html gives advice on what to
+do if HTML Purifier is slowing down your application.
+
+
+---------------------------------------------------------------------------
+7.   Quick install
+
+First, make sure library/HTMLPurifier/DefinitionCache/Serializer is
+writable by the webserver (see Section 5: Caching above for details).
+If your website is in UTF-8 and XHTML Transitional, use this code:
+
+<?php
+    require_once '/path/to/htmlpurifier/library/HTMLPurifier.auto.php';
+
+    $config = HTMLPurifier_Config::createDefault();
+    $purifier = new HTMLPurifier($config);
+    $clean_html = $purifier->purify($dirty_html);
+?>
+
+If your website is in a different encoding or doctype, use this code:
+
+<?php
+    require_once '/path/to/htmlpurifier/library/HTMLPurifier.auto.php';
+
+    $config = HTMLPurifier_Config::createDefault();
+    $config->set('Core.Encoding', 'ISO-8859-1'); // replace with your encoding
+    $config->set('HTML.Doctype', 'HTML 4.01 Transitional'); // replace with your doctype
+    $purifier = new HTMLPurifier($config);
+
+    $clean_html = $purifier->purify($dirty_html);
+?>
+
+    vim: et sw=4 sts=4

--- libraries/htmlpurifier/INSTALL.fr.utf8 ---
@@ -0,0 +1,60 @@
+
+Installation
+    Comment installer HTML Purifier
+
+Attention : Ce document est encodé en UTF-8, si les lettres avec des accents
+ne s'affichent pas, prenez un meilleur éditeur de texte.
+
+L'installation de HTML Purifier est très simple, parce qu'il n'a pas besoin
+de configuration. Pour les utilisateurs impatients, le code se trouve dans le
+pied de page, mais je recommande de lire le document.
+
+1.  Compatibilité
+
+HTML Purifier fonctionne avec PHP 5. PHP 5.3 est la dernière version testée.
+Il ne dépend pas d'autres librairies.
+
+Les extensions optionnelles sont iconv (généralement déjà installée) et tidy
+(répendue aussi). Si vous utilisez UTF-8 et que vous ne voulez pas l'indentation,
+vous pouvez utiliser HTML Purifier sans ces extensions.
+
+
+2.  Inclure la librairie
+
+Quand vous devez l'utilisez, incluez le :
+
+    require_once('/path/to/library/HTMLPurifier.auto.php');
+
+Ne pas l'inclure si ce n'est pas nécessaire, car HTML Purifier est lourd.
+
+HTML Purifier utilise "autoload". Si vous avez défini la fonction __autoload,
+vous devez ajouter cette fonction :
+
+    spl_autoload_register('__autoload')
+
+Plus d'informations dans le document "INSTALL".
+
+3.  Installation rapide
+
+Si votre site Web est en UTF-8 et XHTML Transitional, utilisez :
+
+<?php
+    require_once('/path/to/htmlpurifier/library/HTMLPurifier.auto.php');
+    $purificateur = new HTMLPurifier();
+    $html_propre = $purificateur->purify($html_a_purifier);
+?>
+
+Sinon, utilisez :
+
+<?php
+    require_once('/path/to/html/purifier/library/HTMLPurifier.auto.load');
+    $config = $HTMLPurifier_Config::createDefault();
+    $config->set('Core', 'Encoding', 'ISO-8859-1'); //Remplacez par votre
+    encodage
+    $config->set('Core', 'XHTML', true); //Remplacer par false si HTML 4.01
+    $purificateur = new HTMLPurifier($config);
+    $html_propre = $purificateur->purify($html_a_purifier);
+?>
+
+
+    vim: et sw=4 sts=4

--- libraries/htmlpurifier/LICENSE ---
@@ -0,0 +1,504 @@
+		  GNU LESSER GENERAL PUBLIC LICENSE
+		       Version 2.1, February 1999
+
+ Copyright (C) 1991, 1999 Free Software Foundation, Inc.
+ 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301  USA
+ Everyone is permitted to copy and distribute verbatim copies
+ of this license document, but changing it is not allowed.
+
+[This is the first released version of the Lesser GPL.  It also counts
+ as the successor of the GNU Library Public License, version 2, hence
+ the version number 2.1.]
+
+			    Preamble
+
+  The licenses for most software are designed to take away your
+freedom to share and change it.  By contrast, the GNU General Public
+Licenses are intended to guarantee your freedom to share and change
+free software--to make sure the software is free for all its users.
+
+  This license, the Lesser General Public License, applies to some
+specially designated software packages--typically libraries--of the
+Free Software Foundation and other authors who decide to use it.  You
+can use it too, but we suggest you first think carefully about whether
+this license or the ordinary General Public License is the better
+strategy to use in any particular case, based on the explanations below.
+
+  When we speak of free software, we are referring to freedom of use,
+not price.  Our General Public Licenses are designed to make sure that
+you have the freedom to distribute copies of free software (and charge
+for this service if you wish); that you receive source code or can get
+it if you want it; that you can change the software and use pieces of
+it in new free programs; and that you are informed that you can do
+these things.
+
+  To protect your rights, we need to make restrictions that forbid
+distributors to deny you these rights or to ask you to surrender these
+rights.  These restrictions translate to certain responsibilities for
+you if you distribute copies of the library or if you modify it.
+
+  For example, if you distribute copies of the library, whether gratis
+or for a fee, you must give the recipients all the rights that we gave
+you.  You must make sure that they, too, receive or can get the source
+code.  If you link other code with the library, you must provide
+complete object files to the recipients, so that they can relink them
+with the library after making changes to the library and recompiling
+it.  And you must show them these terms so they know their rights.
+
+  We protect your rights with a two-step method: (1) we copyright the
+library, and (2) we offer you this license, which gives you legal
+permission to copy, distribute and/or modify the library.
+
+  To protect each distributor, we want to make it very clear that
+there is no warranty for the free library.  Also, if the library is
+modified by someone else and passed on, the recipients should know
+that what they have is not the original version, so that the original
+author's reputation will not be affected by problems that might be
+introduced by others.
+
+  Finally, software patents pose a constant threat to the existence of
+any free program.  We wish to make sure that a company cannot
+effectively restrict the users of a free program by obtaining a
+restrictive license from a patent holder.  Therefore, we insist that
+any patent license obtained for a version of the library must be
+consistent with the full freedom of use specified in this license.
+
+  Most GNU software, including some libraries, is covered by the
+ordinary GNU General Public License.  This license, the GNU Lesser
+General Public License, applies to certain designated libraries, and
+is quite different from the ordinary General Public License.  We use
+this license for certain libraries in order to permit linking those
+libraries into non-free programs.
+
+  When a program is linked with a library, whether statically or using
+a shared library, the combination of the two is legally speaking a
+combined work, a derivative of the original library.  The ordinary
+General Public License therefore permits such linking only if the
+entire combination fits its criteria of freedom.  The Lesser General
+Public License permits more lax criteria for linking other code with
+the library.
+
+  We call this license the "Lesser" General Public License because it
+does Less to protect the user's freedom than the ordinary General
+Public License.  It also provides other free software developers Less
+of an advantage over competing non-free programs.  These disadvantages
+are the reason we use the ordinary General Public License for many
+libraries.  However, the Lesser license provides advantages in certain
+special circumstances.
+
+  For example, on rare occasions, there may be a special need to
+encourage the widest possible use of a certain library, so that it becomes
+a de-facto standard.  To achieve this, non-free programs must be
+allowed to use the library.  A more frequent case is that a free
+library does the same job as widely used non-free libraries.  In this
+case, there is little to gain by limiting the free library to free
+software only, so we use the Lesser General Public License.
+
+  In other cases, permission to use a particular library in non-free
+programs enables a greater number of people to use a large body of
+free software.  For example, permission to use the GNU C Library in
+non-free programs enables many more people to use the whole GNU
+operating system, as well as its variant, the GNU/Linux operating
+system.
+
+  Although the Lesser General Public License is Less protective of the
+users' freedom, it does ensure that the user of a program that is
+linked with the Library has the freedom and the wherewithal to run
+that program using a modified version of the Library.
+
+  The precise terms and conditions for copying, distribution and
+modification follow.  Pay close attention to the difference between a
+"work based on the library" and a "work that uses the library".  The
+former contains code derived from the library, whereas the latter must
+be combined with the library in order to run.
+
+		  GNU LESSER GENERAL PUBLIC LICENSE
+   TERMS AND CONDITIONS FOR COPYING, DISTRIBUTION AND MODIFICATION
+
+  0. This License Agreement applies to any software library or other
+program which contains a notice placed by the copyright holder or
+other authorized party saying it may be distributed under the terms of
+this Lesser General Public License (also called "this License").
+Each licensee is addressed as "you".
+
+  A "library" means a collection of software functions and/or data
+prepared so as to be conveniently linked with application programs
+(which use some of those functions and data) to form executables.
+
+  The "Library", below, refers to any such software library or work
+which has been distributed under these terms.  A "work based on the
+Library" means either the Library or any derivative work under
+copyright law: that is to say, a work containing the Library or a
+portion of it, either verbatim or with modifications and/or translated
+straightforwardly into another language.  (Hereinafter, translation is
+included without limitation in the term "modification".)
+
+  "Source code" for a work means the preferred form of the work for
+making modifications to it.  For a library, complete source code means
+all the source code for all modules it contains, plus any associated
+interface definition files, plus the scripts used to control compilation
+and installation of the library.
+
+  Activities other than copying, distribution and modification are not
+covered by this License; they are outside its scope.  The act of
+running a program using the Library is not restricted, and output from
+such a program is covered only if its contents constitute a work based
+on the Library (independent of the use of the Library in a tool for
+writing it).  Whether that is true depends on what the Library does
+and what the program that uses the Library does.
+
+  1. You may copy and distribute verbatim copies of the Library's
+complete source code as you receive it, in any medium, provided that
+you conspicuously and appropriately publish on each copy an
+appropriate copyright notice and disclaimer of warranty; keep intact
+all the notices that refer to this License and to the absence of any
+warranty; and distribute a copy of this License along with the
+Library.
+
+  You may charge a fee for the physical act of transferring a copy,
+and you may at your option offer warranty protection in exchange for a
+fee.
+
+  2. You may modify your copy or copies of the Library or any portion
+of it, thus forming a work based on the Library, and copy and
+distribute such modifications or work under the terms of Section 1
+above, provided that you also meet all of these conditions:
+
+    a) The modified work must itself be a software library.
+
+    b) You must cause the files modified to carry prominent notices
+    stating that you changed the files and the date of any change.
+
+    c) You must cause the whole of the work to be licensed at no
+    charge to all third parties under the terms of this License.
+
+    d) If a facility in the modified Library refers to a function or a
+    table of data to be supplied by an application program that uses
+    the facility, other than as an argument passed when the facility
+    is invoked, then you must make a good faith effort to ensure that,
+    in the event an application does not supply such function or
+    table, the facility still operates, and performs whatever part of
+    its purpose remains meaningful.
+
+    (For example, a function in a library to compute square roots has
+    a purpose that is entirely well-defined independent of the
+    application.  Therefore, Subsection 2d requires that any
+    application-supplied function or table used by this function must
+    be optional: if the application does not supply it, the square
+    root function must still compute square roots.)
+
+These requirements apply to the modified work as a whole.  If
+identifiable sections of that work are not derived from the Library,
+and can be reasonably considered independent and separate works in
+themselves, then this License, and its terms, do not apply to those
+sections when you distribute them as separate works.  But when you
+distribute the same sections as part of a whole which is a work based
+on the Library, the distribution of the whole must be on the terms of
+this License, whose permissions for other licensees extend to the
+entire whole, and thus to each and every part regardless of who wrote
+it.
+
+Thus, it is not the intent of this section to claim rights or contest
+your rights to work written entirely by you; rather, the intent is to
+exercise the right to control the distribution of derivative or
+collective works based on the Library.
+
+In addition, mere aggregation of another work not based on the Library
+with the Library (or with a work based on the Library) on a volume of
+a storage or distribution medium does not bring the other work under
+the scope of this License.
+
+  3. You may opt to apply the terms of the ordinary GNU General Public
+License instead of this License to a given copy of the Library.  To do
+this, you must alter all the notices that refer to this License, so
+that they refer to the ordinary GNU General Public License, version 2,
+instead of to this License.  (If a newer version than version 2 of the
+ordinary GNU General Public License has appeared, then you can specify
+that version instead if you wish.)  Do not make any other change in
+these notices.
+
+  Once this change is made in a given copy, it is irreversible for
+that copy, so the ordinary GNU General Public License applies to all
+subsequent copies and derivative works made from that copy.
+
+  This option is useful when you wish to copy part of the code of
+the Library into a program that is not a library.
+
+  4. You may copy and distribute the Library (or a portion or
+derivative of it, under Section 2) in object code or executable form
+under the terms of Sections 1 and 2 above provided that you accompany
+it with the complete corresponding machine-readable source code, which
+must be distributed under the terms of Sections 1 and 2 above on a
+medium customarily used for software interchange.
+
+  If distribution of object code is made by offering access to copy
+from a designated place, then offering equivalent access to copy the
+source code from the same place satisfies the requirement to
+distribute the source code, even though third parties are not
+compelled to copy the source along with the object code.
+
+  5. A program that contains no derivative of any portion of the
+Library, but is designed to work with the Library by being compiled or
+linked with it, is called a "work that uses the Library".  Such a
+work, in isolation, is not a derivative work of the Library, and
+therefore falls outside the scope of this License.
+
+  However, linking a "work that uses the Library" with the Library
+creates an executable that is a derivative of the Library (because it
+contains portions of the Library), rather than a "work that uses the
+library".  The executable is therefore covered by this License.
+Section 6 states terms for distribution of such executables.
+
+  When a "work that uses the Library" uses material from a header file
+that is part of the Library, the object code for the work may be a
+derivative work of the Library even though the source code is not.
+Whether this is true is especially significant if the work can be
+linked without the Library, or if the work is itself a library.  The
+threshold for this to be true is not precisely defined by law.
+
+  If such an object file uses only numerical parameters, data
+structure layouts and accessors, and small macros and small inline
+functions (ten lines or less in length), then the use of the object
+file is unrestricted, regardless of whether it is legally a derivative
+work.  (Executables containing this object code plus portions of the
+Library will still fall under Section 6.)
+
+  Otherwise, if the work is a derivative of the Library, you may
+distribute the object code for the work under the terms of Section 6.
+Any executables containing that work also fall under Section 6,
+whether or not they are linked directly with the Library itself.
+
+  6. As an exception to the Sections above, you may also combine or
+link a "work that uses the Library" with the Library to produce a
+work containing portions of the Library, and distribute that work
+under terms of your choice, provided that the terms permit
+modification of the work for the customer's own use and reverse
+engineering for debugging such modifications.
+
+  You must give prominent notice with each copy of the work that the
+Library is used in it and that the Library and its use are covered by
+this License.  You must supply a copy of this License.  If the work
+during execution displays copyright notices, you must include the
+copyright notice for the Library among them, as well as a reference
+directing the user to the copy of this License.  Also, you must do one
+of these things:
+
+    a) Accompany the work with the complete corresponding
+    machine-readable source code for the Library including whatever
+    changes were used in the work (which must be distributed under
+    Sections 1 and 2 above); and, if the work is an executable linked
+    with the Library, with the complete machine-readable "work that
+    uses the Library", as object code and/or source code, so that the
+    user can modify the Library and then relink to produce a modified
+    executable containing the modified Library.  (It is understood
+    that the user who changes the contents of definitions files in the
+    Library will not necessarily be able to recompile the application
+    to use the modified definitions.)
+
+    b) Use a suitable shared library mechanism for linking with the
+    Library.  A suitable mechanism is one that (1) uses at run time a
+    copy of the library already present on the user's computer system,
+    rather than copying library functions into the executable, and (2)
+    will operate properly with a modified version of the library, if
+    the user installs one, as long as the modified version is
+    interface-compatible with the version that the work was made with.
+
+    c) Accompany the work with a written offer, valid for at
+    least three years, to give the same user the materials
+    specified in Subsection 6a, above, for a charge no more
+    than the cost of performing this distribution.
+
+    d) If distribution of the work is made by offering access to copy
+    from a designated place, offer equivalent access to copy the above
+    specified materials from the same place.
+
+    e) Verify that the user has already received a copy of these
+    materials or that you have already sent this user a copy.
+
+  For an executable, the required form of the "work that uses the
+Library" must include any data and utility programs needed for
+reproducing the executable from it.  However, as a special exception,
+the materials to be distributed need not include anything that is
+normally distributed (in either source or binary form) with the major
+components (compiler, kernel, and so on) of the operating system on
+which the executable runs, unless that component itself accompanies
+the executable.
+
+  It may happen that this requirement contradicts the license
+restrictions of other proprietary libraries that do not normally
+accompany the operating system.  Such a contradiction means you cannot
+use both them and the Library together in an executable that you
+distribute.
+
+  7. You may place library facilities that are a work based on the
+Library side-by-side in a single library together with other library
+facilities not covered by this License, and distribute such a combined
+library, provided that the separate distribution of the work based on
+the Library and of the other library facilities is otherwise
+permitted, and provided that you do these two things:
+
+    a) Accompany the combined library with a copy of the same work
+    based on the Library, uncombined with any other library
+    facilities.  This must be distributed under the terms of the
+    Sections above.
+
+    b) Give prominent notice with the combined library of the fact
+    that part of it is a work based on the Library, and explaining
+    where to find the accompanying uncombined form of the same work.
+
+  8. You may not copy, modify, sublicense, link with, or distribute
+the Library except as expressly provided under this License.  Any
+attempt otherwise to copy, modify, sublicense, link with, or
+distribute the Library is void, and will automatically terminate your
+rights under this License.  However, parties who have received copies,
+or rights, from you under this License will not have their licenses
+terminated so long as such parties remain in full compliance.
+
+  9. You are not required to accept this License, since you have not
+signed it.  However, nothing else grants you permission to modify or
+distribute the Library or its derivative works.  These actions are
+prohibited by law if you do not accept this License.  Therefore, by
+modifying or distributing the Library (or any work based on the
+Library), you indicate your acceptance of this License to do so, and
+all its terms and conditions for copying, distributing or modifying
+the Library or works based on it.
+
+  10. Each time you redistribute the Library (or any work based on the
+Library), the recipient automatically receives a license from the
+original licensor to copy, distribute, link with or modify the Library
+subject to these terms and conditions.  You may not impose any further
+restrictions on the recipients' exercise of the rights granted herein.
+You are not responsible for enforcing compliance by third parties with
+this License.
+
+  11. If, as a consequence of a court judgment or allegation of patent
+infringement or for any other reason (not limited to patent issues),
+conditions are imposed on you (whether by court order, agreement or
+otherwise) that contradict the conditions of this License, they do not
+excuse you from the conditions of this License.  If you cannot
+distribute so as to satisfy simultaneously your obligations under this
+License and any other pertinent obligations, then as a consequence you
+may not distribute the Library at all.  For example, if a patent
+license would not permit royalty-free redistribution of the Library by
+all those who receive copies directly or indirectly through you, then
+the only way you could satisfy both it and this License would be to
+refrain entirely from distribution of the Library.
+
+If any portion of this section is held invalid or unenforceable under any
+particular circumstance, the balance of the section is intended to apply,
+and the section as a whole is intended to apply in other circumstances.
+
+It is not the purpose of this section to induce you to infringe any
+patents or other property right claims or to contest validity of any
+such claims; this section has the sole purpose of protecting the
+integrity of the free software distribution system which is
+implemented by public license practices.  Many people have made
+generous contributions to the wide range of software distributed
+through that system in reliance on consistent application of that
+system; it is up to the author/donor to decide if he or she is willing
+to distribute software through any other system and a licensee cannot
+impose that choice.
+
+This section is intended to make thoroughly clear what is believed to
+be a consequence of the rest of this License.
+
+  12. If the distribution and/or use of the Library is restricted in
+certain countries either by patents or by copyrighted interfaces, the
+original copyright holder who places the Library under this License may add
+an explicit geographical distribution limitation excluding those countries,
+so that distribution is permitted only in or among countries not thus
+excluded.  In such case, this License incorporates the limitation as if
+written in the body of this License.
+
+  13. The Free Software Foundation may publish revised and/or new
+versions of the Lesser General Public License from time to time.
+Such new versions will be similar in spirit to the present version,
+but may differ in detail to address new problems or concerns.
+
+Each version is given a distinguishing version number.  If the Library
+specifies a version number of this License which applies to it and
+"any later version", you have the option of following the terms and
+conditions either of that version or of any later version published by
+the Free Software Foundation.  If the Library does not specify a
+license version number, you may choose any version ever published by
+the Free Software Foundation.
+
+  14. If you wish to incorporate parts of the Library into other free
+programs whose distribution conditions are incompatible with these,
+write to the author to ask for permission.  For software which is
+copyrighted by the Free Software Foundation, write to the Free
+Software Foundation; we sometimes make exceptions for this.  Our
+decision will be guided by the two goals of preserving the free status
+of all derivatives of our free software and of promoting the sharing
+and reuse of software generally.
+
+			    NO WARRANTY
+
+  15. BECAUSE THE LIBRARY IS LICENSED FREE OF CHARGE, THERE IS NO
+WARRANTY FOR THE LIBRARY, TO THE EXTENT PERMITTED BY APPLICABLE LAW.
+EXCEPT WHEN OTHERWISE STATED IN WRITING THE COPYRIGHT HOLDERS AND/OR
+OTHER PARTIES PROVIDE THE LIBRARY "AS IS" WITHOUT WARRANTY OF ANY
+KIND, EITHER EXPRESSED OR IMPLIED, INCLUDING, BUT NOT LIMITED TO, THE
+IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
+PURPOSE.  THE ENTIRE RISK AS TO THE QUALITY AND PERFORMANCE OF THE
+LIBRARY IS WITH YOU.  SHOULD THE LIBRARY PROVE DEFECTIVE, YOU ASSUME
+THE COST OF ALL NECESSARY SERVICING, REPAIR OR CORRECTION.
+
+  16. IN NO EVENT UNLESS REQUIRED BY APPLICABLE LAW OR AGREED TO IN
+WRITING WILL ANY COPYRIGHT HOLDER, OR ANY OTHER PARTY WHO MAY MODIFY
+AND/OR REDISTRIBUTE THE LIBRARY AS PERMITTED ABOVE, BE LIABLE TO YOU
+FOR DAMAGES, INCLUDING ANY GENERAL, SPECIAL, INCIDENTAL OR
+CONSEQUENTIAL DAMAGES ARISING OUT OF THE USE OR INABILITY TO USE THE
+LIBRARY (INCLUDING BUT NOT LIMITED TO LOSS OF DATA OR DATA BEING
+RENDERED INACCURATE OR LOSSES SUSTAINED BY YOU OR THIRD PARTIES OR A
+FAILURE OF THE LIBRARY TO OPERATE WITH ANY OTHER SOFTWARE), EVEN IF
+SUCH HOLDER OR OTHER PARTY HAS BEEN ADVISED OF THE POSSIBILITY OF SUCH
+DAMAGES.
+
+		     END OF TERMS AND CONDITIONS
+
+           How to Apply These Terms to Your New Libraries
+
+  If you develop a new library, and you want it to be of the greatest
+possible use to the public, we recommend making it free software that
+everyone can redistribute and change.  You can do so by permitting
+redistribution under these terms (or, alternatively, under the terms of the
+ordinary General Public License).
+
+  To apply these terms, attach the following notices to the library.  It is
+safest to attach them to the start of each source file to most effectively
+convey the exclusion of warranty; and each file should have at least the
+"copyright" line and a pointer to where the full notice is found.
+
+    <one line to give the library's name and a brief idea of what it does.>
+    Copyright (C) <year>  <name of author>
+
+    This library is free software; you can redistribute it and/or
+    modify it under the terms of the GNU Lesser General Public
+    License as published by the Free Software Foundation; either
+    version 2.1 of the License, or (at your option) any later version.
+
+    This library is distributed in the hope that it will be useful,
+    but WITHOUT ANY WARRANTY; without even the implied warranty of
+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+    Lesser General Public License for more details.
+
+    You should have received a copy of the GNU Lesser General Public
+    License along with this library; if not, write to the Free Software
+    Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301  USA
+
+Also add information on how to contact you by electronic and paper mail.
+
+You should also get your employer (if you work as a programmer) or your
+school, if any, to sign a "copyright disclaimer" for the library, if
+necessary.  Here is a sample; alter the names:
+
+  Yoyodyne, Inc., hereby disclaims all copyright interest in the
+  library `Frob' (a library for tweaking knobs) written by James Random Hacker.
+
+  <signature of Ty Coon>, 1 April 1990
+  Ty Coon, President of Vice
+
+That's all there is to it!
+
+    vim: et sw=4 sts=4

--- libraries/htmlpurifier/NEWS ---
@@ -0,0 +1,1246 @@
+NEWS ( CHANGELOG and HISTORY )                                     HTMLPurifier
+|||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||
+
+= KEY ====================
+    # Breaks back-compat
+    ! Feature
+    - Bugfix
+      + Sub-comment
+    . Internal change
+==========================
+
+4.13.0, released 2020-06-28
+! Add %HTML.Forms directive, which lets you accept forms in user
+  HTML without requiring full %HTML.Trusted.  Note that forms can
+  be (trivially) used to setup phishing; e.g., an attacker can
+  use CSS absolute positioning to overlay a form on top of a login
+  element, so please be sure to use this with care!   Fixes #213.
+  Thanks Mateusz Turcza for contributing this feature.
+! tr@bgcolor attribute is now supported.  Thanks Kieran Brahney
+  for this enhancement.
+- Further improvements to PHP 6.4 support, contributed by Witold
+  Wasiczko and Eloy Lafuente.
+- Fix PSR-0 compatibility.  Thanks Jordi Boggiano for contributing
+  part of this fix.
+- Fix bug with purifyArray where it doesn't work on empty arrays.
+  Thanks Fräntz Miccoli for the fix.
+- Reduce amount of maintenance scripts included in distribution
+  packages.  Thanks Sergei Morozov for this patch.
+- Remove leading zeros unless if it is only a zero, fixes #239.  Thanks
+  lubomirbartos for this fix.
+- Correct type hinting of maybeGet*, fixes #240.   Thanks Anders Jenbo
+  for this fix.
+
+4.12.0, released 2019-10-27
+! PHP 7.4 is supported, thank you Witold Wasiczko, Mateuz Turcza and
+  Edi Modrić
+- PHPDocs for HTMLModule::addElement() and Bool attr are fixed (thanks
+  Mateusz)
+
+4.11.0, released 2019-07-14
+# SafeScripting now matches case-sensitively against its whitelist (previously it was
+  case-insensitive.)  Thanks Dimitri Gritsajuk <gritsajuk.dimitri@gmail.com>
+  for reporting.
+! New directive %Core.AllowParseManyTags which allows parsing of many nested tags.
+  Thanks M. Suzuki <msuzuki1986@gmail.com> for contributing the patch.
+! purifyArray now supports multidimensional arrays.  Thanks
+  Sandro Miguel Marques <sandromiguel@sandromiguel.com> for contributing this patch.
+! initial and inherit settings available for width, height, and the min-/max-
+  versions thereof.  Thanks Michael Kliewe <info@phpgansta.de> for contributing
+  this patch.
+! More color names are supported.  Thanks Daijobou for contributing.
+- Compatibility fixes for PHP 7.3, including new CI for PHP 7.3
+  (thank you Lukas Neumann <lksnmnn@gmail.com>) and removal of
+  reserved words in our constants (thanks Darko Hrgovic <darko@darkodev.com>
+- Compatibility fixes for HHVM.  Thanks Mateusz Turcza for contributing
+  this fix.
+- HTML Purifier now never defines __autoload, fixing #196.  Thanks
+  Michael Kliewe for reporting.
+- In some situations, Config.php would report an undefined index: class
+  error; this has been fixed.  Thanks DiLong Fa for contributing
+  this fix.
+- We no longer produce <script /> tags; we always explicitly write
+  out the open and close tag.  Thanks Dimitri Gritsajuk
+  <gritsajuk.dimitri@gmail.com> for contributing this fix.
+- Better compatibility when IDNA constants are not present.  Thanks
+  Mateusz Turcza <xemlock@gmail.com> for contributing this fix.
+
+4.10.0, released 2018-02-22
+# PHP 5.3 is no longer officially supported by HTML Purifier
+  (we did not specifically break support, but we are no longer
+  testing on PHP 5.3)
+! Relative CSS length units are now supported
+- A few PHP 7.2 compatibility fixes, thanks John Flatness
+  <john@zerocrates.org>
+- Improve portability with old versions of libxml which don't
+  support accessing the data of a node
+- IDNA2008 is now used for converting domains to ASCII, fixing
+  some rather strange bugs with international domains
+- Fix race condition resulting in E_WARNING when creating
+  directories with Serializer
+
+4.9.3, released 2017-06-02
+- Workaround PHP 7.1 infinite loop when opcode cache is enabled.
+  Thanks @Xiphin (#134, #135)
+- Don't use autoloader when testing for DOMDocument.  Hypothetically,
+  this could cause your install to start using DirectLex if you had
+  previously been monkeypatching in a custom, autoloaded implementation
+  of DOMDocument.  Don't do that.  Thanks @Izumi-kun (#130)
+
+4.9.2, released 2017-03-12
+- Fixes PHP 5.3 compatibility
+- Fix breakage when decoding decimal entities.  Thanks @rybakit (#129)
+
+4.9.1, released 2017-03-08
+! %URI.DefaultScheme can now be set to null, in which case
+  all relative paths are removed.
+! New CSS properties: min-width, max-width, min-height, max-height (#94)
+! Transparency (rgba) and hsl/hsla supported where color CSS is present.
+  Thanks @fxbt for contributing the patch. (#118)
+- When idn_to_ascii is defined, we might accept malformed
+  hostnames.  Apply validation to the result in such cases.
+- Close directory when done in Serializer DefinitionCache (#100)
+- Deleted some asserts to avoid linters from choking (#97)
+- Rework Serializer cache behavior to avoid chmod'ing if possible (#32)
+- Embedded semicolons in strings in CSS are now handled correctly!
+- We accidentally dropped certain Unicode characters if there was
+  one or more invalid characters.  This has been fixed, thanks
+  to mpyw <ryosuke_i_628@yahoo.co.jp>
+- Fix for "Don't truncate upon encountering </div> when using DOMLex"
+  caused a regression with HTML 4.01 Strict parsing with libxml 2.9.1
+  (and maybe later versions, but known OK with libxml 2.9.4).  The
+  fix is to go about handling truncation a bit more cleverly so that
+  we can wrap with divs (sidestepping the bug) but slurping out the
+  rest of the text in case it ran off the end.  (#78)
+- Fix PREG_BACKTRACK_LIMIT_ERROR in HTMLPurifier_Filter_ExtractStyle.
+  Thanks @breathbath for contributing the report and fix (#120)
+- Fix entity decoding algorithm to be more conservative about
+  decoding entities that are missing trailing semicolon.
+  To get old behavior, set %Core.LegacyEntityDecoder to true.
+  (#119)
+- Workaround libxml bug when HTML tags are embedded inside
+  script tags.  To disable workaround set %Core.AggressivelyRemoveScript
+  to false. (#83)
+# By default, when a link has a target attribute associated
+  with it, we now also add rel="noopener" in order to
+  prevent the new window from being able to overwrite
+  the original frame.  To disable this protection,
+  set %HTML.TargetNoopener to FALSE.
+
+4.9.0 was cut on Git but never properly released; when we did the
+real release we decided to skip this version number.
+
+4.8.0, released 2016-07-16
+# By default, when a link has a target attribute associated
+  with it, we now also add rel="noreferrer" in order to
+  prevent the new window from being able to overwrite
+  the original frame.  To disable this protection,
+  set %HTML.TargetNoreferrer to FALSE.
+! Full PHP 7 compatibility, the test suite is ALL GO.
+! %CSS.AllowDuplicates permits duplicate CSS properties.
+! Support for 'tel' URIs.
+! Partial support for 'border-radius' properties when %CSS.AllowProprietary is true.
+  The slash syntax, i.e., 'border-radius: 2em 1em 4em / 0.5em 3em' is not
+  yet supported.
+! %Attr.ID.HTML5 turns on HTML5-style ID handling.
+- alt truncation could result in malformed UTF-8 sequence. Don't
+  truncate.  Thanks Brandon Farber for reporting.
+- Linkify regex is smarter, based off of Gruber's regex.
+- IDNA supported natively on PHP 5.3 and later.
+- Non all-numeric top-level names (e.g., foo.1f, 1f) are now
+  allowed.
+- Minor bounds error fix to squash a PHP 7 notice.
+- Support non-/tmp temporary directories for data:// validation
+- Give a better error message when a user attempts to allow
+  ul/ol without allowing li.
+- On some versions of PHP, the Serializer DefinitionCache could
+  infinite loop when the directory exists but is not listable. (#49)
+- Don't match for <body> inside comments with
+  %Core.ConvertDocumentToFragment. (#67)
+- SafeObject is now less case sensitive. (#57)
+- AutoFormat.RemoveEmpty.Predicate now correctly renders in
+  web form. (#85)
+
+4.7.0, released 2015-08-04
+# opacity is now considered a "tricky" CSS property rather than a
+  proprietary one.
+! %AutoFormat.RemoveEmpty.Predicate for specifying exactly when
+  an element should be considered "empty" (maybe preserve if it
+  has attributes), and modify iframe support so that the iframe
+  is removed if it is missing a src attribute.  Thanks meeva for
+  reporting.
+- Don't truncate upon encountering </div> when using DOMLex.  Thanks
+  Myrto Christina for finally convincing me to fix this.
+- Update YouTube filter for new code.
+- Fix parsing of rgb() values with spaces in them for 'border'
+  attribute.
+- Don't remove foo="" attributes if foo is a boolean attribute.  Thanks
+  valME for reporting.
+
+4.6.0, released 2013-11-30
+# Secure URI munge hashing algorithm has changed to hash_hmac("sha256", $url, $secret).
+  Please update any verification scripts you may have.
+# URI parsing algorithm was made more strict, so only prefixes which
+  looks like schemes will actually be schemes.  Thanks
+  Michael Gusev <mgusev@sugarcrm.com> for fixing.
+# %Core.EscapeInvalidChildren is no longer supported, and no longer does
+  anything.
+! New directive %Core.AllowHostnameUnderscore which allows underscores
+  in hostnames.
+- Eliminate quadratic behavior in DOMLex by using a proper queue.
+  Thanks Ole Laursen for noticing this.
+- Rewritten MakeWellFormed/FixNesting implementation eliminates quadratic
+  behavior in the rest of the purificaiton pipeline.  Thanks Chedburn
+  Networks for sponsoring this work.
+- Made Linkify URL parser a bit less permissive, so that non-breaking
+  spaces and commas are not included as part of URL.  Thanks nAS for fixing.
+- Fix some bad interactions with %HTML.Allowed and injectors.  Thanks
+  David Hirtz for reporting.
+- Fix infinite loop in DirectLex. Thanks Ashar Javed (@soaj1664ashar)
+  for reporting.
+
+4.5.0, released 2013-02-17
+# Fix bug where stacked attribute transforms clobber each other;
+  this also means it's no longer possible to override attribute
+  transforms in later modules.  No internal code was using this
+  but this may break some clients.
+# We now use SHA-1 to identify cached definitions, instead of MD5.
+! Support display:inline-block
+! Support for more white-space CSS values.
+! Permit underscores in font families
+! Support for page-break-* CSS3 properties when proprietary properties
+  are enabled.
+! New directive %Core.DisableExcludes; can be set to 'true' to turn off
+  SGML excludes checking.  If HTML Purifier is removing too much text
+  and you don't care about full standards compliance, try setting this to
+  'true'.
+- Use prepend for SPL autoloading on PHP 5.3 and later.
+- Fix bug with nofollow transform when pre-existing rel exists.
+- Fix bug where background:url() always gets lower-cased
+  (but not background-image:url())
+- Fix bug with non lower-case color names in HTML
+- Fix bug where data URI validation doesn't remove temporary files.
+  Thanks Javier Marín Ros <javiermarinros@gmail.com> for reporting.
+- Don't remove certain empty tags on RemoveEmpty.
+
+4.4.0, released 2012-01-18
+# Removed PEARSax3 handler.
+# URI.Munge now munges URIs inside the same host that go from https
+  to http.  Reported by Neike Taika-Tessaro.
+# Core.EscapeNonASCIICharacters now always transforms entities to
+  entities, even if target encoding is UTF-8.
+# Tighten up selector validation in ExtractStyleBlocks.
+  Non-syntactically valid selectors are now rejected, along with
+  some of the more obscure ones such as attribute selectors, the
+  :lang pseudoselector, and anything not in CSS2.1.  Furthermore,
+  ID and class selectors now work properly with the relevant
+  configuration attributes.  Also, mute errors when parsing CSS
+  with CSS Tidy.  Reported by Mario Heiderich and Norman Hippert.
+! Added support for 'scope' attribute on tables.
+! Added %HTML.TargetBlank, which adds target="blank" to all outgoing links.
+! Properly handle sub-lists directly nested inside of lists in
+  a standards compliant way, by moving them into the preceding <li>
+! Added %HTML.AllowedComments and %HTML.AllowedCommentsRegexp for
+  limited allowed comments in untrusted situations.
+! Implement iframes, and allow them to be used in untrusted mode with
+  %HTML.SafeIframe and %URI.SafeIframeRegexp.  Thanks Bradley M. Froehle
+  <brad.froehle@gmail.com> for submitting an initial version of the patch.
+! The Forms module now works properly for transitional doctypes.
+! Added support for internationalized domain names. You need the PEAR
+  Net_IDNA2 module to be in your path; if it is installed, ensure the
+  class can be loaded and then set %Core.EnableIDNA to true.
+- Color keywords are now case insensitive.  Thanks Yzmir Ramirez
+  <yramirez-htmlpurifier@adicio.com> for reporting.
+- Explicitly initialize anonModule variable to null.
+- Do not duplicate nofollow if already present.  Thanks 178
+  for reporting.
+- Do not add nofollow if hostname matches our current host.  Thanks 178
+  for reporting, and Neike Taika-Tessaro for helping diagnose.
+- Do not unset parser variable; this fixes intermittent serialization
+  problems.  Thanks Neike Taika-Tessaro for reporting, bill
+  <10010tiger@gmail.com> for diagnosing.
+- Fix iconv truncation bug, where non-UTF-8 target encodings see
+  output truncated after around 8000 characters.  Thanks Jörg Ludwig
+  <joerg.ludwig@iserv.eu> for reporting.
+- Fix broken table content model for XHTML1.1 (and also earlier
+  versions, although the W3C validator doesn't catch those violations).
+  Thanks GlitchMr <glitch.mr@gmail.com> for reporting.
+
+4.3.0, released 2011-03-27
+# Fixed broken caching of customized raw definitions, but requires an
+  API change.  The old API still works but will emit a warning,
+  see http://htmlpurifier.org/docs/enduser-customize.html#optimized
+  for how to upgrade your code.
+# Protect against Internet Explorer innerHTML behavior by specially
+  treating attributes with backticks but no angled brackets, quotes or
+  spaces.  This constitutes a slight semantic change, which can be
+  reverted using %Output.FixInnerHTML.  Reported by Neike Taika-Tessaro
+  and Mario Heiderich.
+# Protect against cssText/innerHTML by restricting allowed characters
+  used in fonts further than mandated by the specification and encoding
+  some extra special characters in URLs.  Reported by Neike
+  Taika-Tessaro and Mario Heiderich.
+! Added %HTML.Nofollow to add rel="nofollow" to external links.
+! More types of SPL autoloaders allowed on later versions of PHP.
+! Implementations for position, top, left, right, bottom, z-index
+  when %CSS.Trusted is on.
+! Add %Cache.SerializerPermissions option for custom serializer
+  directory/file permissions
+! Fix longstanding bug in Flash support for non-IE browsers, and
+  allow more wmode attributes.
+! Add %CSS.AllowedFonts to restrict permissible font names.
+- Switch to an iterative traversal of the DOM, which prevents us
+  from running out of stack space for deeply nested documents.
+  Thanks Maxim Krizhanovsky for contributing a patch.
+- Make removal of conditional IE comments ungreedy; thanks Bernd
+  for reporting.
+- Escape CDATA before removing Internet Explorer comments.
+- Fix removal of id attributes under certain conditions by ensuring
+  armor attributes are preserved when recreating tags.
+- Check if schema.ser was corrupted.
+- Check if zend.ze1_compatibility_mode is on, and error out if it is.
+  This safety check is only done for HTMLPurifier.auto.php; if you
+  are using standalone or the specialized includes files, you're
+  expected to know what you're doing.
+- Stop repeatedly writing the cache file after I'm done customizing a
+  raw definition.  Reported by ajh.
+- Switch to using require_once in the Bootstrap to work around bad
+  interaction with Zend Debugger and APC.  Reported by Antonio Parraga.
+- Fix URI handling when hostname is missing but scheme is present.
+  Reported by Neike Taika-Tessaro.
+- Fix missing numeric entities on DirectLex; thanks Neike Taika-Tessaro
+  for reporting.
+- Fix harmless notice from indexing into empty string.  Thanks Matthijs
+  Kooijman <matthijs@stdin.nl> for reporting.
+- Don't autoclose no parent elements are able to support the element
+  that triggered the autoclose.  In particular fixes strange behavior
+  of stray <li> tags.  Thanks pkuliga@gmail.com for reporting and
+  Neike Taika-Tessaro <pinkgothic@gmail.com> for debugging assistance.
+
+4.2.0, released 2010-09-15
+! Added %Core.RemoveProcessingInstructions, which lets you remove
+  <? ... ?> statements.
+! Added %URI.DisableResources functionality; the directive originally
+  did nothing.  Thanks David Rothstein for reporting.
+! Add documentation about configuration directive types.
+! Add %CSS.ForbiddenProperties configuration directive.
+! Add %HTML.FlashAllowFullScreen to permit embedded Flash objects
+  to utilize full-screen mode.
+! Add optional support for the <code>file</code> URI scheme, enable
+  by explicitly setting %URI.AllowedSchemes.
+! Add %Core.NormalizeNewlines options to allow turning off newline
+  normalization.
+- Fix improper handling of Internet Explorer conditional comments
+  by parser.  Thanks zmonteca for reporting.
+- Fix missing attributes bug when running on Mac Snow Leopard and APC.
+  Thanks sidepodcast for the fix.
+- Warn if an element is allowed, but an attribute it requires is
+  not allowed.
+
+4.1.1, released 2010-05-31
+- Fix undefined index warnings in maintenance scripts.
+- Fix bug in DirectLex for parsing elements with a single attribute
+  with entities.
+- Rewrite CSS output logic for font-family and url().  Thanks Mario
+  Heiderich <mario.heiderich@googlemail.com> for reporting and Takeshi
+  Terada <t-terada@violet.plala.or.jp> for suggesting the fix.
+- Emit an error for CollectErrors if a body is extracted
+- Fix bug where in background-position for center keyword handling.
+- Fix infinite loop when a wrapper element is inserted in a context
+  where it's not allowed.  Thanks Lars <lars@renoz.dk> for reporting.
+- Remove +x bit and shebang from index.php; only supported mode is to
+  explicitly call it with php.
+- Make test script less chatty when log_errors is on.
+
+4.1.0, released 2010-04-26
+! Support proprietary height attribute on table element
+! Support YouTube slideshows that contain /cp/ in their URL.
+! Support for data: URI scheme; not enabled by default, add it using
+  %URI.AllowedSchemes
+! Support flashvars when using %HTML.SafeObject and %HTML.SafeEmbed.
+! Support for Internet Explorer compatibility with %HTML.SafeObject
+  using %Output.FlashCompat.
+! Handle <ol><ol> properly, by inserting the necessary <li> tag.
+- Always quote the insides of url(...) in CSS.
+
+4.0.0, released 2009-07-07
+# APIs for ConfigSchema subsystem have substantially changed. See
+  docs/dev-config-bcbreaks.txt for details; in essence, anything that
+  had both namespace and directive now have a single unified key.
+# Some configuration directives were renamed, specifically:
+    %AutoFormatParam.PurifierLinkifyDocURL -> %AutoFormat.PurifierLinkify.DocURL
+    %FilterParam.ExtractStyleBlocksEscaping -> %Filter.ExtractStyleBlocks.Escaping
+    %FilterParam.ExtractStyleBlocksScope -> %Filter.ExtractStyleBlocks.Scope
+    %FilterParam.ExtractStyleBlocksTidyImpl -> %Filter.ExtractStyleBlocks.TidyImpl
+  As usual, the old directive names will still work, but will throw E_NOTICE
+  errors.
+# The allowed values for class have been relaxed to allow all of CDATA for
+  doctypes that are not XHTML 1.1 or XHTML 2.0.  For old behavior, set
+  %Attr.ClassUseCDATA to false.
+# Instead of appending the content model to an old content model, a blank
+  element will replace the old content model.  You can use #SUPER to get
+  the old content model.
+! More robust support for name="" and id=""
+! HTMLPurifier_Config::inherit($config) allows you to inherit one
+  configuration, and have changes to that configuration be propagated
+  to all of its children.
+! Implement %HTML.Attr.Name.UseCDATA, which relaxes validation rules on
+  the name attribute when set. Use with care. Thanks Ian Cook for
+  sponsoring.
+! Implement %AutoFormat.RemoveEmpty.RemoveNbsp, which removes empty
+  tags that contain non-breaking spaces as well other whitespace. You
+  can also modify which tags should have &nbsp; maintained with
+  %AutoFormat.RemoveEmpty.RemoveNbsp.Exceptions.
+! Implement %Attr.AllowedClasses, which allows administrators to restrict
+  classes users can use to a specified finite set of classes, and
+  %Attr.ForbiddenClasses, which is the logical inverse.
+! You can now maintain your own configuration schema directories by
+  creating a config-schema.php file or passing an extra argument. Check
+  docs/dev-config-schema.html for more details.
+! Added HTMLPurifier_Config->serialize() method, which lets you save away
+  your configuration in a compact serial file, which you can unserialize
+  and use directly without having to go through the overhead of setup.
+- Fix bug where URIDefinition would not get cleared if it's directives got
+  changed.
+- Fix fatal error in HTMLPurifier_Encoder on certain platforms (probably NetBSD 5.0)
+- Fix bug in Linkify autoformatter involving <a><span>http://foo</span></a>
+- Make %URI.Munge not apply to links that have the same host as your host.
+- Prevent stray </body> tag from truncating output, if a second </body>
+  is present.
+. Created script maintenance/rename-config.php for renaming a configuration
+  directive while maintaining its alias.  This script does not change source code.
+. Implement namespace locking for definition construction, to prevent
+  bugs where a directive is used for definition construction but is not
+  used to construct the cache hash.
+
+3.3.0, released 2009-02-16
+! Implement CSS property 'overflow' when %CSS.AllowTricky is true.
+! Implement generic property list classess
+- Fix bug with testEncodingSupportsASCII() algorithm when iconv() implementation
+  does not do the "right thing" with characters not supported in the output
+  set.
+- Spellcheck UTF-8: The Secret To Character Encoding
+- Fix improper removal of the contents of elements with only whitespace. Thanks
+  Eric Wald for reporting.
+- Fix broken test suite in versions of PHP without spl_autoload_register()
+- Fix degenerate case with YouTube filter involving double hyphens.
+  Thanks Pierre Attar for reporting.
+- Fix YouTube rendering problem on certain versions of Firefox.
+- Fix CSSDefinition Printer problems with decorators
+- Add text parameter to unit tests, forces text output
+. Add verbose mode to command line test runner, use (--verbose)
+. Turn on unit tests for UnitConverter
+. Fix missing version number in configuration %Attr.DefaultImageAlt (added 3.2.0)
+. Fix newline errors that caused spurious failures when CRLF HTML Purifier was
+  tested on Linux.
+. Removed trailing whitespace from all text files, see
+  remote-trailing-whitespace.php maintenance script.
+. Convert configuration to use property list backend.
+
+3.2.0, released 2008-10-31
+# Using %Core.CollectErrors forces line number/column tracking on, whereas
+  previously you could theoretically turn it off.
+# HTMLPurifier_Injector->notifyEnd() is formally deprecated. Please
+  use handleEnd() instead.
+! %Output.AttrSort for when you need your attributes in alphabetical order to
+  deal with a bug in FCKEditor. Requested by frank farmer.
+! Enable HTML comments when %HTML.Trusted is on. Requested by Waldo Jaquith.
+! Proper support for name attribute. It is now allowed and equivalent to the id
+  attribute in a and img tags, and is only converted to id when %HTML.TidyLevel
+  is heavy (for all doctypes).
+! %AutoFormat.RemoveEmpty to remove some empty tags from documents. Please don't
+  use on hand-written HTML.
+! Add error-cases for unsupported elements in MakeWellFormed. This enables
+  the strategy to be used, standalone, on untrusted input.
+! %Core.AggressivelyFixLt is on by default. This causes more sensible
+  processing of left angled brackets in smileys and other whatnot.
+! Test scripts now have a 'type' parameter, which lets you say 'htmlpurifier',
+  'phpt', 'vtest', etc. in order to only execute those tests. This supercedes
+  the --only-phpt parameter, although for backwards-compatibility the flag
+  will still work.
+! AutoParagraph auto-formatter will now preserve double-newlines upon output.
+  Users who are not performing inbound filtering, this may seem a little
+  useless, but as a bonus, the test suite and handling of edge cases is also
+  improved.
+! Experimental implementation of forms for %HTML.Trusted
+! Track column numbers when maintain line numbers is on
+! Proprietary 'background' attribute on table-related elements converted into
+  corresponding CSS.  Thanks Fusemail for sponsoring this feature!
+! Add forward(), forwardUntilEndToken(), backward() and current() to Injector
+  supertype.
+! HTMLPurifier_Injector->handleEnd() permits modification to end tokens. The
+  time of operation varies slightly from notifyEnd() as *all* end tokens are
+  processed by the injector before they are subject to the well-formedness rules.
+! %Attr.DefaultImageAlt allows overriding default behavior of setting alt to
+  basename of image when not present.
+! %AutoFormat.DisplayLinkURI neuters <a> tags into plain text URLs.
+- Fix two bugs in %URI.MakeAbsolute; one involving empty paths in base URLs,
+  the other involving an undefined $is_folder error.
+- Throw error when %Core.Encoding is set to a spurious value. Previously,
+  this errored silently and returned false.
+- Redirected stderr to stdout for flush error output.
+- %URI.DisableExternal will now use the host in %URI.Base if %URI.Host is not
+  available.
+- Do not re-munge URL if the output URL has the same host as the input URL.
+  Requested by Chris.
+- Fix error in documentation regarding %Filter.ExtractStyleBlocks
+- Prevent <![CDATA[<body></body>]]> from triggering %Core.ConvertDocumentToFragment
+- Fix bug with inline elements in blockquotes conflicting with strict doctype
+- Detect if HTML support is disabled for DOM by checking for loadHTML() method.
+- Fix bug where dots and double-dots in absolute URLs without hostname were
+  not collapsed by URIFilter_MakeAbsolute.
+- Fix bug with anonymous modules operating on SafeEmbed or SafeObject elements
+  by reordering their addition.
+- Will now throw exception on many error conditions during lexer creation; also
+  throw an exception when MaintainLineNumbers is true, but a non-tracksLineNumbers
+  is being used.
+- Detect if domxml extension is loaded, and use DirectLEx accordingly.
+- Improve handling of big numbers with floating point arithmetic in UnitConverter.
+  Reported by David Morton.
+. Strategy_MakeWellFormed now operates in-place, saving memory and allowing
+  for more interesting filter-backtracking
+. New HTMLPurifier_Injector->rewind() functionality, allows injectors to rewind
+  index to reprocess tokens.
+. StringHashParser now allows for multiline sections with "empty" content;
+  previously the section would remain undefined.
+. Added --quick option to multitest.php, which tests only the most recent
+  release for each series.
+. Added --distro option to multitest.php, which accepts either 'normal' or
+  'standalone'. This supercedes --exclude-normal and --exclude-standalone
+
+3.1.1, released 2008-06-19
+# %URI.Munge now, by default, does not munge resources (for example, <img src="">)
+  In order to enable this again, please set %URI.MungeResources to true.
+! More robust imagecrash protection with height/width CSS with %CSS.MaxImgLength,
+  and height/width HTML with %HTML.MaxImgLength.
+! %URI.MungeSecretKey for secure URI munging. Thanks Chris
+  for sponsoring this feature. Check out the corresponding documentation
+  for details. (Att Nightly testers: The API for this feature changed before
+  the general release. Namely, rename your directives %URI.SecureMungeSecretKey =>
+  %URI.MungeSecretKey and and %URI.SecureMunge => %URI.Munge)
+! Implemented post URI filtering. Set member variable $post to true to set
+  a URIFilter as such.
+! Allow modules to define injectors via $info_injector. Injectors are
+  automatically disabled if injector's needed elements are not found.
+! Support for "safe" objects added, use %HTML.SafeObject and %HTML.SafeEmbed.
+  Thanks Chris for sponsoring. If you've been using ad hoc code from the
+  forums, PLEASE use this instead.
+! Added substitutions for %e, %n, %a and %p in %URI.Munge (in order,
+  embedded, tag name, attribute name, CSS property name). See %URI.Munge
+  for more details. Requested by Jochem Blok.
+- Disable percent height/width attributes for img.
+- AttrValidator operations are now atomic; updates to attributes are not
+  manifest in token until end of operations. This prevents naughty internal
+  code from directly modifying CurrentToken when they're not supposed to.
+  This semantics change was requested by frank farmer.
+- Percent encoding checks enabled for URI query and fragment
+- Fix stray backslashes in font-family; CSS Unicode character escapes are
+  now properly resolved (although *only* in font-family). Thanks Takeshi Terada
+  for reporting.
+- Improve parseCDATA algorithm to take into account newline normalization
+- Account for browser confusion between Yen character and backslash in
+  Shift_JIS encoding. This fix generalizes to any other encoding which is not
+  a strict superset of printable ASCII. Thanks Takeshi Terada for reporting.
+- Fix missing configuration parameter in Generator calls. Thanks vs for the
+  partial patch.
+- Improved adherence to Unicode by checking for non-character codepoints.
+  Thanks Geoffrey Sneddon for reporting. This may result in degraded
+  performance for extremely large inputs.
+- Allow CSS property-value pair ''text-decoration: none''. Thanks Jochem Blok
+  for reporting.
+. Added HTMLPurifier_UnitConverter and HTMLPurifier_Length for convenient
+  handling of CSS-style lengths. HTMLPurifier_AttrDef_CSS_Length now uses
+  this class.
+. API of HTMLPurifier_AttrDef_CSS_Length changed from __construct($disable_negative)
+  to __construct($min, $max). __construct(true) is equivalent to
+  __construct('0').
+. Added HTMLPurifier_AttrDef_Switch class
+. Rename HTMLPurifier_HTMLModule_Tidy->construct() to setup() and bubble method
+  up inheritance hierarchy to HTMLPurifier_HTMLModule. All HTMLModules
+  get this called with the configuration object.  All modules now
+  use this rather than __construct(), although legacy code using constructors
+  will still work--the new format, however, lets modules access the
+  configuration object for HTML namespace dependant tweaks.
+. AttrDef_HTML_Pixels now takes a single construction parameter, pixels.
+. ConfigSchema data-structure heavily optimized; on average it uses a third
+  the memory it did previously. The interface has changed accordingly,
+  consult changes to HTMLPurifier_Config for details.
+. Variable parsing types now are magic integers instead of strings
+. Added benchmark for ConfigSchema
+. HTMLPurifier_Generator requires $config and $context parameters. If you
+  don't know what they should be, use HTMLPurifier_Config::createDefault()
+  and new HTMLPurifier_Context().
+. Printers now properly distinguish between output configuration, and
+  target configuration. This is not applicable to scripts using
+  the Printers for HTML Purifier related tasks.
+. HTML/CSS Printers must be primed with prepareGenerator($gen_config), otherwise
+  fatal errors will ensue.
+. URIFilter->prepare can return false in order to abort loading of the filter
+. Factory for AttrDef_URI implemented, URI#embedded to indicate URI that embeds
+  an external resource.
+. %URI.Munge functionality factored out into a post-filter class.
+. Added CurrentCSSProperty context variable during CSS validation
+
+3.1.0, released 2008-05-18
+# Unnecessary references to objects (vestiges of PHP4) removed from method
+  signatures.  The following methods do not need references when assigning from
+  them and will result in E_STRICT errors if you try:
+    + HTMLPurifier_Config->get*Definition() [* = HTML, CSS]
+    + HTMLPurifier_ConfigSchema::instance()
+    + HTMLPurifier_DefinitionCacheFactory::instance()
+    + HTMLPurifier_DefinitionCacheFactory->create()
+    + HTMLPurifier_DoctypeRegistry->register()
+    + HTMLPurifier_DoctypeRegistry->get()
+    + HTMLPurifier_HTMLModule->addElement()
+    + HTMLPurifier_HTMLModule->addBlankElement()
+    + HTMLPurifier_LanguageFactory::instance()
+# Printer_ConfigForm's get*() functions were static-ified
+# %HTML.ForbiddenAttributes requires attribute declarations to be in the
+  form of tag@attr, NOT tag.attr (which will throw an error and won't do
+  anything). This is for forwards compatibility with XML; you'd do best
+  to migrate an %HTML.AllowedAttributes directives to this syntax too.
+! Allow index to be false for config from form creation
+! Added HTMLPurifier::VERSION constant
+! Commas, not dashes, used for serializer IDs. This change is forwards-compatible
+  and allows for version numbers like "3.1.0-dev".
+! %HTML.Allowed deals gracefully with whitespace anywhere, anytime!
+! HTML Purifier's URI handling is a lot more robust, with much stricter
+  validation checks and better percent encoding handling. Thanks Gareth Heyes
+  for indicating security vulnerabilities from lax percent encoding.
+! Bootstrap autoloader deals more robustly with classes that don't exist,
+  preventing class_exists($class, true) from barfing.
+- InterchangeBuilder now alphabetizes its lists
+- Validation error in configdoc output fixed
+- Iconv and other encoding errors muted even with custom error handlers that
+  do not honor error_reporting
+- Add protection against imagecrash attack with CSS height/width
+- HTMLPurifier::instance() created for consistency, is equivalent to getInstance()
+- Fixed and revamped broken ConfigForm smoketest
+- Bug with bool/null fields in Printer_ConfigForm fixed
+- Bug with global forbidden attributes fixed
+- Improved error messages for allowed and forbidden HTML elements and attributes
+- Missing (or null) in configdoc documentation restored
+- If DOM throws and exception during parsing with PH5P (occurs in newer versions
+  of DOM), HTML Purifier punts to DirectLex
+- Fatal error with unserialization of ScriptRequired
+- Created directories are now chmod'ed properly
+- Fixed bug with fallback languages in LanguageFactory
+- Standalone testing setup properly with autoload
+. Out-of-date documentation revised
+. UTF-8 encoding check optimization as suggested by Diego
+. HTMLPurifier_Error removed in favor of exceptions
+. More copy() function removed; should use clone instead
+. More extensive unit tests for HTMLDefinition
+. assertPurification moved to central harness
+. HTMLPurifier_Generator accepts $config and $context parameters during
+  instantiation, not runtime
+. Double-quotes outside of attribute values are now unescaped
+
+3.1.0rc1, released 2008-04-22
+# Autoload support added. Internal require_once's removed in favor of an
+  explicit require list or autoloading. To use HTML Purifier,
+  you must now either use HTMLPurifier.auto.php
+  or HTMLPurifier.includes.php; setting the include path and including
+  HTMLPurifier.php is insufficient--in such cases include HTMLPurifier.autoload.php
+  as well to register our autoload handler (or modify your autoload function
+  to check HTMLPurifier_Bootstrap::getPath($class)). You can also use
+  HTMLPurifier.safe-includes.php for a less performance friendly but more
+  user-friendly library load.
+# HTMLPurifier_ConfigSchema static functions are officially deprecated. Schema
+  information is stored in the ConfigSchema directory, and the
+  maintenance/generate-schema-cache.php generates the schema.ser file, which
+  is now instantiated. Support for userland schema changes coming soon!
+# HTMLPurifier_Config will now throw E_USER_NOTICE when you use a directive
+  alias; to get rid of these errors just modify your configuration to use
+  the new directive name.
+# HTMLPurifier->addFilter is deprecated; built-in filters can now be
+  enabled using %Filter.$filter_name or by setting your own filters using
+  %Filter.Custom
+# Directive-level safety properties superceded in favor of module-level
+  safety. Internal method HTMLModule->addElement() has changed, although
+  the externally visible HTMLDefinition->addElement has *not* changed.
+! Extra utility classes for testing and non-library operations can
+  be found in extras/. Specifically, these are FSTools and ConfigDoc.
+  You may find a use for these in your own project, but right now they
+  are highly experimental and volatile.
+! Integration with PHPT allows for automated smoketests
+! Limited support for proprietary HTML elements, namely <marquee>, sponsored
+  by Chris. You can enable them with %HTML.Proprietary if your client
+  demands them.
+! Support for !important CSS cascade modifier. By default, this will be stripped
+  from CSS, but you can enable it using %CSS.AllowImportant
+! Support for display and visibility CSS properties added, set %CSS.AllowTricky
+  to true to use them.
+! HTML Purifier now has its own Exception hierarchy under HTMLPurifier_Exception.
+  Developer error (not enduser error) can cause these to be triggered.
+! Experimental kses() wrapper introduced with HTMLPurifier.kses.php
+! Finally %CSS.AllowedProperties for tweaking allowed CSS properties without
+  mucking around with HTMLPurifier_CSSDefinition
+! ConfigDoc output has been enhanced with version and deprecation info.
+! %HTML.ForbiddenAttributes and %HTML.ForbiddenElements implemented.
+- Autoclose now operates iteratively, i.e. <span><span><div> now has
+  both span tags closed.
+- Various HTMLPurifier_Config convenience functions now accept another parameter
+  $schema which defines what HTMLPurifier_ConfigSchema to use besides the
+  global default.
+- Fix bug with trusted script handling in libxml versions later than 2.6.28.
+- Fix bug in ExtractStyleBlocks with comments in style tags
+- Fix bug in comment parsing for DirectLex
+- Flush output now displayed when in command line mode for unit tester
+- Fix bug with rgb(0, 1, 2) color syntax with spaces inside shorthand syntax
+- HTMLPurifier_HTMLDefinition->addAttribute can now be called multiple times
+  on the same element without emitting errors.
+- Fixed fatal error in PH5P lexer with invalid tag names
+. Plugins now get their own changelogs according to project conventions.
+. Convert tokens to use instanceof, reducing memory footprint and
+  improving comparison speed.
+. Dry runs now supported in SimpleTest; testing facilities improved
+. Bootstrap class added for handling autoloading functionality
+. Implemented recursive glob at FSTools->globr
+. ConfigSchema now has instance methods for all corresponding define*
+  static methods.
+. A couple of new historical maintenance scripts were added.
+. HTMLPurifier/HTMLModule/Tidy/XHTMLAndHTML4.php split into two files
+. tests/index.php can now be run from any directory.
+. HTMLPurifier_Token subclasses split into seperate files
+. HTMLPURIFIER_PREFIX now is defined in Bootstrap.php, NOT HTMLPurifier.php
+. HTMLPURIFIER_PREFIX can now be defined outside of HTML Purifier
+. New --php=php flag added, allows PHP executable to be specified (command
+  line only!)
+. htmlpurifier_add_test() preferred method to translate test files in to
+  classes, because it handles PHPT files too.
+. Debugger class is deprecated and will be removed soon.
+. Command line argument parsing for testing scripts revamped, now --opt value
+  format is supported.
+. Smoketests now cleanup after magic quotes
+. Generator now can output comments (however, comments are still stripped
+  from HTML Purifier output)
+. HTMLPurifier_ConfigSchema->validate() deprecated in favor of
+  HTMLPurifier_VarParser->parse()
+. Integers auto-cast into float type by VarParser.
+. HTMLPURIFIER_STRICT removed; no validation is performed on runtime, only
+  during cache generation
+. Reordered script calls in maintenance/flush.php
+. Command line scripts now honor exit codes
+. When --flush fails in unit testers, abort tests and print message
+. Improved documentation in docs/dev-flush.html about the maintenance scripts
+. copy() methods removed in favor of clone keyword
+
+3.0.0, released 2008-01-06
+# HTML Purifier is PHP 5 only! The 2.1.x branch will be maintained
+  until PHP 4 is completely deprecated, but no new features will be added
+  to it.
+  + Visibility declarations added
+  + Constructor methods renamed to __construct()
+  + PHP4 reference cruft removed (in progress)
+! CSS properties are now case-insensitive
+! DefinitionCacheFactory now can register new implementations
+! New HTMLPurifier_Filter_ExtractStyleBlocks for extracting <style> from
+  documents and cleaning their contents up. Requires the CSSTidy library
+  <http://csstidy.sourceforge.net/>. You can access the blocks with the
+  'StyleBlocks' Context variable ($purifier->context->get('StyleBlocks')).
+  The output CSS can also be "scoped" for a specific element, use:
+  %Filter.ExtractStyleBlocksScope
+! Experimental support for some proprietary CSS attributes allowed:
+  opacity (and all of the browser-specific equivalents) and scrollbar colors.
+  Enable by setting %CSS.Proprietary to true.
+- Colors missing # but in hex form will be corrected
+- CSS Number algorithm improved
+- Unit testing and multi-testing now on steroids: command lines,
+  XML output, and other goodies now added.
+. Unit tests for Injector improved
+. New classes:
+  + HTMLPurifier_AttrDef_CSS_AlphaValue
+  + HTMLPurifier_AttrDef_CSS_Filter
+. Multitest now has a file docblock
+
+2.1.3, released 2007-11-05
+! tests/multitest.php allows you to test multiple versions by running
+  tests/index.php through multiple interpreters using `phpv` shell
+  script (you must provide this script!)
+- Fixed poor include ordering for Email URI AttrDefs, causes fatal errors
+  on some systems.
+- Injector algorithm further refined: off-by-one error regarding skip
+  counts for dormant injectors fixed
+- Corrective blockquote definition now enabled for HTML 4.01 Strict
+- Fatal error when <img> tag (or any other element with required attributes)
+  has 'id' attribute fixed, thanks NykO18 for reporting
+- Fix warning emitted when a non-supported URI scheme is passed to the
+  MakeAbsolute URIFilter, thanks NykO18 (again)
+- Further refine AutoParagraph injector. Behavior inside of elements
+  allowing paragraph tags clarified: only inline content delimeted by
+  double newlines (not block elements) are paragraphed.
+- Buggy treatment of end tags of elements that have required attributes
+  fixed (does not manifest on default tag-set)
+- Spurious internal content reorganization error suppressed
+- HTMLDefinition->addElement now returns a reference to the created
+  element object, as implied by the documentation
+- Phorum mod's HTML Purifier help message expanded (unreleased elsewhere)
+- Fix a theoretical class of infinite loops from DirectLex reported
+  by Nate Abele
+- Work around unnecessary DOMElement type-cast in PH5P that caused errors
+  in PHP 5.1
+- Work around PHP 4 SimpleTest lack-of-error complaining for one-time-only
+  HTMLDefinition errors, this may indicate problems with error-collecting
+  facilities in PHP 5
+- Make ErrorCollectorEMock work in both PHP 4 and PHP 5
+- Make PH5P work with PHP 5.0 by removing unnecessary array parameter typedef
+. %Core.AcceptFullDocuments renamed to %Core.ConvertDocumentToFragment
+  to better communicate its purpose
+. Error unit tests can now specify the expectation of no errors. Future
+  iterations of the harness will be extremely strict about what errors
+  are allowed
+. Extend Injector hooks to allow for more powerful injector routines
+. HTMLDefinition->addBlankElement created, as according to the HTMLModule
+  method
+. Doxygen configuration file updated, with minor improvements
+. Test runner now checks for similarly named files in conf/ directory too.
+. Minor cosmetic change to flush-definition-cache.php: trailing newline is
+  outputted
+. Maintenance script for generating PH5P patch added, original PH5P source
+  file also added under version control
+. Full unit test runner script title made more descriptive with PHP version
+. Updated INSTALL file to state that 4.3.7 is the earliest version we
+  are actively testing
+
+2.1.2, released 2007-09-03
+! Implemented Object module for trusted users
+! Implemented experimental HTML5 parsing mode using PH5P. To use, add
+  this to your code:
+        require_once 'HTMLPurifier/Lexer/PH5P.php';
+        $config->set('Core', 'LexerImpl', 'PH5P');
+  Note that this Lexer introduces some classes not in the HTMLPurifier
+  namespace.  Also, this is PHP5 only.
+! CSS property border-spacing implemented
+- Fix non-visible parsing error in DirectLex with empty tags that have
+  slashes inside attribute values.
+- Fix typo in CSS definition: border-collapse:seperate; was incorrectly
+  accepted as valid CSS. Usually non-visible, because this styling is the
+  default for tables in most browsers. Thanks Brett Zamir for pointing
+  this out.
+- Fix validation errors in configuration form
+- Hammer out a bunch of edge-case bugs in the standalone distribution
+- Inclusion reflection removed from URISchemeRegistry; you must manually
+  include any new schema files you wish to use
+- Numerous typo fixes in documentation thanks to Brett Zamir
+. Unit test refactoring for one logical test per test function
+. Config and context parameters in ComplexHarness deprecated: instead, edit
+  the $config and $context member variables
+. HTML wrapper in DOMLex now takes DTD identifiers into account; doesn't
+  really make a difference, but is good for completeness sake
+. merge-library.php script refactored for greater code reusability and
+  PHP4 compatibility
+
+2.1.1, released 2007-08-04
+- Fix show-stopper bug in %URI.MakeAbsolute functionality
+- Fix PHP4 syntax error in standalone version
+. Add prefix directory to include path for standalone, this prevents
+  other installations from clobbering the standalone's URI schemes
+. Single test methods can be invoked by prefixing with __only
+
+2.1.0, released 2007-08-02
+# flush-htmldefinition-cache.php superseded in favor of a generic
+  flush-definition-cache.php script, you can clear a specific cache
+  by passing its name as a parameter to the script
+! Phorum mod implemented for HTML Purifier
+! With %Core.AggressivelyFixLt, <3 and similar emoticons no longer
+  trigger HTML removal in PHP5 (DOMLex). This directive is not necessary
+  for PHP4 (DirectLex).
+! Standalone file now available, which greatly reduces the amount of
+  includes (although there are still a few files that reside in the
+  standalone folder)
+! Relative URIs can now be transformed into their absolute equivalents
+  using %URI.Base and %URI.MakeAbsolute
+! Ruby implemented for XHTML 1.1
+! You can now define custom URI filtering behavior, see enduser-uri-filter.html
+  for more details
+! UTF-8 font names now supported in CSS
+- AutoFormatters emit friendly error messages if tags or attributes they
+  need are not allowed
+- ConfigForm's compactification of directive names is now configurable
+- AutoParagraph autoformatter algorithm refined after field-testing
+- XHTML 1.1 now applies XHTML 1.0 Strict cleanup routines, namely
+  blockquote wrapping
+- Contents of <style> tags removed by default when tags are removed
+. HTMLPurifier_Config->getSerial() implemented, this is extremely useful
+  for output cache invalidation
+. ConfigForm printer now can retrieve CSS and JS files as strings, in
+  case HTML Purifier's directory is not publically accessible
+. Introduce new text/itext configuration directive values: these represent
+  longer strings that would be more appropriately edited with a textarea
+. Allow newlines to act as separators for lists, hashes, lookups and
+  %HTML.Allowed
+. ConfigForm generates textareas instead of text inputs for lists, hashes,
+  lookups, text and itext fields
+. Hidden element content removal genericized: %Core.HiddenElements can
+  be used to customize this behavior, by default <script> and <style> are
+  hidden
+. Added HTMLPURIFIER_PREFIX constant, should be used instead of dirname(__FILE__)
+. Custom ChildDef added to default include list
+. URIScheme reflection improved: will not attempt to include file if class
+  already exists. May clobber autoload, so I need to keep an eye on it
+. ConfigSchema heavily optimized, will only collect information and validate
+  definitions when HTMLPURIFIER_SCHEMA_STRICT is true.
+. AttrDef_URI unit tests and implementation refactored
+. benchmarks/ directory now protected from public view with .htaccess file;
+  run the tests via command line
+. URI scheme is munged off if there is no authority and the scheme is the
+  default one
+. All unit tests inherit from HTMLPurifier_Harness, not UnitTestCase
+. Interface for URIScheme changed
+. Generic URI object to hold components of URI added, most systems involved
+  in URI validation have been migrated to use it
+. Custom filtering for URIs factored out to URIDefinition interface for
+  maximum extensibility
+
+2.0.1, released 2007-06-27
+! Tag auto-closing now based on a ChildDef heuristic rather than a
+  manually set auto_close array; some behavior may change
+! Experimental AutoFormat functionality added: auto-paragraph and
+  linkify your HTML input by setting %AutoFormat.AutoParagraph and
+  %AutoFormat.Linkify to true
+! Newlines normalized internally, and then converted back to the
+  value of PHP_EOL. If this is not desired, set your newline format
+  using %Output.Newline.
+! Beta error collection, messages are implemented for the most generic
+  cases involving Lexing or Strategies
+- Clean up special case code for <script> tags
+- Reorder includes for DefinitionCache decorators, fixes a possible
+  missing class error
+- Fixed bug where manually modified definitions were not saved via cache
+  (mostly harmless, except for the fact that it would be a little slower)
+- Configuration objects with different serials do not clobber each
+  others when revision numbers are unequal
+- Improve Serializer DefinitionCache directory permissions checks
+- DefinitionCache no longer throws errors when it encounters old
+  serial files that do not conform to the current style
+- Stray xmlns attributes removed from configuration documentation
+- configForm.php smoketest no longer has XSS vulnerability due to
+  unescaped print_r output
+- Printer adheres to configuration's directives on output format
+- Fix improperly named form field in ConfigForm printer
+. Rewire some test-cases to swallow errors rather than expect them
+. HTMLDefinition printer updated with some of the new attributes
+. DefinitionCache keys reordered to reflect precedence: version number,
+  hash, then revision number
+. %Core.DefinitionCache renamed to %Cache.DefinitionImpl
+. Interlinking in configuration documentation added using
+  Injector_PurifierLinkify
+. Directives now keep track of aliases to themselves
+. Error collector now requires a severity to be passed, use PHP's internal
+  error constants for this
+. HTMLPurifier_Config::getAllowedDirectivesForForm implemented, allows
+  much easier selective embedding of configuration values
+. Doctype objects now accept public and system DTD identifiers
+. %HTML.Doctype is now constrained by specific values, to specify a custom
+  doctype use new %HTML.CustomDoctype
+. ConfigForm truncates long directives to keep the form small, and does
+  not re-output namespaces
+
+2.0.0, released 2007-06-20
+# Completely refactored HTMLModuleManager, decentralizing safety
+  information
+# Transform modules changed to Tidy modules, which offer more flexibility
+  and better modularization
+# Configuration object now finalizes itself when a read operation is
+  performed on it, ensuring that its internal state stays consistent.
+  To revert this behavior, you can set the $autoFinalize member variable
+  off, but it's not recommended.
+# New compact syntax for AttrDef objects that can be used to instantiate
+  new objects via make()
+# Definitions (esp. HTMLDefinition) are now cached for a significant
+  performance boost. You can disable caching by setting %Core.DefinitionCache
+  to null. You CANNOT edit raw definitions without setting the corresponding
+  DefinitionID directive (%HTML.DefinitionID for HTMLDefinition).
+# Contents between <script> tags are now completely removed if <script>
+  is not allowed
+# Prototype-declarations for Lexer removed in favor of configuration
+  determination of Lexer implementations.
+! HTML Purifier now works in PHP 4.3.2.
+! Configuration form-editing API makes tweaking HTMLPurifier_Config a
+  breeze!
+! Configuration directives that accept hashes now allow new string
+  format: key1:value1,key2:value2
+! ConfigDoc now factored into OOP design
+! All deprecated elements now natively supported
+! Implement TinyMCE styled whitelist specification format in
+  %HTML.Allowed
+! Config object gives more friendly error messages when things go wrong
+! Advanced API implemented: easy functions for creating elements (addElement)
+  and attributes (addAttribute) on HTMLDefinition
+! Add native support for required attributes
+- Deprecated and removed EnableRedundantUTF8Cleaning. It didn't even work!
+- DOMLex will not emit errors when a custom error handler that does not
+  honor error_reporting is used
+- StrictBlockquote child definition refrains from wrapping whitespace
+  in tags now.
+- Bug resulting from tag transforms to non-allowed elements fixed
+- ChildDef_Custom's regex generation has been improved, removing several
+  false positives
+. Unit test for ElementDef created, ElementDef behavior modified to
+  be more flexible
+. Added convenience functions for HTMLModule constructors
+. AttrTypes now has accessor functions that should be used instead
+  of directly manipulating info
+. TagTransform_Center deprecated in favor of generic TagTransform_Simple
+. Add extra protection in AttrDef_URI against phantom Schemes
+. Doctype object added to HTMLDefinition which describes certain aspects
+  of the operational document type
+. Lexer is now pre-emptively included, with a conditional include for the
+  PHP5 only version.
+. HTMLDefinition and CSSDefinition have a common parent class: Definition.
+. DirectLex can now track line-numbers
+. Preliminary error collector is in place, although no code actually reports
+  errors yet
+. Factor out most of ValidateAttributes to new AttrValidator class
+
+1.6.1, released 2007-05-05
+! Support for more deprecated attributes via transformations:
+  + hspace and vspace in img
+  + size and noshade in hr
+  + nowrap in td
+  + clear in br
+  + align in caption, table, img and hr
+  + type in ul, ol and li
+! DirectLex now preserves text in which a < bracket is followed by
+  a non-alphanumeric character. This means that certain emoticons
+  are now preserved.
+! %Core.RemoveInvalidImg is now operational, when set to false invalid
+  images will hang around with an empty src
+! target attribute in a tag supported, use %Attr.AllowedFrameTargets
+  to enable
+! CSS property white-space now allows nowrap (supported in all modern
+  browsers) but not others (which have spotty browser implementations)
+! XHTML 1.1 mode now sort-of works without any fatal errors, and
+  lang is now moved over to xml:lang.
+! Attribute transformation smoketest available at smoketests/attrTransform.php
+! Transformation of font's size attribute now handles super-large numbers
+- Possibly fatal bug with __autoload() fixed in module manager
+- Invert HTMLModuleManager->addModule() processing order to check
+  prefixes first and then the literal module
+- Empty strings get converted to empty arrays instead of arrays with
+  an empty string in them.
+- Merging in attribute lists now works.
+. Demo script removed: it has been added to the website's repository
+. Basic.php script modified to work out of the box
+. Refactor AttrTransform classes to reduce duplication
+. AttrTransform_TextAlign axed in favor of a more general
+  AttrTransform_EnumToCSS, refer to HTMLModule/TransformToStrict.php to
+  see how the new equivalent is implemented
+. Unit tests now use exclusively assertIdentical
+
+1.6.0, released 2007-04-01
+! Support for most common deprecated attributes via transformations:
+  + bgcolor in td, th, tr and table
+  + border in img
+  + name in a and img
+  + width in td, th and hr
+  + height in td, th
+! Support for CSS attribute 'height' added
+! Support for rel and rev attributes in a tags added, use %Attr.AllowedRel
+  and %Attr.AllowedRev to activate
+- You can define ID blacklists using regular expressions via
+  %Attr.IDBlacklistRegexp
+- Error messages are emitted when you attempt to "allow" elements or
+  attributes that HTML Purifier does not support
+- Fix segfault in unit test. The problem is not very reproduceable and
+  I don't know what causes it, but a six line patch fixed it.
+
+1.5.0, released 2007-03-23
+! Added a rudimentary I18N and L10N system modeled off MediaWiki. It
+  doesn't actually do anything yet, but keep your eyes peeled.
+! docs/enduser-utf8.html explains how to use UTF-8 and HTML Purifier
+! Newly structured HTMLDefinition modeled off of XHTML 1.1 modules.
+  I am loathe to release beta quality APIs, but this is exactly that;
+  don't use the internal interfaces if you're not willing to do migration
+  later on.
+- Allow 'x' subtag in language codes
+- Fixed buggy chameleon-support for ins and del
+. Added support for IDREF attributes (i.e. for)
+. Renamed HTMLPurifier_AttrDef_Class to HTMLPurifier_AttrDef_Nmtokens
+. Removed context variable ParentType, replaced with IsInline, which
+  is false when you're not inline and an integer of the parent that
+  caused you to become inline when you are (so possibly zero)
+. Removed ElementDef->type in favor of ElementDef->descendants_are_inline
+  and HTMLDefinition->content_sets
+. StrictBlockquote now reports what elements its supposed to allow,
+  rather than what it does allow
+. Removed HTMLDefinition->info_flow_elements in favor of
+  HTMLDefinition->content_sets['Flow']
+. Removed redundant "exclusionary" definitions from DTD roster
+. StrictBlockquote now requires a construction parameter as if it
+  were an Required ChildDef, this is the "real" set of allowed elements
+. AttrDef partitioned into HTML, CSS and URI segments
+. Modify Youtube filter regexp to be multiline
+. Require both PHP5 and DOM extension in order to use DOMLex, fixes
+  some edge cases where a DOMDocument class exists in a PHP4 environment
+  due to DOM XML extension.
+
+1.4.1, released 2007-01-21
+! docs/enduser-youtube.html updated according to new functionality
+- YouTube IDs can have underscores and dashes
+
+1.4.0, released 2007-01-21
+! Implemented list-style-image, URIs now allowed in list-style
+! Implemented background-image, background-repeat, background-attachment
+  and background-position CSS properties. Shorthand property background
+  supports all of these properties.
+! Configuration documentation looks nicer
+! Added %Core.EscapeNonASCIICharacters to workaround loss of Unicode
+  characters while %Core.Encoding is set to a non-UTF-8 encoding.
+! Support for configuration directive aliases added
+! Config object can now be instantiated from ini files
+! YouTube preservation code added to the core, with two lines of code
+  you can add it as a filter to your code. See smoketests/preserveYouTube.php
+  for sample code.
+! Moved SLOW to docs/enduser-slow.html and added code examples
+- Replaced version check with functionality check for DOM (thanks Stephen
+  Khoo)
+. Added smoketest 'all.php', which loads all other smoketests via frames
+. Implemented AttrDef_CSSURI for url(http://google.com) style declarations
+. Added convenient single test selector form on test runner
+
+1.3.2, released 2006-12-25
+! HTMLPurifier object now accepts configuration arrays, no need to manually
+  instantiate a configuration object
+! Context object now accessible to outside
+! Added enduser-youtube.html, explains how to embed YouTube videos. See
+  also corresponding smoketest preserveYouTube.php.
+! Added purifyArray(), which takes a list of HTML and purifies it all
+! Added static member variable $version to HTML Purifier with PHP-compatible
+  version number string.
+- Fixed fatal error thrown by upper-cased language attributes
+- printDefinition.php: added labels, added better clarification
+. HTMLPurifier_Config::create() added, takes mixed variable and converts into
+  a HTMLPurifier_Config object.
+
+1.3.1, released 2006-12-06
+! Added HTMLPurifier.func.php stub for a convenient function to call the library
+- Fixed bug in RemoveInvalidImg code that caused all images to be dropped
+  (thanks to .mario for reporting this)
+. Standardized all attribute handling variables to attr, made it plural
+
+1.3.0, released 2006-11-26
+# Invalid images are now removed, rather than replaced with a dud
+  <img src="" alt="Invalid image" />. Previous behavior can be restored
+  with new directive %Core.RemoveInvalidImg set to false.
+! (X)HTML Strict now supported
+  + Transparently handles inline elements in block context (blockquote)
+! Added GET method to demo for easier validation, added 50kb max input size
+! New directive %HTML.BlockWrapper, for block-ifying inline elements
+! New directive %HTML.Parent, allows you to only allow inline content
+! New directives %HTML.AllowedElements and %HTML.AllowedAttributes to let
+  users narrow the set of allowed tags
+! <li value="4"> and <ul start="2"> now allowed in loose mode
+! New directives %URI.DisableExternalResources and %URI.DisableResources
+! New directive %Attr.DisableURI, which eliminates all hyperlinking
+! New directive %URI.Munge, munges URI so you can use some sort of redirector
+  service to avoid PageRank leaks or warn users that they are exiting your site.
+! Added spiffy new smoketest printDefinition.php, which lets you twiddle with
+  the configuration settings and see how the internal rules are affected.
+! New directive %URI.HostBlacklist for blocking links to bad hosts.
+  xssAttacks.php smoketest updated accordingly.
+- Added missing type to ChildDef_Chameleon
+- Remove Tidy option from demo if there is not Tidy available
+. ChildDef_Required guards against empty tags
+. Lookup table HTMLDefinition->info_flow_elements added
+. Added peace-of-mind variable initialization to Strategy_FixNesting
+. Added HTMLPurifier->info_parent_def, parent child processing made special
+. Added internal documents briefly summarizing future progression of HTML
+. HTMLPurifier_Config->getBatch($namespace) added
+. More lenient casting to bool from string in HTMLPurifier_ConfigSchema
+. Refactored ChildDef classes into their own files
+
+1.2.0, released 2006-11-19
+# ID attributes now disabled by default. New directives:
+  + %HTML.EnableAttrID - restores old behavior by allowing IDs
+  + %Attr.IDPrefix - %Attr.IDBlacklist alternative that munges all user IDs
+    so that they don't collide with your IDs
+  + %Attr.IDPrefixLocal - Same as above, but for when there are multiple
+    instances of user content on the page
+  + Profuse documentation on how to use these available in docs/enduser-id.txt
+! Added MODx plugin <http://modxcms.com/forums/index.php/topic,6604.0.html>
+! Added percent encoding normalization
+! XSS attacks smoketest given facelift
+! Configuration documentation now has table of contents
+! Added %URI.DisableExternal, which prevents links to external websites.  You
+  can also use %URI.Host to permit absolute linking to subdomains
+! Non-accessible resources (ex. mailto) blocked from embedded URIs (img src)
+- Type variable in HTMLDefinition was not being set properly, fixed
+- Documentation updated
+  + TODO added request Phalanger
+  + TODO added request Native compression
+  + TODO added request Remove redundant tags
+  + TODO added possible plaintext formatter for HTML Purifier documentation
+  + Updated ConfigDoc TODO
+  + Improved inline comments in AttrDef/Class.php, AttrDef/CSS.php
+    and AttrDef/Host.php
+  + Revamped documentation into HTML, along with misc updates
+- HTMLPurifier_Context doesn't throw a variable reference error if you attempt
+  to retrieve a non-existent variable
+. Switched to purify()-wide Context object registry
+. Refactored unit tests to minimize duplication
+. XSS attack sheet updated
+. configdoc.xml now has xml:space attached to default value nodes
+. Allow configuration directives to permit null values
+. Cleaned up test-cases to remove unnecessary swallowErrors()
+
+1.1.2, released 2006-09-30
+! Add HTMLPurifier.auto.php stub file that configures include_path
+- Documentation updated
+  + INSTALL document rewritten
+  + TODO added semi-lossy conversion
+  + API Doxygen docs' file exclusions updated
+  + Added notes on HTML versus XML attribute whitespace handling
+  + Noted that HTMLPurifier_ChildDef_Custom isn't being used
+  + Noted that config object's definitions are cached versions
+- Fixed lack of attribute parsing in HTMLPurifier_Lexer_PEARSax3
+- ftp:// URIs now have their typecodes checked
+- Hooked up HTMLPurifier_ChildDef_Custom's unit tests (they weren't being run)
+. Line endings standardized throughout project (svn:eol-style standardized)
+. Refactored parseData() to general Lexer class
+. Tester named "HTML Purifier" not "HTMLPurifier"
+
+1.1.1, released 2006-09-24
+! Configuration option to optionally Tidy up output for indentation to make up
+  for dropped whitespace by DOMLex (pretty-printing for the entire application
+  should be done by a page-wide Tidy)
+- Various documentation updates
+- Fixed parse error in configuration documentation script
+- Fixed fatal error in benchmark scripts, slightly augmented
+- As far as possible, whitespace is preserved in-between table children
+- Sample test-settings.php file included
+
+1.1.0, released 2006-09-16
+! Directive documentation generation using XSLT
+! XHTML can now be turned off, output becomes <br>
+- Made URI validator more forgiving: will ignore leading and trailing
+  quotes, apostrophes and less than or greater than signs.
+- Enforce alphanumeric namespace and directive names for configuration.
+- Table child definition made more flexible, will fix up poorly ordered elements
+. Renamed ConfigDef to ConfigSchema
+
+1.0.1, released 2006-09-04
+- Fixed slight bug in DOMLex attribute parsing
+- Fixed rejection of case-insensitive configuration values when there is a
+  set of allowed values.  This manifested in %Core.Encoding.
+- Fixed rejection of inline style declarations that had lots of extra
+  space in them.  This manifested in TinyMCE.
+
+1.0.0, released 2006-09-01
+! Shorthand CSS properties implemented: font, border, background, list-style
+! Basic color keywords translated into hexadecimal values
+! Table CSS properties implemented
+! Support for charsets other than UTF-8 (defined by iconv)
+! Malformed UTF-8 and non-SGML character detection and cleaning implemented
+- Fixed broken numeric entity conversion
+- API documentation completed
+. (HTML|CSS)Definition de-singleton-ized
+
+1.0.0beta, released 2006-08-16
+! First public release, most functionality implemented. Notable omissions are:
+  + Shorthand CSS properties
+  + Table CSS properties
+  + Deprecated attribute transformations
+
+    vim: et sw=4 sts=4

--- libraries/htmlpurifier/README.md ---
@@ -0,0 +1,29 @@
+HTML Purifier [![Build Status](https://secure.travis-ci.org/ezyang/htmlpurifier.svg?branch=master)](http://travis-ci.org/ezyang/htmlpurifier)
+=============
+
+HTML Purifier is an HTML filtering solution that uses a unique combination
+of robust whitelists and aggressive parsing to ensure that not only are
+XSS attacks thwarted, but the resulting HTML is standards compliant.
+
+HTML Purifier is oriented towards richly formatted documents from
+untrusted sources that require CSS and a full tag-set.  This library can
+be configured to accept a more restrictive set of tags, but it won't be
+as efficient as more bare-bones parsers. It will, however, do the job
+right, which may be more important.
+
+Places to go:
+
+* See INSTALL for a quick installation guide
+* See docs/ for developer-oriented documentation, code examples and
+  an in-depth installation guide.
+* See WYSIWYG for information on editors like TinyMCE and FCKeditor
+
+HTML Purifier can be found on the web at: [http://htmlpurifier.org/](http://htmlpurifier.org/)
+
+## Installation
+
+Package available on [Composer](https://packagist.org/packages/ezyang/htmlpurifier).
+
+If you're using Composer to manage dependencies, you can use
+
+    $ composer require ezyang/htmlpurifier

--- libraries/htmlpurifier/TODO ---
@@ -0,0 +1,150 @@
+
+TODO List
+
+= KEY ====================
+    # Flagship
+    - Regular
+    ? Maybe I'll Do It
+==========================
+
+If no interest is expressed for a feature that may require a considerable
+amount of effort to implement, it may get endlessly delayed. Do not be
+afraid to cast your vote for the next feature to be implemented!
+
+Things to do as soon as possible:
+
+ - http://htmlpurifier.org/phorum/read.php?3,5560,6307#msg-6307
+ - Think about allowing explicit order of operations hooks for transforms
+ - Fix "<.<" bug (trailing < is removed if not EOD)
+ - Build in better internal state dumps and debugging tools for remote
+   debugging
+ - Allowed/Allowed* have strange interactions when both set
+ ? Transform lone embeds into object tags
+ - Deprecated config options that emit warnings when you set them (with'
+   a way of muting the warning if you really want to)
+ - Make HTML.Trusted work with Output.FlashCompat
+ - HTML.Trusted and HTML.SafeObject have funny interaction; general
+   problem is what to do when a module "supersedes" another
+   (see also tables and basic tables.)  This is a little dicier
+   because HTML.SafeObject has some extra functionality that
+   trusted might find useful.  See http://htmlpurifier.org/phorum/read.php?3,5762,6100
+
+FUTURE VERSIONS
+---------------
+
+4.9 release [OMG CONFIG PONIES]
+ ! Fix Printer. It's from the old days when we didn't have decent XML classes
+ ! Factor demo.php into a set of Printer classes, and then create a stub
+   file for users here (inside the actual HTML Purifier library)
+ - Fix error handling with form construction
+ - Do encoding validation in Printers, or at least, where user data comes in
+ - Config: Add examples to everything (make built-in which also automatically
+   gives output)
+ - Add "register" field to config schemas to eliminate dependence on
+   naming conventions (try to remember why we ultimately decided on tihs)
+
+5.0 release [HTML 5]
+ # Swap out code to use html5lib tokenizer and tree-builder
+ ! Allow turning off of FixNesting and required attribute insertion
+
+5.1 release [It's All About Trust] (floating)
+ # Implement untrusted, dangerous elements/attributes
+ # Implement IDREF support (harder than it seems, since you cannot have
+   IDREFs to non-existent IDs)
+     - Implement <area> (client and server side image maps are blocking
+       on IDREF support)
+ # Frameset XHTML 1.0 and HTML 4.01 doctypes
+ - Figure out how to simultaneously set %CSS.Trusted and %HTML.Trusted (?)
+
+5.2 release [Error'ed]
+ # Error logging for filtering/cleanup procedures
+ # Additional support for poorly written HTML
+    - Microsoft Word HTML cleaning (i.e. MsoNormal, but research essential!)
+    - Friendly strict handling of <address> (block -> <br>)
+ - XSS-attempt detection--certain errors are flagged XSS-like
+ - Append something to duplicate IDs so they're still usable (impl. note: the
+   dupe detector would also need to detect the suffix as well)
+
+6.0 release [Beyond HTML]
+ # Legit token based CSS parsing (will require revamping almost every
+   AttrDef class). Probably will use CSSTidy
+ # More control over allowed CSS properties using a modularization
+ # IRI support (this includes IDN)
+ - Standardize token armor for all areas of processing
+
+7.0 release [To XML and Beyond]
+ - Extended HTML capabilities based on namespacing and tag transforms (COMPLEX)
+    - Hooks for adding custom processors to custom namespaced tags and
+      attributes, offer default implementation
+    - Lots of documentation and samples
+
+Ongoing
+ - More refactoring to take advantage of PHP5's facilities
+ - Refactor unit tests into lots of test methods
+ - Plugins for major CMSes (COMPLEX)
+    - phpBB
+    - Also, a FAQ for extension writers with HTML Purifier
+
+AutoFormat
+ - Smileys
+ - Syntax highlighting (with GeSHi) with <pre> and possibly <?php
+ - Look at http://drupal.org/project/Modules/category/63 for ideas
+
+Neat feature related
+ ! Support exporting configuration, so users can easily tweak settings
+   in the demo, and then copy-paste into their own setup
+ - Advanced URI filtering schemes (see docs/proposal-new-directives.txt)
+ - Allow scoped="scoped" attribute in <style> tags; may be troublesome
+   because regular CSS has no way of uniquely identifying nodes, so we'd
+   have to generate IDs
+ - Explain how to use HTML Purifier in non-PHP languages / create
+   a simple command line stub (or complicated?)
+ - Fixes for Firefox's inability to handle COL alignment props (Bug 915)
+ - Automatically add non-breaking spaces to empty table cells when
+   empty-cells:show is applied to have compatibility with Internet Explorer
+ - Table of Contents generation (XHTML Compiler might be reusable). May also
+   be out-of-band information.
+ - Full set of color keywords. Also, a way to add onto them without
+   finalizing the configuration object.
+ - Write a var_export and memcached DefinitionCache - Denis
+ - Built-in support for target="_blank" on all external links
+ - Convert RTL/LTR override characters to <bdo> tags, or vice versa on demand.
+   Also, enable disabling of directionality
+ ? Externalize inline CSS to promote clean HTML, proposed by Sander Tekelenburg
+ ? Remove redundant tags, ex. <u><u>Underlined</u></u>. Implementation notes:
+    1. Analyzing which tags to remove duplicants
+    2. Ensure attributes are merged into the parent tag
+    3. Extend the tag exclusion system to specify whether or not the
+    contents should be dropped or not (currently, there's code that could do
+    something like this if it didn't drop the inner text too.)
+ ? Make AutoParagraph also support paragraph-izing double <br> tags, and not
+   just double newlines.  This is kind of tough to do in the current framework,
+   though, and might be reasonably approximated by search replacing double <br>s
+   with newlines before running it through HTML Purifier.
+
+Maintenance related (slightly boring)
+ # CHMOD install script for PEAR installs
+ ! Factor out command line parser into its own class, and unit test it
+ - Reduce size of internal data-structures (esp. HTMLDefinition)
+ - Allow merging configurations.  Thus,
+        a -> b -> default
+        c -> d -> default
+   becomes
+        a -> b -> c -> d -> default
+   Maybe allow more fine-grained tuning of this behavior. Alternatively,
+   encourage people to use short plist depths before building them up.
+ - Time PHPT tests
+
+ChildDef related (very boring)
+ - Abstract ChildDef_BlockQuote to work with all elements that only
+   allow blocks in them, required or optional
+ - Implement lenient <ruby> child validation
+
+Wontfix
+ - Non-lossy smart alternate character encoding transformations (unless
+   patch provided)
+ - Pretty-printing HTML: users can use Tidy on the output on entire page
+ - Native content compression, whitespace stripping: use gzip if this is
+   really important
+
+    vim: et sw=4 sts=4

--- libraries/htmlpurifier/VERSION ---
@@ -0,0 +1 @@
+4.13.0
\ No newline at end of file

--- libraries/htmlpurifier/WHATSNEW ---
@@ -0,0 +1,4 @@
+HTML Purifier 4.13.x is a maintenance release which fixes
+PSR-0 compatibility of our package.  There are also a few
+new features (%HTML.Forms and tg@bgcolor support) and
+a number of minor bugfixes.

--- libraries/htmlpurifier/WYSIWYG ---
@@ -0,0 +1,20 @@
+
+WYSIWYG - What You See Is What You Get
+    HTML Purifier: A Pretty Good Fit for TinyMCE and FCKeditor
+
+Javascript-based WYSIWYG editors, simply stated, are quite amazing.  But I've
+always been wary about using them due to security issues: they handle the
+client-side magic, but once you've been served a piping hot load of unfiltered
+HTML, what should be done then?  In some situations, you can serve it uncleaned,
+since you only offer these facilities to trusted(?) authors.
+
+Unfortunantely, for blog comments and anonymous input, BBCode, Textile and
+other markup languages still reign supreme.  Put simply: filtering HTML is
+hard work, and these WYSIWYG authors don't offer anything to alleviate that
+trouble.  Therein lies the solution:
+
+HTML Purifier is perfect for filtering pure-HTML input from WYSIWYG editors.
+
+Enough said.
+
+    vim: et sw=4 sts=4

--- libraries/htmlpurifier/art/icon-16x16.svg ---
@@ -0,0 +1,101 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no"?>
+<!-- Created with Inkscape (http://www.inkscape.org/) -->
+<svg
+   xmlns:dc="http://purl.org/dc/elements/1.1/"
+   xmlns:cc="http://web.resource.org/cc/"
+   xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
+   xmlns:svg="http://www.w3.org/2000/svg"
+   xmlns="http://www.w3.org/2000/svg"
+   xmlns:sodipodi="http://inkscape.sourceforge.net/DTD/sodipodi-0.dtd"
+   xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"
+   width="16.000000px"
+   height="16.000000px"
+   id="svg2"
+   sodipodi:version="0.32"
+   inkscape:version="0.42.2"
+   sodipodi:docbase="C:\DOCUME~1\Edward\MYDOCU~1\MYWEBS~1\HTMLPU~1\art"
+   sodipodi:docname="ICON-1~1.SVG"
+   inkscape:export-filename="C:\Documents and Settings\Edward\My Documents\My Webs\htmlpurifier\art\icon.png"
+   inkscape:export-xdpi="90.000000"
+   inkscape:export-ydpi="90.000000">
+  <defs
+     id="defs4">
+    <linearGradient
+       id="linearGradient5003">
+      <stop
+         style="stop-color:#537ddd;stop-opacity:1.0000000;"
+         offset="0.00000000"
+         id="stop5005" />
+      <stop
+         style="stop-color:#000000;stop-opacity:1.0000000;"
+         offset="1.0000000"
+         id="stop5007" />
+    </linearGradient>
+    <linearGradient
+       id="linearGradient4993">
+      <stop
+         style="stop-color:#183577;stop-opacity:1.0000000;"
+         offset="0.00000000"
+         id="stop4995" />
+      <stop
+         id="stop5001"
+         offset="0.58142859"
+         style="stop-color:#8b9fbb;stop-opacity:1.0000000;" />
+      <stop
+         style="stop-color:#ffffff;stop-opacity:1.0000000;"
+         offset="1.0000000"
+         id="stop4997" />
+    </linearGradient>
+  </defs>
+  <sodipodi:namedview
+     id="base"
+     pagecolor="#ffffff"
+     bordercolor="#666666"
+     borderopacity="1.0"
+     inkscape:pageopacity="0.0"
+     inkscape:pageshadow="2"
+     inkscape:zoom="23.255956"
+     inkscape:cx="3.2274095"
+     inkscape:cy="4.1487021"
+     inkscape:document-units="px"
+     inkscape:current-layer="layer1"
+     showgrid="false"
+     showguides="false"
+     gridspacingy="0.50000000cm"
+     gridspacingx="0.50000000cm"
+     gridoriginy="0.00000000cm"
+     gridoriginx="0.00000000cm"
+     gridtolerance="0.10000000cm"
+     gridempspacing="2"
+     inkscape:grid-points="true"
+     inkscape:grid-bbox="false"
+     inkscape:window-width="975"
+     inkscape:window-height="759"
+     inkscape:window-x="130"
+     inkscape:window-y="129" />
+  <metadata
+     id="metadata7">
+    <rdf:RDF>
+      <cc:Work
+         rdf:about="">
+        <dc:format>image/svg+xml</dc:format>
+        <dc:type
+           rdf:resource="http://purl.org/dc/dcmitype/StillImage" />
+      </cc:Work>
+    </rdf:RDF>
+  </metadata>
+  <g
+     inkscape:label="Layer 1"
+     inkscape:groupmode="layer"
+     id="layer1">
+    <path
+       style="fill:none;fill-opacity:0.75000000;fill-rule:evenodd;stroke:#000000;stroke-width:1.0000004px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1.0000000"
+       d="M 6.1949060,157.57756 L 6.1949060,157.57756 z "
+       id="path1319" />
+    <path
+       style="fill:#224db0;fill-opacity:1.0000000;fill-rule:evenodd;stroke:none;stroke-width:6.0000000;stroke-linecap:butt;stroke-linejoin:round;marker-start:none;stroke-miterlimit:4.0000000;stroke-dasharray:none;stroke-opacity:1.0000000"
+       d="M 0.58257145,1.2121863 C 0.63548185,3.4711463 0.61139575,5.1777365 1.0905516,7.3958765 C 1.2484712,8.3223265 2.8202544,8.4670465 3.5807376,8.5653065 C 4.0690207,8.6283965 4.0902492,8.5661465 4.0906878,9.1995265 C 4.1064337,11.195036 4.0317991,11.792303 4.0906878,13.786273 C 4.0906878,15.786203 4.0909380,15.786453 6.0908601,15.786453 C 9.0907431,15.786453 10.414747,15.786053 12.414669,15.786053 C 14.414592,15.786053 14.414842,15.785813 14.414842,13.785893 C 14.418166,10.552283 14.404522,7.8374163 14.421897,4.6040763 C 14.625008,2.9294663 14.978320,2.5231063 15.830433,1.1499263 C 15.040843,1.1499263 14.943078,1.1493063 14.129102,1.1493063 C 8.8912931,1.1493063 5.8203807,1.2121863 0.58257145,1.2121863 z M 2.0905126,2.4028663 C 2.8330809,2.4028663 3.3476197,2.4028663 4.0901879,2.4028663 C 4.0901879,4.8586963 4.0906878,4.8408265 4.0906878,7.2966665 C 3.2248799,7.2967665 2.2374444,7.5239665 2.1488437,6.3255665 C 1.8765344,4.2270765 1.8837837,4.4962263 2.0905126,2.4028663 z M 5.4346466,6.5656265 L 6.8695071,6.5656265 L 6.8696331,13.558223 L 9.8657791,11.557663 L 9.8656551,6.5656265 L 13.070633,6.5656265 L 13.070633,13.786523 C 13.070633,14.786503 13.070633,14.786503 12.070671,14.786503 L 6.4158330,14.786503 C 5.5388453,14.786503 5.4347719,14.786723 5.4347719,13.786523 L 5.4346466,6.5656265 z "
+       id="path1325"
+       sodipodi:nodetypes="ccsccsscccsccccccccccccccccc" />
+  </g>
+</svg>

--- libraries/htmlpurifier/art/icon-32x32.svg ---
@@ -0,0 +1,101 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no"?>
+<!-- Created with Inkscape (http://www.inkscape.org/) -->
+<svg
+   xmlns:dc="http://purl.org/dc/elements/1.1/"
+   xmlns:cc="http://web.resource.org/cc/"
+   xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
+   xmlns:svg="http://www.w3.org/2000/svg"
+   xmlns="http://www.w3.org/2000/svg"
+   xmlns:sodipodi="http://inkscape.sourceforge.net/DTD/sodipodi-0.dtd"
+   xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"
+   width="16.000000px"
+   height="16.000000px"
+   id="svg2"
+   sodipodi:version="0.32"
+   inkscape:version="0.42.2"
+   sodipodi:docbase="C:\DOCUME~1\Edward\MYDOCU~1\MYWEBS~1\HTMLPU~1\art"
+   sodipodi:docname="icon-32x32.svg"
+   inkscape:export-filename="C:\Documents and Settings\Edward\My Documents\My Webs\htmlpurifier\art\icon-16x16.png"
+   inkscape:export-xdpi="90.000000"
+   inkscape:export-ydpi="90.000000">
+  <defs
+     id="defs4">
+    <linearGradient
+       id="linearGradient5003">
+      <stop
+         style="stop-color:#537ddd;stop-opacity:1.0000000;"
+         offset="0.00000000"
+         id="stop5005" />
+      <stop
+         style="stop-color:#000000;stop-opacity:1.0000000;"
+         offset="1.0000000"
+         id="stop5007" />
+    </linearGradient>
+    <linearGradient
+       id="linearGradient4993">
+      <stop
+         style="stop-color:#183577;stop-opacity:1.0000000;"
+         offset="0.00000000"
+         id="stop4995" />
+      <stop
+         id="stop5001"
+         offset="0.58142859"
+         style="stop-color:#8b9fbb;stop-opacity:1.0000000;" />
+      <stop
+         style="stop-color:#ffffff;stop-opacity:1.0000000;"
+         offset="1.0000000"
+         id="stop4997" />
+    </linearGradient>
+  </defs>
+  <sodipodi:namedview
+     id="base"
+     pagecolor="#ffffff"
+     bordercolor="#666666"
+     borderopacity="1.0"
+     inkscape:pageopacity="0.0"
+     inkscape:pageshadow="2"
+     inkscape:zoom="23.255956"
+     inkscape:cx="3.2274095"
+     inkscape:cy="4.1487021"
+     inkscape:document-units="px"
+     inkscape:current-layer="layer1"
+     showgrid="false"
+     showguides="false"
+     gridspacingy="0.50000000cm"
+     gridspacingx="0.50000000cm"
+     gridoriginy="0.00000000cm"
+     gridoriginx="0.00000000cm"
+     gridtolerance="0.10000000cm"
+     gridempspacing="2"
+     inkscape:grid-points="true"
+     inkscape:grid-bbox="false"
+     inkscape:window-width="975"
+     inkscape:window-height="759"
+     inkscape:window-x="130"
+     inkscape:window-y="129" />
+  <metadata
+     id="metadata7">
+    <rdf:RDF>
+      <cc:Work
+         rdf:about="">
+        <dc:format>image/svg+xml</dc:format>
+        <dc:type
+           rdf:resource="http://purl.org/dc/dcmitype/StillImage" />
+      </cc:Work>
+    </rdf:RDF>
+  </metadata>
+  <g
+     inkscape:label="Layer 1"
+     inkscape:groupmode="layer"
+     id="layer1">
+    <path
+       style="fill:none;fill-opacity:0.75000000;fill-rule:evenodd;stroke:#000000;stroke-width:1.0000004px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1.0000000"
+       d="M 6.1949060,157.57756 L 6.1949060,157.57756 z "
+       id="path1319" />
+    <path
+       style="fill:#224db0;fill-opacity:1.0000000;fill-rule:evenodd;stroke:none;stroke-width:6.0000000;stroke-linecap:butt;stroke-linejoin:round;marker-start:none;stroke-miterlimit:4.0000000;stroke-dasharray:none;stroke-opacity:1.0000000"
+       d="M 0.58257145,1.2121863 C 0.63548185,3.4711463 0.61139575,5.1777365 1.0905516,7.3958765 C 1.2484712,8.3223265 2.8202544,8.4670465 3.5807376,8.5653065 C 4.0690207,8.6283965 4.0902492,8.5661465 4.0906878,9.1995265 C 4.1064337,11.195036 4.0317991,11.792303 4.0906878,13.786273 C 4.0906878,15.786203 4.0909380,15.786453 6.0908601,15.786453 C 9.0907431,15.786453 10.414747,15.786053 12.414669,15.786053 C 14.414592,15.786053 14.414842,15.785813 14.414842,13.785893 C 14.418166,10.552283 14.404522,7.8374163 14.421897,4.6040763 C 14.625008,2.9294663 14.978320,2.5231063 15.830433,1.1499263 C 15.040843,1.1499263 14.943078,1.1493063 14.129102,1.1493063 C 8.8912931,1.1493063 5.8203807,1.2121863 0.58257145,1.2121863 z M 2.0905126,2.4028663 C 2.8330809,2.4028663 3.3476197,2.4028663 4.0901879,2.4028663 C 4.0901879,4.8586963 4.0906878,4.8408265 4.0906878,7.2966665 C 3.2248799,7.2967665 2.2374444,7.5239665 2.1488437,6.3255665 C 1.8765344,4.2270765 1.8837837,4.4962263 2.0905126,2.4028663 z M 5.0906487,6.5656265 L 6.8695071,6.5656265 L 6.8696331,13.558223 L 9.8657791,11.557663 L 9.8656551,6.5656265 L 13.414631,6.5656265 L 13.414631,13.786523 C 13.414631,14.786503 13.414631,14.786503 12.414669,14.786503 L 6.0718351,14.786503 C 5.1948474,14.786503 5.0907740,14.786723 5.0907740,13.786523 L 5.0906487,6.5656265 z "
+       id="path1325"
+       sodipodi:nodetypes="ccsccsscccsccccccccccccccccc" />
+  </g>
+</svg>

--- libraries/htmlpurifier/art/logo.svg ---
@@ -0,0 +1,119 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no"?>
+<!-- Created with Inkscape (http://www.inkscape.org/) -->
+<svg
+   xmlns:dc="http://purl.org/dc/elements/1.1/"
+   xmlns:cc="http://web.resource.org/cc/"
+   xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
+   xmlns:svg="http://www.w3.org/2000/svg"
+   xmlns="http://www.w3.org/2000/svg"
+   xmlns:xlink="http://www.w3.org/1999/xlink"
+   xmlns:sodipodi="http://inkscape.sourceforge.net/DTD/sodipodi-0.dtd"
+   xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"
+   width="82.000000mm"
+   height="82.000000mm"
+   id="svg2"
+   sodipodi:version="0.32"
+   inkscape:version="0.42.2"
+   sodipodi:docbase="C:\Documents and Settings\Edward\My Documents\My Webs\htmlpurifier\art"
+   sodipodi:docname="logo-bold-large.svg">
+  <defs
+     id="defs4">
+    <linearGradient
+       id="linearGradient5003">
+      <stop
+         style="stop-color:#537ddd;stop-opacity:1.0000000;"
+         offset="0.00000000"
+         id="stop5005" />
+      <stop
+         style="stop-color:#000000;stop-opacity:1.0000000;"
+         offset="1.0000000"
+         id="stop5007" />
+    </linearGradient>
+    <linearGradient
+       id="linearGradient4993">
+      <stop
+         style="stop-color:#183577;stop-opacity:1.0000000;"
+         offset="0.00000000"
+         id="stop4995" />
+      <stop
+         id="stop5001"
+         offset="0.58142859"
+         style="stop-color:#8b9fbb;stop-opacity:1.0000000;" />
+      <stop
+         style="stop-color:#ffffff;stop-opacity:1.0000000;"
+         offset="1.0000000"
+         id="stop4997" />
+    </linearGradient>
+    <linearGradient
+       inkscape:collect="always"
+       xlink:href="#linearGradient4993"
+       id="linearGradient4999"
+       x1="283.46457"
+       y1="141.72675"
+       x2="11.135608"
+       y2="141.72675"
+       gradientUnits="userSpaceOnUse"
+       gradientTransform="translate(2.000000,4.000000)" />
+    <linearGradient
+       inkscape:collect="always"
+       xlink:href="#linearGradient5003"
+       id="linearGradient5009"
+       x1="2.9621078"
+       y1="141.72675"
+       x2="283.46457"
+       y2="141.72675"
+       gradientUnits="userSpaceOnUse"
+       gradientTransform="translate(2.000000,4.000000)" />
+  </defs>
+  <sodipodi:namedview
+     id="base"
+     pagecolor="#ffffff"
+     bordercolor="#666666"
+     borderopacity="1.0"
+     inkscape:pageopacity="0.0"
+     inkscape:pageshadow="2"
+     inkscape:zoom="1.0000000"
+     inkscape:cx="100.23897"
+     inkscape:cy="178.03397"
+     inkscape:document-units="px"
+     inkscape:current-layer="layer1"
+     showgrid="false"
+     showguides="false"
+     gridspacingy="0.50000000cm"
+     gridspacingx="0.50000000cm"
+     gridoriginy="0.00000000cm"
+     gridoriginx="0.00000000cm"
+     gridtolerance="0.10000000cm"
+     gridempspacing="2"
+     inkscape:grid-points="true"
+     inkscape:grid-bbox="false"
+     inkscape:window-width="975"
+     inkscape:window-height="759"
+     inkscape:window-x="139"
+     inkscape:window-y="88" />
+  <metadata
+     id="metadata7">
+    <rdf:RDF>
+      <cc:Work
+         rdf:about="">
+        <dc:format>image/svg+xml</dc:format>
+        <dc:type
+           rdf:resource="http://purl.org/dc/dcmitype/StillImage" />
+      </cc:Work>
+    </rdf:RDF>
+  </metadata>
+  <g
+     inkscape:label="Layer 1"
+     inkscape:groupmode="layer"
+     id="layer1">
+    <path
+       style="fill:none;fill-opacity:0.75000000;fill-rule:evenodd;stroke:#000000;stroke-width:1.0000000px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1.0000000"
+       d="M 19.726130,9.6194746 L 19.726130,9.6194746 z "
+       id="path1319" />
+    <path
+       style="fill:url(#linearGradient4999);fill-opacity:1.0000000;fill-rule:evenodd;stroke:url(#linearGradient5009);stroke-width:10.000000;stroke-linecap:butt;stroke-linejoin:round;marker-start:none;stroke-miterlimit:4.0000000;stroke-dasharray:none;stroke-opacity:1.0000000"
+       d="M 4.9621078,5.1031050 C 5.8995325,45.125639 5.4727947,85.709799 13.962107,125.00936 C 16.760003,141.42321 35.988453,143.98728 49.462107,145.72811 C 58.113128,146.84585 67.112800,145.74318 67.120572,156.96457 C 67.399545,192.31975 66.077225,216.69948 67.120572,252.02707 C 67.120572,287.46015 67.125004,287.46457 102.55807,287.46457 C 155.70768,287.46457 179.16536,287.45768 214.59843,287.45768 C 250.03151,287.45768 250.03593,287.45325 250.03593,252.02018 C 250.09483,194.72943 249.85310,122.48395 250.16093,65.197704 C 253.75952,35.528496 270.36749,28.328596 285.46457,4.0000020 C 271.47521,4.0000020 259.39483,3.9889299 244.97343,3.9889297 C 152.17399,3.9889293 97.761552,5.1031060 4.9621078,5.1031050 z M 31.678643,26.198667 C 44.834892,26.198667 53.955464,26.198667 67.111714,26.198667 C 67.111713,69.709084 67.120572,79.741005 67.120572,123.25143 C 51.780853,123.25317 34.281868,127.27859 32.712107,106.04622 C 27.887543,68.866763 28.015982,63.286945 31.678643,26.198667 z M 84.837103,110.29921 L 102.55585,110.29921 L 102.55807,247.98656 L 155.64148,212.54217 L 155.63926,110.29921 L 232.31496,110.29921 L 232.31496,252.03150 C 232.31496,269.74803 232.31496,269.74803 214.59843,269.74803 L 102.22100,269.74803 C 86.683215,269.74803 84.839322,269.75212 84.839322,252.03150 L 84.837103,110.29921 z "
+       id="path1325"
+       sodipodi:nodetypes="ccsccsscccsccccccccccccccccc" />
+  </g>
+</svg>

--- libraries/htmlpurifier/benchmarks/.htaccess ---
@@ -0,0 +1,7 @@
+<IfModule mod_authz_core.c>
+    Require all denied
+</IfModule>
+
+<IfModule !mod_authz_core.c>
+    Deny from all
+</ifModule>

--- libraries/htmlpurifier/benchmarks/ConfigSchema.php ---
@@ -0,0 +1,16 @@
+<?php
+
+chdir(dirname(__FILE__));
+
+//require_once '../library/HTMLPurifier.path.php';
+shell_exec('php ../maintenance/generate-schema-cache.php');
+require_once '../library/HTMLPurifier.path.php';
+require_once 'HTMLPurifier.includes.php';
+
+$begin = xdebug_memory_usage();
+
+$schema = HTMLPurifier_ConfigSchema::makeFromSerial();
+
+echo xdebug_memory_usage() - $begin;
+
+// vim: et sw=4 sts=4

--- libraries/htmlpurifier/benchmarks/Lexer.php ---
@@ -0,0 +1,161 @@
+<?php
+
+require_once '../library/HTMLPurifier.auto.php';
+@include_once '../test-settings.php';
+
+// PEAR
+require_once 'Benchmark/Timer.php'; // to do the timing
+require_once 'Text/Password.php'; // for generating random input
+
+$LEXERS = array();
+$RUNS = isset($GLOBALS['HTMLPurifierTest']['Runs'])
+    ? $GLOBALS['HTMLPurifierTest']['Runs'] : 2;
+
+require_once 'HTMLPurifier/Lexer/DirectLex.php';
+$LEXERS['DirectLex'] = new HTMLPurifier_Lexer_DirectLex();
+
+if (version_compare(PHP_VERSION, '5', '>=')) {
+    require_once 'HTMLPurifier/Lexer/DOMLex.php';
+    $LEXERS['DOMLex'] = new HTMLPurifier_Lexer_DOMLex();
+}
+
+// custom class to aid unit testing
+class RowTimer extends Benchmark_Timer
+{
+
+    public $name;
+
+    public function __construct($name, $auto = false)
+    {
+        $this->name = htmlentities($name);
+        $this->Benchmark_Timer($auto);
+    }
+
+    public function getOutput()
+    {
+        $total  = $this->TimeElapsed();
+        $result = $this->getProfiling();
+        $dashes = '';
+
+        $out = '<tr>';
+
+        $out .= "<td>{$this->name}</td>";
+
+        $standard = false;
+
+        foreach ($result as $k => $v) {
+            if ($v['name'] == 'Start' || $v['name'] == 'Stop') continue;
+
+            //$perc = (($v['diff'] * 100) / $total);
+            //$tperc = (($v['total'] * 100) / $total);
+
+            //$out .= '<td align="right">' . $v['diff'] . '</td>';
+
+            if ($standard == false) $standard = $v['diff'];
+
+            $perc = $v['diff'] * 100 / $standard;
+            $bad_run = ($v['diff'] < 0);
+
+            $out .= '<td align="right"'.
+                   ($bad_run ? ' style="color:#AAA;"' : '').
+                   '>' . number_format($perc, 2, '.', '') .
+                   '%</td><td>'.number_format($v['diff'],4,'.','').'</td>';
+
+        }
+
+        $out .= '</tr>';
+
+        return $out;
+    }
+}
+
+function print_lexers()
+{
+    global $LEXERS;
+    $first = true;
+    foreach ($LEXERS as $key => $value) {
+        if (!$first) echo ' / ';
+        echo htmlspecialchars($key);
+        $first = false;
+    }
+}
+
+function do_benchmark($name, $document)
+{
+    global $LEXERS, $RUNS;
+
+    $config = HTMLPurifier_Config::createDefault();
+    $context = new HTMLPurifier_Context();
+
+    $timer = new RowTimer($name);
+    $timer->start();
+
+    foreach($LEXERS as $key => $lexer) {
+        for ($i=0; $i<$RUNS; $i++) $tokens = $lexer->tokenizeHTML($document, $config, $context);
+        $timer->setMarker($key);
+    }
+
+    $timer->stop();
+    $timer->display();
+}
+
+?>
+<html>
+<head>
+<title>Benchmark: <?php print_lexers(); ?></title>
+</head>
+<body>
+<h1>Benchmark: <?php print_lexers(); ?></h1>
+<table border="1">
+<tr><th>Case</th><?php
+foreach ($LEXERS as $key => $value) {
+    echo '<th colspan="2">' . htmlspecialchars($key) . '</th>';
+}
+?></tr>
+<?php
+
+// ************************************************************************** //
+
+// sample of html pages
+
+$dir = 'samples/Lexer';
+$dh  = opendir($dir);
+while (false !== ($filename = readdir($dh))) {
+
+    if (strpos($filename, '.html') !== strlen($filename) - 5) continue;
+    $document = file_get_contents($dir . '/' . $filename);
+    do_benchmark("File: $filename", $document);
+
+}
+
+// crashers, caused infinite loops before
+
+$snippets = array();
+$snippets[] = '<a href="foo>';
+$snippets[] = '<a "=>';
+
+foreach ($snippets as $snippet) {
+    do_benchmark($snippet, $snippet);
+}
+
+// random input
+
+$random = Text_Password::create(80, 'unpronounceable', 'qwerty <>="\'');
+
+do_benchmark('Random input', $random);
+
+?></table>
+
+<?php
+
+echo '<div>Random input was: ' .
+  '<span colspan="4" style="font-family:monospace;">' .
+  htmlspecialchars($random) . '</span></div>';
+
+?>
+
+
+</body></html>
+<?php
+
+// vim: et sw=4 sts=4

--- libraries/htmlpurifier/benchmarks/Trace.php ---
@@ -0,0 +1,21 @@
+<?php
+
+ini_set('xdebug.trace_format', 1);
+ini_set('xdebug.show_mem_delta', true);
+
+if (file_exists('Trace.xt')) {
+    echo "Previous trace Trace.xt must be removed before this script can be run.";
+    exit;
+}
+
+xdebug_start_trace(dirname(__FILE__) . '/Trace');
+require_once '../library/HTMLPurifier.auto.php';
+
+$purifier = new HTMLPurifier();
+
+$data = $purifier->purify(file_get_contents('samples/Lexer/4.html'));
+xdebug_stop_trace();
+
+echo "Trace finished.";
+
+// vim: et sw=4 sts=4

--- libraries/htmlpurifier/benchmarks/samples/Lexer/1.html ---
@@ -0,0 +1,56 @@
+<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
+<html>
+<head>
+    <title>Main Page - Huaxia Taiji Club</title>
+    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
+    <link rel="stylesheet" type="text/css" media="screen, projection" href="/screen.css" />
+    <link rel="stylesheet" type="text/css" media="print" href="/print.css" />
+</head>
+<body>
+
+<div id="translation"><a href="/ch/Main_Page">&#20013;&#25991;</a></div>
+
+<div id="heading"><a href="/en/Main_Page" title="English Main Page">Huaxia Taiji Club</a>
+  <a class="heading_ch" href="/ch/Main_Page" title="&#20013;&#25991;&#20027;&#39029;">&#21326;&#22799;&#22826;&#26497;&#20465;&#20048;&#37096;</a></div>
+<ul id="menu">
+    <li><a href="/en/Main_Page" class="active">Main Page</a></li><li><a href="/en/About">About</a></li><li><a href="/en/News">News</a></li><li><a href="/en/Events">Events</a></li><li><a href="/en/Digest">Digest</a></li><li><a href="/en/Taiji_and_I">Taiji and I</a></li><li><a href="/en/Downloads">Downloads</a></li><li><a href="/en/Registration">Registration</a></li><li><a href="/en/Contact">Contact</a></li>    <li><a href="http://www.taijiclub.org/gallery2/main.php">Gallery</a></li>
+
+    <li><a href="http://www.taijiclub.org/forums/index.php">Forums</a></li>
+
+</ul>
+<div id="content">
+<h1 id="title">Main Page</h1><h2>Taiji (Tai Chi) </h2>
+
+<div id="sidebar">
+<h3>Recent News</h3>
+<ul>
+ <li>Zou Xiaojun was elected as the new club vice president </li>
+
+ <li>HX Edison Taiji Club <a href="http://www.taijiclub.org/downloads/Taiji_club_regulation_.pdf">by-law</a>  effective 3/28/2006</li>
+ <li>A new email account for our club: HXEdisontaijiclub@yahoo.com</li>
+
+ <li>Workshop conducted by <a href="http://www.taijiclub.org/ch/Digest/LiDeyin">?????</a> Li Deyin is set on June 4, 2006 at Clarion Hotel in Edison from 9:30am-12pm; <a href="http://www.taijiclub.org/en/Registration">Registration</a></li>
+
+</ul>
+</div>
+
+
+
+<p><i>Taiji</i> is an ancient Chinese tradition of movement systems that is associated with philosophy, physiology, psychology, geometry and dynamics. It is the slowest form of martial arts and is meant to improve the internal spirit.   It is soothing to the soul and extremely invigorating. </p>
+
+<p>The founder of Taiji was Zhang Sanfeng (Chang San-feng), who was a monk of the Wu Dang (Wu Tang) Monastery and lived in the period from 1391 to 1459. His exercises stressed suppleness and elasticity as opposed to the hardness and force of other martial art styles. Several centuries old, Taiji was originally developed as a form of self-defense, emphasizing strength, balance, flexibility and speed. Tai Chi also differs from other martial arts in that it is based on the Taoist religion and aims to avoid aggressive forces. </p>
+
+<p>Modern Taiji includes many forms &mdash; Quan, Sword and Fan. Impacting the mind and body of the practitioners, Taiji is practiced as a meditative exercise made up of a series of forms, or choreographed motions, requiring slow, gentle movement of the arms, legs and torso. Taiji practitioners learn to center their attention on their breathing and body movements so that the exercise strengthens their overall mental and physical awareness. In a sense, Taiji is similar to yoga in that it is also a form of moving meditation, with the goal of achieving stillness through the motion and awareness of breath. To perform Taiji, practitioners have to empty their mind of thoughts and worries in order to achieve harmony. It is a great aid for reducing stress and improving the quality of life. </p>
+
+<p>In China and in communities all over the world, Taiji is practiced by young and old in the early morning hours. It's a great way to bring a new and fresh day!</p>
+
+<p>Check out our <a href="/gallery2/main.php">gallery</a>.</p>
+
+<div style="text-align:center;"><a href="http://www.taijiclub.org/gallery2/v/2006/group1b.jpg.html?g2_imageViewsIndex=1"><img src="/gallery2/d/1836-2/group1b.jpg" /></a></div>
+
+<div style="text-align:center;">Click on photo to see HR version</div></div>
+</body>
+</html>
+
+<!-- vim: et sw=4 sts=4
+-->

--- libraries/htmlpurifier/benchmarks/samples/Lexer/2.html ---
@@ -0,0 +1,20 @@
+<html><head><meta http-equiv="content-type" content="text/html; charset=UTF-8"><title>Google</title><style><!--
+body,td,a,p,.h{font-family:arial,sans-serif;}
+.h{font-size: 20px;}
+.q{color:#0000cc;}
+//-->
+</style>
+<script>
+<!--
+function sf(){document.f.q.focus();}
+function rwt(el,ct,cd,sg){var e = window.encodeURIComponent ? encodeURIComponent : escape;el.href="/url?sa=t&ct="+e(ct)+"&cd="+e(cd)+"&url="+e(el.href).replace(/\+/g,"%2B")+"&ei=fHNBRJDEG4HSaLONmIoP"+sg;el.onmousedown="";return true;}
+// -->
+</script>
+</head><body bgcolor=#ffffff text=#000000 link=#0000cc vlink=#551a8b alink=#ff0000 onLoad=sf() topmargin=3 marginheight=3><center><table border=0 cellspacing=0 cellpadding=0 width=100%><tr><td align=right nowrap><font size=-1><b>edwardzyang@gmail.com</b>&nbsp;|&nbsp;<a href="/url?sa=p&pref=ig&pval=2&q=http://www.google.com/ig%3Fhl%3Den" onmousedown="return rwt(this,'pro','hppphou:def','&sig2=hDbTpsWIp9YG37a23n6krQ')">Personalized Home</a>&nbsp;|&nbsp;<a href="/searchhistory/?hl=en">Search History</a>&nbsp;|&nbsp;<a href="https://www.google.com/accounts/ManageAccount">My Account</a>&nbsp;|&nbsp;<a href="http://www.google.com/accounts/Logout?continue=http://www.google.com/">Sign out</a></font></td></tr><tr height=4><td><img alt="" width=1 height=1></td></tr></table><img src="/intl/en/images/logo.gif" width=276 height=110 alt="Google"><br><br>
+<form action=/search name=f><script><!--
+function qs(el) {if (window.RegExp && window.encodeURIComponent) {var ue=el.href;var qe=encodeURIComponent(document.f.q.value);if(ue.indexOf("q=")!=-1){el.href=ue.replace(new RegExp("q=[^&$]*"),"q="+qe);}else{el.href=ue+"&q="+qe;}}return 1;}
+// -->
+</script><table border=0 cellspacing=0 cellpadding=4><tr><td nowrap><font size=-1><b>Web</b>&nbsp;&nbsp;&nbsp;&nbsp;<a id=1a class=q href="/imghp?hl=en&tab=wi" onClick="return qs(this);">Images</a>&nbsp;&nbsp;&nbsp;&nbsp;<a id=2a class=q href="http://groups.google.com/grphp?hl=en&tab=wg" onClick="return qs(this);">Groups</a>&nbsp;&nbsp;&nbsp;&nbsp;<a id=4a class=q href="http://news.google.com/nwshp?hl=en&tab=wn" onClick="return qs(this);">News</a>&nbsp;&nbsp;&nbsp;&nbsp;<a id=5a class=q href="http://froogle.google.com/frghp?hl=en&tab=wf" onClick="return qs(this);">Froogle</a>&nbsp;&nbsp;&nbsp;&nbsp;<a id=8a class=q href="/lochp?hl=en&tab=wl" onClick="return qs(this);">Local</a>&nbsp;&nbsp;&nbsp;&nbsp;<b><a href="/intl/en/options/" class=q>more&nbsp;&raquo;</a></b></font></td></tr></table><table cellspacing=0 cellpadding=0><tr><td width=25%>&nbsp;</td><td align=center><input type=hidden name=hl value=en><input maxlength=2048 size=55 name=q value="" title="Google Search"><br><input type=submit value="Google Search" name=btnG><input type=submit value="I'm Feeling Lucky" name=btnI></td><td valign=top nowrap width=25%><font size=-2>&nbsp;&nbsp;<a href=/advanced_search?hl=en>Advanced Search</a><br>&nbsp;&nbsp;<a href=/preferences?hl=en>Preferences</a><br>&nbsp;&nbsp;<a href=/language_tools?hl=en>Language Tools</a></font></td></tr></table></form><br><br><font size=-1><a href="/ads/">Advertising&nbsp;Programs</a> - <a href=/services/>Business Solutions</a> - <a href=/about.html>About Google</a></font><p><font size=-2>&copy;2006 Google</font></p></center></body></html>
+
+<!-- vim: et sw=4 sts=4
+-->

--- libraries/htmlpurifier/benchmarks/samples/Lexer/3.html ---
@@ -0,0 +1,131 @@
+<html>
+<head>
+<title>Anime Digi-Lib Index</title>
+<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
+</head>
+
+<div id="tb">
+
+<form name="lycos_search" method="get" target="_new" style="margin: 0px"
+      action="http://r.hotbot.com/r/memberpgs_lycos_searchbox_af/http://www.angelfire.lycos.com/cgi-bin/search/pursuit">
+
+	<table id="tbtable" cellpadding="0" cellspacing="0" border="0" width="100%" style="border: 1px solid black;">
+	  <tr style="background-color: #dcf7ff">
+	    <td colspan="3">
+	      <table cellpadding="0" cellspacing="0" border="0">
+		<tr>
+		  <td>&nbsp;Search:</td>
+
+		  <td><input type="radio" name="cat" value="lycos" checked></td>
+		  <td nowrap="nowrap">The Web</td>
+		  <td><input type="radio" name="cat" value="angelfire"></td>
+		  <td nowrap="nowrap">Angelfire</td>
+		  <td nowrap="nowrap">&nbsp;&nbsp;&nbsp;<img src="http://af.lygo.com/d/toolbar/planeticon.gif"></td><td nowrap="nowrap">&nbsp;<a href="http://r.lycos.com/r/tlbr_planet/http://planet.lycos.com" target="_new">Planet</a></td>
+		</tr>
+	      </table>
+	      <td nowrap="nowrap"><a href="http://lt.angelfire.com/af_toolbar/edit/_h_/www.angelfire.lycos.com/build/index.tmpl" target="_top">
+		    <span id="build">Edit your Site</span></a>&nbsp;</td>
+
+	      <td><img src="http://af.lygo.com/d/toolbar/dir.gif" alt="show site directory" border="0" height="10" hspace="3" width="8"></td>
+	      <td nowrap="nowrap"><a href="http://lt.angelfire.com/af_toolbar/browse/_h_/www.angelfire.lycos.com/directory/index.tmpl" target="_top">Browse Sites</a>&nbsp;</td>
+	      <td><a href="http://lt.angelfire.com/af_toolbar/angelfire/_h_/www.angelfire.lycos.com" target="_top"><img src="http://af.lygo.com/d/toolbar/aflogo_top.gif" alt="hosted by angelfire" border="0" height="26" width="143"></a></td>
+	  </tr>
+	  <tr style="background-color: #dcf7ff">
+	    <td nowrap="nowrap" valign="middle">&nbsp;<input size="30" style="font-size: 10px; background-color: #fff;" type="text" name="query" id="searchbox"></td>
+
+		<td style="background: #fff url(http://af.lygo.com/d/toolbar/bg.gif) repeat-x; text-align: center;" colspan="3" align="center">
+		<a href="http://clk.atdmt.com/VON/go/lycsnvon0710000019von/direct/01/"><img src="/sys/free_logo_xxxx_157x20.gif" height="20" width="157" border="0" alt="Vonage"></a><img src="http://view.atdmt.com/VON/view/lycsnvon0710000019von/direct/01/"></td>
+
+	    <span style="font-size: 11px;">
+		<span style="color:#00f; font-weight:bold;">&#171;</span>
+		<span id="top100">
+		  <a href="javascript:void top100('prev')" target="_top">Previous</a> |
+		  <a href="http://lt.angelfire.com/af_toolbar/top100/_h_/www.angelfire.lycos.com/cgi-bin/top100/pagelist?start=1" target="_top">Top 100</a> |
+		  <a href="javascript:void top100('next')" target="_top">Next</a>
+
+		</span>
+		<span style="color: #00f; font-weight: bold;">&#187;</span>
+	      </span>
+	    </td>
+	    <td valign="top" style="background: #fff url(http://af.lygo.com/d/toolbar/bg.gif) repeat-x;"><a href="http://lt.angelfire.com/af_toolbar/angelfire/_h_/www.angelfire.lycos.com" target="_top"><img src="http://af.lygo.com/d/toolbar/aflogo_bot.gif" alt="hosted by angelfire" border="0" height="22" width="143"></a></td>
+	  </tr>
+	</table>
+      </form>
+     </div>
+
+<table border="0" cellpadding="0" cellspacing="0" width="728"><tr><td>
+  <script type="text/javascript">
+if (objAdMgr.isSlotAvailable("leaderboard")) {
+	objAdMgr.renderSlot("leaderboard")
+}
+</script>
+<noscript>
+<a href="http://network.realmedia.com/RealMedia/ads/click_nx.ads/lycosangelfire/ros/728x90/wp/ss/a/491169@Top1?x"><img border="0" src="http://network.realmedia.com/RealMedia/ads/adstream_nx.ads/lycosangelfire/ros/728x90/wp/ss/a/491169@Top1" alt="leaderboard ad" /></a>
+</noscript>
+
+</td></tr>
+</table>
+<table width="86%" border="0" cellspacing="0" cellpadding="2">
+  <tr>
+    <td height="388" width="19%" bgcolor="#FFCCFF" valign="top">
+      <p>May 1, 2000</p>
+      <p><b>Pop Culture</b> </p>
+      <p>by. H. Finkelstein</p>
+
+    </td>
+    <td height="388" width="52%" valign="top">
+      <p>Welcome to the <b>Anime Digi-Lib</b>, a virtual index to anime on the
+        internet. This site strives to house a comprehensive index to both personal
+        and commercial websites and provides reviews to these sites. We hope to
+        be a gateway for people who've never imagined they'd ever be interested
+        in Japanese Animation. </p>
+      <table width="99%" border="1" cellspacing="0" cellpadding="2" height="320" name="Searchnservices">
+        <tr>
+          <td height="263" valign="top" width="58%">
+            <p>&nbsp; </p>
+            <p>&nbsp;</p>
+
+<FORM ACTION="/cgi-bin/script_library/site_search/search" METHOD="GET">
+
+<table border="0" cellpadding="2" cellspacing="0">
+<tr>
+<td colspan="2">Search term: <INPUT NAME="search_term"><br></td>
+</tr>
+<tr>
+<td colspan="2" align="center">Case-sensitive -
+<INPUT TYPE="checkbox" NAME="case_sensitive">yes<br></td>
+</tr>
+<tr>
+<td align="right"><INPUT TYPE="radio" NAME="search_type" VALUE="exact" CHECKED>exact</td>
+<td><INPUT TYPE="radio" NAME="search_type" VALUE="fuzzy">fuzzy<br></td>
+
+</tr>
+<tr>
+<td colspan="2" align="center"><INPUT TYPE="hidden" NAME="display" VALUE="#FF0000"><INPUT TYPE="submit"></td>
+</tr>
+</table>
+</form>
+
+
+            <td>
+              <table border="0" cellpadding="0" cellspacing="0" width="100%">
+<tr><td><font face="verdana,geneva" color="#000011" size="1">What is better, subtitled or dubbed anime?</font></td></tr>
+<tr><td><input type="radio" name="rd" value="1"><font face="verdana" size="2" color="#000011">Subtitled</font></td></tr>
+
+<tr><td align="middle"><font face="verdana" size="1"><a href="http://pub.alxnet.com/poll?id=2079873&q=view">Current results</a></font></td></tr>
+</table></td></tr>
+          <tr>
+            <td><font face="verdana" size="1"><a href="http://www.alxnet.com/services/poll/">Free
+              Web Polls</a></font></td>
+          </tr>
+</table></form>
+<!-- Alxnet.com -- web poll code ends -->
+    </td>
+  </tr>
+</table>
+</body>
+
+</html>
+
+<!-- vim: et sw=4 sts=4
+-->

--- libraries/htmlpurifier/benchmarks/samples/Lexer/4.html ---
@@ -0,0 +1,543 @@
+<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
+<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr">
+	<head>
+		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
+		<meta name="keywords" content="Tai Chi Chuan,Yang Pan-hou,Yang Chien-hou,Yang style Tai Chi Chuan,Yang Lu-ch'an,Wu/Hao style T'ai Chi Ch'uan,Wu Ch'uan-y�,Hao Wei-chen,Yang Shou-chung,Wu style T'ai Chi Ch'uan,Wu Chien-ch'�an" />
+<link rel="shortcut icon" href="/favicon.ico" />
+<link rel="copyright" href="http://www.gnu.org/copyleft/fdl.html" />
+		<title>Tai Chi Chuan - Wikipedia, the free encyclopedia</title>
+		<style type="text/css" media="screen,projection">/*<![CDATA[*/ @import "/skins-1.5/monobook/main.css?9"; /*]]>*/</style>
+		<link rel="stylesheet" type="text/css" media="print" href="/skins-1.5/common/commonPrint.css" />
+
+		<!--[if lt IE 5.5000]><style type="text/css">@import "/skins-1.5/monobook/IE50Fixes.css";</style><![endif]-->
+		<!--[if IE 5.5000]><style type="text/css">@import "/skins-1.5/monobook/IE55Fixes.css";</style><![endif]-->
+		<!--[if IE 6]><style type="text/css">@import "/skins-1.5/monobook/IE60Fixes.css";</style><![endif]-->
+		<!--[if IE 7]><style type="text/css">@import "/skins-1.5/monobook/IE70Fixes.css?1";</style><![endif]-->
+		<!--[if lt IE 7]><script type="text/javascript" src="/skins-1.5/common/IEFixes.js"></script>
+		<meta http-equiv="imagetoolbar" content="no" /><![endif]-->
+		<script type="text/javascript">var skin = 'monobook';var stylepath = '/skins-1.5';</script>
+		<script type="text/javascript" src="/skins-1.5/common/wikibits.js?1"><!-- wikibits js --></script>
+		<script type="text/javascript" src="/w/index.php?title=-&amp;action=raw&amp;smaxage=0&amp;gen=js"><!-- site js --></script>
+
+		<style type="text/css">/*<![CDATA[*/
+@import "/w/index.php?title=MediaWiki:Common.css&action=raw&ctype=text/css&smaxage=2678400";
+@import "/w/index.php?title=MediaWiki:Monobook.css&action=raw&ctype=text/css&smaxage=2678400";
+@import "/w/index.php?title=-&action=raw&gen=css&maxage=2678400&ts=20060721225848";
+@import "/w/index.php?title=User:Edward_Z._Yang/monobook.css&action=raw&ctype=text/css";
+/*]]>*/</style>
+		<script type="text/javascript" src="/w/index.php?title=User:Edward_Z._Yang/monobook.js&amp;action=raw&amp;ctype=text/javascript&amp;dontcountme=s"></script>
+		<!-- Head Scripts -->
+			</head>
+<body  class="ns-0 ltr">
+	<div id="globalWrapper">
+		<div id="column-content">
+	<div id="content">
+
+		<a name="top" id="top"></a>
+		<div id="siteNotice"><div id="wikimania2006" style="text-align:right; font-size:80%"><a href="http://wm06reg.wikimedia.org/" class="external text" title="http://wm06reg.wikimedia.org/">Registration</a> for <a href="http://wikimania2006.wikimedia.org" class="external text" title="http://wikimania2006.wikimedia.org">Wikimania 2006</a> is open.&nbsp;&nbsp;&nbsp;</div>
+</div>		<h1 class="firstHeading">Tai Chi Chuan</h1>
+		<div id="bodyContent">
+			<h3 id="siteSub">From Wikipedia, the free encyclopedia</h3>
+
+			<div id="contentSub"></div>
+									<div id="jump-to-nav">Jump to: <a href="#column-one">navigation</a>, <a href="#searchInput">search</a></div>			<!-- start content -->
+			<table border="1" cellpadding="2" cellspacing="0" align="right">
+<tr>
+<th colspan="2" bgcolor="#FFCCCC"><big>???</big></th>
+</tr>
+<tr>
+<td colspan="2">
+
+<div class="center">
+<div class="thumb tnone">
+<div style="width:182px;"><a href="/wiki/Image:Yang_Ch%27eng-fu_circa_1918.jpg" class="internal" title="Yang Chengfu in a posture from the Tai Chi solo form known as Single Whip, circa 1918"><img src="http://upload.wikimedia.org/wikipedia/en/thumb/d/d1/Yang_Ch%27eng-fu_circa_1918.jpg/180px-Yang_Ch%27eng-fu_circa_1918.jpg" alt="Yang Chengfu in a posture from the Tai Chi solo form known as Single Whip, circa 1918" width="180" height="255" longdesc="/wiki/Image:Yang_Ch%27eng-fu_circa_1918.jpg" /></a>
+<div class="thumbcaption">
+<div class="magnify" style="float:right"><a href="/wiki/Image:Yang_Ch%27eng-fu_circa_1918.jpg" class="internal" title="Enlarge"><img src="/skins-1.5/common/images/magnify-clip.png" width="15" height="11" alt="Enlarge" /></a></div>
+<b><a href="/wiki/Yang_Chengfu" title="Yang Chengfu">Yang Chengfu</a> in a posture from the Tai Chi solo form known as <i>Single Whip</i>, circa <a href="/wiki/1918" title="1918">1918</a></b></div>
+</div>
+</div>
+</div>
+</td>
+</tr>
+
+<tr>
+<th colspan="2"><a href="/wiki/Chinese_language" title="Chinese language">Chinese</a> Name</th>
+</tr>
+<tr>
+<td><a href="/wiki/Hanyu_Pinyin" title="Hanyu Pinyin">Hanyu Pinyin</a></td>
+<td>T�ij�qu�n</td>
+</tr>
+<tr>
+<td><a href="/wiki/Wade-Giles" title="Wade-Giles">Wade-Giles</a></td>
+<td>T'ai<sup>4</sup> Chi<sup>2</sup> Ch'�an<sup>2</sup></td>
+
+</tr>
+<tr>
+<td><a href="/wiki/Simplified_Chinese" title="Simplified Chinese">Simplified Chinese</a></td>
+<td>???</td>
+</tr>
+<tr>
+<td><a href="/wiki/Traditional_Chinese" title="Traditional Chinese">Traditional Chinese</a></td>
+<td><a href="http://en.wiktionary.org/wiki/%E5%A4%AA" class="extiw" title="wiktionary:?">?</a><a href="http://en.wiktionary.org/wiki/%E6%A5%B5" class="extiw" title="wiktionary:?">?</a><a href="http://en.wiktionary.org/wiki/%E6%8B%B3" class="extiw" title="wiktionary:?">?</a></td>
+</tr>
+<tr>
+<td><a href="/wiki/Cantonese_%28linguistics%29" title="Cantonese (linguistics)">Cantonese</a></td>
+
+<td>taai3 gik6 kyun4</td>
+</tr>
+<tr>
+<td><a href="/wiki/Hiragana" title="Hiragana">Japanese Hiragana</a></td>
+<td>???????</td>
+</tr>
+<tr>
+<td><a href="/wiki/Korean_%28language%29" title="Korean (language)">Korean</a></td>
+<td>???</td>
+</tr>
+<tr>
+<td><a href="/wiki/Vietnamese_%28language%29" title="Vietnamese (language)">Vietnamese</a></td>
+
+<td>Th�i C?c Quy?n</td>
+</tr>
+</table>
+<p><b>Tai Chi Chuan</b>, <b>T'ai Chi Ch'�an</b> or <b>Taijiquan</b> (<a href="/wiki/Traditional_Chinese_character" title="Traditional Chinese character">Traditional Chinese</a>: ???; <a href="/wiki/Simplified_Chinese_character" title="Simplified Chinese character">Simplified Chinese</a>: ???; <a href="/wiki/Pinyin" title="Pinyin">pinyin</a>: T�ij�qu�n; literally "supreme ultimate fist"), commonly known as <b>Tai Chi</b>, <b>T'ai Chi</b>, or <b><a href="/wiki/Taiji" title="Taiji">Taiji</a></b>, is an <a href="/wiki/Neijia" title="Neijia">internal</a> <a href="/wiki/Chinese_martial_arts" title="Chinese martial arts">Chinese martial art</a>. There are different styles of T'ai Chi Ch'�an, although most agree they are all based on the system originally taught by the <a href="/wiki/Chen" title="Chen">Chen</a> family to the <a href="/wiki/Yang" title="Yang">Yang</a> family starting in <a href="/wiki/1820" title="1820">1820</a>. It is often promoted and practiced as a <a href="/wiki/Martial_arts_therapy" title="Martial arts therapy">martial arts therapy</a> for the purposes of <a href="/wiki/Health" title="Health">health</a> and <a href="/wiki/Longevity" title="Longevity">longevity</a>, (some <a href="/wiki/Tai_Chi_Chuan#Citations_to_medical_research" title="Tai Chi Chuan">recent medical studies</a> support its effectiveness). T'ai Chi Ch'�an is considered a <i>soft</i> style martial art, an art applied with as complete a relaxation or "softness" in the musculature as possible, to distinguish its theory and application from that of the <i>hard</i> martial art styles which use a degree of tension in the muscles.</p>
+
+<p>Variations of T'ai Chi Ch'�an's basic training forms are well known as the slow motion routines that groups of people practice every morning in parks across China and other parts of the world. Traditional T'ai Chi training is intended to teach awareness of one's own balance and what affects it, awareness of the same in others, an appreciation of the practical value in one's ability to moderate extremes of behavior and attitude at both mental and physical levels, and how this applies to effective self-defense principles.</p>
+<table id="toc" class="toc" summary="Contents">
+<tr>
+<td>
+<div id="toctitle">
+<h2>Contents</h2>
+</div>
+<ul>
+<li class="toclevel-1"><a href="#Overview"><span class="tocnumber">1</span> <span class="toctext">Overview</span></a></li>
+<li class="toclevel-1"><a href="#Training_and_techniques"><span class="tocnumber">2</span> <span class="toctext">Training and techniques</span></a></li>
+
+<li class="toclevel-1"><a href="#Styles_and_history"><span class="tocnumber">3</span> <span class="toctext">Styles and history</span></a>
+<ul>
+<li class="toclevel-2"><a href="#Family_tree"><span class="tocnumber">3.1</span> <span class="toctext">Family tree</span></a></li>
+<li class="toclevel-2"><a href="#Notes_to_Family_tree_table"><span class="tocnumber">3.2</span> <span class="toctext">Notes to Family tree table</span></a></li>
+</ul>
+</li>
+<li class="toclevel-1"><a href="#Modern_T.27ai_Chi"><span class="tocnumber">4</span> <span class="toctext">Modern T'ai Chi</span></a>
+
+<ul>
+<li class="toclevel-2"><a href="#Modern_forms"><span class="tocnumber">4.1</span> <span class="toctext">Modern forms</span></a></li>
+</ul>
+</li>
+<li class="toclevel-1"><a href="#Health_benefits"><span class="tocnumber">5</span> <span class="toctext">Health benefits</span></a>
+<ul>
+<li class="toclevel-2"><a href="#Citations_to_medical_research"><span class="tocnumber">5.1</span> <span class="toctext">Citations to medical research</span></a></li>
+</ul>
+
+</li>
+<li class="toclevel-1"><a href="#See_also"><span class="tocnumber">6</span> <span class="toctext">See also</span></a></li>
+<li class="toclevel-1"><a href="#External_links"><span class="tocnumber">7</span> <span class="toctext">External links</span></a></li>
+</ul>
+</td>
+</tr>
+</table>
+<p><script type="text/javascript">
+//<![CDATA[
+ if (window.showTocToggle) { var tocShowText = "show"; var tocHideText = "hide"; showTocToggle(); }
+//]]>
+</script></p>
+<div class="editsection" style="float:right;margin-left:5px;">[<a href="/w/index.php?title=Tai_Chi_Chuan&amp;action=edit&amp;section=1" title="Edit section: Overview">edit</a>]</div>
+
+<p><a name="Overview" id="Overview"></a></p>
+<h2>Overview</h2>
+<p>Historically, T'ai Chi Ch'�an has been regarded as a martial art, and its traditional practitioners still teach it as one. Even so, it has developed a worldwide following among many thousands of people with little or no interest in martial training for its aforementioned benefits to health and <a href="/wiki/Preventive_medicine" title="Preventive medicine">health maintenance</a>. Some call it a form of moving <a href="/wiki/Meditation" title="Meditation">meditation</a>, and T'ai Chi theory and practice evolved in agreement with many of the principles of <a href="/wiki/Traditional_Chinese_medicine" title="Traditional Chinese medicine">traditional Chinese medicine</a>. Besides general health benefits and <a href="/wiki/Stress_management" title="Stress management">stress management</a> attributed to beginning and intermediate level T'ai Chi training, many therapeutic interventions along the lines of traditional Chinese medicine are taught to advanced T'ai Chi students.</p>
+<p>T'ai Chi Ch'�an as physical training is characterized by its requirement for the use of leverage through the joints based on coordination in relaxation rather than muscular tension in order to neutralize or initiate physical attacks. The slow, repetitive work involved in that process is said to gently increase and open the internal circulation (<a href="/wiki/Breath" title="Breath">breath</a>, body heat, <a href="/wiki/Blood" title="Blood">blood</a>, <a href="/wiki/Lymph" title="Lymph">lymph</a>, <a href="/wiki/Peristalsis" title="Peristalsis">peristalsis</a>, etc.). Over time, proponents say, this enhancement becomes a lasting effect, a direct reversal of the constricting physical effects of stress on the human body. This reversal allows much more of the students' native energy to be available to them, which they may then apply more effectively to the rest of their lives; families, careers, spiritual or creative pursuits, hobbies, etc.</p>
+
+<p>The study of T'ai Chi Ch'�an involves three primary subjects:</p>
+<ul>
+<li><b>Health</b> - an unhealthy or otherwise uncomfortable person will find it difficult to meditate to a state of calmness or to use T'ai Chi as a martial art. T'ai Chi's health training therefore concentrates on relieving the physical effects of stress on the body and mind.</li>
+<li><b>Meditation</b> - the focus meditation and subsequent calmness cultivated by the meditative aspect of T'ai Chi is seen as necessary to maintain optimum health (in the sense of effectively maintaining stress relief or <a href="/wiki/Homeostasis" title="Homeostasis">homeostasis</a>) and in order to use it as a soft style martial art.</li>
+<li><b>Martial art</b> - the ability to competently use T'ai Chi as a martial art is said to be proof that the health and meditation aspects are working according to the dictates of the theory of T'ai Chi Ch'�an.</li>
+
+</ul>
+<p>In its traditional form (many modern variations exist which ignore at least one of the above requirements) every aspect of its training has to conform with all three of the aforementioned categories.</p>
+<p>The <a href="/wiki/Mandarin_%28linguistics%29" title="Mandarin (linguistics)">Mandarin</a> term "T'ai Chi Ch'�an" translates as "Supreme Ultimate Boxing" or "Boundless Fist". T'ai Chi training involves learning solo routines, known as <i>forms</i>, and two person routines, known as <i><a href="/wiki/Pushing_hands" title="Pushing hands">pushing hands</a></i>, as well as <i><a href="/wiki/Acupressure" title="Acupressure">acupressure</a></i>-related manipulations taught by traditional schools. T'ai Chi Ch'�an is seen by many of its schools as a variety of <a href="/wiki/Taoism" title="Taoism">Taoism</a>, and it does seemingly incorporate many Taoist principles into its practice (see below). It is an art form said to date back many centuries (although not reliably documented under that name before 1850), with precursor disciplines dating back thousands of years. The explanation given by the traditional T'ai Chi family schools for why so many of their previous generations have dedicated their lives to the study and preservation of the art is that the discipline it seems to give its students to dramatically improve the effects of stress in their lives, with a few years of hard work, should hold a useful purpose for people living in a stressful world. They say that once the T'ai Chi principles have been understood and internalized into the bodily framework the practitioner will have an immediately accessible "toolkit" thereby to improve and then maintain their health, to provide a meditative focus, and that can work as an effective and subtle martial art for self-defense.</p>
+<p>Teachers say the study of T'ai Chi Ch'�an is, more than anything else, about challenging one's ability to change oneself appropriately in response to outside forces. These principles are taught using the examples of <a href="/wiki/Physics" title="Physics">physics</a> as experienced by two (or more) bodies in <a href="/wiki/Combat" title="Combat">combat</a>. In order to be able to protect oneself or someone else by using change, it is necessary to understand what the consequences are of changing appropriately, changing inappropriately and not changing at all in response to an attack. Students, by this theory, will appreciate the full benefits of the entire art in the fastest way through physical training of the martial art aspect.</p>
+
+<p><a href="/wiki/Wu_Chien-ch%27uan" title="Wu Chien-ch'uan">Wu Chien-ch'�an</a>, co-founder of the Wu family style, described the name <i>T'ai Chi Ch'�an</i> this way at the beginning of the <a href="/wiki/20th_century" title="20th century">20th century</a>:</p>
+<dl>
+<dd>"Various people have offered different explanations for the name <i>T'ai Chi Ch'uan</i>. Some have said: 'In terms of self-cultivation, one must train from a state of movement towards a state of stillness. <i>T'ai Chi</i> comes about through the balance of <i><a href="/wiki/Yin" title="Yin">yin</a></i> and <i><a href="/wiki/Yang" title="Yang">yang</a></i>. In terms of the art of attack and defense then, in the context of the <a href="/wiki/I_Ching" title="I Ching">changes</a> of full and empty, one is constantly internally latent, not outwardly expressive, as if the <i>yin</i> and <i>yang</i> of <i>T'ai Chi</i> have not yet divided apart.'</dd>
+
+<dd>Others say: 'Every movement of <i>T'ai Chi Ch'uan</i> is based on circles, just like the shape of a <a href="/wiki/Taijitu" title="Taijitu"><i>T'ai Chi</i> symbol</a>. Therefore, it is called <i>T'ai Chi Ch'uan</i>.' Both explanations are quite reasonable, especially the second, which is more complete."</dd>
+</dl>
+<div class="editsection" style="float:right;margin-left:5px;">[<a href="/w/index.php?title=Tai_Chi_Chuan&amp;action=edit&amp;section=2" title="Edit section: Training and techniques">edit</a>]</div>
+<p><a name="Training_and_techniques" id="Training_and_techniques"></a></p>
+
+<h2>Training and techniques</h2>
+<div class="thumb tright">
+<div style="width:182px;"><a href="/wiki/Image:Yin_yang.svg" class="internal" title="The T'ai Chi Symbol or T'ai Chi T'u (Taijitu)"><img src="http://upload.wikimedia.org/wikipedia/commons/thumb/1/17/Yin_yang.svg/180px-Yin_yang.svg.png" alt="The T'ai Chi Symbol or T'ai Chi T'u (Taijitu)" width="180" height="180" longdesc="/wiki/Image:Yin_yang.svg" /></a>
+<div class="thumbcaption">
+<div class="magnify" style="float:right"><a href="/wiki/Image:Yin_yang.svg" class="internal" title="Enlarge"><img src="/skins-1.5/common/images/magnify-clip.png" width="15" height="11" alt="Enlarge" /></a></div>
+<b>The T'ai Chi Symbol or T'ai Chi T'u (Taijitu)</b></div>
+</div>
+</div>
+<p>As the name <i>T'ai Chi Ch'�an</i> is held to be derived from the T'ai Chi symbol, the <i>taijitu</i> or <i>t'ai chi t'u</i> (???, <a href="/wiki/Pinyin" title="Pinyin">pinyin</a> t�ij�t�), commonly known in the West as the "<a href="/wiki/Yin-yang" title="Yin-yang">yin-yang</a>" diagram, T'ai Chi Ch'�an techniques are said therefore to physically and energetically balance <i>yin</i> (receptive) and <i>yang</i> (active) principles: "From ultimate softness comes ultimate hardness."</p>
+
+<p>The core training involves two primary features: the first being the solo form or <i>ch'�an</i>, a slow sequence of movements which emphasize a straight spine, relaxed breathing and a natural range of motion; the second being different styles of <i>pushing hands</i> or <i>t'ui shou</i> (??) for training "stickiness" and sensitivity in the reflexes through various motions from the forms in concert with a training partner in order to learn leverage, timing, coordination and positioning when interacting with another. Pushing hands is seen as necessary not only for training the self-defense skills of a soft style such as T'ai Chi by demonstrating the forms' movement principles experientially, but also it is said to improve upon the level of conditioning provided by practice of the solo forms by increasing the workload on students while they practice those movement principles.</p>
+<p>The solo form should take the students through a complete, natural, range of motion over their centre of gravity. Accurate, repeated practice of the solo routine is said to retrain posture, encourage circulation throughout the students' bodies, maintain flexibility through their joints and further familiarize students with the martial application sequences implied by the forms. The major traditional styles of T'ai Chi have forms which differ somewhat cosmetically, but there are also many obvious similarities which point to their common origin. The solo forms, empty-hand and <a href="/wiki/Weapon" title="Weapon">weapon</a>, are catalogues of movements that are practised individually in pushing hands and martial application scenarios to prepare students for self-defence training. In most traditional schools different variations of the solo forms can be practiced; fast/slow, small circle/large circle, square/round (which are different expressions of leverage through the joints), low sitting/high sitting (the degree to which weight-bearing knees are kept bent throughout the form), for example.</p>
+<p>In a fight, if one uses hardness to resist violent force then both sides are certain to be injured, at least to some degree. Such injury, according to T'ai Chi theory, is a natural consequence of meeting brute force with brute force. The collision of two like forces, yang with yang, is known as "double-weighted" in T'ai Chi terminology. Instead, students are taught not to fight or resist an incoming force, but to meet it in softness and "stick" to it, following its motion while remaining in physical contact until the incoming force of attack exhausts itself or can be safely redirected, the result of meeting yang with yin. Done correctly, achieving this yin/yang or yang/yin balance in combat (and, by extension, other areas of one's life) is known as being "single-weighted" and is a primary goal of T'ai Chi Ch'�an training. <a href="/wiki/Lao_Tzu" title="Lao Tzu">Lao Tzu</a> provided the <a href="/wiki/Archetype" title="Archetype">archetype</a> for this in the <a href="/wiki/Tao_Te_Ching" title="Tao Te Ching">Tao Te Ching</a> when he wrote, "The soft and the pliable will defeat the hard and strong." This soft "neutralization" of an attack can be accomplished very quickly in an actual fight by an adept practitioner. A T'ai Chi student has to be well conditioned by many years of disciplined training; stable, sensitive and elastic mentally and physically in order to realize this ability, however.</p>
+
+<p>Other training exercises include:</p>
+<ul>
+<li>Weapons training and <a href="/wiki/Fencing" title="Fencing">fencing</a> applications employing the straight <i><a href="/wiki/Sword" title="Sword">sword</a></i> known as the <i>jian</i> or <i>chien</i> or <i>gim</i> (<a href="/wiki/Jian" title="Jian">ji�n</a> ?), a heavier curved <i>sabre</i>, sometimes called a <i>broadsword</i> or <i>tao</i> (<a href="/wiki/Dao_%28saber%29" title="Dao (saber)">dao</a> ?, which is actually considered a big <i><a href="/wiki/Knife" title="Knife">knife</a></i>), folding <i><a href="/wiki/Tessen" title="Tessen">fan</a></i>, <i>staff</i> (?), 7 foot (2 m) <i><a href="/wiki/Qiang_%28spear%29" title="Qiang (spear)">spear</a></i> and 13 foot (4 m) <i><a href="/wiki/Lance" title="Lance">lance</a></i> (both called qiang ?). More exotic weapons still used by some traditional styles are the large <i>Da Dao</i> or <i>Ta Tao</i> (??) sabre, <i><a href="/wiki/Ji_%28halberd%29" title="Ji (halberd)">halberd</a></i> (ji ?), <i>cane</i>, <i>rope-dart</i>, <i><a href="/wiki/Three_sectional_staff" title="Three sectional staff">three sectional staff</a></i>, <i><a href="/wiki/Lasso" title="Lasso">lasso</a></i>, <i><a href="/wiki/Whip" title="Whip">whip</a></i>, <i><a href="/wiki/Chain_whip" title="Chain whip">chain whip</a></i> and <i>steel whip</i>.</li>
+
+<li>Two-person tournament sparring (as part of push hands competitions and/or <i><a href="/wiki/San_shou" title="San shou">san shou</a></i> ??);</li>
+<li>Breathing exercises; <i><a href="/wiki/Nei_kung" title="Nei kung">nei kung</a></i> (?? n�igong) or, more commonly, <i><a href="/wiki/Ch%27i_kung" title="Ch'i kung">ch'i kung</a></i> (?? q�gong) to develop <b><a href="/wiki/Ch%27i" title="Ch'i">ch'i</a></b> (? q�) or "breath energy" in coordination with physical movement and <a href="/wiki/Zhan_zhuang" title="Zhan zhuang">post standing</a> or combinations of the two. These were formerly taught only to disciples as a separate, complementary training system. In the last 50 years they have become more well known to the general public.</li>
+
+</ul>
+<p>T'ai Chi's martial aspect relies on sensitivity to the opponent's movements and centre of gravity dictating appropriate responses. Effectively affecting or "capturing" the opponent's centre of gravity immediately upon contact is trained as the primary goal of the martial T'ai Chi student, and from there all other technique can follow with seeming effortlessness. The alert calmness required to achieve the necessary sensitivity is acquired over thousands of hours of first <i>yin</i> (slow, repetitive, meditative, low impact) and then later adding <i>yang</i> ("realistic," active, fast, high impact) martial training; forms, pushing hands and sparring. T'ai Chi Ch'�an trains in three basic ranges, close, medium and long, and then everything in between. Pushes and open hand strikes are more common than punches, and kicks are usually to the legs and lower torso, never higher than the hip in most styles. The fingers, fists, palms, sides of the hands, wrists, forearms, elbows, shoulders, back, hips, knees and feet are commonly used to strike, with strikes to the eyes, throat, heart, groin and other acupressure points trained by advanced students. There is an extensive repertoire of joint traps, locks and breaks (<a href="/wiki/Chin_na" title="Chin na">chin na</a>), particularly applied to lock up or break an opponent's elbows, wrists, fingers, ankles, back or neck. Most T'ai Chi teachers expect their students to thoroughly learn defensive or neutralizing skills first, and a student will have to demonstrate proficiency with them before offensive skills will be extensively trained. There is also an emphasis in the traditional schools on kind-heartedness. One is expected to show mercy to one's opponents, as instanced by a poem preserved in some of the T'ai Chi families said to be derived from the <a href="/wiki/Shaolin" title="Shaolin">Shaolin</a> temple:</p>
+<dl>
+<dd>"I would rather maim than kill</dd>
+
+<dd>Hurt than maim</dd>
+<dd>Intimidate than hurt</dd>
+<dd>Avoid than intimidate."</dd>
+</dl>
+<div class="thumb tright">
+<div style="width:352px;"><a href="/wiki/Image:Martial_arts_-_Fragrant_Hills.JPG" class="internal" title="An outdoor Chen style class in Beijing"><img src="http://upload.wikimedia.org/wikipedia/commons/thumb/b/b6/Martial_arts_-_Fragrant_Hills.JPG/350px-Martial_arts_-_Fragrant_Hills.JPG" alt="An outdoor Chen style class in Beijing" width="350" height="233" longdesc="/wiki/Image:Martial_arts_-_Fragrant_Hills.JPG" /></a>
+<div class="thumbcaption">
+<div class="magnify" style="float:right"><a href="/wiki/Image:Martial_arts_-_Fragrant_Hills.JPG" class="internal" title="Enlarge"><img src="/skins-1.5/common/images/magnify-clip.png" width="15" height="11" alt="Enlarge" /></a></div>
+An outdoor Chen style class in Beijing</div>
+</div>
+</div>
+<div class="editsection" style="float:right;margin-left:5px;">[<a href="/w/index.php?title=Tai_Chi_Chuan&amp;action=edit&amp;section=3" title="Edit section: Styles and history">edit</a>]</div>
+
+<p><a name="Styles_and_history" id="Styles_and_history"></a></p>
+<h2>Styles and history</h2>
+<p>There are five major styles of T'ai Chi Ch'�an, each named after the Chinese family that teaches (or taught) it:</p>
+<ul>
+<li><b><a href="/wiki/Chen_style_Tai_Chi_Chuan" title="Chen style Tai Chi Chuan">Chen style</a></b> (??) and its close cousin <b><a href="/w/index.php?title=Zhaobao_style_T%27ai_Chi_Ch%27uan&amp;action=edit" class="new" title="Zhaobao style T'ai Chi Ch'uan">Zhao Bao Style</a></b> (?????)</li>
+<li><b><a href="/wiki/Yang_style_T%27ai_Chi_Ch%27uan" title="Yang style T'ai Chi Ch'uan">Yang style</a></b> (??)</li>
+
+<li><b><a href="/wiki/Wu/Hao_style_T%27ai_Chi_Ch%27uan" title="Wu/Hao style T'ai Chi Ch'uan">Wu or Wu/Hao style of Wu Yu-hsiang</a></b> (??)</li>
+<li><b><a href="/wiki/Wu_style_T%27ai_Chi_Ch%27uan" title="Wu style T'ai Chi Ch'uan">Wu style of Wu Ch'uan-y� and Wu Chien-ch'uan</a></b> (??)</li>
+<li><b><a href="/wiki/Sun_style_T%27ai_Chi_Ch%27uan" title="Sun style T'ai Chi Ch'uan">Sun style</a></b> (??)</li>
+</ul>
+<p>The order of seniority is as listed above. The order of popularity is Yang, Wu, Chen, Sun, and Wu/Hao. The first five major family styles share much underlying theory, but differ in their approaches to training.</p>
+<p>In the modern world there are now dozens of new styles, hybrid styles and offshoots of the main styles, but the five family schools are the groups recognised by the international community as being orthodox. For example, there are <i>several</i> groups teaching what they call <a href="/wiki/Wudang_Tai_Chi_Chuan" title="Wudang Tai Chi Chuan">Wu Tang style T'ai Chi Ch'�an (??????)</a>. The best known modern style going by the name <i>Wu Tang</i> has gained some publicity internationally, especially in the <a href="/wiki/United_Kingdom" title="United Kingdom">UK</a> and <a href="/wiki/Europe" title="Europe">Europe</a>, but was originally taught by a senior student of the Wu (?) style.</p>
+
+<p>The designation <i><a href="/wiki/Wudangquan" title="Wudangquan">Wu Tang Ch'�an</a></i> is also used to broadly distinguish <i>internal</i> or <i>nei chia</i> martial arts (said to be a specialty of the <a href="/wiki/Monasteries" title="Monasteries">monasteries</a> at <a href="/wiki/Wudangshan" title="Wudangshan">Wu Tang Shan</a>) from what are known as the <i>external</i> or <i>wei chia</i> styles based on <i><a href="/w/index.php?title=Shaolinquan_kung_fu&amp;action=edit" class="new" title="Shaolinquan kung fu">Shaolinquan kung fu</a></i>, although that distinction is sometimes disputed by individual schools. In this broad sense, among many T'ai Chi schools <i>all</i> styles of T'ai Chi (as well as related arts such as <a href="/wiki/Bagua_zhang" title="Bagua zhang">Pa Kua Chang</a> and <a href="/wiki/Hsing_Yi" title="Hsing Yi">Hsing-i Ch'�an</a>) are therefore considered to be "Wu Tang style" martial arts. The schools that designate themselves "Wu Tang style" relative to the family styles mentioned above mostly claim to teach an "original style" they say was formulated by a Taoist monk called <a href="/wiki/Zhang_Sanfeng" title="Zhang Sanfeng">Zhang Sanfeng</a> and taught by him in the Taoist monasteries at Wu Tang Shan. Some consider that what is practised under that name today may be a modern back-formation based on stories and popular veneration of Zhang Sanfeng (see below) as well as the martial fame of the Wu Tang monastery (there are many other martial art styles historically associated with Wu Tang besides T'ai Chi).</p>
+
+<p>When tracing T'ai Chi Ch'�an's formative influences to <a href="/wiki/Taoist" title="Taoist">Taoist</a> and <a href="/wiki/Buddhist" title="Buddhist">Buddhist</a> monasteries, one has little more to go on than legendary tales from a modern historical perspective, but T'ai Chi Ch'�an's practical connection to and dependence upon the theories of <a href="/wiki/Song_dynasty" title="Song dynasty">Sung dynasty</a> <a href="/wiki/Neo-Confucianism" title="Neo-Confucianism">Neo-Confucianism</a> (a conscious synthesis of Taoist, Buddhist and <a href="/wiki/Confucian" title="Confucian">Confucian</a> traditions, esp. the teachings of <a href="/wiki/Mencius" title="Mencius">Mencius</a>) is readily apparent to its practitioners. The philosophical and political landscape of that time in Chinese history is fairly well documented, even if the origin of the art later to become known as T'ai Chi Ch'�an in it is not. T'ai Chi Ch'�an's theories and practice are therefore believed by some schools to have been formulated by the Taoist monk <a href="/wiki/Zhang_Sanfeng" title="Zhang Sanfeng">Zhang Sanfeng</a> in the 12th century, a time frame fitting well with when the principles of the Neo-Confucian school were making themselves felt in Chinese intellectual life. Therefore the didactic story is told that Zhang Sanfeng as a young man studied <a href="/wiki/Tao_Yin" title="Tao Yin">Tao Yin</a> (??, <a href="/wiki/Pinyin" title="Pinyin">Pinyin</a> daoyin) breathing exercises from his Taoist teachers and martial arts at the Buddhist Shaolin monastery, eventually combining the martial forms and breathing exercises to formulate the soft or internal principles we associate with T'ai Chi Ch'�an and related martial arts. Its subsequent fame attributed to his teaching, Wu Tang monastery was known thereafter as an important martial center for many centuries, its many styles of internal <a href="/wiki/Kung_fu" title="Kung fu">kung fu</a> preserved and refined at various Taoist temples.</p>
+
+<div class="editsection" style="float:right;margin-left:5px;">[<a href="/w/index.php?title=Tai_Chi_Chuan&amp;action=edit&amp;section=4" title="Edit section: Family tree">edit</a>]</div>
+<p><a name="Family_tree" id="Family_tree"></a></p>
+<h3>Family tree</h3>
+<p>This family tree is not comprehensive.</p>
+<pre>
+<b>LEGENDARY FIGURES</b>
+   |
+<a href="/wiki/Zhang_Sanfeng" title="Zhang Sanfeng">Zhang Sanfeng</a>*
+circa 12th century
+<a href="/wiki/Nei_chia" title="Nei chia">NEI CHIA</a>
+
+   |
+<a href="/w/index.php?title=Wang_Zongyue&amp;action=edit" class="new" title="Wang Zongyue">Wang Zongyue</a>*
+T'AI CHI CH'�AN
+   |
+<b>THE 5 MAJOR CLASSICAL FAMILY STYLES</b>
+   |
+Chen Wangting
+1600-1680 9th generation Chen
+<a href="/wiki/Chen_style_Tai_Chi_Chuan" title="Chen style Tai Chi Chuan">CHEN STYLE</a>
+   |
+   +-------------------------------------------------------------------+
+   |                                                                   |
+<a href="/w/index.php?title=Chen_Changxing&amp;action=edit" class="new" title="Chen Changxing">Chen Changxing</a>                                                     <a href="/w/index.php?title=Chen_Youben&amp;action=edit" class="new" title="Chen Youben">Chen Youben</a>
+1771-1853 14th generation Chen                                     circa 1800s 14th generation Chen
+Chen Old Frame                                                     Chen New Frame
+   |                                                                   |
+
+<a href="/wiki/Yang_Lu-ch%27an" title="Yang Lu-ch'an">Yang Lu-ch'an</a>                                                      <a href="/w/index.php?title=Chen_Qingping&amp;action=edit" class="new" title="Chen Qingping">Chen Qingping</a>
+1799-1872                                                          1795-1868
+<a href="/wiki/Yang_style_Tai_Chi_Chuan" title="Yang style Tai Chi Chuan">YANG STYLE</a>                                                         Chen Small Frame, Zhao Bao Frame
+   |                                                                   |
+   +---------------------------------+-----------------------------+   |
+   |                                 |                             |   |
+<a href="/wiki/Yang_Pan-hou" title="Yang Pan-hou">Yang Pan-hou</a>                      <a href="/wiki/Yang_Chien-hou" title="Yang Chien-hou">Yang Chien-hou</a>                   <a href="/w/index.php?title=Wu_Yu-hsiang&amp;action=edit" class="new" title="Wu Yu-hsiang">Wu Yu-hsiang</a>
+1837-1892                         1839-1917                        1812-1880
+Yang Small Frame                     |                             <a href="/wiki/Wu/Hao_style_T%27ai_Chi_Ch%27uan" title="Wu/Hao style T'ai Chi Ch'uan">WU/HAO STYLE</a>
+
+   |                                 +-----------------+                      |
+   |                                 |                 |                      |
+<a href="/wiki/Wu_Ch%27uan-y%C3%BC" title="Wu Ch'uan-y�">Wu Ch'uan-y�</a>                      <a href="/wiki/Yang_Shao-hou" title="Yang Shao-hou">Yang Shao-hou</a>     <a href="/wiki/Yang_Ch%27eng-fu" title="Yang Ch'eng-fu">Yang Ch'eng-fu</a>          <a href="/w/index.php?title=Li_I-y%C3%BC&amp;action=edit" class="new" title="Li I-y�">Li I-y�</a>
+1834-1902                         1862-1930         1883-1936               1832-1892
+   |                              Yang Small Frame  <a href="/wiki/103_form_Yang_family_T%27ai_Chi_Ch%27uan" title="103 form Yang family T'ai Chi Ch'uan">Yang Big Frame</a>            |
+<a href="/wiki/Wu_Chien-ch%27%C3%BCan" title="Wu Chien-ch'�an">Wu Chien-ch'�an</a>                                        |                    <a href="/wiki/Hao_Wei-chen" title="Hao Wei-chen">Hao Wei-chen</a>
+
+1870-1942                                           <a href="/wiki/Yang_Shou-chung" title="Yang Shou-chung">Yang Shou-chung</a>         1849-1920
+<a href="/wiki/Wu_style_T%27ai_Chi_Ch%27uan" title="Wu style T'ai Chi Ch'uan">WU STYLE</a>                                            1910-1985                 |
+<a href="/wiki/108_form_Wu_family_T%27ai_Chi_Ch%27uan" title="108 form Wu family T'ai Chi Ch'uan">108 Form</a>                                                                      |
+   |                                                                        <a href="/wiki/Sun_Lu-t%27ang" title="Sun Lu-t'ang">Sun Lu-t'ang</a>
+<a href="/wiki/Wu_Kung-i" title="Wu Kung-i">Wu Kung-i</a>                                                                   1861-1932
+1900-1970                                                                   <a href="/wiki/Sun_style_T%27ai_Chi_Ch%27uan" title="Sun style T'ai Chi Ch'uan">SUN STYLE</a>
+
+   |                                                                          |
+<a href="/w/index.php?title=Wu_Ta-kuei&amp;action=edit" class="new" title="Wu Ta-kuei">Wu Ta-kuei</a>                                                                  <a href="/w/index.php?title=Sun_Hsing-i&amp;action=edit" class="new" title="Sun Hsing-i">Sun Hsing-i</a>
+1923-1970                                                                   1891-1929
+
+<b>MODERN FORMS</b>
+
+from Yang Ch`eng-fu
+        |
+        |
+        |
+        +--------------+
+        |              |
+  <a href="/wiki/Cheng_Man-ch%27ing" title="Cheng Man-ch'ing">Cheng Man-ch'ing</a>     |
+  1901-1975            |
+  Short (37) Form      |
+                       |
+              Chinese Sports Commission
+              1956
+              Beijing <a href="/wiki/24_Form" title="24 Form">24 Form</a>
+              .
+              .
+              1989
+              <a href="/wiki/42_Form_%28Competition_Form%29_T%27ai_Chi_Ch%27uan" title="42 Form (Competition Form) T'ai Chi Ch'uan">42 Competition Form</a>
+
+              (<a href="/wiki/Wushu" title="Wushu">Wushu</a> competition form combined from Sun, Wu, Chen, and Yang styles)
+</pre>
+<div class="editsection" style="float:right;margin-left:5px;">[<a href="/w/index.php?title=Tai_Chi_Chuan&amp;action=edit&amp;section=5" title="Edit section: Notes to Family tree table">edit</a>]</div>
+<p><a name="Notes_to_Family_tree_table" id="Notes_to_Family_tree_table"></a></p>
+<h3>Notes to Family tree table</h3>
+<p>Names denoted by an asterisk are legendary or semilegendary figures in the lineage, which means their involvement in the lineage, while accepted by most of the major schools, isn't independently verifiable from known historical records.</p>
+<p>The Cheng Man-ch'ing and <a href="/w/index.php?title=Chinese_Sports_Commission&amp;action=edit" class="new" title="Chinese Sports Commission">Chinese Sports Commission</a> short forms are said to be derived from Yang family forms, but neither are recognized as Yang family T'ai Chi Ch'�an by current Yang family teachers. The Chen, Yang and Wu families are now promoting their own shortened demonstration forms for competitive purposes.</p>
+
+<div class="editsection" style="float:right;margin-left:5px;">[<a href="/w/index.php?title=Tai_Chi_Chuan&amp;action=edit&amp;section=6" title="Edit section: Modern T'ai Chi">edit</a>]</div>
+<p><a name="Modern_T.27ai_Chi" id="Modern_T.27ai_Chi"></a></p>
+<h2>Modern T'ai Chi</h2>
+<div class="thumb tright">
+<div style="width:352px;"><a href="/wiki/Image:Taichi_shanghai_bund_2005.jpg" class="internal" title="Yang style in Shanghai"><img src="http://upload.wikimedia.org/wikipedia/commons/thumb/9/9f/Taichi_shanghai_bund_2005.jpg/350px-Taichi_shanghai_bund_2005.jpg" alt="Yang style in Shanghai" width="350" height="263" longdesc="/wiki/Image:Taichi_shanghai_bund_2005.jpg" /></a>
+<div class="thumbcaption">
+<div class="magnify" style="float:right"><a href="/wiki/Image:Taichi_shanghai_bund_2005.jpg" class="internal" title="Enlarge"><img src="/skins-1.5/common/images/magnify-clip.png" width="15" height="11" alt="Enlarge" /></a></div>
+Yang style in Shanghai</div>
+</div>
+</div>
+<p>T'ai Chi has become very popular in the last twenty years or so, as the <a href="/wiki/Baby_boomers" title="Baby boomers">baby boomers</a> age and T'ai Chi's reputation for ameliorating the effects of aging becomes more well-known. Hospitals, clinics, community and senior centers are all hosting T'ai Chi classes in communities around the world. As a result of this popularity, there has been some divergence between those who say they practice T'ai Chi primarily for fighting, those who practice it for its <a href="/wiki/Aesthetic" title="Aesthetic">aesthetic</a> appeal (as in the shortened, modern, theatrical "Taijiquan" forms of <a href="/wiki/Wushu" title="Wushu">wushu</a>, see below), and those who are more interested in its benefits to physical and mental health. The wushu aspect is primarily for show; the forms taught for those purposes are designed to earn points in competition and are mostly unconcerned with either health maintenance or martial ability. More traditional stylists still see the two aspects of health and martial arts as equally necessary pieces of the puzzle, the <i>yin</i> and <i>yang</i> of T'ai Chi Ch'�an. The T'ai Chi "family" schools therefore still present their teachings in a martial art context even though the majority of their students nowadays profess that they are primarily interested in training for the claimed health benefits.</p>
+
+<p>Along with <a href="/wiki/Yoga" title="Yoga">Yoga</a>, it is one of the fastest growing fitness and health maintenance activities, in terms of numbers of students enrolling in classes. Since there is no universal certification process and most Westerners haven't seen very much T'ai Chi and don't know what to look for, practically anyone can learn or even make up a few moves and call themselves a teacher. This is especially prevalent in the <a href="/wiki/New_Age" title="New Age">New Age</a> community. Relatively few of these teachers even know that there are martial applications to the T'ai Chi forms. Those who do know that it is a martial art usually don't teach martially themselves. If they do teach self-defense, it is often a mixture of motions which the teachers think look like T'ai Chi Ch'�an with some other system. This is especially evident in schools located outside of China. While this phenomenon may have made some external aspects of T'ai Chi available for a wider audience, the traditional T'ai Chi family schools see the martial focus as a fundamental part of their training, both for health <i>and</i> self-defense purposes. They claim that while the students may not need to practice martial applications themselves to derive a benefit from T'ai Chi training, they assert that T'ai Chi teachers at least should know the martial applications to ensure that the movements they teach are done correctly and safely by their students. Also, working on the ability to protect oneself from physical attack (one of the most stressful things that can happen to a person) certainly falls under the category of complete "health maintenance." For these reasons they claim that a school not teaching those aspects somewhere in their syllabus cannot be said to be actually teaching the art itself, and will be much less likely to be able to reproduce the full health benefits that made T'ai Chi's reputation in the first place.</p>
+<div class="editsection" style="float:right;margin-left:5px;">[<a href="/w/index.php?title=Tai_Chi_Chuan&amp;action=edit&amp;section=7" title="Edit section: Modern forms">edit</a>]</div>
+<p><a name="Modern_forms" id="Modern_forms"></a></p>
+<h3>Modern forms</h3>
+
+<div class="thumb tright">
+<div style="width:352px;"><a href="/wiki/Image:Tai_Chi_fans.jpg" class="internal" title="Women practicing non-martial T'ai Chi in Chinatown (New York City, New York, USA)."><img src="http://upload.wikimedia.org/wikipedia/en/thumb/a/ad/Tai_Chi_fans.jpg/350px-Tai_Chi_fans.jpg" alt="Women practicing non-martial T'ai Chi in Chinatown (New York City, New York, USA)." width="350" height="201" longdesc="/wiki/Image:Tai_Chi_fans.jpg" /></a>
+<div class="thumbcaption">
+<div class="magnify" style="float:right"><a href="/wiki/Image:Tai_Chi_fans.jpg" class="internal" title="Enlarge"><img src="/skins-1.5/common/images/magnify-clip.png" width="15" height="11" alt="Enlarge" /></a></div>
+Women practicing non-martial T'ai Chi in <a href="/wiki/Chinatown_%28Manhattan%29" title="Chinatown (Manhattan)">Chinatown</a> (<a href="/wiki/New_York_City" title="New York City">New York City</a>, <a href="/wiki/New_York" title="New York">New York</a>, <a href="/wiki/USA" title="USA">USA</a>).</div>
+</div>
+</div>
+
+<p>In order to standardize T'ai Chi Ch'�an for wushu tournament judging, and because many of the family T'ai Chi Ch'�an teachers had either moved out of China or had been forced to stop teaching after the <a href="/wiki/Chinese_Civil_War" title="Chinese Civil War">Communist regime was established</a> in <a href="/wiki/1949" title="1949">1949</a>, the government sponsored Chinese Sports Committee brought together four of their wushu teachers to truncate the Yang family hand form to <a href="/wiki/24_Form_%28Simplified_Form%29_T%27ai_Chi_Ch%27uan" title="24 Form (Simplified Form) T'ai Chi Ch'uan">24 postures</a> in <a href="/wiki/1956" title="1956">1956</a>. They wanted to somehow retain the look of T'ai Chi Ch'�an but make an easy to remember routine that was less difficult to teach and much less difficult to learn than longer (generally 88 to 108 posture) classical solo hand forms. In <a href="/wiki/1976" title="1976">1976</a>, they developed a slightly longer form also for the purposes of demonstration that still didn't involve the complete memory, balance and coordination requirements of the traditional forms. This was a combination form, the <i>Combined 48 Forms</i> that were created by three wushu coaches headed by Professor Men Hui Feng. The combined forms were created based on simplifying and combining some features of the classical forms from four of the original styles; Ch'en, Yang, Wu, and Sun. Even though shorter modern forms don't have the conditioning benefits of the classical forms, the idea was to take what they felt were distinctive cosmetic features of these styles and to express them in a shorter time for purposes of competition.</p>
+
+<p>As T'ai Chi again became popular on the Mainland, competitive forms were developed to be completed within a 6 minute time limit. In the late <a href="/wiki/1980s" title="1980s">1980s</a>, the Chinese Sports Committee standardized many different competition forms. It had developed sets said to represent the four major styles as well as combined forms. These five sets of forms were created by different teams, and later approved by a committee of wushu coaches in China. All sets of forms thus created were named after their style, e.g., the Ch'en Style National Competition Form is the <i>56 Forms</i>, and so on. The combined forms are <i>The 42 Form</i> or simply the <i>Competition Form</i>, as it is known in China. In the 11th <a href="/wiki/Asian_Games" title="Asian Games">Asian Games</a> of <a href="/wiki/1990" title="1990">1990</a>, wushu was included as an item for competition for the first time with the 42 Form being chosen to represent T'ai Chi. The International Wushu Federation (<a href="/w/index.php?title=IWUF&amp;action=edit" class="new" title="IWUF">IWUF</a>) has applied for wushu to be part of the <a href="/wiki/Olympic_games" title="Olympic games">Olympic games</a>. If accepted, it is likely that T'ai Chi and wushu will be represented as demonstration events in <a href="/wiki/2008" title="2008">2008</a>.</p>
+
+<p>Representatives of the original T'ai Chi families do not teach the forms developed by the Chinese Sports Committee. T'ai Chi Ch'�an has historically been seen by them as a martial art, not a sport, with competitions mostly entered as a hobby or to promote one's school publicly, but with little bearing on measuring actual accomplishment in the art. Their criticisms of modern forms include that the modern, "government" routines have no standardized, internally consistent training requirements. Also, that people studying competition forms rarely train pushing hands or other power generation trainings vital to learning the martial applications of T'ai Chi Ch'�an and thereby lack the <a href="/wiki/Quality_control" title="Quality control">quality control</a> traditional teachers maintain is essential for achieving the full benefits from both the health and the martial aspect of traditional T'ai Chi training.</p>
+<div class="editsection" style="float:right;margin-left:5px;">[<a href="/w/index.php?title=Tai_Chi_Chuan&amp;action=edit&amp;section=8" title="Edit section: Health benefits">edit</a>]</div>
+<p><a name="Health_benefits" id="Health_benefits"></a></p>
+<h2>Health benefits</h2>
+<p>Researchers have found that long-term T'ai Chi practice had favorable effects on the promotion of balance control, flexibility and cardiovascular fitness and reduced the risk of falls in elders. The studies also reported reduced pain, stress and anxiety in healthy subjects. Other studies have indicated improved cardiovascular and respiratory function in healthy subjects as well as those who had undergone coronary artery bypass surgery. Patients also benefited from T'ai Chi who suffered from heart failure, high blood pressure, heart attacks, arthritis and multiple sclerosis.</p>
+<p>T'ai Chi has also been shown to reduce the symptoms of young Attention Deficit and Hyperactivity Disorder (<a href="/wiki/ADHD" title="ADHD">ADHD</a>) sufferers. T'ai Chi's gentle, low impact, movements surprisingly burn more calories than surfing and nearly as many as downhill skiing. T'ai Chi also boosts aspects of the immune system's function very significantly, and has been shown to reduce the incidence of anxiety, depression, and overall mood disturbance. (See research citations listed below.)</p>
+
+<p>A pilot study has found evidence that T'ai Chi and related qigong helps reduce the severity of <a href="/wiki/Diabetes" title="Diabetes">diabetes</a>.<a href="http://www.abc.net.au/pm/content/2005/s1535304.htm" class="external autonumber" title="http://www.abc.net.au/pm/content/2005/s1535304.htm">[1]</a></p>
+<div class="editsection" style="float:right;margin-left:5px;">[<a href="/w/index.php?title=Tai_Chi_Chuan&amp;action=edit&amp;section=9" title="Edit section: Citations to medical research">edit</a>]</div>
+<p><a name="Citations_to_medical_research" id="Citations_to_medical_research"></a></p>
+<h3>Citations to medical research</h3>
+<ul>
+<li>Wolf SL, Sattin RW, Kutner M. Intense T'ai Chi exercise training and fall occurrences in older, transitionally frail adults: a randomized, controlled trial. J Am Geriatr Soc. 2003 Dec; 51(12): 1693-701. <a href="http://www.ncbi.nlm.nih.gov/entrez/query.fcgi?cmd=Retrieve&amp;db=pubmed&amp;dopt=Abstract&amp;list_uids=14687346" class="external" title="http://www.ncbi.nlm.nih.gov/entrez/query.fcgi?cmd=Retrieve&amp;db=pubmed&amp;dopt=Abstract&amp;list_uids=14687346">PMID 14687346</a></li>
+<li>Wang C, Collet JP, Lau J. The effect of Tai Chi on health outcomes in patients with chronic conditions: a <a href="/wiki/Systematic_review" title="Systematic review">systematic review</a>. Arch Intern Med. 2004 Mar 8;164(5):493-501. <a href="http://www.ncbi.nlm.nih.gov/entrez/query.fcgi?cmd=Retrieve&amp;db=pubmed&amp;dopt=Abstract&amp;list_uids=15006825" class="external" title="http://www.ncbi.nlm.nih.gov/entrez/query.fcgi?cmd=Retrieve&amp;db=pubmed&amp;dopt=Abstract&amp;list_uids=15006825">PMID 15006825</a></li>
+
+<li>Search a listing of articles relating to the FICSIT trials and T'ai Chi <a href="http://www.ncbi.nlm.nih.gov/entrez/query.fcgi?cmd=Select+from+History&amp;db=pubmed&amp;query_key=3" class="external autonumber" title="http://www.ncbi.nlm.nih.gov/entrez/query.fcgi?cmd=Select+from+History&amp;db=pubmed&amp;query_key=3">[2]</a></li>
+<li>Hernandez-Reif, M., Field, T.M., &amp; Thimas, E. (2001). Attention deficit hyperactivity disorder: benefits from Tai Chi. Journal of Bodywork &amp; Movement Therapies, 5(2):120-3, 2001 Apr, 5(23 ref), 120-123</li>
+<li>Calorie Burning Chart <a href="http://www.nutristrategy.com/activitylist3.htm" class="external autonumber" title="http://www.nutristrategy.com/activitylist3.htm">[3]</a></li>
+<li>Tai Chi boosts T-Cell counts in immune system <a href="http://www.acupuncturetoday.com/archives2003/nov/11taichi.html" class="external autonumber" title="http://www.acupuncturetoday.com/archives2003/nov/11taichi.html">[4]</a></li>
+<li>Tai Chi, depression, anxiety, and mood disturbance (American Psychological Association) Journal of Psychosomatic Research, 1989 Vol 33 (2) 197-206</li>
+
+<li>A comprehensive listing of Tai Chi medical research links <a href="http://www.worldtaichiday.org/WTCQDHlthBenft.html" class="external autonumber" title="http://www.worldtaichiday.org/WTCQDHlthBenft.html">[5]</a></li>
+<li>References to medical publications <a href="http://www.worldtaichiday.org/HeadlineNews.html" class="external autonumber" title="http://www.worldtaichiday.org/HeadlineNews.html">[6]</a></li>
+<li><a href="http://www.abc.net.au/pm/content/2005/s1535304.htm" class="external text" title="http://www.abc.net.au/pm/content/2005/s1535304.htm">Tai Chi a promising remedy for diabetes</a>, <i>Australian Broadcasting Corporation</i>, 20 December, 2005 - Pilot study of Qigong and tai chi in diabetes sufferers.</li>
+<li>Health Research Articles on "Tai Chi as Health Therapy" for many issues, i.e. ADHD, Cardiac Health &amp; Rehabilitation, Diabetes, High Blood Pressure, Menopause, Bone Loss, Weight Loss, etc.<a href="http://www.worldtaichiday.org/LIBRARYArticles/LIBRARYTaiChiArticlesMenu.html" class="external autonumber" title="http://www.worldtaichiday.org/LIBRARYArticles/LIBRARYTaiChiArticlesMenu.html">[7]</a></li>
+</ul>
+
+<div class="editsection" style="float:right;margin-left:5px;">[<a href="/w/index.php?title=Tai_Chi_Chuan&amp;action=edit&amp;section=10" title="Edit section: See also">edit</a>]</div>
+<p><a name="See_also" id="See_also"></a></p>
+<h2>See also</h2>
+<ul>
+<li><a href="/wiki/Jing_%28TCM%29" title="Jing (TCM)">Jing</a></li>
+<li><a href="/wiki/List_of_Tai_Chi_Chuan_forms" title="List of Tai Chi Chuan forms">List of Tai Chi Chuan forms</a></li>
+<li><a href="/wiki/Nei_Jin" title="Nei Jin">nei chin</a></li>
+<li><a href="/wiki/Silk_reeling" title="Silk reeling">Silk reeling</a></li>
+<li><a href="/wiki/World_Tai_Chi_and_Qigong_Day" title="World Tai Chi and Qigong Day">World Tai Chi and Qigong Day</a></li>
+
+</ul>
+<div class="editsection" style="float:right;margin-left:5px;">[<a href="/w/index.php?title=Tai_Chi_Chuan&amp;action=edit&amp;section=11" title="Edit section: External links">edit</a>]</div>
+<p><a name="External_links" id="External_links"></a></p>
+<h2>External links</h2>
+<ul>
+<li><a href="http://www.chenxiaowang.com/" class="external text" title="http://www.chenxiaowang.com/">A Chen Family Website</a></li>
+<li><a href="http://www.yangfamilytaichi.com/" class="external text" title="http://www.yangfamilytaichi.com/">Yang Family Website</a></li>
+<li><a href="http://www.wustyle.com/" class="external text" title="http://www.wustyle.com/">Wu Chien-ch'�an Family Website</a></li>
+<li><a href="http://www.fushengyuan-taichi.com.au/" class="external text" title="http://www.fushengyuan-taichi.com.au/">Fu Family Website</a></li>
+
+<li><a href="http://www.itcca.org/" class="external text" title="http://www.itcca.org/">Yang family disciple's website (ITCCA)</a></li>
+<li><a href="http://www.dongtaichi.com/" class="external text" title="http://www.dongtaichi.com/">Dong T'ai Chi</a></li>
+<li><a href="http://www.leefamilystyle.com/" class="external text" title="http://www.leefamilystyle.com/">UK website for Li style, popular in Europe</a></li>
+<li><a href="http://www.chen-taiji.com/mambo/" class="external text" title="http://www.chen-taiji.com/mambo/">The World of Taijiquan</a></li>
+<li><a href="http://www.scheele.org/lee/tcclinks.html" class="external text" title="http://www.scheele.org/lee/tcclinks.html">Lee Scheele's Links to T'ai Chi Ch'uan Web Sites</a></li>
+<li><a href="http://news.bbc.co.uk/1/hi/health/3543907.stm" class="external text" title="http://news.bbc.co.uk/1/hi/health/3543907.stm">BBC article</a></li>
+<li><a href="http://www.acupuncturetoday.com/archives2004/jul/07taichi.html" class="external text" title="http://www.acupuncturetoday.com/archives2004/jul/07taichi.html">Tai Chi: Good for the Mind, Good for the Body</a></li>
+<li><a href="http://www.taichiunion.com/" class="external text" title="http://www.taichiunion.com/">Tai Chi Chuan Union for Great Britian: The largest collective of independent Tai Chi Chuan Instructors in the British Isles</a></li>
+</ul>
+
+
+<!-- Saved in parser cache with key enwiki:pcache:idhash:30690-0!0!0!1!!en!2 and timestamp 20060722121412 -->
+<div class="printfooter">
+Retrieved from "<a href="http://en.wikipedia.org/wiki/Tai_Chi_Chuan">http://en.wikipedia.org/wiki/Tai_Chi_Chuan</a>"</div>
+			<div id="catlinks"><p class='catlinks'><a href="/w/index.php?title=Special:Categories&amp;article=Tai_Chi_Chuan" title="Special:Categories">Categories</a>: <span dir='ltr'><a href="/wiki/Category:Chinese_martial_arts" title="Category:Chinese martial arts">Chinese martial arts</a></span> | <span dir='ltr'><a href="/wiki/Category:T%27ai_Chi_Ch%27uan" title="Category:T'ai Chi Ch'uan">T'ai Chi Ch'uan</a></span> | <span dir='ltr'><a href="/wiki/Category:Taoism" title="Category:Taoism">Taoism</a></span> | <span dir='ltr'><a href="/wiki/Category:Meditation" title="Category:Meditation">Meditation</a></span> | <span dir='ltr'><a href="/wiki/Category:Mind-body_interventions" title="Category:Mind-body interventions">Mind-body interventions</a></span> | <span dir='ltr'><a href="/wiki/Category:Traditional_Chinese_medicine" title="Category:Traditional Chinese medicine">Traditional Chinese medicine</a></span></p></div>			<!-- end content -->
+
+			<div class="visualClear"></div>
+		</div>
+	</div>
+		</div>
+		<div id="column-one">
+	<div id="p-cactions" class="portlet">
+		<h5>Views</h5>
+		<ul>
+
+				 <li id="ca-nstab-main" class="selected"><a href="/wiki/Tai_Chi_Chuan">Article</a></li>
+				 <li id="ca-talk"><a href="/wiki/Talk:Tai_Chi_Chuan">Discussion</a></li>
+				 <li id="ca-edit"><a href="/w/index.php?title=Tai_Chi_Chuan&amp;action=edit">Edit this page</a></li>
+				 <li id="ca-history"><a href="/w/index.php?title=Tai_Chi_Chuan&amp;action=history">History</a></li>
+				 <li id="ca-protect"><a href="/w/index.php?title=Tai_Chi_Chuan&amp;action=protect">Protect</a></li>
+				 <li id="ca-delete"><a href="/w/index.php?title=Tai_Chi_Chuan&amp;action=delete">Delete</a></li>
+
+				 <li id="ca-move"><a href="/w/index.php?title=Special:Movepage&amp;target=Tai_Chi_Chuan">Move</a></li>
+				 <li id="ca-unwatch"><a href="/w/index.php?title=Tai_Chi_Chuan&amp;action=unwatch">Unwatch</a></li>
+		</ul>
+	</div>
+	<div class="portlet" id="p-personal">
+		<h5>Personal tools</h5>
+		<div class="pBody">
+
+			<ul>
+				<li id="pt-userpage"><a href="/wiki/User:Edward_Z._Yang">Edward Z. Yang</a></li>
+				<li id="pt-mytalk"><a href="/wiki/User_talk:Edward_Z._Yang">My talk</a></li>
+				<li id="pt-preferences"><a href="/wiki/Special:Preferences">My preferences</a></li>
+				<li id="pt-watchlist"><a href="/wiki/Special:Watchlist">My watchlist</a></li>
+				<li id="pt-mycontris"><a href="/wiki/Special:Contributions/Edward_Z._Yang">My contributions</a></li>
+
+				<li id="pt-logout"><a href="/w/index.php?title=Special:Userlogout&amp;returnto=Tai_Chi_Chuan">Log out</a></li>
+			</ul>
+		</div>
+	</div>
+	<div class="portlet" id="p-logo">
+		<a style="background-image: url(/images/wiki-en.png);" href="/wiki/Main_Page" title="Main Page"></a>
+	</div>
+	<script type="text/javascript"> if (window.isMSIE55) fixalpha(); </script>
+
+		<div class='portlet' id='p-navigation'>
+		<h5>Navigation</h5>
+		<div class='pBody'>
+			<ul>
+				<li id="n-mainpage"><a href="/wiki/Main_Page">Main Page</a></li>
+				<li id="n-portal"><a href="/wiki/Wikipedia:Community_Portal">Community Portal</a></li>
+				<li id="n-Featured-articles"><a href="/wiki/Wikipedia:Featured_articles">Featured articles</a></li>
+
+				<li id="n-currentevents"><a href="/wiki/Portal:Current_events">Current events</a></li>
+				<li id="n-recentchanges"><a href="/wiki/Special:Recentchanges">Recent changes</a></li>
+				<li id="n-randompage"><a href="/wiki/Special:Random">Random article</a></li>
+				<li id="n-help"><a href="/wiki/Help:Contents">Help</a></li>
+				<li id="n-contact"><a href="/wiki/Wikipedia:Contact_us">Contact Wikipedia</a></li>
+				<li id="n-sitesupport"><a href="http://wikimediafoundation.org/wiki/Fundraising#Donation_methods">Donations</a></li>
+
+			</ul>
+		</div>
+	</div>
+		<div id="p-search" class="portlet">
+		<h5><label for="searchInput">Search</label></h5>
+		<div id="searchBody" class="pBody">
+			<form action="/wiki/Special:Search" id="searchform"><div>
+				<input id="searchInput" name="search" type="text" accesskey="f" value="" />
+
+				<input type='submit' name="go" class="searchButton" id="searchGoButton"	value="Go" />&nbsp;
+				<input type='submit' name="fulltext" class="searchButton" value="Search" />
+			</div></form>
+		</div>
+	</div>
+	<div class="portlet" id="p-tb">
+		<h5>Toolbox</h5>
+		<div class="pBody">
+
+			<ul>
+				<li id="t-whatlinkshere"><a href="/w/index.php?title=Special:Whatlinkshere&amp;target=Tai_Chi_Chuan">What links here</a></li>
+				<li id="t-recentchangeslinked"><a href="/w/index.php?title=Special:Recentchangeslinked&amp;target=Tai_Chi_Chuan">Related changes</a></li>
+<li id="t-upload"><a href="/wiki/Special:Upload">Upload file</a></li>
+<li id="t-specialpages"><a href="/wiki/Special:Specialpages">Special pages</a></li>
+				<li id="t-print"><a href="/w/index.php?title=Tai_Chi_Chuan&amp;printable=yes">Printable version</a></li>				<li id="t-permalink"><a href="/w/index.php?title=Tai_Chi_Chuan&amp;oldid=65197836">Permanent link</a></li><li id="t-cite"><a href="/w/index.php?title=Special:Cite&amp;page=Tai_Chi_Chuan&amp;id=65197836">Cite this article</a></li>			</ul>
+
+		</div>
+	</div>
+	<div id="p-lang" class="portlet">
+		<h5>In other languages</h5>
+		<div class="pBody">
+			<ul>
+				<li class="interwiki-br"><a href="http://br.wikipedia.org/wiki/Taichichuan">Brezhoneg</a></li>
+				<li class="interwiki-ca"><a href="http://ca.wikipedia.org/wiki/Tai_txi_txuan">Catal�</a></li>
+
+				<li class="interwiki-cs"><a href="http://cs.wikipedia.org/wiki/Tchaj-%C5%A5i">Cesky</a></li>
+				<li class="interwiki-da"><a href="http://da.wikipedia.org/wiki/Tai_Chi">Dansk</a></li>
+				<li class="interwiki-de"><a href="http://de.wikipedia.org/wiki/Taijiquan">Deutsch</a></li>
+				<li class="interwiki-et"><a href="http://et.wikipedia.org/wiki/Taijiquan">Eesti</a></li>
+				<li class="interwiki-el"><a href="http://el.wikipedia.org/wiki/%CE%A4%CE%AC%CE%B9_%CE%A4%CE%B6%CE%AF_%CE%A3%CE%BF%CF%85%CE%AC%CE%BD">????????</a></li>
+				<li class="interwiki-es"><a href="http://es.wikipedia.org/wiki/Tai_Chi_Chuan">Espa�ol</a></li>
+
+				<li class="interwiki-eo"><a href="http://eo.wikipedia.org/wiki/Taj%C4%9Di%C4%89uano">Esperanto</a></li>
+				<li class="interwiki-fr"><a href="http://fr.wikipedia.org/wiki/Tai-chi-chuan">Fran�ais</a></li>
+				<li class="interwiki-it"><a href="http://it.wikipedia.org/wiki/Taijiquan">Italiano</a></li>
+				<li class="interwiki-he"><a href="http://he.wikipedia.org/wiki/%D7%98%D7%90%D7%99_%D7%A6%27%D7%99">?????</a></li>
+				<li class="interwiki-hu"><a href="http://hu.wikipedia.org/wiki/Taijiquan">Magyar</a></li>
+				<li class="interwiki-nl"><a href="http://nl.wikipedia.org/wiki/Tai_Chi">Nederlands</a></li>
+
+				<li class="interwiki-ja"><a href="http://ja.wikipedia.org/wiki/%E5%A4%AA%E6%A5%B5%E6%8B%B3">???</a></li>
+				<li class="interwiki-pl"><a href="http://pl.wikipedia.org/wiki/Taijiquan">Polski</a></li>
+				<li class="interwiki-pt"><a href="http://pt.wikipedia.org/wiki/Tai_Chi_Chuan">Portugu�s</a></li>
+				<li class="interwiki-ro"><a href="http://ro.wikipedia.org/wiki/Taijiquan">Rom�na</a></li>
+				<li class="interwiki-ru"><a href="http://ru.wikipedia.org/wiki/%D0%A2%D0%B0%D0%B9%D1%86%D0%B7%D0%B8%D1%86%D1%8E%D0%B0%D0%BD%D1%8C">???????</a></li>
+				<li class="interwiki-fi"><a href="http://fi.wikipedia.org/wiki/Taijiquan">Suomi</a></li>
+
+				<li class="interwiki-sv"><a href="http://sv.wikipedia.org/wiki/Taijiquan">Svenska</a></li>
+				<li class="interwiki-th"><a href="http://th.wikipedia.org/wiki/%E0%B9%84%E0%B8%97%E0%B9%88%E0%B9%80%E0%B8%81%E0%B9%8A%E0%B8%81">???</a></li>
+				<li class="interwiki-tr"><a href="http://tr.wikipedia.org/wiki/Tai-Chi_Chuan">T�rk�e</a></li>
+				<li class="interwiki-zh"><a href="http://zh.wikipedia.org/wiki/%E5%A4%AA%E6%9E%81%E6%8B%B3">??</a></li>
+			</ul>
+		</div>
+	</div>
+
+		</div><!-- end of the left (by default at least) column -->
+			<div class="visualClear"></div>
+			<div id="footer">
+				<div id="f-poweredbyico"><a href="http://www.mediawiki.org/"><img src="/skins-1.5/common/images/poweredby_mediawiki_88x31.png" alt="MediaWiki" /></a></div>
+				<div id="f-copyrightico"><a href="http://wikimediafoundation.org/"><img src="/images/wikimedia-button.png" border="0" alt="Wikimedia Foundation"/></a></div>
+			<ul id="f-list">
+				<li id="lastmod"> This page was last modified 03:15, July 22, 2006.</li>
+				<li id="copyright">All text is available under the terms of the <a class='internal' href="/wiki/Wikipedia:Text_of_the_GNU_Free_Documentation_License" title="Wikipedia:Text of the GNU Free Documentation License">GNU Free Documentation License</a>. (See <b><a class='internal' href="/wiki/Wikipedia:Copyrights" title="Wikipedia:Copyrights">Copyrights</a></b> for details.) <br /> Wikipedia&reg; is a registered trademark of the Wikimedia Foundation, Inc.<br /></li>
+
+				<li id="privacy"><a href="http://wikimediafoundation.org/wiki/Privacy_policy" title="wikimedia:Privacy policy">Privacy policy</a></li>
+				<li id="about"><a href="/wiki/Wikipedia:About" title="Wikipedia:About">About Wikipedia</a></li>
+				<li id="disclaimer"><a href="/wiki/Wikipedia:General_disclaimer" title="Wikipedia:General disclaimer">Disclaimers</a></li>
+			</ul>
+		</div>
+	<script type="text/javascript"> if (window.runOnloadHook) runOnloadHook();</script>
+</div>
+
+<!-- Served by srv25 in 0.089 secs. -->
+</body></html>
+
+<!-- vim: et sw=4 sts=4
+-->

--- libraries/htmlpurifier/benchmarks/samples/Lexer/DISCLAIMER.txt ---
@@ -0,0 +1,7 @@
+Disclaimer:
+
+The HTML used in these samples are taken from random websites.  I claim
+no copyright over these and assert that I may use them like this under
+fair use.
+
+    vim: et sw=4 sts=4

--- libraries/htmlpurifier/composer.json ---
@@ -0,0 +1,28 @@
+{
+    "name": "ezyang/htmlpurifier",
+    "description": "Standards compliant HTML filter written in PHP",
+    "type": "library",
+    "keywords": ["html"],
+    "homepage": "http://htmlpurifier.org/",
+    "license": "LGPL-2.1-or-later",
+    "authors": [
+        {
+            "name": "Edward Z. Yang",
+            "email": "admin@htmlpurifier.org",
+            "homepage": "http://ezyang.com"
+        }
+    ],
+    "require": {
+        "php": ">=5.2"
+    },
+    "require-dev": {
+        "simpletest/simpletest": "dev-master#72de02a7b80c6bb8864ef9bf66d41d2f58f826bd"
+    },
+    "autoload": {
+        "psr-0": { "HTMLPurifier": "library/" },
+        "files": ["library/HTMLPurifier.composer.php"],
+        "exclude-from-classmap": [
+            "/library/HTMLPurifier/Language/"
+        ]
+    }
+}

--- libraries/htmlpurifier/configdoc/generate.php ---
@@ -0,0 +1,64 @@
+<?php
+
+/**
+ * Generates XML and HTML documents describing configuration.
+ * @note PHP 5.2+ only!
+ */
+
+/*
+TODO:
+- make XML format richer
+- extend XSLT transformation (see the corresponding XSLT file)
+- allow generation of packaged docs that can be easily moved
+- multipage documentation
+- determine how to multilingualize
+- add blurbs to ToC
+*/
+
+if (version_compare(PHP_VERSION, '5.2', '<')) exit('PHP 5.2+ required.');
+error_reporting(E_ALL | E_STRICT);
+
+// load dual-libraries
+require_once dirname(__FILE__) . '/../extras/HTMLPurifierExtras.auto.php';
+require_once dirname(__FILE__) . '/../library/HTMLPurifier.auto.php';
+
+// setup HTML Purifier singleton
+HTMLPurifier::getInstance(array(
+    'AutoFormat.PurifierLinkify' => true
+));
+
+$builder = new HTMLPurifier_ConfigSchema_InterchangeBuilder();
+$interchange = new HTMLPurifier_ConfigSchema_Interchange();
+$builder->buildDir($interchange);
+$loader = dirname(__FILE__) . '/../config-schema.php';
+if (file_exists($loader)) include $loader;
+$interchange->validate();
+
+$style = 'plain'; // use $_GET in the future, careful to validate!
+$configdoc_xml = dirname(__FILE__) . '/configdoc.xml';
+
+$xml_builder = new HTMLPurifier_ConfigSchema_Builder_Xml();
+$xml_builder->openURI($configdoc_xml);
+$xml_builder->build($interchange);
+unset($xml_builder); // free handle
+
+$xslt = new ConfigDoc_HTMLXSLTProcessor();
+$xslt->importStylesheet(dirname(__FILE__) . "/styles/$style.xsl");
+$output = $xslt->transformToHTML($configdoc_xml);
+
+if (!$output) {
+    echo "Error in generating files\n";
+    exit(1);
+}
+
+// write out
+file_put_contents(dirname(__FILE__) . "/$style.html", $output);
+
+if (php_sapi_name() != 'cli') {
+    // output (instant feedback if it's a browser)
+    echo $output;
+} else {
+    echo "Files generated successfully.\n";
+}
+
+// vim: et sw=4 sts=4

--- libraries/htmlpurifier/configdoc/styles/plain.css ---
@@ -0,0 +1,44 @@
+
+body {margin:0;padding:0;}
+#content {
+  margin:1em auto;
+  max-width: 47em;
+  width: expression(document.body.clientWidth >
+    85 * parseInt(document.body.currentStyle.fontSize) ?
+    "54em": "auto");
+}
+
+table {border-collapse:collapse;}
+table td, table th {padding:0.2em;}
+
+table.constraints {margin:0 0 1em;}
+table.constraints th {
+  text-align:right;padding-left:0.4em;padding-right:0.4em;background:#EEE;
+  width:8em;vertical-align:top;}
+table.constraints td {padding-right:0.4em; padding-left: 1em;}
+table.constraints td ul {padding:0; margin:0; list-style:none;}
+table.constraints td pre {margin:0;}
+
+#tocContainer {position:relative;}
+#toc {list-style-type:none; font-weight:bold; font-size:1em; margin-bottom:1em;}
+#toc li {position:relative; line-height: 1.2em;}
+#toc .col-2 {margin-left:50%;}
+#toc .col-l {float:left;}
+#toc ul {list-style-type:disc; font-weight:normal; padding-bottom:1.2em;}
+
+.description p {margin-top:0;margin-bottom:1em;}
+
+#library, h1 {text-align:center; font-family:Garamond, serif;
+  font-variant:small-caps;}
+#library {font-size:1em;}
+h1 {margin-top:0;}
+h2 {border-bottom:1px solid #CCC; font-family:sans-serif; font-weight:normal;
+    font-size:1.3em; clear:both;}
+h3 {font-family:sans-serif; font-size:1.1em; font-weight:bold; }
+h4 {font-family:sans-serif; font-size:0.9em; font-weight:bold; }
+
+.deprecated {color: #CCC;}
+.deprecated table.constraints th {background:#FFF;}
+.deprecated-notice {color: #000; text-align:center; margin-bottom: 1em;}
+
+/* vim: et sw=4 sts=4 */

--- libraries/htmlpurifier/configdoc/styles/plain.xsl ---
@@ -0,0 +1,253 @@
+<?xml version="1.0" encoding="UTF-8"?>
+<xsl:stylesheet
+    version     = "1.0"
+    xmlns       = "http://www.w3.org/1999/xhtml"
+    xmlns:xsl   = "http://www.w3.org/1999/XSL/Transform"
+>
+    <xsl:output
+        method      = "xml"
+        encoding    = "UTF-8"
+        doctype-public = "-//W3C//DTD XHTML 1.0 Transitional//EN"
+        doctype-system = "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"
+        indent = "no"
+        media-type = "text/html"
+    />
+    <xsl:param name="css" select="'styles/plain.css'"/>
+    <xsl:param name="title" select="'Configuration Documentation'"/>
+
+    <xsl:variable name="typeLookup"  select="document('../types.xml')/types" />
+    <xsl:variable name="usageLookup" select="document('../usage.xml')/usage" />
+
+    <!-- Twiddle this variable to get the columns as even as possible -->
+    <xsl:variable name="maxNumberAdjust" select="2" />
+
+    <xsl:template match="/">
+        <html lang="en" xml:lang="en">
+            <head>
+                <title><xsl:value-of select="$title" /> - <xsl:value-of select="/configdoc/title" /></title>
+                <meta http-equiv="Content-Type" content="text/html;charset=UTF-8" />
+                <link rel="stylesheet" type="text/css" href="{$css}" />
+            </head>
+            <body>
+                <div id="content">
+                    <div id="library"><xsl:value-of select="/configdoc/title" /></div>
+                    <h1><xsl:value-of select="$title" /></h1>
+                    <div id="tocContainer">
+                        <h2>Table of Contents</h2>
+                        <ul id="toc">
+                            <xsl:apply-templates mode="toc">
+                                <xsl:with-param name="overflowNumber" select="round(count(/configdoc/namespace) div 2) + $maxNumberAdjust" />
+                            </xsl:apply-templates>
+                        </ul>
+                    </div>
+                    <div id="typesContainer">
+                        <h2>Types</h2>
+                        <xsl:apply-templates select="$typeLookup" mode="types" />
+                    </div>
+                    <xsl:apply-templates />
+                </div>
+            </body>
+        </html>
+    </xsl:template>
+
+    <xsl:template match="type" mode="types">
+        <div class="type-block">
+            <xsl:attribute name="id">type-<xsl:value-of select="@id" /></xsl:attribute>
+            <h3><code><xsl:value-of select="@id" /></code>: <xsl:value-of select="@name" /></h3>
+            <div class="type-description">
+                <xsl:copy-of xmlns:xhtml="http://www.w3.org/1999/xhtml" select="xhtml:div/node()" />
+            </div>
+        </div>
+    </xsl:template>
+
+    <xsl:template match="title" mode="toc" />
+    <xsl:template match="namespace" mode="toc">
+        <xsl:param name="overflowNumber" />
+        <xsl:variable name="number"><xsl:number level="single" /></xsl:variable>
+        <xsl:variable name="directiveNumber"><xsl:number level="any" count="directive" /></xsl:variable>
+        <xsl:if test="count(directive)&gt;0">
+            <li>
+                <!-- BEGIN multicolumn code -->
+                <xsl:if test="$number &gt;= $overflowNumber">
+                    <xsl:attribute name="class">col-2</xsl:attribute>
+                </xsl:if>
+                <xsl:if test="$number = $overflowNumber">
+                    <xsl:attribute name="style">margin-top:-<xsl:value-of select="($number * 2 + $directiveNumber - 3) * 1.2" />em</xsl:attribute>
+                </xsl:if>
+                <!-- END multicolumn code -->
+                <a href="#{@id}"><xsl:value-of select="name" /></a>
+                <ul>
+                    <xsl:apply-templates select="directive" mode="toc">
+                        <xsl:with-param name="overflowNumber" select="$overflowNumber" />
+                    </xsl:apply-templates>
+                </ul>
+                <xsl:if test="$number + 1 = $overflowNumber">
+                    <div class="col-l" />
+                </xsl:if>
+            </li>
+        </xsl:if>
+    </xsl:template>
+    <xsl:template match="directive" mode="toc">
+        <xsl:variable name="number">
+            <xsl:number level="any" count="directive|namespace" />
+        </xsl:variable>
+        <xsl:if test="not(deprecated)">
+            <li>
+                <a href="#{@id}"><xsl:value-of select="name" /></a>
+            </li>
+        </xsl:if>
+    </xsl:template>
+
+    <xsl:template match="title" />
+
+    <xsl:template match="namespace">
+        <div class="namespace">
+            <xsl:apply-templates />
+            <xsl:if test="count(directive)=0">
+                <p>No configuration directives defined for this namespace.</p>
+            </xsl:if>
+        </div>
+    </xsl:template>
+    <xsl:template match="namespace/name">
+        <h2 id="{../@id}"><xsl:value-of select="." /></h2>
+    </xsl:template>
+    <xsl:template match="namespace/description">
+        <div class="description">
+            <xsl:copy-of xmlns:xhtml="http://www.w3.org/1999/xhtml" select="xhtml:div/node()" />
+        </div>
+    </xsl:template>
+
+    <xsl:template match="directive">
+        <div>
+            <xsl:attribute name="class"><!--
+                -->directive<!--
+                --><xsl:if test="deprecated"> deprecated</xsl:if><!--
+            --></xsl:attribute>
+            <xsl:apply-templates>
+                <xsl:with-param name="id" select="@id" />
+            </xsl:apply-templates>
+        </div>
+    </xsl:template>
+    <xsl:template match="directive/name">
+        <xsl:param name="id" />
+        <xsl:apply-templates select="../aliases/alias" mode="anchor" />
+        <h3 id="{$id}"><xsl:value-of select="$id" /></h3>
+    </xsl:template>
+    <xsl:template match="alias" mode="anchor">
+        <a id="{.}"></a>
+    </xsl:template>
+
+    <!-- Do not pass through -->
+    <xsl:template match="alias"></xsl:template>
+
+    <xsl:template match="directive/constraints">
+        <xsl:param name="id" />
+        <table class="constraints">
+            <xsl:apply-templates />
+            <xsl:if test="../aliases/alias">
+                <xsl:apply-templates select="../aliases" mode="constraints" />
+            </xsl:if>
+            <xsl:apply-templates select="$usageLookup/directive[@id=$id]" />
+        </table>
+    </xsl:template>
+    <xsl:template match="directive/aliases" mode="constraints">
+        <tr>
+            <th>Aliases</th>
+            <td>
+                <xsl:for-each select="alias">
+                    <xsl:if test="position()&gt;1">, </xsl:if>
+                    <xsl:value-of select="." />
+                </xsl:for-each>
+            </td>
+        </tr>
+    </xsl:template>
+    <xsl:template match="directive/description">
+        <div class="description">
+            <xsl:copy-of xmlns:xhtml="http://www.w3.org/1999/xhtml" select="xhtml:div/node()" />
+        </div>
+    </xsl:template>
+    <xsl:template match="directive/deprecated">
+        <div class="deprecated-notice">
+            <strong>Warning:</strong>
+            This directive was deprecated in version <xsl:value-of select="version" />.
+            <a href="#{use}">%<xsl:value-of select="use" /></a> should be used instead.
+        </div>
+    </xsl:template>
+    <xsl:template match="usage/directive">
+        <tr>
+            <th>Used in</th>
+            <td>
+                <ul>
+                    <xsl:apply-templates />
+                </ul>
+            </td>
+        </tr>
+    </xsl:template>
+    <xsl:template match="usage/directive/file">
+        <li>
+            <em><xsl:value-of select="@name" /></em> on line<xsl:if test="count(line)&gt;1">s</xsl:if>
+            <xsl:text> </xsl:text>
+            <xsl:for-each select="line">
+                <xsl:if test="position()&gt;1">, </xsl:if>
+                <xsl:value-of select="." />
+            </xsl:for-each>
+        </li>
+    </xsl:template>
+
+    <xsl:template match="constraints/version">
+        <tr>
+            <th>Version added</th>
+            <td><xsl:value-of select="." /></td>
+        </tr>
+    </xsl:template>
+    <xsl:template match="constraints/type">
+        <tr>
+            <th>Type</th>
+            <td>
+                <xsl:variable name="type" select="text()" />
+                <xsl:attribute name="class">type type-<xsl:value-of select="$type" /></xsl:attribute>
+                <a>
+                    <xsl:attribute name="href">#type-<xsl:value-of select="$type" /></xsl:attribute>
+                    <xsl:value-of select="$typeLookup/type[@id=$type]/@name" />
+                    <xsl:if test="@allow-null='yes'">
+                        (or null)
+                    </xsl:if>
+                </a>
+            </td>
+        </tr>
+    </xsl:template>
+    <xsl:template match="constraints/allowed">
+        <tr>
+            <th>Allowed values</th>
+            <td>
+                <xsl:for-each select="value"><!--
+                 --><xsl:if test="position()&gt;1">, </xsl:if>
+                    &quot;<xsl:value-of select="." />&quot;<!--
+             --></xsl:for-each>
+            </td>
+        </tr>
+    </xsl:template>
+    <xsl:template match="constraints/default">
+        <tr>
+            <th>Default</th>
+            <td><pre><xsl:value-of select="." xml:space="preserve" /></pre></td>
+        </tr>
+    </xsl:template>
+    <xsl:template match="constraints/external">
+        <tr>
+            <th>External deps</th>
+            <td>
+                <ul>
+                    <xsl:apply-templates />
+                </ul>
+            </td>
+        </tr>
+    </xsl:template>
+    <xsl:template match="constraints/external/project">
+        <li><xsl:value-of select="." /></li>
+    </xsl:template>
+
+</xsl:stylesheet>
+
+<!-- vim: et sw=4 sts=4
+-->

--- libraries/htmlpurifier/configdoc/types.xml ---
@@ -0,0 +1,69 @@
+<?xml version="1.0" encoding="UTF-8"?>
+<types>
+  <type id="string" name="String"><div xmlns="http://www.w3.org/1999/xhtml">
+    A <a
+    href="http://docs.php.net/manual/en/language.types.string.php">sequence
+    of characters</a>.
+  </div></type>
+  <type id="istring" name="Case-insensitive string"><div xmlns="http://www.w3.org/1999/xhtml">
+    A series of case-insensitive characters.  Internally, upper-case
+    ASCII characters will be converted to lower-case.
+  </div></type>
+  <type id="text" name="Text"><div xmlns="http://www.w3.org/1999/xhtml">
+    A series of characters that may contain newlines.  Text tends to
+    indicate human-oriented text, as opposed to a machine format.
+  </div></type>
+  <type id="itext" name="Case-insensitive text"><div xmlns="http://www.w3.org/1999/xhtml">
+    A series of case-insensitive characters that may contain newlines.
+  </div></type>
+  <type id="int" name="Integer"><div xmlns="http://www.w3.org/1999/xhtml">
+    An <a
+      href="http://docs.php.net/manual/en/language.types.integer.php">
+      integer</a>.  You are alternatively permitted to pass a string of
+    digits instead, which will be cast to an integer using
+    <code>(int)</code>.
+  </div></type>
+  <type id="float" name="Float"><div xmlns="http://www.w3.org/1999/xhtml">
+    A <a href="http://docs.php.net/manual/en/language.types.float.php">
+      floating point number</a>.  You are alternatively permitted to
+    pass a numeric string (as defined by <code>is_numeric()</code>),
+    which will be cast to a float using <code>(float)</code>.
+  </div></type>
+  <type id="bool" name="Boolean"><div xmlns="http://www.w3.org/1999/xhtml">
+    A <a
+      href="http://docs.php.net/manual/en/language.types.boolean.php">boolean</a>.
+    You are alternatively permitted to pass an integer <code>0</code> or
+    <code>1</code> (other integers are not permitted) or a string
+    <code>"on"</code>, <code>"true"</code> or <code>"1"</code> for
+    <code>true</code>, and <code>"off"</code>, <code>"false"</code> or
+    <code>"0"</code> for <code>false</code>.
+  </div></type>
+  <type id="lookup" name="Lookup array"><div xmlns="http://www.w3.org/1999/xhtml">
+    An array whose values are <code>true</code>, e.g. <code>array('key'
+      => true, 'key2' => true)</code>.  You are alternatively permitted
+    to pass an array list of the keys <code>array('key', 'key2')</code>
+    or a comma-separated string of keys <code>"key, key2"</code>.  If
+    you pass an array list of values, ensure that your values are
+    strictly numerically indexed: <code>array('key1', 2 =>
+      'key2')</code> will not do what you expect and emits a warning.
+  </div></type>
+  <type id="list" name="Array list"><div xmlns="http://www.w3.org/1999/xhtml">
+    An array which has consecutive integer indexes, e.g.
+    <code>array('val1', 'val2')</code>.  You are alternatively permitted
+    to pass a comma-separated string of keys <code>"val1, val2"</code>.
+    If your array is not in this form, <code>array_values</code> is run
+    on the array and a warning is emitted.
+  </div></type>
+  <type id="hash" name="Associative array"><div xmlns="http://www.w3.org/1999/xhtml">
+    An array which is a mapping of keys to values, e.g.
+    <code>array('key1' => 'val1', 'key2' => 'val2')</code>.  You are
+    alternatively permitted to pass a comma-separated string of
+    key-colon-value strings, e.g. <code>"key1: val1, key2: val2"</code>.
+  </div></type>
+  <type id="mixed" name="Mixed"><div xmlns="http://www.w3.org/1999/xhtml">
+    An arbitrary PHP value of any type.
+  </div></type>
+</types>
+
+<!-- vim: et sw=4 sts=4
+-->

--- libraries/htmlpurifier/configdoc/usage.xml ---
@@ -0,0 +1,600 @@
+<?xml version="1.0" encoding="UTF-8"?>
+<usage>
+ <directive id="Core.CollectErrors">
+  <file name="HTMLPurifier.php">
+   <line>162</line>
+  </file>
+  <file name="HTMLPurifier/Lexer.php">
+   <line>85</line>
+   <line>326</line>
+  </file>
+  <file name="HTMLPurifier/Lexer/DirectLex.php">
+   <line>67</line>
+   <line>87</line>
+   <line>385</line>
+  </file>
+  <file name="HTMLPurifier/Strategy/RemoveForeignElements.php">
+   <line>57</line>
+  </file>
+ </directive>
+ <directive id="CSS.MaxImgLength">
+  <file name="HTMLPurifier/CSSDefinition.php">
+   <line>240</line>
+  </file>
+ </directive>
+ <directive id="CSS.Proprietary">
+  <file name="HTMLPurifier/CSSDefinition.php">
+   <line>365</line>
+  </file>
+ </directive>
+ <directive id="CSS.AllowTricky">
+  <file name="HTMLPurifier/CSSDefinition.php">
+   <line>369</line>
+  </file>
+ </directive>
+ <directive id="CSS.Trusted">
+  <file name="HTMLPurifier/CSSDefinition.php">
+   <line>373</line>
+  </file>
+ </directive>
+ <directive id="CSS.AllowImportant">
+  <file name="HTMLPurifier/CSSDefinition.php">
+   <line>377</line>
+  </file>
+ </directive>
+ <directive id="CSS.AllowedProperties">
+  <file name="HTMLPurifier/CSSDefinition.php">
+   <line>506</line>
+  </file>
+ </directive>
+ <directive id="CSS.ForbiddenProperties">
+  <file name="HTMLPurifier/CSSDefinition.php">
+   <line>522</line>
+  </file>
+ </directive>
+ <directive id="Cache.DefinitionImpl">
+  <file name="HTMLPurifier/DefinitionCacheFactory.php">
+   <line>66</line>
+  </file>
+ </directive>
+ <directive id="HTML.Doctype">
+  <file name="HTMLPurifier/DoctypeRegistry.php">
+   <line>119</line>
+  </file>
+ </directive>
+ <directive id="HTML.CustomDoctype">
+  <file name="HTMLPurifier/DoctypeRegistry.php">
+   <line>123</line>
+  </file>
+ </directive>
+ <directive id="HTML.XHTML">
+  <file name="HTMLPurifier/DoctypeRegistry.php">
+   <line>128</line>
+  </file>
+ </directive>
+ <directive id="HTML.Strict">
+  <file name="HTMLPurifier/DoctypeRegistry.php">
+   <line>133</line>
+  </file>
+ </directive>
+ <directive id="Core.Encoding">
+  <file name="HTMLPurifier/Encoder.php">
+   <line>380</line>
+   <line>428</line>
+  </file>
+ </directive>
+ <directive id="Test.ForceNoIconv">
+  <file name="HTMLPurifier/Encoder.php">
+   <line>388</line>
+   <line>439</line>
+  </file>
+ </directive>
+ <directive id="Core.EscapeNonASCIICharacters">
+  <file name="HTMLPurifier/Encoder.php">
+   <line>429</line>
+  </file>
+ </directive>
+ <directive id="Output.CommentScriptContents">
+  <file name="HTMLPurifier/Generator.php">
+   <line>70</line>
+  </file>
+ </directive>
+ <directive id="Output.FixInnerHTML">
+  <file name="HTMLPurifier/Generator.php">
+   <line>71</line>
+  </file>
+ </directive>
+ <directive id="Output.SortAttr">
+  <file name="HTMLPurifier/Generator.php">
+   <line>72</line>
+  </file>
+ </directive>
+ <directive id="Output.FlashCompat">
+  <file name="HTMLPurifier/Generator.php">
+   <line>73</line>
+  </file>
+ </directive>
+ <directive id="Output.TidyFormat">
+  <file name="HTMLPurifier/Generator.php">
+   <line>104</line>
+  </file>
+ </directive>
+ <directive id="Core.NormalizeNewlines">
+  <file name="HTMLPurifier/Generator.php">
+   <line>122</line>
+  </file>
+  <file name="HTMLPurifier/Lexer.php">
+   <line>308</line>
+  </file>
+ </directive>
+ <directive id="Output.Newline">
+  <file name="HTMLPurifier/Generator.php">
+   <line>123</line>
+  </file>
+ </directive>
+ <directive id="HTML.BlockWrapper">
+  <file name="HTMLPurifier/HTMLDefinition.php">
+   <line>263</line>
+  </file>
+ </directive>
+ <directive id="HTML.Parent">
+  <file name="HTMLPurifier/HTMLDefinition.php">
+   <line>273</line>
+  </file>
+ </directive>
+ <directive id="HTML.AllowedElements">
+  <file name="HTMLPurifier/HTMLDefinition.php">
+   <line>291</line>
+  </file>
+ </directive>
+ <directive id="HTML.AllowedAttributes">
+  <file name="HTMLPurifier/HTMLDefinition.php">
+   <line>292</line>
+  </file>
+ </directive>
+ <directive id="HTML.Allowed">
+  <file name="HTMLPurifier/HTMLDefinition.php">
+   <line>295</line>
+  </file>
+ </directive>
+ <directive id="HTML.ForbiddenElements">
+  <file name="HTMLPurifier/HTMLDefinition.php">
+   <line>399</line>
+  </file>
+ </directive>
+ <directive id="HTML.ForbiddenAttributes">
+  <file name="HTMLPurifier/HTMLDefinition.php">
+   <line>400</line>
+  </file>
+ </directive>
+ <directive id="HTML.Trusted">
+  <file name="HTMLPurifier/HTMLModuleManager.php">
+   <line>234</line>
+  </file>
+  <file name="HTMLPurifier/Lexer.php">
+   <line>313</line>
+   <line>353</line>
+  </file>
+  <file name="HTMLPurifier/HTMLModule/Image.php">
+   <line>37</line>
+  </file>
+  <file name="HTMLPurifier/Lexer/DirectLex.php">
+   <line>47</line>
+  </file>
+  <file name="HTMLPurifier/Strategy/RemoveForeignElements.php">
+   <line>30</line>
+  </file>
+ </directive>
+ <directive id="HTML.AllowedModules">
+  <file name="HTMLPurifier/HTMLModuleManager.php">
+   <line>241</line>
+  </file>
+ </directive>
+ <directive id="HTML.CoreModules">
+  <file name="HTMLPurifier/HTMLModuleManager.php">
+   <line>242</line>
+  </file>
+ </directive>
+ <directive id="HTML.Proprietary">
+  <file name="HTMLPurifier/HTMLModuleManager.php">
+   <line>256</line>
+  </file>
+ </directive>
+ <directive id="HTML.SafeObject">
+  <file name="HTMLPurifier/HTMLModuleManager.php">
+   <line>259</line>
+  </file>
+ </directive>
+ <directive id="HTML.SafeEmbed">
+  <file name="HTMLPurifier/HTMLModuleManager.php">
+   <line>262</line>
+  </file>
+ </directive>
+ <directive id="HTML.SafeScripting">
+  <file name="HTMLPurifier/HTMLModuleManager.php">
+   <line>265</line>
+  </file>
+  <file name="HTMLPurifier/HTMLModule/SafeScripting.php">
+   <line>22</line>
+  </file>
+ </directive>
+ <directive id="HTML.Nofollow">
+  <file name="HTMLPurifier/HTMLModuleManager.php">
+   <line>268</line>
+  </file>
+ </directive>
+ <directive id="HTML.TargetBlank">
+  <file name="HTMLPurifier/HTMLModuleManager.php">
+   <line>271</line>
+  </file>
+ </directive>
+ <directive id="HTML.TargetNoreferrer">
+  <file name="HTMLPurifier/HTMLModuleManager.php">
+   <line>276</line>
+  </file>
+ </directive>
+ <directive id="HTML.TargetNoopener">
+  <file name="HTMLPurifier/HTMLModuleManager.php">
+   <line>279</line>
+  </file>
+ </directive>
+ <directive id="Attr.IDBlacklist">
+  <file name="HTMLPurifier/IDAccumulator.php">
+   <line>27</line>
+  </file>
+ </directive>
+ <directive id="Core.Language">
+  <file name="HTMLPurifier/LanguageFactory.php">
+   <line>93</line>
+  </file>
+ </directive>
+ <directive id="Core.LexerImpl">
+  <file name="HTMLPurifier/Lexer.php">
+   <line>80</line>
+  </file>
+ </directive>
+ <directive id="Core.MaintainLineNumbers">
+  <file name="HTMLPurifier/Lexer.php">
+   <line>84</line>
+  </file>
+  <file name="HTMLPurifier/Lexer/DirectLex.php">
+   <line>62</line>
+  </file>
+ </directive>
+ <directive id="Core.LegacyEntityDecoder">
+  <file name="HTMLPurifier/Lexer.php">
+   <line>215</line>
+   <line>337</line>
+  </file>
+ </directive>
+ <directive id="Core.ConvertDocumentToFragment">
+  <file name="HTMLPurifier/Lexer.php">
+   <line>324</line>
+  </file>
+ </directive>
+ <directive id="Core.RemoveProcessingInstructions">
+  <file name="HTMLPurifier/Lexer.php">
+   <line>347</line>
+  </file>
+ </directive>
+ <directive id="Core.HiddenElements">
+  <file name="HTMLPurifier/Lexer.php">
+   <line>351</line>
+  </file>
+  <file name="HTMLPurifier/Strategy/RemoveForeignElements.php">
+   <line>36</line>
+  </file>
+ </directive>
+ <directive id="Core.AggressivelyRemoveScript">
+  <file name="HTMLPurifier/Lexer.php">
+   <line>352</line>
+  </file>
+ </directive>
+ <directive id="Core.RemoveScriptContents">
+  <file name="HTMLPurifier/Lexer.php">
+   <line>353</line>
+  </file>
+  <file name="HTMLPurifier/Strategy/RemoveForeignElements.php">
+   <line>35</line>
+  </file>
+ </directive>
+ <directive id="URI.">
+  <file name="HTMLPurifier/URIDefinition.php">
+   <line>65</line>
+  </file>
+  <file name="HTMLPurifier/URIFilter/Munge.php">
+   <line>46</line>
+  </file>
+ </directive>
+ <directive id="URI.Host">
+  <file name="HTMLPurifier/URIDefinition.php">
+   <line>76</line>
+  </file>
+  <file name="HTMLPurifier/URIScheme.php">
+   <line>89</line>
+  </file>
+ </directive>
+ <directive id="URI.Base">
+  <file name="HTMLPurifier/URIDefinition.php">
+   <line>77</line>
+  </file>
+ </directive>
+ <directive id="URI.DefaultScheme">
+  <file name="HTMLPurifier/URIDefinition.php">
+   <line>84</line>
+  </file>
+ </directive>
+ <directive id="URI.AllowedSchemes">
+  <file name="HTMLPurifier/URISchemeRegistry.php">
+   <line>48</line>
+  </file>
+ </directive>
+ <directive id="URI.OverrideAllowedSchemes">
+  <file name="HTMLPurifier/URISchemeRegistry.php">
+   <line>49</line>
+  </file>
+ </directive>
+ <directive id="CSS.AllowDuplicates">
+  <file name="HTMLPurifier/AttrDef/CSS.php">
+   <line>28</line>
+  </file>
+ </directive>
+ <directive id="URI.Disable">
+  <file name="HTMLPurifier/AttrDef/URI.php">
+   <line>47</line>
+  </file>
+ </directive>
+ <directive id="Core.ColorKeywords">
+  <file name="HTMLPurifier/AttrDef/CSS/Color.php">
+   <line>29</line>
+  </file>
+  <file name="HTMLPurifier/AttrDef/HTML/Color.php">
+   <line>19</line>
+  </file>
+ </directive>
+ <directive id="CSS.AllowedFonts">
+  <file name="HTMLPurifier/AttrDef/CSS/FontFamily.php">
+   <line>64</line>
+  </file>
+ </directive>
+ <directive id="Attr.AllowedClasses">
+  <file name="HTMLPurifier/AttrDef/HTML/Class.php">
+   <line>33</line>
+  </file>
+ </directive>
+ <directive id="Attr.ForbiddenClasses">
+  <file name="HTMLPurifier/AttrDef/HTML/Class.php">
+   <line>34</line>
+  </file>
+ </directive>
+ <directive id="Attr.AllowedFrameTargets">
+  <file name="HTMLPurifier/AttrDef/HTML/FrameTarget.php">
+   <line>32</line>
+  </file>
+ </directive>
+ <directive id="Attr.EnableID">
+  <file name="HTMLPurifier/AttrDef/HTML/ID.php">
+   <line>41</line>
+  </file>
+ </directive>
+ <directive id="Attr.IDPrefix">
+  <file name="HTMLPurifier/AttrDef/HTML/ID.php">
+   <line>51</line>
+  </file>
+ </directive>
+ <directive id="Attr.IDPrefixLocal">
+  <file name="HTMLPurifier/AttrDef/HTML/ID.php">
+   <line>53</line>
+   <line>58</line>
+  </file>
+ </directive>
+ <directive id="Attr.ID.HTML5">
+  <file name="HTMLPurifier/AttrDef/HTML/ID.php">
+   <line>75</line>
+  </file>
+ </directive>
+ <directive id="Attr.IDBlacklistRegexp">
+  <file name="HTMLPurifier/AttrDef/HTML/ID.php">
+   <line>97</line>
+  </file>
+ </directive>
+ <directive id="Attr.">
+  <file name="HTMLPurifier/AttrDef/HTML/LinkTypes.php">
+   <line>46</line>
+  </file>
+ </directive>
+ <directive id="Core.AllowHostnameUnderscore">
+  <file name="HTMLPurifier/AttrDef/URI/Host.php">
+   <line>77</line>
+  </file>
+ </directive>
+ <directive id="Core.EnableIDNA">
+  <file name="HTMLPurifier/AttrDef/URI/Host.php">
+   <line>109</line>
+  </file>
+ </directive>
+ <directive id="Attr.DefaultTextDir">
+  <file name="HTMLPurifier/AttrTransform/BdoDir.php">
+   <line>22</line>
+  </file>
+ </directive>
+ <directive id="Core.RemoveInvalidImg">
+  <file name="HTMLPurifier/AttrTransform/ImgRequired.php">
+   <line>24</line>
+  </file>
+  <file name="HTMLPurifier/Strategy/RemoveForeignElements.php">
+   <line>27</line>
+  </file>
+ </directive>
+ <directive id="Attr.DefaultInvalidImage">
+  <file name="HTMLPurifier/AttrTransform/ImgRequired.php">
+   <line>27</line>
+  </file>
+ </directive>
+ <directive id="Attr.DefaultImageAlt">
+  <file name="HTMLPurifier/AttrTransform/ImgRequired.php">
+   <line>33</line>
+  </file>
+ </directive>
+ <directive id="Attr.DefaultInvalidImageAlt">
+  <file name="HTMLPurifier/AttrTransform/ImgRequired.php">
+   <line>40</line>
+  </file>
+ </directive>
+ <directive id="HTML.Attr.Name.UseCDATA">
+  <file name="HTMLPurifier/AttrTransform/Name.php">
+   <line>18</line>
+  </file>
+  <file name="HTMLPurifier/HTMLModule/Name.php">
+   <line>19</line>
+  </file>
+ </directive>
+ <directive id="HTML.FlashAllowFullScreen">
+  <file name="HTMLPurifier/AttrTransform/SafeParam.php">
+   <line>53</line>
+  </file>
+ </directive>
+ <directive id="Cache.SerializerPath">
+  <file name="HTMLPurifier/DefinitionCache/Serializer.php">
+   <line>185</line>
+  </file>
+ </directive>
+ <directive id="Cache.SerializerPermissions">
+  <file name="HTMLPurifier/DefinitionCache/Serializer.php">
+   <line>202</line>
+   <line>218</line>
+  </file>
+ </directive>
+ <directive id="Filter.ExtractStyleBlocks.TidyImpl">
+  <file name="HTMLPurifier/Filter/ExtractStyleBlocks.php">
+   <line>94</line>
+  </file>
+ </directive>
+ <directive id="Filter.ExtractStyleBlocks.Scope">
+  <file name="HTMLPurifier/Filter/ExtractStyleBlocks.php">
+   <line>125</line>
+  </file>
+ </directive>
+ <directive id="Filter.ExtractStyleBlocks.Escaping">
+  <file name="HTMLPurifier/Filter/ExtractStyleBlocks.php">
+   <line>330</line>
+  </file>
+ </directive>
+ <directive id="HTML.Forms">
+  <file name="HTMLPurifier/HTMLModule/Forms.php">
+   <line>31</line>
+  </file>
+ </directive>
+ <directive id="HTML.SafeIframe">
+  <file name="HTMLPurifier/HTMLModule/Iframe.php">
+   <line>28</line>
+  </file>
+  <file name="HTMLPurifier/URIFilter/SafeIframe.php">
+   <line>48</line>
+  </file>
+ </directive>
+ <directive id="HTML.MaxImgLength">
+  <file name="HTMLPurifier/HTMLModule/Image.php">
+   <line>21</line>
+  </file>
+  <file name="HTMLPurifier/HTMLModule/SafeEmbed.php">
+   <line>18</line>
+  </file>
+  <file name="HTMLPurifier/HTMLModule/SafeObject.php">
+   <line>24</line>
+  </file>
+ </directive>
+ <directive id="HTML.TidyLevel">
+  <file name="HTMLPurifier/HTMLModule/Tidy.php">
+   <line>50</line>
+  </file>
+ </directive>
+ <directive id="HTML.TidyAdd">
+  <file name="HTMLPurifier/HTMLModule/Tidy.php">
+   <line>54</line>
+  </file>
+ </directive>
+ <directive id="HTML.TidyRemove">
+  <file name="HTMLPurifier/HTMLModule/Tidy.php">
+   <line>55</line>
+  </file>
+ </directive>
+ <directive id="AutoFormat.PurifierLinkify.DocURL">
+  <file name="HTMLPurifier/Injector/PurifierLinkify.php">
+   <line>31</line>
+  </file>
+ </directive>
+ <directive id="AutoFormat.RemoveEmpty.RemoveNbsp">
+  <file name="HTMLPurifier/Injector/RemoveEmpty.php">
+   <line>46</line>
+  </file>
+ </directive>
+ <directive id="AutoFormat.RemoveEmpty.RemoveNbsp.Exceptions">
+  <file name="HTMLPurifier/Injector/RemoveEmpty.php">
+   <line>47</line>
+  </file>
+ </directive>
+ <directive id="AutoFormat.RemoveEmpty.Predicate">
+  <file name="HTMLPurifier/Injector/RemoveEmpty.php">
+   <line>48</line>
+  </file>
+ </directive>
+ <directive id="Core.AggressivelyFixLt">
+  <file name="HTMLPurifier/Lexer/DOMLex.php">
+   <line>54</line>
+  </file>
+ </directive>
+ <directive id="Core.AllowParseManyTags">
+  <file name="HTMLPurifier/Lexer/DOMLex.php">
+   <line>72</line>
+  </file>
+ </directive>
+ <directive id="Core.DirectLexLineNumberSyncInterval">
+  <file name="HTMLPurifier/Lexer/DirectLex.php">
+   <line>84</line>
+  </file>
+ </directive>
+ <directive id="Core.DisableExcludes">
+  <file name="HTMLPurifier/Strategy/FixNesting.php">
+   <line>54</line>
+  </file>
+ </directive>
+ <directive id="Core.EscapeInvalidTags">
+  <file name="HTMLPurifier/Strategy/MakeWellFormed.php">
+   <line>72</line>
+  </file>
+  <file name="HTMLPurifier/Strategy/RemoveForeignElements.php">
+   <line>26</line>
+  </file>
+ </directive>
+ <directive id="HTML.AllowedComments">
+  <file name="HTMLPurifier/Strategy/RemoveForeignElements.php">
+   <line>31</line>
+  </file>
+ </directive>
+ <directive id="HTML.AllowedCommentsRegexp">
+  <file name="HTMLPurifier/Strategy/RemoveForeignElements.php">
+   <line>32</line>
+  </file>
+ </directive>
+ <directive id="URI.HostBlacklist">
+  <file name="HTMLPurifier/URIFilter/HostBlacklist.php">
+   <line>25</line>
+  </file>
+ </directive>
+ <directive id="URI.MungeResources">
+  <file name="HTMLPurifier/URIFilter/Munge.php">
+   <line>48</line>
+  </file>
+ </directive>
+ <directive id="URI.MungeSecretKey">
+  <file name="HTMLPurifier/URIFilter/Munge.php">
+   <line>49</line>
+  </file>
+ </directive>
+ <directive id="URI.SafeIframeRegexp">
+  <file name="HTMLPurifier/URIFilter/SafeIframe.php">
+   <line>35</line>
+  </file>
+ </directive>
+</usage>

--- libraries/htmlpurifier/docs/dev-advanced-api.html ---
@@ -0,0 +1,26 @@
+<?xml version="1.0" encoding="UTF-8"?>
+<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
+    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
+<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"><head>
+<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
+<meta name="description" content="Specification for HTML Purifier's advanced API for defining custom filtering behavior." />
+<link rel="stylesheet" type="text/css" href="style.css" />
+
+<title>Advanced API - HTML Purifier</title>
+
+</head><body>
+
+<h1>Advanced API</h1>
+
+<div id="filing">Filed under Development</div>
+<div id="index">Return to the <a href="index.html">index</a>.</div>
+<div id="home"><a href="http://htmlpurifier.org/">HTML Purifier</a> End-User Documentation</div>
+
+<p>
+  Please see <a href="enduser-customize.html">Customize!</a>
+</p>
+
+</body></html>
+
+<!-- vim: et sw=4 sts=4
+-->

--- libraries/htmlpurifier/docs/dev-code-quality.txt ---
@@ -0,0 +1,30 @@
+
+Code Quality Issues
+
+Okay, face it.  Programmers can get lazy, cut corners, or make mistakes. They
+also can do quick prototypes, and then forget to rewrite them later.  Well,
+while I can't list mistakes in here, I can list prototype-like segments
+of code that should be aggressively refactored.  This does not list
+optimization issues, that needs to be done after intense profiling.
+
+docs/examples/demo.php - ad hoc HTML/PHP soup to the extreme
+
+AttrDef - a lot of duplication, more generic classes need to be created;
+a lot of strtolower() calls, no legit casing
+    Class - doesn't support Unicode characters (fringe); uses regular expressions
+    Lang - code duplication; premature optimization
+    Length - easily mistaken for CSSLength
+    URI - multiple regular expressions; missing validation for parts (?)
+    CSS - parser doesn't accept advanced CSS (fringe)
+    Number - constructor interface inconsistent with Integer
+Strategy
+    FixNesting - cannot bubble nodes out of structures, duplicated checks
+        for special-case parent node
+    RemoveForeignElements - should be run in parallel with MakeWellFormed
+URIScheme - needs to have callable generic checks
+    mailto - doesn't validate emails, doesn't validate querystring
+    news - doesn't validate opaque path
+    nntp - doesn't constrain path
+    tel - doesn't validate phone numbers, only allows characters '+', '1-9', and 'x'
+
+    vim: et sw=4 sts=4

--- libraries/htmlpurifier/docs/dev-config-bcbreaks.txt ---
@@ -0,0 +1,79 @@
+
+Configuration Backwards-Compatibility Breaks
+
+In version 4.0.0, the configuration subsystem (composed of the outwards
+facing Config class, as well as the ConfigSchema and ConfigSchema_Interchange
+subsystems), was significantly revamped to make use of property lists.
+While most of the changes are internal, some internal APIs were changed for the
+sake of clarity. HTMLPurifier_Config was kept completely backwards compatible,
+although some of the functions were retrofitted with an unambiguous alternate
+syntax. Both of these changes are discussed in this document.
+
+
+
+1. Outwards Facing Changes
+--------------------------------------------------------------------------------
+
+The HTMLPurifier_Config class now takes an alternate syntax. The general rule
+is:
+
+    If you passed $namespace, $directive, pass "$namespace.$directive"
+    instead.
+
+An example:
+
+    $config->set('HTML', 'Allowed', 'p');
+
+becomes:
+
+    $config->set('HTML.Allowed', 'p');
+
+New configuration options may have more than one namespace, they might
+look something like %Filter.YouTube.Blacklist. While you could technically
+set it with ('HTML', 'YouTube.Blacklist'), the logical extension
+('HTML', 'YouTube', 'Blacklist') does not work.
+
+The old API will still work, but will emit E_USER_NOTICEs.
+
+
+
+2. Internal API Changes
+--------------------------------------------------------------------------------
+
+Some overarching notes: we've completely eliminated the notion of namespace;
+it's now an informal construct for organizing related configuration directives.
+
+Also, the validation routines for keys (formerly "$namespace.$directive")
+have been completely relaxed. I don't think it really should be necessary.
+
+2.1 HTMLPurifier_ConfigSchema
+
+First off, if you're interfacing with this class, you really shouldn't.
+HTMLPurifier_ConfigSchema_Builder_ConfigSchema is really the only class that
+should ever be creating HTMLPurifier_ConfigSchema, and HTMLPurifier_Config the
+only class that should be reading it.
+
+All namespace related methods were removed; they are completely unnecessary
+now. Any $namespace, $name arguments must be replaced with $key (where
+$key == "$namespace.$name"), including for addAlias().
+
+The $info and $defaults member variables are no longer indexed as
+[$namespace][$name]; they are now indexed as ["$namespace.$name"].
+
+All deprecated methods were finally removed, after having yelled at you as
+an E_USER_NOTICE for a while now.
+
+2.2 HTMLPurifier_ConfigSchema_Interchange
+
+Member variable $namespaces was removed.
+
+2.3 HTMLPurifier_ConfigSchema_Interchange_Id
+
+Member variable $namespace and $directive removed; member variable $key added.
+Any method that took $namespace, $directive now takes $key.
+
+2.4 HTMLPurifier_ConfigSchema_Interchange_Namespace
+
+Removed.
+
+    vim: et sw=4 sts=4

--- libraries/htmlpurifier/docs/dev-config-naming.txt ---
@@ -0,0 +1,165 @@
+Configuration naming
+
+HTML Purifier 4.0.0 features a new configuration naming system that
+allows arbitrary nesting of namespaces.  While there are certain cases
+in which using two namespaces is obviously better (the canonical example
+is where we were using AutoFormatParam to contain directives for AutoFormat
+parameters), it is unclear whether or not a general migration to highly
+namespaced directives is a good idea or not.
+
+== Case studies ==
+
+=== Attr.* ===
+
+We have a dead duck HTML.Attr.Name.UseCDATA which migrated before we decided
+to think this out thoroughly.
+
+We currently have a large number of directives in the Attr.* namespace.
+These directives tweak the behavior of some HTML attributes.  They have
+the properties:
+
+* While they apply to only one attribute at a time, the attribute can
+  span over multiple elements (not necessarily all attributes, either).
+  The information of which elements it impacts is either omitted or
+  informally stated (EnableID applies to all elements, DefaultImageAlt
+  applies to <img> tags, AllowedRev doesn't say but only applies to a tags).
+
+* There is a certain degree of clustering that could be applied, especially
+  to the ID directives.  The clustering could be done with respect to
+  what element/attribute was used, i.e.
+
+    *.id -> EnableID, IDBlacklistRegexp, IDBlacklist, IDPrefixLocal, IDPrefix
+    img.src -> DefaultInvalidImage
+    img.alt -> DefaultImageAlt, DefaultInvalidImageAlt
+    bdo.dir -> DefaultTextDir
+    a.rel -> AllowedRel
+    a.rev -> AllowedRev
+    a.target -> AllowedFrameTargets
+    a.name -> Name.UseCDATA
+
+* The directives often reference generic attribute types that were specified
+  in the DTD/specification.  However, some of the behavior specifically relies
+  on the fact that other use cases of the attribute are not, at current,
+  supported by HTML Purifier.
+
+    AllowedRel, AllowedRev -> heavily <a> specific; if <link> ends up being
+        allowed, we will also have to give users specificity there (we also
+        want to preserve generality) DTD %Linktypes, HTML5 distinguishes
+        between <link> and <a>/<area>
+    AllowedFrameTargets -> heavily <a> specific, but also used by <area>
+        and <form>. Transitional DTD %FrameTarget, not present in strict,
+        HTML5 calls them "browsing contexts"
+    Default*Image* -> as a default parameter, is almost entirely exlcusive
+        to <img>
+    EnableID -> global attribute
+    Name.UseCDATA -> heavily <a> specific, but has heavy other usage by
+        many things
+
+== AutoFormat.* ==
+
+These have the fairly normal pluggable architecture that lends itself to
+large amounts of namespaces (pluggability may be the key to figuring
+out when gratuitous namespacing is good.)  Properties:
+
+* Boolean directives are fair game for being namespaced: for example,
+  RemoveEmpty.RemoveNbsp triggers RemoveEmpty.RemoveNbsp.Exceptions,
+  the latter of which only makes sense when RemoveEmpty.RemoveNbsp
+  is set to true. (The same applies to RemoveNbsp too)
+
+The AutoFormat string is a bit long, but is the only bit of repeated
+context.
+
+== Core.* ==
+
+Core is the potpourri of directives, mostly regarding some minor behavioral
+tweaks for HTML handling abilities.
+
+    AggressivelyFixLt
+    AllowParseManyTags
+    ConvertDocumentToFragment
+    DirectLexLineNumberSyncInterval
+    LexerImpl
+    MaintainLineNumbers
+        Lexer
+    CollectErrors
+    Language
+        Error handling (Language is ostensibly a little more general, but
+        it's only used for error handling right now)
+    ColorKeywords
+        CSS and HTML
+    Encoding
+    EscapeNonASCIICharacters
+        Character encoding
+    EscapeInvalidChildren
+    EscapeInvalidTags
+    HiddenElements
+    RemoveInvalidImg
+        Lexing/Output
+    RemoveScriptContents
+        Deprecated
+
+== HTML.* ==
+
+    AllowedAttributes
+    AllowedElements
+    AllowedModules
+    Allowed
+    ForbiddenAttributes
+    ForbiddenElements
+        Element set tuning
+    BlockWrapper
+        Child def advanced twiddle
+    CoreModules
+    CustomDoctype
+        Advanced HTMLModuleManager twiddles
+    DefinitionID
+    DefinitionRev
+        Caching
+    Doctype
+    Parent
+    Strict
+    XHTML
+        Global environment
+    MaxImgLength
+        Attribute twiddle? (applies to two attributes)
+    Proprietary
+    SafeEmbed
+    SafeObject
+    Trusted
+        Extra functionality/tagsets
+    TidyAdd
+    TidyLevel
+    TidyRemove
+        Tidy
+
+== Output.* ==
+
+These directly affect the output of Generator. These are all advanced
+twiddles.
+
+== URI.* ==
+
+    AllowedSchemes
+    OverrideAllowedSchemes
+        Scheme tuning
+    Base
+    DefaultScheme
+    Host
+        Global environment
+    DefinitionID
+    DefinitionRev
+        Caching
+    DisableExternalResources
+    DisableExternal
+    DisableResources
+    Disable
+        Contextual/authority tuning
+    HostBlacklist
+        Authority tuning
+    MakeAbsolute
+    MungeResources
+    MungeSecretKey
+    Munge
+        Transformation behavior (munge can be grouped)
+
+

--- libraries/htmlpurifier/docs/dev-config-schema.html ---
@@ -0,0 +1,412 @@
+<?xml version="1.0" encoding="UTF-8"?>
+<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
+  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
+<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
+  <head>
+    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
+    <meta name="description" content="Describes config schema framework in HTML Purifier." />
+    <link rel="stylesheet" type="text/css" href="./style.css" />
+    <title>Config Schema - HTML Purifier</title>
+  </head>
+  <body>
+
+    <h1>Config Schema</h1>
+
+    <div id="filing">Filed under Development</div>
+    <div id="index">Return to the <a href="index.html">index</a>.</div>
+    <div id="home"><a href="http://htmlpurifier.org/">HTML Purifier</a> End-User Documentation</div>
+
+    <p>
+      HTML Purifier has a fairly complex system for configuration. Users
+      interact with a <code>HTMLPurifier_Config</code> object to
+      set configuration directives. The values they set are validated according
+      to a configuration schema, <code>HTMLPurifier_ConfigSchema</code>.
+    </p>
+
+    <p>
+      The schema is mostly transparent to end-users, but if you're doing development
+      work for HTML Purifier and need to define a new configuration directive,
+      you'll need to interact with it. We'll also talk about how to define
+      userspace configuration directives at the very end.
+    </p>
+
+    <h2>Write a directive file</h2>
+
+    <p>
+      Directive files define configuration directives to be used by
+      HTML Purifier. They are placed in <code>library/HTMLPurifier/ConfigSchema/schema/</code>
+      in the form <code><em>Namespace</em>.<em>Directive</em>.txt</code> (I
+      couldn't think of a more descriptive file extension.)
+      Directive files are actually what we call <code>StringHash</code>es,
+      i.e. associative arrays represented in a string form reminiscent of
+      <a href="http://qa.php.net/write-test.php">PHPT</a> tests. Here's a
+      sample directive file, <code>Test.Sample.txt</code>:
+    </p>
+
+    <pre>Test.Sample
+TYPE: string/null
+DEFAULT: NULL
+ALLOWED: 'foo', 'bar'
+VALUE-ALIASES: 'baz' => 'bar'
+VERSION: 3.1.0
+--DESCRIPTION--
+This is a sample configuration directive for the purposes of the
+&lt;code&gt;dev-config-schema.html&lt;code&gt; documentation.
+--ALIASES--
+Test.Example</pre>
+
+    <p>
+      Each of these segments has a specific meaning:
+    </p>
+
+    <table class="table">
+      <thead>
+        <tr>
+          <th>Key</th>
+          <th>Example</th>
+          <th>Description</th>
+        </tr>
+      </thead>
+      <tbody>
+        <tr>
+          <td>ID</td>
+          <td>Test.Sample</td>
+          <td>The name of the directive, in the form Namespace.Directive
+          (implicitly the first line)</td>
+        </tr>
+        <tr>
+          <td>TYPE</td>
+          <td>string/null</td>
+          <td>The type of variable this directive accepts. See below for
+          details. You can also add <code>/null</code> to the end of
+          any basic type to allow null values too.</td>
+        </tr>
+        <tr>
+          <td>DEFAULT</td>
+          <td>NULL</td>
+          <td>A parseable PHP expression of the default value.</td>
+        </tr>
+        <tr>
+          <td>DESCRIPTION</td>
+          <td>This is a...</td>
+          <td>An HTML description of what this directive does.</td>
+        </tr>
+        <tr>
+          <td>VERSION</td>
+          <td>3.1.0</td>
+          <td><em>Recommended</em>. The version of HTML Purifier this directive was added.
+          Directives that have been around since 1.0.0 don't have this,
+          but any new ones should.</td>
+        </tr>
+        <tr>
+          <td>ALIASES</td>
+          <td>Test.Example</td>
+          <td><em>Optional</em>. A comma separated list of aliases for this directive.
+          This is most useful for backwards compatibility and should
+          not be used otherwise.</td>
+        </tr>
+        <tr>
+          <td>ALLOWED</td>
+          <td>'foo', 'bar'</td>
+          <td><em>Optional</em>. Set of allowed value for a directive,
+          a comma separated list of parseable PHP expressions. This
+          is only allowed string, istring, text and itext TYPEs.</td>
+        </tr>
+        <tr>
+          <td>VALUE-ALIASES</td>
+          <td>'baz' =&gt; 'bar'</td>
+          <td><em>Optional</em>. Mapping of one value to another, and
+          should be a comma separated list of keypair duples. This
+          is only allowed string, istring, text and itext TYPEs.</td>
+        </tr>
+        <tr>
+          <td>DEPRECATED-VERSION</td>
+          <td>3.1.0</td>
+          <td><em>Not shown</em>. Indicates that the directive was
+          deprecated this version.</td>
+        </tr>
+        <tr>
+          <td>DEPRECATED-USE</td>
+          <td>Test.NewDirective</td>
+          <td><em>Not shown</em>. Indicates what new directive should be
+          used instead. Note that the directives will functionally be
+          different, although they should offer the same functionality.
+          If they are identical, use an alias instead.</td>
+        </tr>
+        <tr>
+          <td>EXTERNAL</td>
+          <td>CSSTidy</td>
+          <td><em>Not shown</em>. Indicates if there is an external library
+          the user will need to download and install to use this configuration
+          directive. As of right now, this is merely a Google-able name; future
+          versions may also provide links and instructions.</td>
+        </tr>
+      </tbody>
+    </table>
+
+    <p>
+      Some notes on format and style:
+    </p>
+
+    <ul>
+      <li>
+        Each of these keys can be expressed in the short format
+        (<code>KEY: Value</code>) or the long format
+        (<code>--KEY--</code> with value beneath). You must use the
+        long format if multiple lines are needed, or if a long format
+        has been used already (that's why <code>ALIASES</code> in our
+        example is in the long format); otherwise, it's user preference.
+      </li>
+      <li>
+        The HTML descriptions should be wrapped at about 80 columns; do
+        not rely on editor word-wrapping.
+      </li>
+    </ul>
+
+    <p>
+      Also, as promised, here is the set of possible types:
+    </p>
+
+    <table class="table">
+      <thead>
+        <tr>
+          <th>Type</th>
+          <th>Example</th>
+          <th>Description</th>
+        </tr>
+      </thead>
+      <tbody>
+        <tr>
+          <td>string</td>
+          <td>'Foo'</td>
+          <td><a href="http://docs.php.net/manual/en/language.types.string.php">String</a> without newlines</td>
+        </tr>
+        <tr>
+          <td>istring</td>
+          <td>'foo'</td>
+          <td>Case insensitive ASCII string without newlines</td>
+        </tr>
+        <tr>
+          <td>text</td>
+          <td>"A<em>\n</em>b"</td>
+          <td>String with newlines</td>
+        </tr>
+        <tr>
+          <td>itext</td>
+          <td>"a<em>\n</em>b"</td>
+          <td>Case insensitive ASCII string without newlines</td>
+        </tr>
+        <tr>
+          <td>int</td>
+          <td>23</td>
+          <td>Integer</td>
+        </tr>
+        <tr>
+          <td>float</td>
+          <td>3.0</td>
+          <td>Floating point number</td>
+        </tr>
+        <tr>
+          <td>bool</td>
+          <td>true</td>
+          <td>Boolean</td>
+        </tr>
+        <tr>
+          <td>lookup</td>
+          <td>array('key' =&gt; true)</td>
+          <td>Lookup array, used with <code>isset($var[$key])</code></td>
+        </tr>
+        <tr>
+          <td>list</td>
+          <td>array('f', 'b')</td>
+          <td>List array, with ordered numerical indexes</td>
+        </tr>
+        <tr>
+          <td>hash</td>
+          <td>array('key' =&gt; 'val')</td>
+          <td>Associative array of keys to values</td>
+        </tr>
+        <tr>
+          <td>mixed</td>
+          <td>new stdClass</td>
+          <td>Any PHP variable is fine</td>
+        </tr>
+      </tbody>
+    </table>
+
+    <p>
+      The examples represent what will be returned out of the configuration
+      object; users have a little bit of leeway when setting configuration
+      values (for example, a lookup value can be specified as a list;
+      HTML Purifier will flip it as necessary.) These types are defined
+      in <a href="http://repo.or.cz/w/htmlpurifier.git?a=blob;hb=HEAD;f=library/HTMLPurifier/VarParser.php">
+      library/HTMLPurifier/VarParser.php</a>.
+    </p>
+
+    <p>
+      For more information on what values are allowed, and how they are parsed,
+      consult <a href="http://repo.or.cz/w/htmlpurifier.git?a=blob;hb=HEAD;f=library/HTMLPurifier/ConfigSchema/InterchangeBuilder.php">
+      library/HTMLPurifier/ConfigSchema/InterchangeBuilder.php</a>, as well
+      as <a href="http://repo.or.cz/w/htmlpurifier.git?a=blob;hb=HEAD;f=library/HTMLPurifier/ConfigSchema/Interchange/Directive.php">
+      library/HTMLPurifier/ConfigSchema/Interchange/Directive.php</a> for
+      the semantics of the parsed values.
+    </p>
+
+    <h2>Refreshing the cache</h2>
+
+    <p>
+      You may have noticed that your directive file isn't doing anything
+      yet. That's because it hasn't been added to the runtime
+      <code>HTMLPurifier_ConfigSchema</code> instance. Run
+      <code>maintenance/generate-schema-cache.php</code> to fix this.
+      If there were no errors, you're good to go! Don't forget to add
+      some unit tests for your functionality!
+    </p>
+
+    <p>
+      If you ever make changes to your configuration directives, you
+      will need to run this script again.
+    </p>
+    <h2>Adding in-house schema definitions</h2>
+
+    <p>
+      Placing stuff directly in HTML Purifier's source tree is generally not a
+      good idea, so HTML Purifier 4.0.0+ has some facilities in place to make your
+      life easier.
+    </p>
+
+    <p>
+      The first is to pass an extra parameter to <code>maintenance/generate-schema-cache.php</code>
+      with the location of your directory (relative or absolute path will do). For example,
+      if I'm storing my custom definitions in <em>/var/htmlpurifier/myschema</em>, run:
+      <code>php maintenance/generate-schema-cache.php /var/htmlpurifier/myschema</code>.
+    </p>
+
+    <p>
+      Alternatively, you can create a small loader PHP file in the HTML Purifier base
+      directory named <code>config-schema.php</code> (this is the same directory
+      you would place a <code>test-settings.php</code> file).  In this file, add
+      the following line for each directory you want to load:
+    </p>
+
+<pre>$builder-&gt;buildDir($interchange, '/var/htmlpurifier/myschema');</pre>
+
+    <p>You can even load a single file using:</p>
+
+<pre>$builder-&gt;buildFile($interchange, '/var/htmlpurifier/myschema/MyApp.Directive.txt');</pre>
+
+    <p>Storing custom definitions that you don't plan on sending back upstream in
+    a separate directory is <em>definitely</em> a good idea! Additionally, picking
+    a good namespace can go a long way to saving you grief if you want to use
+    someone else's change, but they picked the same name, or if HTML Purifier
+    decides to add support for a configuration directive that has the same name.</p>
+
+    <!-- TODO: how to name directives that rely on naming conventions -->
+
+    <h2>Errors</h2>
+
+    <p>
+      All directive files go through a rigorous validation process
+      through <a href="http://repo.or.cz/w/htmlpurifier.git?a=blob;hb=HEAD;f=library/HTMLPurifier/ConfigSchema/Validator.php">
+      library/HTMLPurifier/ConfigSchema/Validator.php</a>, as well
+      as some basic checks during building. While
+      listing every error out here is out-of-scope for this document, we
+      can give some general tips for interpreting error messages.
+      There are two types of errors: builder errors and validation errors.
+    </p>
+
+    <h3>Builder errors</h3>
+
+    <blockquote>
+      <p>
+        <strong>Exception:</strong> Expected type string, got
+        integer in DEFAULT in directive hash 'Ns.Dir'
+      </p>
+    </blockquote>
+
+    <p>
+      You can identify a builder error by the keyword "directive hash."
+      These are the easiest to deal with, because they directly correspond
+      with your directive file. Find the offending directive file (which
+      is the directive hash plus the .txt extension), find the
+      offending index ("in DEFAULT" means the DEFAULT key) and fix the error.
+      This particular error would occur if your default value is not the same
+      type as TYPE.
+    </p>
+
+    <h3>Validation errors</h3>
+
+    <blockquote>
+      <p>
+        <strong>Exception:</strong> Alias 3 in valueAliases in directive
+        'Ns.Dir' must be a string
+      </p>
+    </blockquote>
+
+    <p>
+      These are a little trickier, because we're not actually validating
+      your directive file, or even the direct string hash representation.
+      We're validating an Interchange object, and the error messages do
+      not mention any string hash keys.
+    </p>
+
+    <p>
+      Nevertheless, it's not difficult to figure out what went wrong.
+      Read the "context" statements in reverse:
+    </p>
+
+    <dl>
+      <dt>in directive 'Ns.Dir'</dt>
+        <dd>This means we need to look at the directive file <code>Ns.Dir.txt</code></dd>
+      <dt>in valueAliases</dt>
+        <dd>There's no key actually called this, but there's one that's close:
+          VALUE-ALIASES. Indeed, that's where to look.</dd>
+      <dt>Alias 3</dt>
+        <dd>The value alias that is equal to 3 is the culprit.</dd>
+    </dl>
+
+    <p>
+      In this particular case, you're not allowed to alias integers values to
+      strings values.
+    </p>
+
+    <p>
+      The most difficult part is translating the Interchange member variable (valueAliases)
+      into a directive file key (VALUE-ALIASES), but there's a one-to-one
+      correspondence currently. If the two formats diverge, any discrepancies
+      will be described in <a href="http://repo.or.cz/w/htmlpurifier.git?a=blob;hb=HEAD;f=library/HTMLPurifier/ConfigSchema/InterchangeBuilder.php">
+      library/HTMLPurifier/ConfigSchema/InterchangeBuilder.php</a>.
+    </p>
+
+    <h2>Internals</h2>
+
+    <p>
+      Much of the configuration schema framework's codebase deals with
+      shuffling data from one format to another, and doing validation on this
+      data.
+      The keystone of all of this is the <code>HTMLPurifier_ConfigSchema_Interchange</code>
+      class, which represents the purest, parsed representation of the schema.
+    </p>
+
+    <p>
+      Hand-writing this data is unwieldy, however, so we write directive files.
+      These directive files are parsed by <code>HTMLPurifier_StringHashParser</code>
+      into <code>HTMLPurifier_StringHash</code>es, which then
+      are run through <code>HTMLPurifier_ConfigSchema_InterchangeBuilder</code>
+      to construct the interchange object.
+    </p>
+
+    <p>
+      From the interchange object, the data can be siphoned into other forms
+      using <code>HTMLPurifier_ConfigSchema_Builder</code> subclasses.
+      For example, <code>HTMLPurifier_ConfigSchema_Builder_ConfigSchema</code>
+      generates a runtime <code>HTMLPurifier_ConfigSchema</code> object,
+      which <code>HTMLPurifier_Config</code> uses to validate its incoming
+      data. There is also an XML serializer, which is used to build documentation.
+    </p>
+
+  </body>
+</html>
+
+<!-- vim: et sw=4 sts=4
+-->

--- libraries/htmlpurifier/docs/dev-flush.html ---
@@ -0,0 +1,68 @@
+<?xml version="1.0" encoding="UTF-8"?>
+<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
+    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
+<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
+<head>
+    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
+    <meta name="description" content="Discusses when to flush HTML Purifier's various caches." />
+    <link rel="stylesheet" type="text/css" href="./style.css" />
+    <title>Flushing the Purifier - HTML Purifier</title>
+</head>
+<body>
+
+<h1>Flushing the Purifier</h1>
+
+<div id="filing">Filed under Development</div>
+<div id="index">Return to the <a href="index.html">index</a>.</div>
+<div id="home"><a href="http://htmlpurifier.org/">HTML Purifier</a> End-User Documentation</div>
+
+<p>
+    If you've been poking around the various folders in HTML Purifier,
+    you may have noticed the <code>maintenance</code> directory.  Almost
+    all of these scripts are devoted to flushing out the various caches
+    HTML Purifier uses.  Normal users don't have to worry about this:
+    regular library usage is transparent.  However, when doing development
+    work on HTML Purifier, you may find you have to flush one of the
+    caches.
+</p>
+
+<p>
+    As a general rule of thumb, run <code>flush.php</code> whenever you make
+    any <em>major</em> changes, or when tests start mysteriously failing.
+    In more detail, run this script if:
+</p>
+
+<ul>
+    <li>
+        You added new source files to HTML Purifier's main library.
+        (see <code>generate-includes.php</code>)
+    </li>
+    <li>
+        You modified the configuration schema (see
+        <code>generate-schema-cache.php</code>). This usually means
+        adding or modifying files in <code>HTMLPurifier/ConfigSchema/schema/</code>,
+        although in rare cases modifying <code>HTMLPurifier/ConfigSchema.php</code>
+        will also require this.
+    </li>
+    <li>
+        You modified a Definition, or its subsystems. The most usual candidate
+        is <code>HTMLPurifier/HTMLDefinition.php</code>, which also encompasses
+        the files in <code>HTMLPurifier/HTMLModule/</code> as well as if you've
+        <a href="enduser-customize.html">customizing definitions</a> without
+        the cache disabled. (see <code>flush-generation-cache.php</code>)
+    </li>
+    <li>
+        You modified source files, and have been using the standalone
+        version from the full installation. (see <code>generate-standalone.php</code>)
+    </li>
+</ul>
+
+<p>
+    You can check out the corresponding scripts for more information on what they
+    do.
+</p>
+
+</body></html>
+
+<!-- vim: et sw=4 sts=4
+-->

--- libraries/htmlpurifier/docs/dev-includes.txt ---
@@ -0,0 +1,281 @@
+
+INCLUDES, AUTOLOAD, BYTECODE CACHES and OPTIMIZATION
+
+The Problem
+-----------
+
+HTML Purifier contains a number of extra components that are not used all
+of the time, only if the user explicitly specifies that we should use
+them.
+
+Some of these optional components are optionally included (Filter,
+Language, Lexer, Printer), while others are included all the time
+(Injector, URIFilter, HTMLModule, URIScheme). We will stipulate that these
+are all developer specified: it is conceivable that certain Tokens are not
+used, but this is user-dependent and should not be trusted.
+
+We should come up with a consistent way to handle these things and ensure
+that we get the maximum performance when there is bytecode caches and
+when there are not. Unfortunately, these two goals seem contrary to each
+other.
+
+A peripheral issue is the performance of ConfigSchema, which has been
+shown take a large, constant amount of initialization time, and is
+intricately linked to the issue of includes due to its pervasive use
+in our plugin architecture.
+
+Pros and Cons
+-------------
+
+We will assume that user-based extensions will be included by them.
+
+Conditional includes:
+  Pros:
+    - User management is simplified; only a single directive needs to be set
+    - Only necessary code is included
+  Cons:
+    - Doesn't play nicely with opcode caches
+    - Adds complexity to standalone version
+    - Optional configuration directives are not exposed without a little
+      extra coaxing (not implemented yet)
+
+Include it all:
+  Pros:
+    - User management is still simple
+    - Plays nicely with opcode caches and standalone version
+    - All configuration directives are present
+  Cons:
+    - Lots of (how much?) extra code is included
+    - Classes that inherit from external libraries will cause compile
+      errors
+
+Build an include stub (Let's do this!):
+  Pros:
+    - Only necessary code is included
+    - Plays nicely with opcode caches and standalone version
+    - require (without once) can be used, see above
+    - Could further extend as a compilation to one file
+  Cons:
+    - Not implemented yet
+    - Requires user intervention and use of a command line script
+    - Standalone script must be chained to this
+    - More complex and compiled-language-like
+    - Requires a whole new class of system-wide configuration directives,
+      as configuration objects can be reused
+    - Determining what needs to be included can be complex (see above)
+    - No way of autodetecting dynamically instantiated classes
+    - Might be slow
+
+Include stubs
+-------------
+
+This solution may be "just right" for users who are heavily oriented
+towards performance. However, there are a number of picky implementation
+details to work out beforehand.
+
+The number one concern is how to make the HTML Purifier files "work
+out of the box", while still being able to easily get them into a form
+that works with this setup. As the codebase stands right now, it would
+be necessary to strip out all of the require_once calls. The only way
+we could get rid of the require_once calls is to use __autoload or
+use the stub for all cases (which might not be a bad idea).
+
+    Aside
+    -----
+    An important thing to remember, however, is that these require_once's
+    are valuable data about what classes a file needs. Unfortunately, there's
+    no distinction between whether or not the file is needed all the time,
+    or whether or not it is one of our "optional" files. Thus, it is
+    effectively useless.
+
+    Deprecated
+    ----------
+    One of the things I'd like to do is have the code search for any classes
+    that are explicitly mentioned in the code. If a class isn't mentioned, I
+    get to assume that it is "optional," i.e. included via introspection.
+    The choice is either to use PHP's tokenizer or use regexps; regexps would
+    be faster but a tokenizer would be more correct. If this ends up being
+    unfeasible, adding dependency comments isn't a bad idea. (This could
+    even be done automatically by search/replacing require_once, although
+    we'd have to manually inspect the results for the optional requires.)
+
+    NOTE: This ends up not being necessary, as we're going to make the user
+    figure out all the extra classes they need, and only include the core
+    which is predetermined.
+
+Using the autoload framework with include stubs works nicely with
+introspective classes: instead of having to have require_once inside
+the function, we can let autoload do the work; we simply need to
+new $class or accept the object straight from the caller. Handling filters
+becomes a simple matter of ticking off configuration directives, and
+if ConfigSchema spits out errors, adding the necessary includes. We could
+also use the autoload framework as a fallback, in case the user forgets
+to make the include, but doesn't really care about performance.
+
+    Insight
+    -------
+    All of this talk is merely a natural extension of what our current
+    standalone functionality does. However, instead of having our code
+    perform the includes, or attempting to inline everything that possibly
+    could be used, we boot the issue to the user, making them include
+    everything or setup the fallback autoload handler.
+
+Configuration Schema
+--------------------
+
+A common deficiency for all of the conditional include setups (including
+the dynamically built include PHP stub) is that if one of this
+conditionally included files includes a configuration directive, it
+is not accessible to configdoc. A stopgap solution for this problem is
+to have it piggy-back off of the data in the merge-library.php script
+to figure out what extra files it needs to include, but if the file also
+inherits classes that don't exist, we're in big trouble.
+
+I think it's high time we centralized the configuration documentation.
+However, the type checking has been a great boon for the library, and
+I'd like to keep that. The compromise is to use some other source, and
+then parse it into the ConfigSchema internal format (sans all of those
+nasty documentation strings which we really don't need at runtime) and
+serialize that for future use.
+
+The next question is that of format. XML is very verbose, and the prospect
+of setting defaults in it gives me willies. However, this may be necessary.
+Splitting up the file into manageable chunks may alleviate this trouble,
+and we may be even want to create our own format optimized for specifying
+configuration. It might look like (based off the PHPT format, which is
+nicely compact yet unambiguous and human-readable):
+
+Core.HiddenElements
+TYPE:    lookup
+DEFAULT: array('script', 'style') // auto-converted during processing
+--ALIASES--
+Core.InvisibleElements, Core.StupidElements
+--DESCRIPTION--
+<p>
+  Blah blah
+</p>
+
+The first line is the directive name, the lines after that prior to the
+first --HEADER-- block are single-line values, and then after that
+the multiline values are there. No value is restricted to a particular
+format: DEFAULT could very well be multiline if that would be easier.
+This would make it insanely easy, also, to add arbitrary extra parameters,
+like:
+
+VERSION:  3.0.0
+ALLOWED:  'none', 'light', 'medium', 'heavy' // this is wrapped in array()
+EXTERNAL: CSSTidy // this would be documented somewhere else with a URL
+
+The final loss would be that you wouldn't know what file the directive
+was used in; with some clever regexps it should be possible to
+figure out where $config->get($ns, $d); occurs. Reflective calls to
+the configuration object is mitigated by the fact that getBatch is
+used, so we can simply talk about that in the namespace definition page.
+This might be slow, but it would only happen when we are creating
+the documentation for consumption, and is sugar.
+
+We can put this in a schema/ directory, outside of HTML Purifier. The serialized
+data gets treated like entities.ser.
+
+The final thing that needs to be handled is user defined configurations.
+They can be added at runtime using ConfigSchema::registerDirectory()
+which globs the directory and grabs all of the directives to be incorporated
+in. Then, the result is saved. We may want to take advantage of the
+DefinitionCache framework, although it is not altogether certain what
+configuration directives would be used to generate our key (meta-directives!)
+
+    Further thoughts
+    ----------------
+    Our master configuration schema will only need to be updated once
+    every new version, so it's easily versionable. User specified
+    schema files are far more volatile, but it's far too expensive
+    to check the filemtimes of all the files, so a DefinitionRev style
+    mechanism works better. However, we can uniquely identify the
+    schema based on the directories they loaded, so there's no need
+    for a DefinitionId until we give them full programmatic control.
+
+    These variables should be directly incorporated into ConfigSchema,
+    and ConfigSchema should handle serialization. Some refactoring will be
+    necessary for the DefinitionCache classes, as they are built with
+    Config in mind. If the user changes something, the cache file gets
+    rebuilt. If the version changes, the cache file gets rebuilt. Since
+    our unit tests flush the caches before we start, and the operation is
+    pretty fast, this will not negatively impact unit testing.
+
+One last thing: certain configuration directives require that files
+get added. They may even be specified dynamically. It is not a good idea
+for the HTMLPurifier_Config object to be used directly for such matters.
+Instead, the userland code should explicitly perform the includes. We may
+put in something like:
+
+REQUIRES: HTMLPurifier_Filter_ExtractStyleBlocks
+
+To indicate that if that class doesn't exist, and the user is attempting
+to use the directive, we should fatally error out. The stub includes the core files,
+and the user includes everything else. Any reflective things like new
+$class would be required to tie in with the configuration.
+
+It would work very well with rarely used configuration options, but it
+wouldn't be so good for "core" parts that can be disabled. In such cases
+the core include file would need to be modified, and the only way
+to properly do this is use the configuration object. Once again, our
+ability to create cache keys saves the day again: we can create arbitrary
+stub files for arbitrary configurations and include those. They could
+even be the single file affairs. The only thing we'd need to include,
+then, would be HTMLPurifier_Config! Then, the configuration object would
+load the library.
+
+    An aside...
+    -----------
+    One questions, however, the wisdom of letting PHP files write other PHP
+    files. It seems like a recipe for disaster, or at least lots of headaches
+    in highly secured setups, where PHP does not have the ability to write
+    to its root. In such cases, we could use sticky bits or tell the user
+    to manually generate the file.
+
+    The other troublesome bit is actually doing the calculations necessary.
+    For certain cases, it's simple (such as URIScheme), but for AttrDef
+    and HTMLModule the dependency trees are very complex in relation to
+    %HTML.Allowed and friends. I think that this idea should be shelved
+    and looked at a later, less insane date.
+
+An interesting dilemma presents itself when a configuration form is offered
+to the user. Normally, the configuration object is not accessible without
+editing PHP code; this facility changes thing. The sensible thing to do
+is stipulate that all classes required by the directives you allow must
+be included.
+
+Unit testing
+------------
+
+Setting up the parsing and translation into our existing format would not
+be difficult to do. It might represent a good time for us to rethink our
+tests for these facilities; as creative as they are, they are often hacky
+and require public visibility for things that ought to be protected.
+This is especially applicable for our DefinitionCache tests.
+
+Migration
+---------
+
+Because we are not *adding* anything essentially new, it should be trivial
+to write a script to take our existing data and dump it into the new format.
+Well, not trivial, but fairly easy to accomplish. Primary implementation
+difficulties would probably involve formatting the file nicely.
+
+Backwards-compatibility
+-----------------------
+
+I expect that the ConfigSchema methods should stick around for a little bit,
+but display E_USER_NOTICE warnings that they are deprecated. This will
+require documentation!
+
+New stuff
+---------
+
+VERSION: Version number directive was introduced
+DEPRECATED-VERSION: If the directive was deprecated, when was it deprecated?
+DEPRECATED-USE: If the directive was deprecated, what should the user use now?
+REQUIRES: What classes does this configuration directive require, but are
+    not part of the HTML Purifier core?
+
+    vim: et sw=4 sts=4

--- libraries/htmlpurifier/docs/dev-naming.html ---
@@ -0,0 +1,83 @@
+<?xml version="1.0" encoding="UTF-8"?>
+<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
+    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
+<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"><head>
+<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
+<meta name="description" content="Defines class naming conventions in HTML Purifier." />
+<link rel="stylesheet" type="text/css" href="./style.css" />
+
+<title>Naming Conventions - HTML Purifier</title>
+
+</head><body>
+
+<h1>Naming Conventions</h1>
+
+<div id="filing">Filed under Development</div>
+<div id="index">Return to the <a href="index.html">index</a>.</div>
+<div id="home"><a href="http://htmlpurifier.org/">HTML Purifier</a> End-User Documentation</div>
+
+<p>The classes in this library follow a few naming conventions, which may
+help you find the correct functionality more quickly.  Here they are:</p>
+
+<dl>
+
+<dt>All classes occupy the HTMLPurifier pseudo-namespace.</dt>
+    <dd>This means that all classes are prefixed with HTMLPurifier_.  As such, all
+    names under HTMLPurifier_ are reserved.  I recommend that you use the name
+    HTMLPurifierX_YourName_ClassName, especially if you want to take advantage
+    of HTMLPurifier_ConfigDef.</dd>
+
+<dt>All classes correspond to their path if library/ was in the include path</dt>
+    <dd>HTMLPurifier_AttrDef is located at HTMLPurifier/AttrDef.php; replace
+    underscores with slashes and append .php and you'll have the location of
+    the class.</dd>
+
+<dt>Harness and Test are reserved class names for unit tests</dt>
+    <dd>The suffix <code>Test</code> indicates that the class is a subclass of UnitTestCase
+    (of the Simpletest library) and is testable. "Harness" indicates a subclass
+    of UnitTestCase that is not meant to be run but to be extended into
+    concrete test cases and contains custom test methods (i.e. assert*())</dd>
+
+<dt>Class names do not necessarily represent inheritance hierarchies</dt>
+    <dd>While we try to reflect inheritance in naming to some extent, it is not
+    guaranteed (for instance, none of the classes inherit from HTMLPurifier,
+    the base class).  However, all class files have the require_once
+    declarations to whichever classes they are tightly coupled to.</dd>
+
+<dt>Strategy has a meaning different from the Gang of Four pattern</dt>
+    <dd>In Design Patterns, the Gang of Four describes a Strategy object as
+    encapsulating an algorithm so that they can be switched at run-time.  While
+    our strategies are indeed algorithms, they are not meant to be substituted:
+    all must be present in order for proper functioning.</dd>
+
+<dt>Abbreviations are avoided</dt>
+    <dd>We try to avoid abbreviations as much as possible, but in some cases,
+    abbreviated version is more readable than the full version. Here, we
+    list common abbreviations:
+    <ul>
+        <li>Attr to Attributes (note that it is plural, i.e. <code>$attr = array()</code>)</li>
+        <li>Def to Definition</li>
+        <li><code>$ret</code> is the value to be returned in a function</li>
+    </ul>
+    </dd>
+
+<dt>Ambiguity concerning the definition of Def/Definition</dt>
+    <dd>While a definition normally defines the structure/acceptable values of
+    an entity, most of the definitions in this application also attempt
+    to validate and fix the value.  I am unsure of a better name, as
+    "Validator" would exclude fixing the value, "Fixer" doesn't invoke
+    the proper image of "fixing" something, and "ValidatorFixer" is too long!
+    Some other suggestions were "Handler", "Reference", "Check", "Fix",
+    "Repair" and "Heal".</dd>
+
+<dt>Transform not Transformer</dt>
+    <dd>Transform is both a noun and a verb, and thus we define a "Transform" as
+    something that "transforms," leaving "Transformer" (which sounds like an
+    electrical device/robot toy).</dd>
+
+</dl>
+
+</body></html>
+
+<!-- vim: et sw=4 sts=4
+-->

--- libraries/htmlpurifier/docs/dev-optimization.html ---
@@ -0,0 +1,33 @@
+<?xml version="1.0" encoding="UTF-8"?>
+<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
+    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
+<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"><head>
+<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
+<meta name="description" content="Discusses possible methods of optimizing HTML Purifier." />
+<link rel="stylesheet" type="text/css" href="./style.css" />
+
+<title>Optimization - HTML Purifier</title>
+
+</head><body>
+
+<h1>Optimization</h1>
+
+<div id="filing">Filed under Development</div>
+<div id="index">Return to the <a href="index.html">index</a>.</div>
+<div id="home"><a href="http://htmlpurifier.org/">HTML Purifier</a> End-User Documentation</div>
+
+<p>Here are some possible optimization techniques we can apply to code sections if
+they turn out to be slow.  Be sure not to prematurely optimize: if you get
+that itch, put it here!</p>
+
+<ul>
+    <li>Make Tokens Flyweights (may prove problematic, probably not worth it)</li>
+    <li>Rewrite regexps into PHP code</li>
+    <li>Batch regexp validation (do as many per function call as possible)</li>
+    <li>Parallelize strategies</li>
+</ul>
+
+</body></html>
+
+<!-- vim: et sw=4 sts=4
+-->

--- libraries/htmlpurifier/docs/dev-progress.html ---
@@ -0,0 +1,309 @@
+<?xml version="1.0" encoding="UTF-8"?>
+<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
+    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
+<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"><head>
+<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
+<meta name="description" content="Tables detailing HTML element and CSS property implementation coverage in HTML Purifier." />
+<link rel="stylesheet" type="text/css" href="./style.css" />
+
+<title>Implementation Progress - HTML Purifier</title>
+
+<style type="text/css">
+
+td {padding-right:1em;border-bottom:1px solid #000;padding-left:0.5em;}
+th {text-align:left;padding-top:1.4em;font-size:13pt;
+    border-bottom:2px solid #000;background:#FFF;}
+thead th {text-align:left;padding:0.1em;background-color:#EEE;}
+
+.impl-yes {background:#9D9;}
+.impl-partial {background:#FFA;}
+.impl-no {background:#CCC;}
+
+.danger {color:#600;}
+.css1 {color:#060;}
+.required {font-weight:bold;}
+.feature {color:#999;}
+
+</style>
+
+</head><body>
+
+<h1>Implementation Progress</h1>
+
+<div id="filing">Filed under Development</div>
+<div id="index">Return to the <a href="index.html">index</a>.</div>
+<div id="home"><a href="http://htmlpurifier.org/">HTML Purifier</a> End-User Documentation</div>
+
+<p>
+  <strong>Warning:</strong> This table is kept for historical purposes and
+  is not being actively updated.
+</p>
+
+<h2>Key</h2>
+
+<table cellspacing="0"><tbody>
+<tr><td class="impl-yes">Implemented</td></tr>
+<tr><td class="impl-partial">Partially implemented</td></tr>
+<tr><td class="impl-no">Not priority to implement</td></tr>
+<tr><td class="danger">Dangerous attribute/property</td></tr>
+<tr><td class="css1">Present in CSS1</td></tr>
+<tr><td class="feature">Feature, requires extra work</td></tr>
+</tbody></table>
+
+<h2>CSS</h2>
+
+<table cellspacing="0">
+
+<thead>
+<tr><th>Name</th><th>Notes</th></tr>
+</thead>
+
+<!--
+<tr><td>-</td><td>-</td></tr>
+-->
+
+<tbody>
+<tr><th colspan="2">Standard</th></tr>
+<tr class="css1 impl-yes"><td>background-color</td><td>COMPOSITE(&lt;color&gt;, transparent)</td></tr>
+<tr class="css1 impl-yes"><td>background</td><td>SHORTHAND, currently alias for background-color</td></tr>
+<tr class="css1 impl-yes"><td>border</td><td>SHORTHAND, MULTIPLE</td></tr>
+<tr class="css1 impl-yes"><td>border-color</td><td>MULTIPLE</td></tr>
+<tr class="css1 impl-yes"><td>border-style</td><td>MULTIPLE</td></tr>
+<tr class="css1 impl-yes"><td>border-width</td><td>MULTIPLE</td></tr>
+<tr class="css1 impl-yes"><td>border-*</td><td>SHORTHAND</td></tr>
+<tr class="impl-yes"><td>border-*-color</td><td>COMPOSITE(&lt;color&gt;, transparent)</td></tr>
+<tr class="impl-yes"><td>border-*-style</td><td>ENUM(none, hidden, dotted, dashed,
+    solid, double, groove, ridge, inset, outset)</td></tr>
+<tr class="css1 impl-yes"><td>border-*-width</td><td>COMPOSITE(&lt;length&gt;, thin, medium, thick)</td></tr>
+<tr class="css1 impl-yes"><td>clear</td><td>ENUM(none, left, right, both)</td></tr>
+<tr class="css1 impl-yes"><td>color</td><td>&lt;color&gt;</td></tr>
+<tr class="css1 impl-yes"><td>float</td><td>ENUM(left, right, none), May require layout
+    precautions with clear</td></tr>
+<tr class="css1 impl-yes"><td>font</td><td>SHORTHAND</td></tr>
+<tr class="css1 impl-yes"><td>font-family</td><td>CSS validator may complain if fallback font
+    family not specified</td></tr>
+<tr class="css1 impl-yes"><td>font-size</td><td>COMPOSITE(&lt;absolute-size&gt;,
+    &lt;relative-size&gt;, &lt;length&gt;, &lt;percentage&gt;)</td></tr>
+<tr class="css1 impl-yes"><td>font-style</td><td>ENUM(normal, italic, oblique)</td></tr>
+<tr class="css1 impl-yes"><td>font-variant</td><td>ENUM(normal, small-caps)</td></tr>
+<tr class="css1 impl-yes"><td>font-weight</td><td>ENUM(normal, bold, bolder, lighter,
+    100, 200, 300, 400, 500, 600, 700, 800, 900), maybe special code for
+    in-between integers</td></tr>
+<tr class="css1 impl-yes"><td>letter-spacing</td><td>COMPOSITE(&lt;length&gt;, normal)</td></tr>
+<tr class="css1 impl-yes"><td>line-height</td><td>COMPOSITE(&lt;number&gt;,
+    &lt;length&gt;, &lt;percentage&gt;, normal)</td></tr>
+<tr class="css1 impl-yes"><td>list-style-position</td><td>ENUM(inside, outside),
+    Strange behavior in browsers</td></tr>
+<tr class="css1 impl-yes"><td>list-style-type</td><td>ENUM(...),
+    Well-supported values are: disc, circle, square,
+    decimal, lower-roman, upper-roman, lower-alpha and upper-alpha. See also
+    CSS 3. Mostly IE lack of support.</td></tr>
+<tr class="css1 impl-yes"><td>list-style</td><td>SHORTHAND</td></tr>
+<tr class="css1 impl-yes"><td>margin</td><td>MULTIPLE</td></tr>
+<tr class="css1 impl-yes"><td>margin-*</td><td>COMPOSITE(&lt;length&gt;,
+    &lt;percentage&gt;, auto)</td></tr>
+<tr class="css1 impl-yes"><td>padding</td><td>MULTIPLE</td></tr>
+<tr class="css1 impl-yes"><td>padding-*</td><td>COMPOSITE(&lt;length&gt;(positive),
+    &lt;percentage&gt;(positive))</td></tr>
+<tr class="css1 impl-yes"><td>text-align</td><td>ENUM(left, right,
+    center, justify)</td></tr>
+<tr class="css1 impl-yes"><td>text-decoration</td><td>No blink (argh my eyes), not
+    enum, can be combined (composite sorta): underline, overline,
+    line-through</td></tr>
+<tr class="css1 impl-yes"><td>text-indent</td><td>COMPOSITE(&lt;length&gt;,
+    &lt;percentage&gt;)</td></tr>
+<tr class="css1 impl-yes"><td>text-transform</td><td>ENUM(capitalize, uppercase,
+    lowercase, none)</td></tr>
+<tr class="css1 impl-yes"><td>width</td><td>COMPOSITE(&lt;length&gt;,
+    &lt;percentage&gt;, auto), Interesting</td></tr>
+<tr class="css1 impl-yes"><td>word-spacing</td><td>COMPOSITE(&lt;length&gt;, auto),
+    IE 5 no support</td></tr>
+</tbody>
+
+<tbody>
+<tr><th colspan="2">Table</th></tr>
+<tr class="impl-yes"><td>border-collapse</td><td>ENUM(collapse, seperate)</td></tr>
+<tr class="impl-yes"><td>border-space</td><td>MULTIPLE</td></tr>
+<tr class="impl-yes"><td>caption-side</td><td>ENUM(top, bottom)</td></tr>
+<tr class="feature"><td>empty-cells</td><td>ENUM(show, hide), No IE support makes this useless,
+    possible fix with &amp;nbsp;? Unknown release milestone.</td></tr>
+<tr class="impl-yes"><td>table-layout</td><td>ENUM(auto, fixed)</td></tr>
+<tr class="impl-yes css1"><td>vertical-align</td><td>COMPOSITE(ENUM(baseline, sub,
+    super, top, text-top, middle, bottom, text-bottom), &lt;percentage&gt;,
+    &lt;length&gt;) Also applies to others with explicit height</td></tr>
+</tbody>
+
+<tbody>
+<tr><th colspan="2">Absolute positioning, unknown release milestone</th></tr>
+<tr class="danger impl-no"><td>bottom</td><td rowspan="4">Dangerous, must be non-negative to even be considered,
+    but it's still possible to arbitrarily position by running over.</td></tr>
+<tr class="danger impl-no"><td>left</td></tr>
+<tr class="danger impl-no"><td>right</td></tr>
+<tr class="danger impl-no"><td>top</td></tr>
+<tr class="impl-no"><td>clip</td><td>-</td></tr>
+<tr class="danger impl-no"><td>position</td><td>ENUM(static, relative, absolute, fixed)
+    relative not absolute?</td></tr>
+<tr class="danger impl-no"><td>z-index</td><td>Dangerous</td></tr>
+</tbody>
+
+<tbody>
+<tr><th colspan="2">Unknown</th></tr>
+<tr class="danger css1 impl-yes"><td>background-image</td><td>Dangerous</td></tr>
+<tr class="css1 impl-yes"><td>background-attachment</td><td>ENUM(scroll, fixed),
+    Depends on background-image</td></tr>
+<tr class="css1 impl-yes"><td>background-position</td><td>Depends on background-image</td></tr>
+<tr class="danger impl-no"><td>cursor</td><td>Dangerous but fluffy</td></tr>
+<tr class="danger impl-yes"><td>display</td><td>ENUM(...), Dangerous but interesting;
+    will not implement list-item, run-in (Opera only) or table (no IE);
+    inline-block has incomplete IE6 support and requires -moz-inline-box
+    for Mozilla. Unknown target milestone.</td></tr>
+<tr class="css1 impl-yes"><td>height</td><td>Interesting, why use it? Unknown target milestone.</td></tr>
+<tr class="danger css1 impl-yes"><td>list-style-image</td><td>Dangerous?</td></tr>
+<tr class="impl-no"><td>max-height</td><td rowspan="4">No IE 5/6</td></tr>
+<tr class="impl-no"><td>min-height</td></tr>
+<tr class="impl-no"><td>max-width</td></tr>
+<tr class="impl-no"><td>min-width</td></tr>
+<tr class="impl-no"><td>orphans</td><td>No IE support</td></tr>
+<tr class="impl-no"><td>widows</td><td>No IE support</td></tr>
+<tr><td>overflow</td><td>ENUM, IE 5/6 almost (remove visible if set). Unknown target milestone.</td></tr>
+<tr><td>page-break-after</td><td>ENUM(auto, always, avoid, left, right),
+    IE 5.5/6 and Opera. Unknown target milestone.</td></tr>
+<tr><td>page-break-before</td><td>ENUM(auto, always, avoid, left, right),
+    Mostly supported. Unknown target milestone.</td></tr>
+<tr><td>page-break-inside</td><td>ENUM(avoid, auto), Opera only. Unknown target milestone.</td></tr>
+<tr class="impl-no"><td>quotes</td><td>May be dropped from CSS2, fairly useless for inline context</td></tr>
+<tr class="danger impl-yes"><td>visibility</td><td>ENUM(visible, hidden, collapse),
+    Dangerous</td></tr>
+<tr class="css1 feature impl-partial"><td>white-space</td><td>ENUM(normal, pre, nowrap, pre-wrap,
+    pre-line), Spotty implementation:
+    pre (no IE 5/6), <em>nowrap</em> (no IE 5, supported),
+    pre-wrap (only Opera), pre-line (no support). Fixable? Unknown target milestone.</td></tr>
+</tbody>
+
+<tbody class="impl-no">
+<tr><th colspan="2">Aural</th></tr>
+<tr><td>azimuth</td><td>-</td></tr>
+<tr><td>cue</td><td>-</td></tr>
+<tr><td>cue-after</td><td>-</td></tr>
+<tr><td>cue-before</td><td>-</td></tr>
+<tr><td>elevation</td><td>-</td></tr>
+<tr><td>pause-after</td><td>-</td></tr>
+<tr><td>pause-before</td><td>-</td></tr>
+<tr><td>pause</td><td>-</td></tr>
+<tr><td>pitch-range</td><td>-</td></tr>
+<tr><td>pitch</td><td>-</td></tr>
+<tr><td>play-during</td><td>-</td></tr>
+<tr><td>richness</td><td>-</td></tr>
+<tr><td>speak-header</td><td>Table related</td></tr>
+<tr><td>speak-numeral</td><td>-</td></tr>
+<tr><td>speak-punctuation</td><td>-</td></tr>
+<tr><td>speak</td><td>-</td></tr>
+<tr><td>speech-rate</td><td>-</td></tr>
+<tr><td>stress</td><td>-</td></tr>
+<tr><td>voice-family</td><td>-</td></tr>
+<tr><td>volume</td><td>-</td></tr>
+</tbody>
+
+<tbody class="impl-no">
+<tr><th colspan="2">Will not implement</th></tr>
+<tr><td>content</td><td>Not applicable for inline styles</td></tr>
+<tr><td>counter-increment</td><td>Needs content, Opera only</td></tr>
+<tr><td>counter-reset</td><td>Needs content, Opera only</td></tr>
+<tr><td>direction</td><td>No support</td></tr>
+<tr><td>outline-color</td><td rowspan="4">IE Mac and Opera on outside,
+Mozilla on inside and needs -moz-outline, no IE support.</td></tr>
+    <tr><td>outline-style</td></tr>
+    <tr><td>outline-width</td></tr>
+    <tr><td>outline</td></tr>
+<tr><td>unicode-bidi</td><td>No support</td></tr>
+</tbody>
+
+</table>
+
+<h2>Interesting Attributes</h2>
+
+<table cellspacing="0">
+
+<thead>
+<tr><th>Attribute</th><th>Tags</th><th>Notes</th></tr>
+</thead>
+
+<!--
+<tr><th></th></tr>
+<tbody>
+<tr><td>-</td><td>-</td><td>-</td></tr>
+</tbody>
+-->
+
+<tbody>
+<tr><th colspan="3">CSS</th></tr>
+<tr class="impl-yes"><td>style</td><td>All</td><td>Parser is reasonably functional. Status here doesn't count individual properties.</td></tr>
+</tbody>
+
+<tbody>
+<tr><th colspan="3">Questionable</th></tr>
+<tr class="impl-no"><td>accesskey</td><td>A</td><td>May interfere with main interface</td></tr>
+<tr class="impl-no"><td>tabindex</td><td>A</td><td>May interfere with main interface</td></tr>
+<tr class="impl-yes"><td>target</td><td>A</td><td>Config enabled, only useful for frame layouts, disallowed in strict</td></tr>
+</tbody>
+
+<tbody>
+<tr><th colspan="3">Miscellaneous</th></tr>
+<tr><td>datetime</td><td>DEL, INS</td><td>No visible effect, ISO format</td></tr>
+<tr class="impl-yes"><td>rel</td><td>A</td><td>Largely user-defined: nofollow, tag (see microformats)</td></tr>
+<tr class="impl-yes"><td>rev</td><td>A</td><td>Largely user-defined: vote-*</td></tr>
+<tr class="feature"><td>axis</td><td>TD, TH</td><td>W3C only: No browser implementation</td></tr>
+<tr class="feature"><td>char</td><td>COL, COLGROUP, TBODY, TD, TFOOT, TH, THEAD, TR</td><td>W3C only: No browser implementation</td></tr>
+<tr class="feature"><td>headers</td><td>TD, TH</td><td>W3C only: No browser implementation</td></tr>
+<tr class="impl-yes"><td>scope</td><td>TD, TH</td><td>W3C only: No browser implementation</td></tr>
+</tbody>
+
+<tbody class="impl-yes">
+<tr><th colspan="3">URI</th></tr>
+<tr><td rowspan="2">cite</td><td>BLOCKQUOTE, Q</td><td>For attribution</td></tr>
+    <tr><td>DEL, INS</td><td>Link to explanation why it changed</td></tr>
+<tr><td>href</td><td>A</td><td>-</td></tr>
+<tr><td>longdesc</td><td>IMG</td><td>-</td></tr>
+<tr class="required"><td>src</td><td>IMG</td><td>Required</td></tr>
+</tbody>
+
+<tbody>
+<tr><th colspan="3">Transform</th></tr>
+<tr class="impl-yes"><td rowspan="5">align</td><td>CAPTION</td><td>'caption-side' for top/bottom, 'text-align' for left/right</td></tr>
+    <tr class="impl-yes"><td>IMG</td><td rowspan="3">See specimens/html-align-to-css.html</td></tr>
+    <tr class="impl-yes"><td>TABLE</td></tr>
+    <tr class="impl-yes"><td>HR</td></tr>
+    <tr class="impl-yes"><td>H1, H2, H3, H4, H5, H6, P</td><td>Equivalent style 'text-align'</td></tr>
+<tr class="required impl-yes"><td>alt</td><td>IMG</td><td>Required, insert image filename if src is present or default invalid image text</td></tr>
+<tr class="impl-yes"><td rowspan="3">bgcolor</td><td>TABLE</td><td>Superset style 'background-color'</td></tr>
+    <tr class="impl-yes"><td>TR</td><td>Superset style 'background-color'</td></tr>
+    <tr class="impl-yes"><td>TD, TH</td><td>Superset style 'background-color'</td></tr>
+<tr class="impl-yes"><td>border</td><td>IMG</td><td>Equivalent style <code>border:[number]px solid</code></td></tr>
+<tr class="impl-yes"><td>clear</td><td>BR</td><td>Near-equiv style 'clear', transform 'all' into 'both'</td></tr>
+<tr class="impl-no"><td>compact</td><td>DL, OL, UL</td><td>Boolean, needs custom CSS class; rarely used anyway</td></tr>
+<tr class="required impl-yes"><td>dir</td><td>BDO</td><td>Required, insert ltr (or configuration value) if none</td></tr>
+<tr class="impl-yes"><td>height</td><td>TD, TH</td><td>Near-equiv style 'height', needs px suffix if original was in pixels</td></tr>
+<tr class="impl-yes"><td>hspace</td><td>IMG</td><td>Near-equiv styles 'margin-top' and 'margin-bottom', needs px suffix</td></tr>
+<tr class="impl-yes"><td>lang</td><td>*</td><td>Copy value to xml:lang</td></tr>
+<tr class="impl-yes"><td rowspan="2">name</td><td>IMG</td><td>Turn into ID</td></tr>
+    <tr class="impl-yes"><td>A</td><td>Turn into ID</td></tr>
+<tr class="impl-yes"><td>noshade</td><td>HR</td><td>Boolean, style 'border-style:solid;'</td></tr>
+<tr class="impl-yes"><td>nowrap</td><td>TD, TH</td><td>Boolean, style 'white-space:nowrap;' (not compat with IE5)</td></tr>
+<tr class="impl-yes"><td>size</td><td>HR</td><td>Near-equiv 'height', needs px suffix if original was pixels</td></tr>
+<tr class="required impl-yes"><td>src</td><td>IMG</td><td>Required, insert blank or default img if not set</td></tr>
+<tr class="impl-yes"><td>start</td><td>OL</td><td>Poorly supported 'counter-reset', allowed in loose, dropped in strict</td></tr>
+<tr class="impl-yes"><td rowspan="3">type</td><td>LI</td><td rowspan="3">Equivalent style 'list-style-type', different allowed values though. (needs testing)</td></tr>
+    <tr class="impl-yes"><td>OL</td></tr>
+    <tr class="impl-yes"><td>UL</td></tr>
+<tr class="impl-yes"><td>value</td><td>LI</td><td>Poorly supported 'counter-reset', allowed in loose, dropped in strict</td></tr>
+<tr class="impl-yes"><td>vspace</td><td>IMG</td><td>Near-equiv styles 'margin-left' and 'margin-right', needs px suffix, see hspace</td></tr>
+<tr class="impl-yes"><td rowspan="2">width</td><td>HR</td><td rowspan="2">Near-equiv style 'width', needs px suffix if original was pixels</td></tr>
+    <tr class="impl-yes"><td>TD, TH</td></tr>
+</tbody>
+
+</table>
+
+</body></html>
+
+<!-- vim: et sw=4 sts=4
+-->

--- libraries/htmlpurifier/docs/dtd/xhtml1-transitional.dtd ---
@@ -0,0 +1,1201 @@
+<!--
+   Extensible HTML version 1.0 Transitional DTD
+
+   This is the same as HTML 4 Transitional except for
+   changes due to the differences between XML and SGML.
+
+   Namespace = http://www.w3.org/1999/xhtml
+
+   For further information, see: http://www.w3.org/TR/xhtml1
+
+   Copyright (c) 1998-2002 W3C (MIT, INRIA, Keio),
+   All Rights Reserved. 
+
+   This DTD module is identified by the PUBLIC and SYSTEM identifiers:
+
+   PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
+   SYSTEM "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"
+
+   $Revision: 1.2 $
+   $Date: 2002/08/01 18:37:55 $
+
+-->
+
+<!--================ Character mnemonic entities =========================-->
+
+<!ENTITY % HTMLlat1 PUBLIC
+   "-//W3C//ENTITIES Latin 1 for XHTML//EN"
+   "xhtml-lat1.ent">
+%HTMLlat1;
+
+<!ENTITY % HTMLsymbol PUBLIC
+   "-//W3C//ENTITIES Symbols for XHTML//EN"
+   "xhtml-symbol.ent">
+%HTMLsymbol;
+
+<!ENTITY % HTMLspecial PUBLIC
+   "-//W3C//ENTITIES Special for XHTML//EN"
+   "xhtml-special.ent">
+%HTMLspecial;
+
+<!--================== Imported Names ====================================-->
+
+<!ENTITY % ContentType "CDATA">
+    <!-- media type, as per [RFC2045] -->
+
+<!ENTITY % ContentTypes "CDATA">
+    <!-- comma-separated list of media types, as per [RFC2045] -->
+
+<!ENTITY % Charset "CDATA">
+    <!-- a character encoding, as per [RFC2045] -->
+
+<!ENTITY % Charsets "CDATA">
+    <!-- a space separated list of character encodings, as per [RFC2045] -->
+
+<!ENTITY % LanguageCode "NMTOKEN">
+    <!-- a language code, as per [RFC3066] -->
+
+<!ENTITY % Character "CDATA">
+    <!-- a single character, as per section 2.2 of [XML] -->
+
+<!ENTITY % Number "CDATA">
+    <!-- one or more digits -->
+
+<!ENTITY % LinkTypes "CDATA">
+    <!-- space-separated list of link types -->
+
+<!ENTITY % MediaDesc "CDATA">
+    <!-- single or comma-separated list of media descriptors -->
+
+<!ENTITY % URI "CDATA">
+    <!-- a Uniform Resource Identifier, see [RFC2396] -->
+
+<!ENTITY % UriList "CDATA">
+    <!-- a space separated list of Uniform Resource Identifiers -->
+
+<!ENTITY % Datetime "CDATA">
+    <!-- date and time information. ISO date format -->
+
+<!ENTITY % Script "CDATA">
+    <!-- script expression -->
+
+<!ENTITY % StyleSheet "CDATA">
+    <!-- style sheet data -->
+
+<!ENTITY % Text "CDATA">
+    <!-- used for titles etc. -->
+
+<!ENTITY % FrameTarget "NMTOKEN">
+    <!-- render in this frame -->
+
+<!ENTITY % Length "CDATA">
+    <!-- nn for pixels or nn% for percentage length -->
+
+<!ENTITY % MultiLength "CDATA">
+    <!-- pixel, percentage, or relative -->
+
+<!ENTITY % Pixels "CDATA">
+    <!-- integer representing length in pixels -->
+
+<!-- these are used for image maps -->
+
+<!ENTITY % Shape "(rect|circle|poly|default)">
+
+<!ENTITY % Coords "CDATA">
+    <!-- comma separated list of lengths -->
+
+<!-- used for object, applet, img, input and iframe -->
+<!ENTITY % ImgAlign "(top|middle|bottom|left|right)">
+
+<!-- a color using sRGB: #RRGGBB as Hex values -->
+<!ENTITY % Color "CDATA">
+
+<!-- There are also 16 widely known color names with their sRGB values:
+
+    Black  = #000000    Green  = #008000
+    Silver = #C0C0C0    Lime   = #00FF00
+    Gray   = #808080    Olive  = #808000
+    White  = #FFFFFF    Yellow = #FFFF00
+    Maroon = #800000    Navy   = #000080
+    Red    = #FF0000    Blue   = #0000FF
+    Purple = #800080    Teal   = #008080
+    Fuchsia= #FF00FF    Aqua   = #00FFFF
+-->
+
+<!--=================== Generic Attributes ===============================-->
+
+<!-- core attributes common to most elements
+  id       document-wide unique id
+  class    space separated list of classes
+  style    associated style info
+  title    advisory title/amplification
+-->
+<!ENTITY % coreattrs
+ "id          ID             #IMPLIED
+  class       CDATA          #IMPLIED
+  style       %StyleSheet;   #IMPLIED
+  title       %Text;         #IMPLIED"
+  >
+
+<!-- internationalization attributes
+  lang        language code (backwards compatible)
+  xml:lang    language code (as per XML 1.0 spec)
+  dir         direction for weak/neutral text
+-->
+<!ENTITY % i18n
+ "lang        %LanguageCode; #IMPLIED
+  xml:lang    %LanguageCode; #IMPLIED
+  dir         (ltr|rtl)      #IMPLIED"
+  >
+
+<!-- attributes for common UI events
+  onclick     a pointer button was clicked
+  ondblclick  a pointer button was double clicked
+  onmousedown a pointer button was pressed down
+  onmouseup   a pointer button was released
+  onmousemove a pointer was moved onto the element
+  onmouseout  a pointer was moved away from the element
+  onkeypress  a key was pressed and released
+  onkeydown   a key was pressed down
+  onkeyup     a key was released
+-->
+<!ENTITY % events
+ "onclick     %Script;       #IMPLIED
+  ondblclick  %Script;       #IMPLIED
+  onmousedown %Script;       #IMPLIED
+  onmouseup   %Script;       #IMPLIED
+  onmouseover %Script;       #IMPLIED
+  onmousemove %Script;       #IMPLIED
+  onmouseout  %Script;       #IMPLIED
+  onkeypress  %Script;       #IMPLIED
+  onkeydown   %Script;       #IMPLIED
+  onkeyup     %Script;       #IMPLIED"
+  >
+
+<!-- attributes for elements that can get the focus
+  accesskey   accessibility key character
+  tabindex    position in tabbing order
+  onfocus     the element got the focus
+  onblur      the element lost the focus
+-->
+<!ENTITY % focus
+ "accesskey   %Character;    #IMPLIED
+  tabindex    %Number;       #IMPLIED
+  onfocus     %Script;       #IMPLIED
+  onblur      %Script;       #IMPLIED"
+  >
+
+<!ENTITY % attrs "%coreattrs; %i18n; %events;">
+
+<!-- text alignment for p, div, h1-h6. The default is
+     align="left" for ltr headings, "right" for rtl -->
+
+<!ENTITY % TextAlign "align (left|center|right|justify) #IMPLIED">
+
+<!--=================== Text Elements ====================================-->
+
+<!ENTITY % special.extra
+   "object | applet | img | map | iframe">
+	
+<!ENTITY % special.basic
+	"br | span | bdo">
+
+<!ENTITY % special
+   "%special.basic; | %special.extra;">
+
+<!ENTITY % fontstyle.extra "big | small | font | basefont">
+
+<!ENTITY % fontstyle.basic "tt | i | b | u
+                      | s | strike ">
+
+<!ENTITY % fontstyle "%fontstyle.basic; | %fontstyle.extra;">
+
+<!ENTITY % phrase.extra "sub | sup">
+<!ENTITY % phrase.basic "em | strong | dfn | code | q |
+                   samp | kbd | var | cite | abbr | acronym">
+
+<!ENTITY % phrase "%phrase.basic; | %phrase.extra;">
+
+<!ENTITY % inline.forms "input | select | textarea | label | button">
+
+<!-- these can occur at block or inline level -->
+<!ENTITY % misc.inline "ins | del | script">
+
+<!-- these can only occur at block level -->
+<!ENTITY % misc "noscript | %misc.inline;">
+
+<!ENTITY % inline "a | %special; | %fontstyle; | %phrase; | %inline.forms;">
+
+<!-- %Inline; covers inline or "text-level" elements -->
+<!ENTITY % Inline "(#PCDATA | %inline; | %misc.inline;)*">
+
+<!--================== Block level elements ==============================-->
+
+<!ENTITY % heading "h1|h2|h3|h4|h5|h6">
+<!ENTITY % lists "ul | ol | dl | menu | dir">
+<!ENTITY % blocktext "pre | hr | blockquote | address | center | noframes">
+
+<!ENTITY % block
+    "p | %heading; | div | %lists; | %blocktext; | isindex |fieldset | table">
+
+<!-- %Flow; mixes block and inline and is used for list items etc. -->
+<!ENTITY % Flow "(#PCDATA | %block; | form | %inline; | %misc;)*">
+
+<!--================== Content models for exclusions =====================-->
+
+<!-- a elements use %Inline; excluding a -->
+
+<!ENTITY % a.content
+   "(#PCDATA | %special; | %fontstyle; | %phrase; | %inline.forms; | %misc.inline;)*">
+
+<!-- pre uses %Inline excluding img, object, applet, big, small,
+     font, or basefont -->
+
+<!ENTITY % pre.content
+   "(#PCDATA | a | %special.basic; | %fontstyle.basic; | %phrase.basic; |
+	   %inline.forms; | %misc.inline;)*">
+
+<!-- form uses %Flow; excluding form -->
+
+<!ENTITY % form.content "(#PCDATA | %block; | %inline; | %misc;)*">
+
+<!-- button uses %Flow; but excludes a, form, form controls, iframe -->
+
+<!ENTITY % button.content
+   "(#PCDATA | p | %heading; | div | %lists; | %blocktext; |
+      table | br | span | bdo | object | applet | img | map |
+      %fontstyle; | %phrase; | %misc;)*">
+
+<!--================ Document Structure ==================================-->
+
+<!-- the namespace URI designates the document profile -->
+
+<!ELEMENT html (head, body)>
+<!ATTLIST html
+  %i18n;
+  id          ID             #IMPLIED
+  xmlns       %URI;          #FIXED 'http://www.w3.org/1999/xhtml'
+  >
+
+<!--================ Document Head =======================================-->
+
+<!ENTITY % head.misc "(script|style|meta|link|object|isindex)*">
+
+<!-- content model is %head.misc; combined with a single
+     title and an optional base element in any order -->
+
+<!ELEMENT head (%head.misc;,
+     ((title, %head.misc;, (base, %head.misc;)?) |
+      (base, %head.misc;, (title, %head.misc;))))>
+
+<!ATTLIST head
+  %i18n;
+  id          ID             #IMPLIED
+  profile     %URI;          #IMPLIED
+  >
+
+<!-- The title element is not considered part of the flow of text.
+       It should be displayed, for example as the page header or
+       window title. Exactly one title is required per document.
+    -->
+<!ELEMENT title (#PCDATA)>
+<!ATTLIST title 
+  %i18n;
+  id          ID             #IMPLIED
+  >
+
+<!-- document base URI -->
+
+<!ELEMENT base EMPTY>
+<!ATTLIST base
+  id          ID             #IMPLIED
+  href        %URI;          #IMPLIED
+  target      %FrameTarget;  #IMPLIED
+  >
+
+<!-- generic metainformation -->
+<!ELEMENT meta EMPTY>
+<!ATTLIST meta
+  %i18n;
+  id          ID             #IMPLIED
+  http-equiv  CDATA          #IMPLIED
+  name        CDATA          #IMPLIED
+  content     CDATA          #REQUIRED
+  scheme      CDATA          #IMPLIED
+  >
+
+<!--
+  Relationship values can be used in principle:
+
+   a) for document specific toolbars/menus when used
+      with the link element in document head e.g.
+        start, contents, previous, next, index, end, help
+   b) to link to a separate style sheet (rel="stylesheet")
+   c) to make a link to a script (rel="script")
+   d) by stylesheets to control how collections of
+      html nodes are rendered into printed documents
+   e) to make a link to a printable version of this document
+      e.g. a PostScript or PDF version (rel="alternate" media="print")
+-->
+
+<!ELEMENT link EMPTY>
+<!ATTLIST link
+  %attrs;
+  charset     %Charset;      #IMPLIED
+  href        %URI;          #IMPLIED
+  hreflang    %LanguageCode; #IMPLIED
+  type        %ContentType;  #IMPLIED
+  rel         %LinkTypes;    #IMPLIED
+  rev         %LinkTypes;    #IMPLIED
+  media       %MediaDesc;    #IMPLIED
+  target      %FrameTarget;  #IMPLIED
+  >
+
+<!-- style info, which may include CDATA sections -->
+<!ELEMENT style (#PCDATA)>
+<!ATTLIST style
+  %i18n;
+  id          ID             #IMPLIED
+  type        %ContentType;  #REQUIRED
+  media       %MediaDesc;    #IMPLIED
+  title       %Text;         #IMPLIED
+  xml:space   (preserve)     #FIXED 'preserve'
+  >
+
+<!-- script statements, which may include CDATA sections -->
+<!ELEMENT script (#PCDATA)>
+<!ATTLIST script
+  id          ID             #IMPLIED
+  charset     %Charset;      #IMPLIED
+  type        %ContentType;  #REQUIRED
+  language    CDATA          #IMPLIED
+  src         %URI;          #IMPLIED
+  defer       (defer)        #IMPLIED
+  xml:space   (preserve)     #FIXED 'preserve'
+  >
+
+<!-- alternate content container for non script-based rendering -->
+
+<!ELEMENT noscript %Flow;>
+<!ATTLIST noscript
+  %attrs;
+  >
+
+<!--======================= Frames =======================================-->
+
+<!-- inline subwindow -->
+
+<!ELEMENT iframe %Flow;>
+<!ATTLIST iframe
+  %coreattrs;
+  longdesc    %URI;          #IMPLIED
+  name        NMTOKEN        #IMPLIED
+  src         %URI;          #IMPLIED
+  frameborder (1|0)          "1"
+  marginwidth %Pixels;       #IMPLIED
+  marginheight %Pixels;      #IMPLIED
+  scrolling   (yes|no|auto)  "auto"
+  align       %ImgAlign;     #IMPLIED
+  height      %Length;       #IMPLIED
+  width       %Length;       #IMPLIED
+  >
+
+<!-- alternate content container for non frame-based rendering -->
+
+<!ELEMENT noframes %Flow;>
+<!ATTLIST noframes
+  %attrs;
+  >
+
+<!--=================== Document Body ====================================-->
+
+<!ELEMENT body %Flow;>
+<!ATTLIST body
+  %attrs;
+  onload      %Script;       #IMPLIED
+  onunload    %Script;       #IMPLIED
+  background  %URI;          #IMPLIED
+  bgcolor     %Color;        #IMPLIED
+  text        %Color;        #IMPLIED
+  link        %Color;        #IMPLIED
+  vlink       %Color;        #IMPLIED
+  alink       %Color;        #IMPLIED
+  >
+
+<!ELEMENT div %Flow;>  <!-- generic language/style container -->
+<!ATTLIST div
+  %attrs;
+  %TextAlign;
+  >
+
+<!--=================== Paragraphs =======================================-->
+
+<!ELEMENT p %Inline;>
+<!ATTLIST p
+  %attrs;
+  %TextAlign;
+  >
+
+<!--=================== Headings =========================================-->
+
+<!--
+  There are six levels of headings from h1 (the most important)
+  to h6 (the least important).
+-->
+
+<!ELEMENT h1  %Inline;>
+<!ATTLIST h1
+  %attrs;
+  %TextAlign;
+  >
+
+<!ELEMENT h2 %Inline;>
+<!ATTLIST h2
+  %attrs;
+  %TextAlign;
+  >
+
+<!ELEMENT h3 %Inline;>
+<!ATTLIST h3
+  %attrs;
+  %TextAlign;
+  >
+
+<!ELEMENT h4 %Inline;>
+<!ATTLIST h4
+  %attrs;
+  %TextAlign;
+  >
+
+<!ELEMENT h5 %Inline;>
+<!ATTLIST h5
+  %attrs;
+  %TextAlign;
+  >
+
+<!ELEMENT h6 %Inline;>
+<!ATTLIST h6
+  %attrs;
+  %TextAlign;
+  >
+
+<!--=================== Lists ============================================-->
+
+<!-- Unordered list bullet styles -->
+
+<!ENTITY % ULStyle "(disc|square|circle)">
+
+<!-- Unordered list -->
+
+<!ELEMENT ul (li)+>
+<!ATTLIST ul
+  %attrs;
+  type        %ULStyle;     #IMPLIED
+  compact     (compact)     #IMPLIED
+  >
+
+<!-- Ordered list numbering style
+
+    1   arabic numbers      1, 2, 3, ...
+    a   lower alpha         a, b, c, ...
+    A   upper alpha         A, B, C, ...
+    i   lower roman         i, ii, iii, ...
+    I   upper roman         I, II, III, ...
+
+    The style is applied to the sequence number which by default
+    is reset to 1 for the first list item in an ordered list.
+-->
+<!ENTITY % OLStyle "CDATA">
+
+<!-- Ordered (numbered) list -->
+
+<!ELEMENT ol (li)+>
+<!ATTLIST ol
+  %attrs;
+  type        %OLStyle;      #IMPLIED
+  compact     (compact)      #IMPLIED
+  start       %Number;       #IMPLIED
+  >
+
+<!-- single column list (DEPRECATED) --> 
+<!ELEMENT menu (li)+>
+<!ATTLIST menu
+  %attrs;
+  compact     (compact)     #IMPLIED
+  >
+
+<!-- multiple column list (DEPRECATED) --> 
+<!ELEMENT dir (li)+>
+<!ATTLIST dir
+  %attrs;
+  compact     (compact)     #IMPLIED
+  >
+
+<!-- LIStyle is constrained to: "(%ULStyle;|%OLStyle;)" -->
+<!ENTITY % LIStyle "CDATA">
+
+<!-- list item -->
+
+<!ELEMENT li %Flow;>
+<!ATTLIST li
+  %attrs;
+  type        %LIStyle;      #IMPLIED
+  value       %Number;       #IMPLIED
+  >
+
+<!-- definition lists - dt for term, dd for its definition -->
+
+<!ELEMENT dl (dt|dd)+>
+<!ATTLIST dl
+  %attrs;
+  compact     (compact)      #IMPLIED
+  >
+
+<!ELEMENT dt %Inline;>
+<!ATTLIST dt
+  %attrs;
+  >
+
+<!ELEMENT dd %Flow;>
+<!ATTLIST dd
+  %attrs;
+  >
+
+<!--=================== Address ==========================================-->
+
+<!-- information on author -->
+
+<!ELEMENT address (#PCDATA | %inline; | %misc.inline; | p)*>
+<!ATTLIST address
+  %attrs;
+  >
+
+<!--=================== Horizontal Rule ==================================-->
+
+<!ELEMENT hr EMPTY>
+<!ATTLIST hr
+  %attrs;
+  align       (left|center|right) #IMPLIED
+  noshade     (noshade)      #IMPLIED
+  size        %Pixels;       #IMPLIED
+  width       %Length;       #IMPLIED
+  >
+
+<!--=================== Preformatted Text ================================-->
+
+<!-- content is %Inline; excluding 
+        "img|object|applet|big|small|sub|sup|font|basefont" -->
+
+<!ELEMENT pre %pre.content;>
+<!ATTLIST pre
+  %attrs;
+  width       %Number;      #IMPLIED
+  xml:space   (preserve)    #FIXED 'preserve'
+  >
+
+<!--=================== Block-like Quotes ================================-->
+
+<!ELEMENT blockquote %Flow;>
+<!ATTLIST blockquote
+  %attrs;
+  cite        %URI;          #IMPLIED
+  >
+
+<!--=================== Text alignment ===================================-->
+
+<!-- center content -->
+<!ELEMENT center %Flow;>
+<!ATTLIST center
+  %attrs;
+  >
+
+<!--=================== Inserted/Deleted Text ============================-->
+
+<!--
+  ins/del are allowed in block and inline content, but its
+  inappropriate to include block content within an ins element
+  occurring in inline content.
+-->
+<!ELEMENT ins %Flow;>
+<!ATTLIST ins
+  %attrs;
+  cite        %URI;          #IMPLIED
+  datetime    %Datetime;     #IMPLIED
+  >
+
+<!ELEMENT del %Flow;>
+<!ATTLIST del
+  %attrs;
+  cite        %URI;          #IMPLIED
+  datetime    %Datetime;     #IMPLIED
+  >
+
+<!--================== The Anchor Element ================================-->
+
+<!-- content is %Inline; except that anchors shouldn't be nested -->
+
+<!ELEMENT a %a.content;>
+<!ATTLIST a
+  %attrs;
+  %focus;
+  charset     %Charset;      #IMPLIED
+  type        %ContentType;  #IMPLIED
+  name        NMTOKEN        #IMPLIED
+  href        %URI;          #IMPLIED
+  hreflang    %LanguageCode; #IMPLIED
+  rel         %LinkTypes;    #IMPLIED
+  rev         %LinkTypes;    #IMPLIED
+  shape       %Shape;        "rect"
+  coords      %Coords;       #IMPLIED
+  target      %FrameTarget;  #IMPLIED
+  >
+
+<!--===================== Inline Elements ================================-->
+
+<!ELEMENT span %Inline;> <!-- generic language/style container -->
+<!ATTLIST span
+  %attrs;
+  >
+
+<!ELEMENT bdo %Inline;>  <!-- I18N BiDi over-ride -->
+<!ATTLIST bdo
+  %coreattrs;
+  %events;
+  lang        %LanguageCode; #IMPLIED
+  xml:lang    %LanguageCode; #IMPLIED
+  dir         (ltr|rtl)      #REQUIRED
+  >
+
+<!ELEMENT br EMPTY>   <!-- forced line break -->
+<!ATTLIST br
+  %coreattrs;
+  clear       (left|all|right|none) "none"
+  >
+
+<!ELEMENT em %Inline;>   <!-- emphasis -->
+<!ATTLIST em %attrs;>
+
+<!ELEMENT strong %Inline;>   <!-- strong emphasis -->
+<!ATTLIST strong %attrs;>
+
+<!ELEMENT dfn %Inline;>   <!-- definitional -->
+<!ATTLIST dfn %attrs;>
+
+<!ELEMENT code %Inline;>   <!-- program code -->
+<!ATTLIST code %attrs;>
+
+<!ELEMENT samp %Inline;>   <!-- sample -->
+<!ATTLIST samp %attrs;>
+
+<!ELEMENT kbd %Inline;>  <!-- something user would type -->
+<!ATTLIST kbd %attrs;>
+
+<!ELEMENT var %Inline;>   <!-- variable -->
+<!ATTLIST var %attrs;>
+
+<!ELEMENT cite %Inline;>   <!-- citation -->
+<!ATTLIST cite %attrs;>
+
+<!ELEMENT abbr %Inline;>   <!-- abbreviation -->
+<!ATTLIST abbr %attrs;>
+
+<!ELEMENT acronym %Inline;>   <!-- acronym -->
+<!ATTLIST acronym %attrs;>
+
+<!ELEMENT q %Inline;>   <!-- inlined quote -->
+<!ATTLIST q
+  %attrs;
+  cite        %URI;          #IMPLIED
+  >
+
+<!ELEMENT sub %Inline;> <!-- subscript -->
+<!ATTLIST sub %attrs;>
+
+<!ELEMENT sup %Inline;> <!-- superscript -->
+<!ATTLIST sup %attrs;>
+
+<!ELEMENT tt %Inline;>   <!-- fixed pitch font -->
+<!ATTLIST tt %attrs;>
+
+<!ELEMENT i %Inline;>   <!-- italic font -->
+<!ATTLIST i %attrs;>
+
+<!ELEMENT b %Inline;>   <!-- bold font -->
+<!ATTLIST b %attrs;>
+
+<!ELEMENT big %Inline;>   <!-- bigger font -->
+<!ATTLIST big %attrs;>
+
+<!ELEMENT small %Inline;>   <!-- smaller font -->
+<!ATTLIST small %attrs;>
+
+<!ELEMENT u %Inline;>   <!-- underline -->
+<!ATTLIST u %attrs;>
+
+<!ELEMENT s %Inline;>   <!-- strike-through -->
+<!ATTLIST s %attrs;>
+
+<!ELEMENT strike %Inline;>   <!-- strike-through -->
+<!ATTLIST strike %attrs;>
+
+<!ELEMENT basefont EMPTY>  <!-- base font size -->
+<!ATTLIST basefont
+  id          ID             #IMPLIED
+  size        CDATA          #REQUIRED
+  color       %Color;        #IMPLIED
+  face        CDATA          #IMPLIED
+  >
+
+<!ELEMENT font %Inline;> <!-- local change to font -->
+<!ATTLIST font
+  %coreattrs;
+  %i18n;
+  size        CDATA          #IMPLIED
+  color       %Color;        #IMPLIED
+  face        CDATA          #IMPLIED
+  >
+
+<!--==================== Object ======================================-->
+<!--
+  object is used to embed objects as part of HTML pages.
+  param elements should precede other content. Parameters
+  can also be expressed as attribute/value pairs on the
+  object element itself when brevity is desired.
+-->
+
+<!ELEMENT object (#PCDATA | param | %block; | form | %inline; | %misc;)*>
+<!ATTLIST object
+  %attrs;
+  declare     (declare)      #IMPLIED
+  classid     %URI;          #IMPLIED
+  codebase    %URI;          #IMPLIED
+  data        %URI;          #IMPLIED
+  type        %ContentType;  #IMPLIED
+  codetype    %ContentType;  #IMPLIED
+  archive     %UriList;      #IMPLIED
+  standby     %Text;         #IMPLIED
+  height      %Length;       #IMPLIED
+  width       %Length;       #IMPLIED
+  usemap      %URI;          #IMPLIED
+  name        NMTOKEN        #IMPLIED
+  tabindex    %Number;       #IMPLIED
+  align       %ImgAlign;     #IMPLIED
+  border      %Pixels;       #IMPLIED
+  hspace      %Pixels;       #IMPLIED
+  vspace      %Pixels;       #IMPLIED
+  >
+
+<!--
+  param is used to supply a named property value.
+  In XML it would seem natural to follow RDF and support an
+  abbreviated syntax where the param elements are replaced
+  by attribute value pairs on the object start tag.
+-->
+<!ELEMENT param EMPTY>
+<!ATTLIST param
+  id          ID             #IMPLIED
+  name        CDATA          #REQUIRED
+  value       CDATA          #IMPLIED
+  valuetype   (data|ref|object) "data"
+  type        %ContentType;  #IMPLIED
+  >
+
+<!--=================== Java applet ==================================-->
+<!--
+  One of code or object attributes must be present.
+  Place param elements before other content.
+-->
+<!ELEMENT applet (#PCDATA | param | %block; | form | %inline; | %misc;)*>
+<!ATTLIST applet
+  %coreattrs;
+  codebase    %URI;          #IMPLIED
+  archive     CDATA          #IMPLIED
+  code        CDATA          #IMPLIED
+  object      CDATA          #IMPLIED
+  alt         %Text;         #IMPLIED
+  name        NMTOKEN        #IMPLIED
+  width       %Length;       #REQUIRED
+  height      %Length;       #REQUIRED
+  align       %ImgAlign;     #IMPLIED
+  hspace      %Pixels;       #IMPLIED
+  vspace      %Pixels;       #IMPLIED
+  >
+
+<!--=================== Images ===========================================-->
+
+<!--
+   To avoid accessibility problems for people who aren't
+   able to see the image, you should provide a text
+   description using the alt and longdesc attributes.
+   In addition, avoid the use of server-side image maps.
+-->
+
+<!ELEMENT img EMPTY>
+<!ATTLIST img
+  %attrs;
+  src         %URI;          #REQUIRED
+  alt         %Text;         #REQUIRED
+  name        NMTOKEN        #IMPLIED
+  longdesc    %URI;          #IMPLIED
+  height      %Length;       #IMPLIED
+  width       %Length;       #IMPLIED
+  usemap      %URI;          #IMPLIED
+  ismap       (ismap)        #IMPLIED
+  align       %ImgAlign;     #IMPLIED
+  border      %Length;       #IMPLIED
+  hspace      %Pixels;       #IMPLIED
+  vspace      %Pixels;       #IMPLIED
+  >
+
+<!-- usemap points to a map element which may be in this document
+  or an external document, although the latter is not widely supported -->
+
+<!--================== Client-side image maps ============================-->
+
+<!-- These can be placed in the same document or grouped in a
+     separate document although this isn't yet widely supported -->
+
+<!ELEMENT map ((%block; | form | %misc;)+ | area+)>
+<!ATTLIST map
+  %i18n;
+  %events;
+  id          ID             #REQUIRED
+  class       CDATA          #IMPLIED
+  style       %StyleSheet;   #IMPLIED
+  title       %Text;         #IMPLIED
+  name        CDATA          #IMPLIED
+  >
+
+<!ELEMENT area EMPTY>
+<!ATTLIST area
+  %attrs;
+  %focus;
+  shape       %Shape;        "rect"
+  coords      %Coords;       #IMPLIED
+  href        %URI;          #IMPLIED
+  nohref      (nohref)       #IMPLIED
+  alt         %Text;         #REQUIRED
+  target      %FrameTarget;  #IMPLIED
+  >
+
+<!--================ Forms ===============================================-->
+
+<!ELEMENT form %form.content;>   <!-- forms shouldn't be nested -->
+
+<!ATTLIST form
+  %attrs;
+  action      %URI;          #REQUIRED
+  method      (get|post)     "get"
+  name        NMTOKEN        #IMPLIED
+  enctype     %ContentType;  "application/x-www-form-urlencoded"
+  onsubmit    %Script;       #IMPLIED
+  onreset     %Script;       #IMPLIED
+  accept      %ContentTypes; #IMPLIED
+  accept-charset %Charsets;  #IMPLIED
+  target      %FrameTarget;  #IMPLIED
+  >
+
+<!--
+  Each label must not contain more than ONE field
+  Label elements shouldn't be nested.
+-->
+<!ELEMENT label %Inline;>
+<!ATTLIST label
+  %attrs;
+  for         IDREF          #IMPLIED
+  accesskey   %Character;    #IMPLIED
+  onfocus     %Script;       #IMPLIED
+  onblur      %Script;       #IMPLIED
+  >
+
+<!ENTITY % InputType
+  "(text | password | checkbox |
+    radio | submit | reset |
+    file | hidden | image | button)"
+   >
+
+<!-- the name attribute is required for all but submit & reset -->
+
+<!ELEMENT input EMPTY>     <!-- form control -->
+<!ATTLIST input
+  %attrs;
+  %focus;
+  type        %InputType;    "text"
+  name        CDATA          #IMPLIED
+  value       CDATA          #IMPLIED
+  checked     (checked)      #IMPLIED
+  disabled    (disabled)     #IMPLIED
+  readonly    (readonly)     #IMPLIED
+  size        CDATA          #IMPLIED
+  maxlength   %Number;       #IMPLIED
+  src         %URI;          #IMPLIED
+  alt         CDATA          #IMPLIED
+  usemap      %URI;          #IMPLIED
+  onselect    %Script;       #IMPLIED
+  onchange    %Script;       #IMPLIED
+  accept      %ContentTypes; #IMPLIED
+  align       %ImgAlign;     #IMPLIED
+  >
+
+<!ELEMENT select (optgroup|option)+>  <!-- option selector -->
+<!ATTLIST select
+  %attrs;
+  name        CDATA          #IMPLIED
+  size        %Number;       #IMPLIED
+  multiple    (multiple)     #IMPLIED
+  disabled    (disabled)     #IMPLIED
+  tabindex    %Number;       #IMPLIED
+  onfocus     %Script;       #IMPLIED
+  onblur      %Script;       #IMPLIED
+  onchange    %Script;       #IMPLIED
+  >
+
+<!ELEMENT optgroup (option)+>   <!-- option group -->
+<!ATTLIST optgroup
+  %attrs;
+  disabled    (disabled)     #IMPLIED
+  label       %Text;         #REQUIRED
+  >
+
+<!ELEMENT option (#PCDATA)>     <!-- selectable choice -->
+<!ATTLIST option
+  %attrs;
+  selected    (selected)     #IMPLIED
+  disabled    (disabled)     #IMPLIED
+  label       %Text;         #IMPLIED
+  value       CDATA          #IMPLIED
+  >
+
+<!ELEMENT textarea (#PCDATA)>     <!-- multi-line text field -->
+<!ATTLIST textarea
+  %attrs;
+  %focus;
+  name        CDATA          #IMPLIED
+  rows        %Number;       #REQUIRED
+  cols        %Number;       #REQUIRED
+  disabled    (disabled)     #IMPLIED
+  readonly    (readonly)     #IMPLIED
+  onselect    %Script;       #IMPLIED
+  onchange    %Script;       #IMPLIED
+  >
+
+<!--
+  The fieldset element is used to group form fields.
+  Only one legend element should occur in the content
+  and if present should only be preceded by whitespace.
+-->
+<!ELEMENT fieldset (#PCDATA | legend | %block; | form | %inline; | %misc;)*>
+<!ATTLIST fieldset
+  %attrs;
+  >
+
+<!ENTITY % LAlign "(top|bottom|left|right)">
+
+<!ELEMENT legend %Inline;>     <!-- fieldset label -->
+<!ATTLIST legend
+  %attrs;
+  accesskey   %Character;    #IMPLIED
+  align       %LAlign;       #IMPLIED
+  >
+
+<!--
+ Content is %Flow; excluding a, form, form controls, iframe
+--> 
+<!ELEMENT button %button.content;>  <!-- push button -->
+<!ATTLIST button
+  %attrs;
+  %focus;
+  name        CDATA          #IMPLIED
+  value       CDATA          #IMPLIED
+  type        (button|submit|reset) "submit"
+  disabled    (disabled)     #IMPLIED
+  >
+
+<!-- single-line text input control (DEPRECATED) -->
+<!ELEMENT isindex EMPTY>
+<!ATTLIST isindex
+  %coreattrs;
+  %i18n;
+  prompt      %Text;         #IMPLIED
+  >
+
+<!--======================= Tables =======================================-->
+
+<!-- Derived from IETF HTML table standard, see [RFC1942] -->
+
+<!--
+ The border attribute sets the thickness of the frame around the
+ table. The default units are screen pixels.
+
+ The frame attribute specifies which parts of the frame around
+ the table should be rendered. The values are not the same as
+ CALS to avoid a name clash with the valign attribute.
+-->
+<!ENTITY % TFrame "(void|above|below|hsides|lhs|rhs|vsides|box|border)">
+
+<!--
+ The rules attribute defines which rules to draw between cells:
+
+ If rules is absent then assume:
+     "none" if border is absent or border="0" otherwise "all"
+-->
+
+<!ENTITY % TRules "(none | groups | rows | cols | all)">
+  
+<!-- horizontal placement of table relative to document -->
+<!ENTITY % TAlign "(left|center|right)">
+
+<!-- horizontal alignment attributes for cell contents
+
+  char        alignment char, e.g. char=':'
+  charoff     offset for alignment char
+-->
+<!ENTITY % cellhalign
+  "align      (left|center|right|justify|char) #IMPLIED
+   char       %Character;    #IMPLIED
+   charoff    %Length;       #IMPLIED"
+  >
+
+<!-- vertical alignment attributes for cell contents -->
+<!ENTITY % cellvalign
+  "valign     (top|middle|bottom|baseline) #IMPLIED"
+  >
+
+<!ELEMENT table
+     (caption?, (col*|colgroup*), thead?, tfoot?, (tbody+|tr+))>
+<!ELEMENT caption  %Inline;>
+<!ELEMENT thead    (tr)+>
+<!ELEMENT tfoot    (tr)+>
+<!ELEMENT tbody    (tr)+>
+<!ELEMENT colgroup (col)*>
+<!ELEMENT col      EMPTY>
+<!ELEMENT tr       (th|td)+>
+<!ELEMENT th       %Flow;>
+<!ELEMENT td       %Flow;>
+
+<!ATTLIST table
+  %attrs;
+  summary     %Text;         #IMPLIED
+  width       %Length;       #IMPLIED
+  border      %Pixels;       #IMPLIED
+  frame       %TFrame;       #IMPLIED
+  rules       %TRules;       #IMPLIED
+  cellspacing %Length;       #IMPLIED
+  cellpadding %Length;       #IMPLIED
+  align       %TAlign;       #IMPLIED
+  bgcolor     %Color;        #IMPLIED
+  >
+
+<!ENTITY % CAlign "(top|bottom|left|right)">
+
+<!ATTLIST caption
+  %attrs;
+  align       %CAlign;       #IMPLIED
+  >
+
+<!--
+colgroup groups a set of col elements. It allows you to group
+several semantically related columns together.
+-->
+<!ATTLIST colgroup
+  %attrs;
+  span        %Number;       "1"
+  width       %MultiLength;  #IMPLIED
+  %cellhalign;
+  %cellvalign;
+  >
+
+<!--
+ col elements define the alignment properties for cells in
+ one or more columns.
+
+ The width attribute specifies the width of the columns, e.g.
+
+     width=64        width in screen pixels
+     width=0.5*      relative width of 0.5
+
+ The span attribute causes the attributes of one
+ col element to apply to more than one column.
+-->
+<!ATTLIST col
+  %attrs;
+  span        %Number;       "1"
+  width       %MultiLength;  #IMPLIED
+  %cellhalign;
+  %cellvalign;
+  >
+
+<!--
+    Use thead to duplicate headers when breaking table
+    across page boundaries, or for static headers when
+    tbody sections are rendered in scrolling panel.
+
+    Use tfoot to duplicate footers when breaking table
+    across page boundaries, or for static footers when
+    tbody sections are rendered in scrolling panel.
+
+    Use multiple tbody sections when rules are needed
+    between groups of table rows.
+-->
+<!ATTLIST thead
+  %attrs;
+  %cellhalign;
+  %cellvalign;
+  >
+
+<!ATTLIST tfoot
+  %attrs;
+  %cellhalign;
+  %cellvalign;
+  >
+
+<!ATTLIST tbody
+  %attrs;
+  %cellhalign;
+  %cellvalign;
+  >
+
+<!ATTLIST tr
+  %attrs;
+  %cellhalign;
+  %cellvalign;
+  bgcolor     %Color;        #IMPLIED
+  >
+
+<!-- Scope is simpler than headers attribute for common tables -->
+<!ENTITY % Scope "(row|col|rowgroup|colgroup)">
+
+<!-- th is for headers, td for data and for cells acting as both -->
+
+<!ATTLIST th
+  %attrs;
+  abbr        %Text;         #IMPLIED
+  axis        CDATA          #IMPLIED
+  headers     IDREFS         #IMPLIED
+  scope       %Scope;        #IMPLIED
+  rowspan     %Number;       "1"
+  colspan     %Number;       "1"
+  %cellhalign;
+  %cellvalign;
+  nowrap      (nowrap)       #IMPLIED
+  bgcolor     %Color;        #IMPLIED
+  width       %Length;       #IMPLIED
+  height      %Length;       #IMPLIED
+  >
+
+<!ATTLIST td
+  %attrs;
+  abbr        %Text;         #IMPLIED
+  axis        CDATA          #IMPLIED
+  headers     IDREFS         #IMPLIED
+  scope       %Scope;        #IMPLIED
+  rowspan     %Number;       "1"
+  colspan     %Number;       "1"
+  %cellhalign;
+  %cellvalign;
+  nowrap      (nowrap)       #IMPLIED
+  bgcolor     %Color;        #IMPLIED
+  width       %Length;       #IMPLIED
+  height      %Length;       #IMPLIED
+  >
+

--- libraries/htmlpurifier/docs/enduser-customize.html ---
@@ -0,0 +1,850 @@
+<?xml version="1.0" encoding="UTF-8"?>
+<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
+    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
+<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"><head>
+<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
+<meta name="description" content="Tutorial for customizing HTML Purifier's tag and attribute sets." />
+<link rel="stylesheet" type="text/css" href="style.css" />
+
+<title>Customize - HTML Purifier</title>
+
+</head><body>
+
+<h1 class="subtitled">Customize!</h1>
+<div class="subtitle">HTML Purifier is a Swiss-Army Knife</div>
+
+<div id="filing">Filed under End-User</div>
+<div id="index">Return to the <a href="index.html">index</a>.</div>
+<div id="home"><a href="http://htmlpurifier.org/">HTML Purifier</a> End-User Documentation</div>
+
+<p>
+  HTML Purifier has this quirk where if you try to allow certain elements or
+  attributes, HTML Purifier will tell you that it's not supported, and that
+  you should go to the forums to find out how to implement it. Well, this
+  document is how to implement elements and attributes which HTML Purifier
+  doesn't support out of the box.
+</p>
+
+<h2>Is it necessary?</h2>
+
+<p>
+  Before we even write any code, it is paramount to consider whether or
+  not the code we're writing is necessary or not. HTML Purifier, by default,
+  contains a large set of elements and attributes: large enough so that
+  <em>any</em> element or attribute in XHTML 1.0 or 1.1 (and its HTML variants)
+  that can be safely used by the general public is implemented.
+</p>
+
+<p>
+  So what needs to be implemented? (Feel free to skip this section if
+  you know what you want).
+</p>
+
+<h3>XHTML 1.0</h3>
+
+<p>
+  All of the modules listed below are based off of the
+  <a href="http://www.w3.org/TR/2001/REC-xhtml-modularization-20010410/abstract_modules.html#sec_5.2.">modularization of
+  XHTML</a>, which, while technically for XHTML 1.1, is quite a useful
+  resource.
+</p>
+
+<ul>
+  <li>Structure</li>
+  <li>Frames</li>
+  <li>Applets (deprecated)</li>
+  <li>Forms</li>
+  <li>Image maps</li>
+  <li>Objects</li>
+  <li>Frames</li>
+  <li>Events</li>
+  <li>Meta-information</li>
+  <li>Style sheets</li>
+  <li>Link (not hypertext)</li>
+  <li>Base</li>
+  <li>Name</li>
+</ul>
+
+<p>
+  If you don't recognize it, you probably don't need it. But the curious
+  can look all of these modules up in the above-mentioned document.  Note
+  that inline scripting comes packaged with HTML Purifier (more on this
+  later).
+</p>
+
+<h3>XHTML 1.1</h3>
+
+<p>
+  As of HTMLPurifier 2.1.0, we have implemented the
+  <a href="http://www.w3.org/TR/2001/REC-ruby-20010531/">Ruby module</a>,
+  which defines a set of tags
+  for publishing short annotations for text, used mostly in Japanese
+  and Chinese school texts, but applicable for positioning any text (not
+  limited to translations) above or below other corresponding text.
+</p>
+
+<h3>HTML 5</h3>
+
+<p>
+  <a href="http://www.whatwg.org/specs/web-apps/current-work/">HTML 5</a>
+  is a fork of HTML 4.01 by WHATWG, who believed that XHTML 2.0 was headed
+  in the wrong direction.  It too is a working draft, and may change
+  drastically before publication, but it should be noted that the
+  <code>canvas</code> tag has been implemented by many browser vendors.
+</p>
+
+<h3>Proprietary</h3>
+
+<p>
+  There are a number of proprietary tags still in the wild. Many of them
+  have been documented in <a href="ref-proprietary-tags.txt">ref-proprietary-tags.txt</a>,
+  but there is currently no implementation for any of them.
+</p>
+
+<h3>Extensions</h3>
+
+<p>
+  There are also a number of other XML languages out there that can
+  be embedded in HTML documents: two of the most popular are MathML and
+  SVG, and I frequently get requests to implement these.  But they are
+  expansive, comprehensive specifications, and it would take far too long
+  to implement them <em>correctly</em> (most systems I've seen go as far
+  as whitelisting tags and no further; come on, what about nesting!)
+</p>
+
+<p>
+  Word of warning: HTML Purifier is currently <em>not</em> namespace
+  aware.
+</p>
+
+<h2>Giving back</h2>
+
+<p>
+  As you may imagine from the details above (don't be abashed if you didn't
+  read it all: a glance over would have done), there's quite a bit that
+  HTML Purifier doesn't implement.  Recent architectural changes have
+  allowed HTML Purifier to implement elements and attributes that are not
+  safe!  Don't worry, they won't be activated unless you set %HTML.Trusted
+  to true, but they certainly help out users who need to put, say, forms
+  on their page and don't want to go through the trouble of reading this
+  and implementing it themself.
+</p>
+
+<p>
+  So any of the above that you implement for your own application could
+  help out some other poor sap on the other side of the globe.  Help us
+  out, and send back code so that it can be hammered into a module and
+  released with the core.  Any code would be greatly appreciated!
+</p>
+
+<h2>And now...</h2>
+
+<p>
+  Enough philosophical talk, time for some code:
+</p>
+
+<pre>$config = HTMLPurifier_Config::createDefault();
+$config-&gt;set('HTML.DefinitionID', 'enduser-customize.html tutorial');
+$config-&gt;set('HTML.DefinitionRev', 1);
+if ($def = $config-&gt;maybeGetRawHTMLDefinition()) {
+    // our code will go here
+}</pre>
+
+<p>
+  Assuming that HTML Purifier has already been properly loaded (hint:
+  include <code>HTMLPurifier.auto.php</code>), this code will set up
+  the environment that you need to start customizing the HTML definition.
+  What's going on?
+</p>
+
+<ul>
+  <li>
+    The first three lines are regular configuration code:
+    <ul>
+      <li>
+        %HTML.DefinitionID is set to a unique identifier for your
+        custom HTML definition.  This prevents it from clobbering
+        other custom definitions on the same installation.
+      </li>
+      <li>
+        %HTML.DefinitionRev is a revision integer of your HTML
+        definition.  Because HTML definitions are cached, you'll need
+        to increment this whenever you make a change in order to flush
+        the cache.
+      </li>
+    </ul>
+  </li>
+  <li>
+    The fourth line retrieves a raw <code>HTMLPurifier_HTMLDefinition</code>
+    object that we will be tweaking.  Interestingly enough, we have
+    placed it in an if block: this is because
+    <code>maybeGetRawHTMLDefinition</code>, as its name suggests, may
+    return a NULL, in which case we should skip doing any
+    initialization.  This, in fact, will correspond to when our fully
+    customized object is already in the cache.
+  </li>
+</ul>
+
+<h2>Turn off caching</h2>
+
+<p>
+  To make development easier, we're going to temporarily turn off
+  definition caching:
+</p>
+
+<pre>$config = HTMLPurifier_Config::createDefault();
+$config-&gt;set('HTML.DefinitionID', 'enduser-customize.html tutorial');
+$config-&gt;set('HTML.DefinitionRev', 1);
+<strong>$config-&gt;set('Cache.DefinitionImpl', null); // TODO: remove this later!</strong>
+$def = $config-&gt;getHTMLDefinition(true);</pre>
+
+<p>
+  A few things should be mentioned about the caching mechanism before
+  we move on.  For performance reasons, HTML Purifier caches generated
+  <code>HTMLPurifier_Definition</code> objects in serialized files
+  stored (by default) in <code>library/HTMLPurifier/DefinitionCache/Serializer</code>.
+  A lot of processing is done in order to create these objects, so it
+  makes little sense to repeat the same processing over and over again
+  whenever HTML Purifier is called.
+</p>
+
+<p>
+  In order to identify a cache entry, HTML Purifier uses three variables:
+  the library's version number, the value of %HTML.DefinitionRev and
+  a serial of relevant configuration.  Whenever any of these changes,
+  a new HTML definition is generated.  Notice that there is no way
+  for the definition object to track changes to customizations: here, it
+  is up to you to supply appropriate information to DefinitionID and
+  DefinitionRev.
+</p>
+
+<h2 id="addAttribute">Add an attribute</h2>
+
+<p>
+  For this example, we're going to implement the <code>target</code> attribute found
+  on <code>a</code> elements.  To implement an attribute, we have to
+  ask a few questions:
+</p>
+
+<ol>
+  <li>What element is it found on?</li>
+  <li>What is its name?</li>
+  <li>Is it required or optional?</li>
+  <li>What are valid values for it?</li>
+</ol>
+
+<p>
+  The first three are easy: the element is <code>a</code>, the attribute
+  is <code>target</code>, and it is not a required attribute. (If it
+  was required, we'd need to append an asterisk to the attribute name,
+  you'll see an example of this in the addElement() example).
+</p>
+
+<p>
+  The last question is a little trickier.
+  Lets allow the special values: _blank, _self, _target and _top.
+  The form of this is called an <strong>enumeration</strong>, a list of
+  valid values, although only one can be used at a time.  To translate
+  this into code form, we write:
+</p>
+
+<pre>$config = HTMLPurifier_Config::createDefault();
+$config-&gt;set('HTML.DefinitionID', 'enduser-customize.html tutorial');
+$config-&gt;set('HTML.DefinitionRev', 1);
+$config-&gt;set('Cache.DefinitionImpl', null); // remove this later!
+$def = $config-&gt;getHTMLDefinition(true);
+<strong>$def->addAttribute('a', 'target', 'Enum#_blank,_self,_target,_top');</strong></pre>
+
+<p>
+  The <code>Enum#_blank,_self,_target,_top</code> does all the magic.
+  The string is split into two parts, separated by a hash mark (#):
+</p>
+
+<ol>
+  <li>The first part is the name of what we call an <code>AttrDef</code></li>
+  <li>The second part is the parameter of the above-mentioned <code>AttrDef</code></li>
+</ol>
+
+<p>
+  If that sounds vague and generic, it's because it is!  HTML Purifier defines
+  an assortment of different attribute types one can use, and each of these
+  has their own specialized parameter format.  Here are some of the more useful
+  ones:
+</p>
+
+<table class="table">
+  <thead>
+    <tr>
+      <th>Type</th>
+      <th>Format</th>
+      <th>Description</th>
+    </tr>
+  </thead>
+  <tbody>
+    <tr>
+      <th>Enum</th>
+      <td><em>[s:]</em>value1,value2,...</td>
+      <td>
+        Attribute with a number of valid values, one of which may be used. When
+        s: is present, the enumeration is case sensitive.
+      </td>
+    </tr>
+    <tr>
+      <th>Bool</th>
+      <td>attribute_name</td>
+      <td>
+        Boolean attribute, with only one valid value: the name
+        of the attribute.
+      </td>
+    </tr>
+    <tr>
+      <th>CDATA</th>
+      <td></td>
+      <td>
+        Attribute of arbitrary text. Can also be referred to as <strong>Text</strong>
+        (the specification makes a semantic distinction between the two).
+      </td>
+    </tr>
+    <tr>
+      <th>ID</th>
+      <td></td>
+      <td>
+        Attribute that specifies a unique ID
+      </td>
+    </tr>
+    <tr>
+      <th>Pixels</th>
+      <td></td>
+      <td>
+        Attribute that specifies an integer pixel length
+      </td>
+    </tr>
+    <tr>
+      <th>Length</th>
+      <td></td>
+      <td>
+        Attribute that specifies a pixel or percentage length
+      </td>
+    </tr>
+    <tr>
+      <th>NMTOKENS</th>
+      <td></td>
+      <td>
+        Attribute that specifies a number of name tokens, example: the
+        <code>class</code> attribute
+      </td>
+    </tr>
+    <tr>
+      <th>URI</th>
+      <td></td>
+      <td>
+        Attribute that specifies a URI, example: the <code>href</code>
+        attribute
+      </td>
+    </tr>
+    <tr>
+      <th>Number</th>
+      <td></td>
+      <td>
+        Attribute that specifies an positive integer number
+      </td>
+    </tr>
+  </tbody>
+</table>
+
+<p>
+  For a complete list, consult
+  <a href="http://repo.or.cz/w/htmlpurifier.git?a=blob;hb=HEAD;f=library/HTMLPurifier/AttrTypes.php"><code>library/HTMLPurifier/AttrTypes.php</code></a>;
+  more information on attributes that accept parameters can be found on their
+  respective includes in
+  <a href="http://repo.or.cz/w/htmlpurifier.git?a=tree;hb=HEAD;f=library/HTMLPurifier/AttrDef"><code>library/HTMLPurifier/AttrDef</code></a>.
+</p>
+
+<p>
+  Sometimes, the restrictive list in AttrTypes just doesn't cut it. Don't
+  sweat: you can also use a fully instantiated object as the value. The
+  equivalent, verbose form of the above example is:
+</p>
+
+<pre>$config = HTMLPurifier_Config::createDefault();
+$config-&gt;set('HTML.DefinitionID', 'enduser-customize.html tutorial');
+$config-&gt;set('HTML.DefinitionRev', 1);
+$config-&gt;set('Cache.DefinitionImpl', null); // remove this later!
+$def = $config-&gt;getHTMLDefinition(true);
+<strong>$def-&gt;addAttribute('a', 'target', new HTMLPurifier_AttrDef_Enum(
+  array('_blank','_self','_target','_top')
+));</strong></pre>
+
+<p>
+  Trust me, you'll learn to love the shorthand.
+</p>
+
+<h2>Add an element</h2>
+
+<p>
+  Adding attributes is really small-fry stuff, though, and it was possible
+  to add them (albeit a bit more wordy) prior to 2.0. The real gem of
+  the Advanced API is adding elements. There are five questions to
+  ask when adding a new element:
+</p>
+
+<ol>
+  <li>What is the element's name?</li>
+  <li>What content set does this element belong to?</li>
+  <li>What are the allowed children of this element?</li>
+  <li>What attributes does the element allow that are general?</li>
+  <li>What attributes does the element allow that are specific to this element?</li>
+</ol>
+
+<p>
+  It's a mouthful, and you'll be slightly lost if your not familiar with
+  the HTML specification, so let's explain them step by step.
+</p>
+
+<h3>Content set</h3>
+
+<p>
+  The HTML specification defines two major content sets: Inline
+  and Block.  Each of these
+  content sets contain a list of elements: Inline contains things like
+  <code>span</code> and <code>b</code> while Block contains things like
+  <code>div</code> and <code>blockquote</code>.
+</p>
+
+<p>
+  These content sets amount to a macro mechanism for HTML definition. Most
+  elements in HTML are organized into one of these two sets, and most
+  elements in HTML allow elements from one of these sets.  If we had
+  to write each element verbatim into each other element's allowed
+  children, we would have ridiculously large lists; instead we use
+  content sets to compactify the declaration.
+</p>
+
+<p>
+  Practically speaking, there are several useful values you can use here:
+</p>
+
+<table class="table">
+  <thead>
+    <tr>
+      <th>Content set</th>
+      <th>Description</th>
+    </tr>
+  </thead>
+  <tbody>
+    <tr>
+      <th>Inline</th>
+      <td>Character level elements, text</td>
+    </tr>
+    <tr>
+      <th>Block</th>
+      <td>Block-like elements, like paragraphs and lists</td>
+    </tr>
+    <tr>
+      <th><em>false</em></th>
+      <td>
+        Any element that doesn't fit into the mold, for example <code>li</code>
+        or <code>tr</code>
+      </td>
+    </tr>
+  </tbody>
+</table>
+
+<p>
+  By specifying a valid value here, all other elements that use that
+  content set will also allow your element, without you having to do
+  anything. If you specify <em>false</em>, you'll have to register
+  your element manually.
+</p>
+
+<h3>Allowed children</h3>
+
+<p>
+  Allowed children defines the elements that this element can contain.
+  The allowed values may range from none to a complex regexp depending on
+  your element.
+</p>
+
+<p>
+  If you've ever taken a look at the HTML DTD's before, you may have
+  noticed declarations like this:
+</p>
+
+<pre>&lt;!ELEMENT LI - O (%flow;)*             -- list item --&gt;</pre>
+
+<p>
+  The <code>(%flow;)*</code> indicates the allowed children of the
+  <code>li</code> tag: <code>li</code> allows any number of flow
+  elements as its children. (The <code>- O</code> allows the closing tag to be
+  omitted, though in XML this is not allowed.) In HTML Purifier,
+  we'd write it like <code>Flow</code> (here's where the content sets
+  we were discussing earlier come into play). There are three shorthand
+  content models you can specify:
+</p>
+
+<table class="table">
+  <thead>
+    <tr>
+      <th>Content model</th>
+      <th>Description</th>
+    </tr>
+  </thead>
+  <tbody>
+    <tr>
+      <th>Empty</th>
+      <td>No children allowed, like <code>br</code> or <code>hr</code></td>
+    </tr>
+    <tr>
+      <th>Inline</th>
+      <td>Any number of inline elements and text, like <code>span</code></td>
+    </tr>
+    <tr>
+      <th>Flow</th>
+      <td>Any number of inline elements, block elements and text, like <code>div</code></td>
+    </tr>
+  </tbody>
+</table>
+
+<p>
+  This covers 90% of all the cases out there, but what about elements that
+  break the mold like <code>ul</code>? This guy requires at least one
+  child, and the only valid children for it are <code>li</code>. The
+  content model is: <code>Required: li</code>. There are two parts: the
+  first type determines what <code>ChildDef</code> will be used to validate
+  content models. The most common values are:
+</p>
+
+<table class="table">
+  <thead>
+    <tr>
+      <th>Type</th>
+      <th>Description</th>
+    </tr>
+  </thead>
+  <tbody>
+    <tr>
+      <th>Required</th>
+      <td>Children must be one or more of the valid elements</td>
+    </tr>
+    <tr>
+      <th>Optional</th>
+      <td>Children can be any number of the valid elements</td>
+    </tr>
+    <tr>
+      <th>Custom</th>
+      <td>Children must follow the DTD-style regex</td>
+    </tr>
+  </tbody>
+</table>
+
+<p>
+  You can also implement your own <code>ChildDef</code>: this was done
+  for a few special cases in HTML Purifier such as <code>Chameleon</code>
+  (for <code>ins</code> and <code>del</code>), <code>StrictBlockquote</code>
+  and <code>Table</code>.
+</p>
+
+<p>
+  The second part specifies either valid elements or a regular expression.
+  Valid elements are separated with horizontal bars (|), i.e.
+  "<code>a | b | c</code>".  Use #PCDATA to represent plain text.
+  Regular expressions are based off of DTD's style:
+</p>
+
+<ul>
+  <li>Parentheses () are used for grouping</li>
+  <li>Commas (,) separate elements that should come one after another</li>
+  <li>Horizontal bars (|) indicate one or the other elements should be used</li>
+  <li>Plus signs (+) are used for a one or more match</li>
+  <li>Asterisks (*) are used for a zero or more match</li>
+  <li>Question marks (?) are used for a zero or one match</li>
+</ul>
+
+<p>
+  For example, "<code>a, b?, (c | d), e+, f*</code>" means "In this order,
+  one <code>a</code> element, at most one <code>b</code> element,
+  one <code>c</code> or <code>d</code> element (but not both), one or more
+  <code>e</code> elements, and any number of <code>f</code> elements."
+  Regex veterans should be able to jump right in, and those not so savvy
+  can always copy-paste W3C's content model definitions into HTML Purifier
+  and hope for the best.
+</p>
+
+<p>
+  A word of warning: while the regex format is extremely flexible on
+  the developer's side, it is
+  quite unforgiving on the user's side.  If the user input does not <em>exactly</em>
+  match the specification, the entire contents of the element will
+  be nuked.  This is why there is are specific content model types like
+  Optional and Required: while they could be implemented as <code>Custom:
+  (valid | elements)*</code>, the custom classes contain special recovery
+  measures that make sure as much of the user's original content gets
+  through. HTML Purifier's core, as a rule, does not use Custom.
+</p>
+
+<p>
+  One final note: you can also use Content Sets inside your valid elements
+  lists or regular expressions. In fact, the three shorthand content models
+  mentioned above are just that: abbreviations:
+</p>
+
+<table class="table">
+  <thead>
+    <tr>
+      <th>Content model</th>
+      <th>Implementation</th>
+    </tr>
+  </thead>
+  <tbody>
+    <tr>
+      <th>Inline</th>
+      <td>Optional: Inline | #PCDATA</td>
+    </tr>
+    <tr>
+      <th>Flow</th>
+      <td>Optional: Flow | #PCDATA</td>
+    </tr>
+  </tbody>
+</table>
+
+<p>
+  When the definition is compiled, Inline will be replaced with a
+  horizontal-bar separated list of inline elements. Also, notice that
+  it does not contain text: you have to specify that yourself.
+</p>
+
+<h3>Common attributes</h3>
+
+<p>
+  Congratulations: you have just gotten over the proverbial hump (Allowed
+  children). Common attributes is much simpler, and boils down to
+  one question: does your element have the <code>id</code>, <code>style</code>,
+  <code>class</code>, <code>title</code> and <code>lang</code> attributes?
+  If so, you'll want to specify the <code>Common</code> attribute collection,
+  which contains these five attributes that are found on almost every
+  HTML element in the specification.
+</p>
+
+<p>
+  There are a few more collections, but they're really edge cases:
+</p>
+
+<table class="table">
+  <thead>
+    <tr>
+      <th>Collection</th>
+      <th>Attributes</th>
+    </tr>
+  </thead>
+  <tbody>
+    <tr>
+      <th>I18N</th>
+      <td><code>lang</code>, possibly <code>xml:lang</code></td>
+    </tr>
+    <tr>
+      <th>Core</th>
+      <td><code>style</code>, <code>class</code>, <code>id</code> and <code>title</code></td>
+    </tr>
+  </tbody>
+</table>
+
+<p>
+  Common is a combination of the above-mentioned collections.
+</p>
+
+<p class="aside">
+  Readers familiar with the modularization may have noticed that the Core
+  attribute collection differs from that specified by the <a
+  href="http://www.w3.org/TR/xhtml-modularization/abstract_modules.html#s_commonatts">abstract
+  modules of the XHTML Modularization 1.1</a>. We believe this section
+  to be in error, as <code>br</code> permits the use of the <code>style</code>
+  attribute even though it uses the <code>Core</code> collection, and
+  the DTD and XML Schemas supplied by W3C support our interpretation.
+</p>
+
+<h3>Attributes</h3>
+
+<p>
+  If you didn't read the <a href="#addAttribute">earlier section on
+  adding attributes</a>, read it now.  The last parameter is simply
+  an array of attribute names to attribute implementations, in the exact
+  same format as <code>addAttribute()</code>.
+</p>
+
+<h3>Putting it all together</h3>
+
+<p>
+  We're going to implement <code>form</code>. Before we embark, lets
+  grab a reference implementation from over at the
+  <a href="http://www.w3.org/TR/html4/sgml/loosedtd.html">transitional DTD</a>:
+</p>
+
+<pre>&lt;!ELEMENT FORM - - (%flow;)* -(FORM)   -- interactive form --&gt;
+&lt;!ATTLIST FORM
+  %attrs;                              -- %coreattrs, %i18n, %events --
+  action      %URI;          #REQUIRED -- server-side form handler --
+  method      (GET|POST)     GET       -- HTTP method used to submit the form--
+  enctype     %ContentType;  &quot;application/x-www-form-urlencoded&quot;
+  accept      %ContentTypes; #IMPLIED  -- list of MIME types for file upload --
+  name        CDATA          #IMPLIED  -- name of form for scripting --
+  onsubmit    %Script;       #IMPLIED  -- the form was submitted --
+  onreset     %Script;       #IMPLIED  -- the form was reset --
+  target      %FrameTarget;  #IMPLIED  -- render in this frame --
+  accept-charset %Charsets;  #IMPLIED  -- list of supported charsets --
+  &gt;</pre>
+
+<p>
+  Juicy! With just this, we can answer four of our five questions:
+</p>
+
+<ol>
+  <li>What is the element's name? <strong>form</strong></li>
+  <li>What content set does this element belong to? <strong>Block</strong>
+    (this needs a little sleuthing, I find the easiest way is to search
+    the DTD for <code>FORM</code> and determine which set it is in.)</li>
+  <li>What are the allowed children of this element? <strong>One
+    or more flow elements, but no nested <code>form</code>s</strong></li>
+  <li>What attributes does the element allow that are general? <strong>Common</strong></li>
+  <li>What attributes does the element allow that are specific to this element? <strong>A whole bunch, see ATTLIST;
+    we're going to do the vital ones: <code>action</code>, <code>method</code> and <code>name</code></strong></li>
+</ol>
+
+<p>
+  Time for some code:
+</p>
+
+<pre>$config = HTMLPurifier_Config::createDefault();
+$config-&gt;set('HTML.DefinitionID', 'enduser-customize.html tutorial');
+$config-&gt;set('HTML.DefinitionRev', 1);
+$config-&gt;set('Cache.DefinitionImpl', null); // remove this later!
+$def = $config-&gt;getHTMLDefinition(true);
+$def-&gt;addAttribute('a', 'target', new HTMLPurifier_AttrDef_Enum(
+  array('_blank','_self','_target','_top')
+));
+<strong>$form = $def-&gt;addElement(
+  'form',   // name
+  'Block',  // content set
+  'Flow', // allowed children
+  'Common', // attribute collection
+  array( // attributes
+    'action*' => 'URI',
+    'method' => 'Enum#get|post',
+    'name' => 'ID'
+  )
+);
+$form-&gt;excludes = array('form' => true);</strong></pre>
+
+<p>
+  Each of the parameters corresponds to one of the questions we asked.
+  Notice that we added an asterisk to the end of the <code>action</code>
+  attribute to indicate that it is required. If someone specifies a
+  <code>form</code> without that attribute, the tag will be axed.
+  Also, the extra line at the end is a special extra declaration that
+  prevents forms from being nested within each other.
+</p>
+
+<p>
+  And that's all there is to it! Implementing the rest of the form
+  module is left as an exercise to the user; to see more examples
+  check the <a href="http://repo.or.cz/w/htmlpurifier.git?a=tree;hb=HEAD;f=library/HTMLPurifier/HTMLModule"><code>library/HTMLPurifier/HTMLModule/</code></a> directory
+  in your local HTML Purifier installation.
+</p>
+
+<h2>And beyond...</h2>
+
+<p>
+  Perceptive users may have realized that, to a certain extent, we
+  have simply re-implemented the facilities of XML Schema or the
+  Document Type Definition.  What you are seeing here, however, is
+  not just an XML Schema or Document Type Definition: it is a fully
+  expressive method of specifying the definition of HTML that is
+  a portable superset of the capabilities of the two above-mentioned schema
+  languages.  What makes HTMLDefinition so powerful is the fact that
+  if we don't have an implementation for a content model or an attribute
+  definition, you can supply it yourself by writing a PHP class.
+</p>
+
+<p>
+  There are many facets of HTMLDefinition beyond the Advanced API I have
+  walked you through today.  To find out more about these, you can
+  check out these source files:
+</p>
+
+<ul>
+  <li><a href="http://repo.or.cz/w/htmlpurifier.git?a=blob;hb=HEAD;f=library/HTMLPurifier/HTMLModule.php"><code>library/HTMLPurifier/HTMLModule.php</code></a></li>
+  <li><a href="http://repo.or.cz/w/htmlpurifier.git?a=blob;hb=HEAD;f=library/HTMLPurifier/ElementDef.php"><code>library/HTMLPurifier/ElementDef.php</code></a></li>
+</ul>
+
+<h2 id="optimized">Notes for HTML Purifier 4.2.0 and earlier</h3>
+
+<p>
+    Previously, this tutorial gave some incorrect template code for
+    editing raw definitions, and that template code will now produce the
+    error <q>Due to a documentation error in previous version of HTML
+    Purifier...</q>  Here is how to mechanically transform old-style
+    code into new-style code.
+</p>
+
+<p>
+    First, identify all code that edits the raw definition object, and
+    put it together.  Ensure none of this code must be run on every
+    request; if some sub-part needs to always be run, move it outside
+    this block.  Here is an example below, with the raw definition
+    object code bolded.
+</p>
+
+<pre>$config = HTMLPurifier_Config::createDefault();
+$config-&gt;set('HTML.DefinitionID', 'enduser-customize.html tutorial');
+$config-&gt;set('HTML.DefinitionRev', 1);
+$def = $config-&gt;getHTMLDefinition(true);
+<strong>$def->addAttribute('a', 'target', 'Enum#_blank,_self,_target,_top');</strong>
+$purifier = new HTMLPurifier($config);</pre>
+
+<p>
+    Next, replace the raw definition retrieval with a
+    maybeGetRawHTMLDefinition method call inside an if conditional, and
+    place the editing code inside that if block.
+</p>
+
+<pre>$config = HTMLPurifier_Config::createDefault();
+$config-&gt;set('HTML.DefinitionID', 'enduser-customize.html tutorial');
+$config-&gt;set('HTML.DefinitionRev', 1);
+<strong>if ($def = $config-&gt;maybeGetRawHTMLDefinition()) {
+    $def->addAttribute('a', 'target', 'Enum#_blank,_self,_target,_top');
+}</strong>
+$purifier = new HTMLPurifier($config);</pre>
+
+<p>
+    And you're done!  Alternatively, if you're OK with not ever caching
+    your code, the following will still work and not emit warnings.
+</p>
+
+<pre>$config = HTMLPurifier_Config::createDefault();
+$def = $config-&gt;getHTMLDefinition(true);
+$def->addAttribute('a', 'target', 'Enum#_blank,_self,_target,_top');
+$purifier = new HTMLPurifier($config);</pre>
+
+<p>
+    A slightly less efficient version of this was what was going on with
+    old versions of HTML Purifier.
+</p>
+
+<p>
+    <em>Technical notes:</em> ajh pointed out on <a
+        href="http://htmlpurifier.org/phorum/read.php?5,5164,5169#msg-5169">in a forum topic</a> that
+    HTML Purifier appeared to be repeatedly writing to the cache even
+    when a cache entry already existed.  Investigation lead to the
+    discovery of the following infelicity: caching of customized
+    definitions didn't actually work!  The problem was that even though
+    a cache file would be written out at the end of the process, there
+    was no way for HTML Purifier to say, <q>Actually, I've already got a
+        copy of your work, no need to reconfigure your
+        customizations</q>.  This required the API to change: placing
+    all of the customizations to the raw definition object in a
+    conditional which could be skipped.
+</p>
+
+</body></html>
+
+<!-- vim: et sw=4 sts=4
+-->

--- libraries/htmlpurifier/docs/enduser-id.html ---
@@ -0,0 +1,148 @@
+<?xml version="1.0" encoding="UTF-8"?>
+<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
+    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
+<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"><head>
+<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
+<meta name="description" content="Explains various methods for allowing IDs in documents safely in HTML Purifier." />
+<link rel="stylesheet" type="text/css" href="./style.css" />
+
+<title>IDs - HTML Purifier</title>
+
+</head><body>
+
+<h1 class="subtitled">IDs</h1>
+<div class="subtitle">What they are, why you should(n't) wear them, and how to deal with it</div>
+
+<div id="filing">Filed under End-User</div>
+<div id="index">Return to the <a href="index.html">index</a>.</div>
+<div id="home"><a href="http://htmlpurifier.org/">HTML Purifier</a> End-User Documentation</div>
+
+<p>Prior to HTML Purifier 1.2.0, this library blithely accepted user input that
+looked like this:</p>
+
+<pre>&lt;a id=&quot;fragment&quot;&gt;Anchor&lt;/a&gt;</pre>
+
+<p>...presenting an attractive vector for those that would destroy standards
+compliance: simply set the ID to one that is already used elsewhere in the
+document and voila: validation breaks.  There was a half-hearted attempt to
+prevent this by allowing users to blacklist IDs, but I suspect that no one
+really bothered, and thus, with the release of 1.2.0, IDs are now <em>removed</em>
+by default.</p>
+
+<p>IDs, however, are quite useful functionality to have, so if users start
+complaining about broken anchors you'll probably want to turn them back on
+with %Attr.EnableID. But before you go mucking around with the config
+object, it's probably worth to take some precautions to keep your page
+validating. Why?</p>
+
+<ol>
+   <li>Standards-compliant pages are good</li>
+   <li>Duplicated IDs interfere with anchors.  If there are two id="foobar"s in a
+   document, which spot does a browser presented with the fragment #foobar go
+   to? Most browsers opt for the first appearing ID, making it impossible
+   to references the second section. Similarly, duplicated IDs can hijack
+   client-side scripting that relies on the IDs of elements.</li>
+</ol>
+
+<p>You have (currently) four ways of dealing with the problem.</p>
+
+
+
+<h2 class="subtitled">Blacklisting IDs</h2>
+<div class="subsubtitle">Good for pages with single content source and stable templates</div>
+
+<p>Keeping in terms with the
+<acronym title="Keep It Simple, Stupid">KISS</acronym> principle, let us
+deal with the most obvious solution: preventing users from using any IDs that
+appear elsewhere on the document.  The method is simple:</p>
+
+<pre>$config-&gt;set('Attr.EnableID', true);
+$config-&gt;set('Attr.IDBlacklist' array(
+    'list', 'of', 'attribute', 'values', 'that', 'are', 'forbidden'
+));</pre>
+
+<p>That being said, there are some notable drawbacks.  First of all, you have to
+know precisely which IDs are being used by the HTML surrounding the user code.
+This is easier said than done: quite often the page designer and the system
+coder work separately, so the designer has to constantly be talking with the
+coder whenever he decides to add a new anchor.  Miss one and you open yourself
+to possible standards-compliance issues.</p>
+
+<p>Furthermore, this position becomes untenable when a single web page must hold
+multiple portions of user-submitted content.  Since there's obviously no way
+to find out before-hand what IDs users will use, the blacklist is helpless.
+And since HTML Purifier validates each segment separately, perhaps doing
+so at different times, it would be extremely difficult to dynamically update
+the blacklist in between runs.</p>
+
+<p>Finally, simply destroying the ID is extremely un-userfriendly behavior: after
+all, they might have simply specified a duplicate ID by accident.</p>
+
+<p>Thus, we get to our second method.</p>
+
+
+
+<h2 class="subtitled">Namespacing IDs</h2>
+<div class="subsubtitle">Lazy developer's way, but needs user education</div>
+
+<p>This method, too, is quite simple: add a prefix to all user IDs. With this
+code:</p>
+
+<pre>$config-&gt;set('Attr.EnableID', true);
+$config-&gt;set('Attr.IDPrefix', 'user_');</pre>
+
+<p>...this:</p>
+
+<pre>&lt;a id=&quot;foobar&quot;&gt;Anchor!&lt;/a&gt;</pre>
+
+<p>...turns into:</p>
+
+<pre>&lt;a id=&quot;user_foobar&quot;&gt;Anchor!&lt;/a&gt;</pre>
+
+<p>As long as you don't have any IDs that start with user_, collisions are
+guaranteed not to happen.  The drawback is obvious: if a user submits
+id=&quot;foobar&quot;, they probably expect to be able to reference their page with
+#foobar. You'll have to tell them, &quot;No, that doesn't work, you have to add
+user_ to the beginning.&quot;</p>
+
+<p>And yes, things get hairier.  Even with a nice prefix, we still have done
+nothing about multiple HTML Purifier outputs on one page.  Thus, we have
+a second configuration value to piggy-back off of: %Attr.IDPrefixLocal:</p>
+
+<pre>$config-&gt;set('Attr.IDPrefixLocal', 'comment' . $id . '_');</pre>
+
+<p>This new attributes does nothing but append on to regular IDPrefix, but is
+special in that it is volatile: it's value is determined at run-time and
+cannot possibly be cordoned into, say, a .ini config file.  As for what to
+put into the directive, is up to you, but I would recommend the ID number
+the text has been assigned in the database.  Whatever you pick, however, it
+has to be unique and stable for the text you are validating.  Note, however,
+that we require that %Attr.IDPrefix be set before you use this directive.</p>
+
+<p>And also remember: the user has to know what this prefix is too!</p>
+
+
+
+<h2>Abstinence</h2>
+
+<p>You may not want to bother. That's okay too, just don't enable IDs.</p>
+
+<p>Personally, I would take this road whenever user-submitted content would be
+possibly be shown together on one page.  Why a blog comment would need to use
+anchors is beyond me.</p>
+
+
+
+<h2>Denial</h2>
+
+<p>To revert back to pre-1.2.0 behavior, simply:</p>
+
+<pre>$config-&gt;set('Attr.EnableID', true);</pre>
+
+<p>Don't come crying to me when your page mysteriously stops validating, though.</p>
+
+</body>
+</html>
+
+<!-- vim: et sw=4 sts=4
+-->

--- libraries/htmlpurifier/docs/enduser-overview.txt ---
@@ -0,0 +1,59 @@
+
+HTML Purifier
+  by Edward Z. Yang
+
+There are a number of ad hoc HTML filtering solutions out there on the web
+(some examples including HTML_Safe, kses and SafeHtmlChecker.class.php) that
+claim to filter HTML properly, preventing malicious JavaScript and layout
+breaking HTML from getting through the parser.  None of them, however,
+demonstrates a thorough knowledge of neither the DTD that defines the HTML
+nor the caveats of HTML that cannot be expressed by a DTD.  Configurable
+filters (such as kses or PHP's built-in striptags() function) have trouble
+validating the contents of attributes and can be subject to security attacks
+due to poor configuration.  Other filters take the naive approach of
+blacklisting known threats and tags, failing to account for the introduction
+of new technologies, new tags, new attributes or quirky browser behavior.
+
+However, HTML Purifier takes a different approach, one that doesn't use
+specification-ignorant regexes or narrow blacklists.  HTML Purifier will
+decompose the whole document into tokens, and rigorously process the tokens by:
+removing non-whitelisted elements, transforming bad practice tags like <font>
+into <span>, properly checking the nesting of tags and their children and
+validating all attributes according to their RFCs.
+
+To my knowledge, there is nothing like this on the web yet.  Not even MediaWiki,
+which allows an amazingly diverse mix of HTML and wikitext in its documents,
+gets all the nesting quirks right.  Existing solutions hope that no JavaScript
+will slip through, but either do not attempt to ensure that the resulting
+output is valid XHTML or send the HTML through a draconic XML parser (and yet
+still get the nesting wrong: SafeHtmlChecker.class.php does not prevent <a>
+tags from being nested within each other).
+
+This document no longer is a detailed description of how HTMLPurifier works,
+as those descriptions have been moved to the appropriate code.  The first
+draft was drawn up after two rough code sketches and the implementation of a
+forgiving lexer.  You may also be interested in the unit tests located in the
+tests/ folder, which provide a living document on how exactly the filter deals
+with malformed input.
+
+In summary (see corresponding classes for more details):
+
+1. Parse document into an array of tag and text tokens (Lexer)
+2. Remove all elements not on whitelist and transform certain other elements
+   into acceptable forms (i.e. <font>)
+3. Make document well formed while helpfully taking into account certain quirks,
+   such as the fact that <p> tags traditionally are closed by other block-level
+   elements.
+4. Run through all nodes and check children for proper order (especially
+   important for tables).
+5. Validate attributes according to more restrictive definitions based on the
+   RFCs.
+6. Translate back into a string. (Generator)
+
+HTML Purifier is best suited for documents that require a rich array of
+HTML tags.  Things like blog comments are, in all likelihood, most appropriately
+written in an extremely restrictive set of markup that doesn't require
+all this functionality (or not written in HTML at all), although this may
+be changing in the future with the addition of levels of filtering.
+
+    vim: et sw=4 sts=4

--- libraries/htmlpurifier/docs/enduser-security.txt ---
@@ -0,0 +1,18 @@
+
+Security
+
+Like anything that claims to afford security, HTML_Purifier can be circumvented
+through negligence of people. This class will do its job: no more, no less,
+and it's up to you to provide it the proper information and proper context
+to be effective. Things to remember:
+
+1. Character Encoding: see enduser-utf8.html for more info.
+
+2. IDs: see enduser-id.html for more info
+
+3. URIs: see enduser-uri-filter.html
+
+4. CSS: document pending
+Explain which CSS styles we blocked and why.
+
+    vim: et sw=4 sts=4

--- libraries/htmlpurifier/docs/enduser-slow.html ---
@@ -0,0 +1,120 @@
+<?xml version="1.0" encoding="UTF-8"?>
+<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
+    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
+<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"><head>
+<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
+<meta name="description" content="Explains how to speed up HTML Purifier through caching or inbound filtering." />
+<link rel="stylesheet" type="text/css" href="./style.css" />
+
+<title>Speeding up HTML Purifier - HTML Purifier</title>
+
+</head><body>
+
+<h1 class="subtitled">Speeding up HTML Purifier</h1>
+<div class="subtitle">...also known as the HELP ME LIBRARY IS TOO SLOW MY PAGE TAKE TOO LONG page</div>
+
+<div id="filing">Filed under End-User</div>
+<div id="index">Return to the <a href="index.html">index</a>.</div>
+<div id="home"><a href="http://htmlpurifier.org/">HTML Purifier</a> End-User Documentation</div>
+
+<p>HTML Purifier is a very powerful library. But with power comes great
+responsibility, in the form of longer execution times.  Remember, this
+library isn't lightly grazing over submitted HTML: it's deconstructing
+the whole thing, rigorously checking the parts, and then putting it back
+together. </p>
+
+<p>So, if it so turns out that HTML Purifier is kinda too slow for outbound
+filtering, you've got a few options: </p>
+
+<h2>Inbound filtering</h2>
+
+<p>Perform filtering of HTML when it's submitted by the user. Since the
+user is already submitting something, an extra half a second tacked on
+to the load time probably isn't going to be that huge of a problem.
+Then, displaying the content is a simple a manner of outputting it
+directly from your database/filesystem. The trouble with this method is
+that your user loses the original text, and when doing edits, will be
+handling the filtered text.  While this may be a good thing, especially
+if you're using a WYSIWYG editor, it can also result in data-loss if a
+user makes a typo. </p>
+
+<p>Example (non-functional):</p>
+
+<pre>&lt;?php
+    /**
+     * FORM SUBMISSION PAGE
+     * display_error($message) : displays nice error page with message
+     * display_success() : displays a nice success page
+     * display_form() : displays the HTML submission form
+     * database_insert($html) : inserts data into database as new row
+     */
+    if (!empty($_POST)) {
+        require_once '/path/to/library/HTMLPurifier.auto.php';
+        require_once 'HTMLPurifier.func.php';
+        $dirty_html = isset($_POST['html']) ? $_POST['html'] : false;
+        if (!$dirty_html) {
+            display_error('You must write some HTML!');
+        }
+        $html = HTMLPurifier($dirty_html);
+        database_insert($html);
+        display_success();
+        // notice that $dirty_html is *not* saved
+    } else {
+        display_form();
+    }
+?&gt;</pre>
+
+<h2>Caching the filtered output</h2>
+
+<p>Accept the submitted text and put it unaltered into the database, but
+then also generate a filtered version and stash that in the database.
+Serve the filtered version to readers, and the unaltered version to
+editors.  If need be, you can invalidate the cache and have the cached
+filtered version be regenerated on the first page view.  Pros? Full data
+retention. Cons? It's more complicated, and opens other editors up to
+XSS if they are using a WYSIWYG editor (to fix that, they'd have to be
+able to get their hands on the *really* original text served in
+plaintext mode). </p>
+
+<p>Example (non-functional):</p>
+
+<pre>&lt;?php
+    /**
+     * VIEW PAGE
+     * display_error($message) : displays nice error page with message
+     * cache_get($id) : retrieves HTML from fast cache (db or file)
+     * cache_insert($id, $html) : inserts good HTML into cache system
+     * database_get($id) : retrieves raw HTML from database
+     */
+    $id = isset($_GET['id']) ? (int) $_GET['id'] : false;
+    if (!$id) {
+        display_error('Must specify ID.');
+        exit;
+    }
+    $html = cache_get($id); // filesystem or database
+    if ($html === false) {
+        // cache didn't have the HTML, generate it
+        $raw_html = database_get($id);
+        require_once '/path/to/library/HTMLPurifier.auto.php';
+        require_once 'HTMLPurifier.func.php';
+        $html = HTMLPurifier($raw_html);
+        cache_insert($id, $html);
+    }
+    echo $html;
+?&gt;</pre>
+
+<h2>Summary</h2>
+
+<p>In short, inbound filtering is the simple option and caching is the
+robust option (albeit with bigger storage requirements). </p>
+
+<p>There is a third option, independent of the two we've discussed: profile
+and optimize HTMLPurifier yourself. Be sure to report back your results
+if you decide to do that! Especially if you port HTML Purifier to C++.
+<tt>;-)</tt></p>
+
+</body>
+</html>
+
+<!-- vim: et sw=4 sts=4
+-->

--- libraries/htmlpurifier/docs/enduser-tidy.html ---
@@ -0,0 +1,231 @@
+<?xml version="1.0" encoding="UTF-8"?>
+<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
+    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
+<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"><head>
+<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
+<meta name="description" content="Tutorial for tweaking HTML Purifier's Tidy-like behavior." />
+<link rel="stylesheet" type="text/css" href="style.css" />
+
+<title>Tidy - HTML Purifier</title>
+
+</head><body>
+
+<h1>Tidy</h1>
+
+<div id="filing">Filed under Development</div>
+<div id="index">Return to the <a href="index.html">index</a>.</div>
+<div id="home"><a href="http://htmlpurifier.org/">HTML Purifier</a> End-User Documentation</div>
+
+<p>You've probably heard of HTML Tidy, Dave Raggett's little piece
+of software that cleans up poorly written HTML.  Let me say it straight
+out:</p>
+
+<p class="emphasis">This ain't HTML Tidy!</p>
+
+<p>Rather, Tidy stands for a cool set of Tidy-inspired features in HTML Purifier
+that allows users to submit deprecated elements and attributes and get
+valid strict markup back. For example:</p>
+
+<pre>&lt;center&gt;Centered&lt;/center&gt;</pre>
+
+<p>...becomes:</p>
+
+<pre>&lt;div style=&quot;text-align:center;&quot;&gt;Centered&lt;/div&gt;</pre>
+
+<p>...when this particular fix is run on the HTML. This tutorial will give
+you the lowdown of what exactly HTML Purifier will do when Tidy
+is on, and how to fine-tune this behavior. Once again, <strong>you do
+not need Tidy installed on your PHP to use these features!</strong></p>
+
+<h2>What does it do?</h2>
+
+<p>Tidy will do several things to your HTML:</p>
+
+<ul>
+    <li>Convert deprecated elements and attributes to standards-compliant
+        alternatives</li>
+    <li>Enforce XHTML compatibility guidelines and other best practices</li>
+    <li>Preserve data that would normally be removed as per W3C</li>
+</ul>
+
+<h2>What are levels?</h2>
+
+<p>Levels describe how aggressive the Tidy module should be when
+cleaning up HTML. There are four levels to pick: none, light, medium
+and heavy. Each of these levels has a well-defined set of behavior
+associated with it, although it may change depending on your doctype.</p>
+
+<dl>
+    <dt>light</dt>
+    <dd>This is the <strong>lenient</strong> level. If a tag or attribute
+        is about to be removed because it isn't supported by the
+        doctype, Tidy will step in and change into an alternative that
+        is supported.</dd>
+    <dt>medium</dt>
+    <dd>This is the <strong>correctional</strong> level. At this level,
+        all the functions of light are performed, as well as some extra,
+        non-essential best practices enforcement. Changes made on this
+        level are very benign and are unlikely to cause problems.</dd>
+    <dt>heavy</dt>
+    <dd>This is the <strong>aggressive</strong> level. If a tag or
+        attribute is deprecated, it will be converted into a non-deprecated
+        version, no ifs ands or buts.</dd>
+</dl>
+
+<p>By default, Tidy operates on the <strong>medium</strong> level. You can
+change the level of cleaning by setting the %HTML.TidyLevel configuration
+directive:</p>
+
+<pre>$config-&gt;set('HTML.TidyLevel', 'heavy'); // burn baby burn!</pre>
+
+<h2>Is the light level really light?</h2>
+
+<p>It depends on what doctype you're using. If your documents are HTML
+4.01 <em>Transitional</em>, HTML Purifier will be lazy
+and won't clean up your <code>center</code>
+or <code>font</code> tags. But if you're using HTML 4.01 <em>Strict</em>,
+HTML Purifier has no choice: it has to convert them, or they will
+be nuked out of existence. So while light on Transitional will result
+in little to no changes, light on Strict will still result in quite
+a lot of fixes.</p>
+
+<p>This is different behavior from 1.6 or before, where deprecated
+tags in transitional documents would
+always be cleaned up regardless. This is also better behavior.</p>
+
+<h2>My pages look different!</h2>
+
+<p>HTML Purifier is tasked with converting deprecated tags and
+attributes to standards-compliant alternatives, which usually
+need copious amounts of CSS. It's also not foolproof: sometimes
+things do get lost in the translation. This is why when HTML Purifier
+can get away with not doing cleaning, it won't; this is why
+the default value is <strong>medium</strong> and not heavy.</p>
+
+<p>Fortunately, only a few attributes have problems with the switch
+over. They are described below:</p>
+
+<table class="table">
+    <thead><tr>
+        <th>Element@Attr</th>
+        <th>Changes</th>
+    </tr></thead>
+    <tbody>
+        <tr>
+            <td>caption@align</td>
+            <td>Firefox supports stuffing the caption on the
+                left and right side of the table, a feature that
+                Internet Explorer, understandably, does not have.
+                When align equals right or left, the text will simply
+                be aligned on the left or right side.</td>
+        </tr>
+        <tr>
+            <td>img@align</td>
+            <td>The implementation for align bottom is good, but not
+            perfect. There are a few pixel differences.</td>
+        </tr>
+        <tr>
+            <td>br@clear</td>
+            <td>Clear both gets a little wonky in Internet Explorer. Haven't
+                really been able to figure out why.</td>
+        </tr>
+        <tr>
+            <td>hr@noshade</td>
+            <td>All browsers implement this slightly differently: we've
+                chosen to make noshade horizontal rules gray.</td>
+        </tr>
+    </tbody>
+</table>
+
+<p>There are a few more minor, although irritating, bugs.
+Some older browsers support deprecated attributes,
+but not CSS. Transformed elements and attributes will look unstyled
+to said browsers. Also, CSS precedence is slightly different for
+inline styles versus presentational markup. In increasing precedence:</p>
+
+<ol>
+    <li>Presentational attributes</li>
+    <li>External style sheets</li>
+    <li>Inline styling</li>
+</ol>
+
+<p>This means that styling that may have been masked by external CSS
+declarations will start showing up (a good thing, perhaps). Finally,
+if you've turned off the style attribute, almost all of
+these transformations will not work. Sorry mates.</p>
+
+<p>You can review the rendering before and after of these transformations
+by consulting the <a
+href="http://htmlpurifier.org/live/smoketests/attrTransform.php">attrTransform.php
+smoketest</a>.</p>
+
+<h2>I like the general idea, but the specifics bug me!</h2>
+
+<p>So you want HTML Purifier to clean up your HTML, but you're not
+so happy about the br@clear implementation. That's perfectly fine!
+HTML Purifier will make accomodations:</p>
+
+<pre>$config-&gt;set('HTML.Doctype', 'XHTML 1.0 Transitional');
+$config-&gt;set('HTML.TidyLevel', 'heavy'); // all changes, minus...
+<strong>$config-&gt;set('HTML.TidyRemove', 'br@clear');</strong></pre>
+
+<p>That third line does the magic, removing the br@clear fix
+from the module, ensuring that <code>&lt;br clear="both" /&gt;</code>
+will pass through unharmed. The reverse is possible too:</p>
+
+<pre>$config-&gt;set('HTML.Doctype', 'XHTML 1.0 Transitional');
+$config-&gt;set('HTML.TidyLevel', 'none'); // no changes, plus...
+<strong>$config-&gt;set('HTML.TidyAdd', 'p@align');</strong></pre>
+
+<p>In this case, all transformations are shut off, except for the p@align
+one, which you found handy.</p>
+
+<p>To find out what the names of fixes you want to turn on or off are,
+you'll have to consult the source code, specifically the files in
+<code>HTMLPurifier/HTMLModule/Tidy/</code>. There is, however, a
+general syntax:</p>
+
+<table class="table">
+    <thead>
+        <tr>
+            <th>Name</th>
+            <th>Example</th>
+            <th>Interpretation</th>
+        </tr>
+    </thead>
+    <tbody>
+        <tr>
+            <td>element</td>
+            <td>font</td>
+            <td>Tag transform for <em>element</em></td>
+        </tr>
+        <tr>
+            <td>element@attr</td>
+            <td>br@clear</td>
+            <td>Attribute transform for <em>attr</em> on <em>element</em></td>
+        </tr>
+        <tr>
+            <td>@attr</td>
+            <td>@lang</td>
+            <td>Global attribute transform for <em>attr</em></td>
+        </tr>
+        <tr>
+            <td>e#content_model_type</td>
+            <td>blockquote#content_model_type</td>
+            <td>Change of child processing implementation for <em>e</em></td>
+        </tr>
+    </tbody>
+</table>
+
+<h2>So... what's the lowdown?</h2>
+
+<p>The lowdown is, quite frankly, HTML Purifier's default settings are
+probably good enough. The next step is to bump the level up to heavy,
+and if that still doesn't satisfy your appetite, do some fine-tuning.
+Other than that, don't worry about it: this all works silently and
+effectively in the background.</p>
+
+</body></html>
+
+<!-- vim: et sw=4 sts=4
+-->

--- libraries/htmlpurifier/docs/enduser-uri-filter.html ---
@@ -0,0 +1,204 @@
+<?xml version="1.0" encoding="UTF-8"?>
+<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
+    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
+<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"><head>
+<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
+<meta name="description" content="Tutorial for creating custom URI filters." />
+<link rel="stylesheet" type="text/css" href="style.css" />
+
+<title>URI Filters - HTML Purifier</title>
+
+</head><body>
+
+<h1>URI Filters</h1>
+
+<div id="filing">Filed under End-User</div>
+<div id="index">Return to the <a href="index.html">index</a>.</div>
+<div id="home"><a href="http://htmlpurifier.org/">HTML Purifier</a> End-User Documentation</div>
+
+<p>
+  This is a quick and dirty document to get you on your way to writing
+  custom URI filters for your own URL filtering needs.  Why would you
+  want to write a URI filter?  If you need URIs your users put into
+  HTML to magically change into a different URI, this is
+  exactly what you need!
+</p>
+
+<h2>Creating the class</h2>
+
+<p>
+  Any URI filter you make will be a subclass of <code>HTMLPurifier_URIFilter</code>.
+  The scaffolding is thus:
+</p>
+
+<pre>class HTMLPurifier_URIFilter_<strong>NameOfFilter</strong> extends HTMLPurifier_URIFilter
+{
+    public $name = '<strong>NameOfFilter</strong>';
+    public function prepare($config) {}
+    public function filter(&$uri, $config, $context) {}
+}</pre>
+
+<p>
+  Fill in the variable <code>$name</code> with the name of your filter, and
+  take a look at the two methods. <code>prepare()</code> is an initialization
+  method that is called only once, before any filtering has been done of the
+  HTML. Use it to perform any costly setup work that only needs to be done
+  once. <code>filter()</code> is the guts and innards of our filter:
+  it takes the URI and does whatever needs to be done to it.
+</p>
+
+<p>
+  If you've worked with HTML Purifier, you'll recognize the <code>$config</code>
+  and <code>$context</code> parameters.  On the other hand, <code>$uri</code>
+  is something unique to this section of the application: it's a
+  <code>HTMLPurifier_URI</code> object. The interface is thus:
+</p>
+
+<pre>class HTMLPurifier_URI
+{
+    public $scheme, $userinfo, $host, $port, $path, $query, $fragment;
+    public function HTMLPurifier_URI($scheme, $userinfo, $host, $port, $path, $query, $fragment);
+    public function toString();
+    public function copy();
+    public function getSchemeObj($config, $context);
+    public function validate($config, $context);
+}</pre>
+
+<p>
+  The first three methods are fairly self-explanatory: you have a constructor,
+  a serializer, and a cloner.  Generally, you won't be using them when
+  you are manipulating the URI objects themselves.
+  <code>getSchemeObj()</code> is a special purpose method that returns
+  a <code>HTMLPurifier_URIScheme</code> object corresponding to the specific
+  URI at hand. <code>validate()</code> performs general-purpose validation
+  on the internal components of a URI. Once again, you don't need to
+  worry about these: they've already been handled for you.
+</p>
+
+<h2>URI format</h2>
+
+<p>
+  As a URIFilter, we're interested in the member variables of the URI object.
+</p>
+
+<table class="quick"><tbody>
+  <tr><th>Scheme</th>   <td>The protocol for identifying (and possibly locating) a resource (http, ftp, https)</td></tr>
+  <tr><th>Userinfo</th> <td>User information such as a username (bob)</td></tr>
+  <tr><th>Host</th>     <td>Domain name or IP address of the server (example.com, 127.0.0.1)</td></tr>
+  <tr><th>Port</th>     <td>Network port number for the server (80, 12345)</td></tr>
+  <tr><th>Path</th>     <td>Data that identifies the resource, possibly hierarchical (/path/to, ed@example.com)</td></tr>
+  <tr><th>Query</th>    <td>String of information to be interpreted by the resource (?q=search-term)</td></tr>
+  <tr><th>Fragment</th> <td>Additional information for the resource after retrieval (#bookmark)</td></tr>
+</tbody></table>
+
+<p>
+  Because the URI is presented to us in this form, and not
+  <code>http://bob@example.com:8080/foo.php?q=string#hash</code>, it saves us
+  a lot of trouble in having to parse the URI every time we want to filter
+  it. For the record, the above URI has the following components:
+</p>
+
+<table class="quick"><tbody>
+  <tr><th>Scheme</th>   <td>http</td></tr>
+  <tr><th>Userinfo</th> <td>bob</td></tr>
+  <tr><th>Host</th>     <td>example.com</td></tr>
+  <tr><th>Port</th>     <td>8080</td></tr>
+  <tr><th>Path</th>     <td>/foo.php</td></tr>
+  <tr><th>Query</th>    <td>q=string</td></tr>
+  <tr><th>Fragment</th> <td>hash</td></tr>
+</tbody></table>
+
+<p>
+  Note that there is no question mark or octothorpe in the query or
+  fragment: these get removed during parsing.
+</p>
+
+<p>
+  With this information, you can get straight to implementing your
+  <code>filter()</code> method. But one more thing...
+</p>
+
+<h2>Return value: Boolean, not URI</h2>
+
+<p>
+  You may have noticed that the URI is being passed in by reference.
+  This means that whatever changes you make to it, those changes will
+  be reflected in the URI object the callee had.  <strong>Do not
+  return the URI object: it is unnecessary and will cause bugs.</strong>
+  Instead, return a boolean value, true if the filtering was successful,
+  or false if the URI is beyond repair and needs to be axed.
+</p>
+
+<p>
+  Let's suppose I wanted to write a filter that converted links with a
+  custom <code>image</code> scheme to its corresponding real path on
+  our website:
+</p>
+
+<pre>class HTMLPurifier_URIFilter_TransformImageScheme extends HTMLPurifier_URIFilter
+{
+    public $name = 'TransformImageScheme';
+    public function filter(&$uri, $config, $context) {
+        if ($uri->scheme !== 'image') return true;
+        $img_name = $uri->path;
+        // Overwrite the previous URI object
+        $uri = new HTMLPurifier_URI('http', null, null, null, '/img/' . $img_name . '.png', null, null);
+        return true;
+    }
+}</pre>
+
+<p>
+  Notice I did not <code>return $uri;</code>. This filter would turn
+  <code>image:Foo</code> into <code>/img/Foo.png</code>.
+</p>
+
+<h2>Activating your filter</h2>
+
+<p>
+  Having a filter is all well and good, but you need to tell HTML Purifier
+  to use it. Fortunately, this part's simple:
+</p>
+
+<pre>$uri = $config->getDefinition('URI');
+$uri->addFilter(new HTMLPurifier_URIFilter_<strong>NameOfFilter</strong>(), $config);</pre>
+
+<p>
+    After adding a filter, you won't be able to set configuration directives.
+    Structure your code accordingly.
+</p>
+
+<!-- XXX: link to new documentation system -->
+
+<h2>Post-filter</h2>
+
+<p>
+    Remember our TransformImageScheme filter? That filter acted before we had
+    performed scheme validation; otherwise, the URI would have been filtered
+    out when it was discovered that there was no image scheme. Well, a post-filter
+    is run after scheme specific validation, so it's ideal for bulk
+    post-processing of URIs, including munging. To specify a URI as a post-filter,
+    set the <code>$post</code> member variable to TRUE.
+</p>
+
+<pre>class HTMLPurifier_URIFilter_MyPostFilter extends HTMLPurifier_URIFilter
+{
+    public $name = 'MyPostFilter';
+    public $post = true;
+    // ... extra code here
+}
+</pre>
+
+<h2>Examples</h2>
+
+<p>
+  Check the
+  <a href="http://repo.or.cz/w/htmlpurifier.git?a=tree;hb=HEAD;f=library/HTMLPurifier/URIFilter">URIFilter</a>
+  directory for more implementation examples, and see <a href="proposal-new-directives.txt">the
+  new directives proposal document</a> for ideas on what could be implemented
+  as a filter.
+</p>
+
+</body></html>
+
+<!-- vim: et sw=4 sts=4
+-->

--- libraries/htmlpurifier/docs/enduser-utf8.html ---
@@ -0,0 +1,1060 @@
+<?xml version="1.0" encoding="UTF-8"?>
+<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
+    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
+<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"><head>
+<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
+<meta name="description" content="Describes the rationale for using UTF-8, the ramifications otherwise, and how to make the switch." />
+<link rel="stylesheet" type="text/css" href="./style.css" />
+<style type="text/css">
+    .minor td {font-style:italic;}
+</style>
+
+<title>UTF-8: The Secret of Character Encoding - HTML Purifier</title>
+
+<!-- Note to users: this document, though professing to be UTF-8, attempts
+to use only ASCII characters, because most webservers are configured
+to send HTML as ISO-8859-1. So I will, many times, go against my
+own advice for sake of portability.  -->
+
+</head><body>
+
+<h1>UTF-8: The Secret of Character Encoding</h1>
+
+<div id="filing">Filed under End-User</div>
+<div id="index">Return to the <a href="index.html">index</a>.</div>
+<div id="home"><a href="http://htmlpurifier.org/">HTML Purifier</a> End-User Documentation</div>
+
+<p>Character encoding and character sets are not that
+difficult to understand, but so many people blithely stumble
+through the worlds of programming without knowing what to actually
+do about it, or say &quot;Ah, it's a job for those <em>internationalization</em>
+experts.&quot; No, it is not! This document will walk you through
+determining the encoding of your system and how you should handle
+this information. It will stay away from excessive discussion on
+the internals of character encoding.</p>
+
+<p>This document is not designed to be read in its entirety: it will
+slowly introduce concepts that build on each other: you need not get to
+the bottom to have learned something new. However, I strongly
+recommend you read all the way to <strong>Why UTF-8?</strong>, because at least
+at that point you'd have made a conscious decision not to migrate,
+which can be a rewarding (but difficult) task.</p>
+
+<blockquote class="aside">
+<div class="label">Asides</div>
+    <p>Text in this formatting is an <strong>aside</strong>,
+    interesting tidbits for the curious but not strictly necessary material to
+    do the tutorial. If you read this text, you'll come out
+    with a greater understanding of the underlying issues.</p>
+</blockquote>
+
+<h2>Table of Contents</h2>
+
+<ol id="toc">
+    <li><a href="#findcharset">Finding the real encoding</a></li>
+    <li><a href="#findmetacharset">Finding the embedded encoding</a></li>
+    <li><a href="#fixcharset">Fixing the encoding</a><ol>
+        <li><a href="#fixcharset-none">No embedded encoding</a></li>
+        <li><a href="#fixcharset-diff">Embedded encoding disagrees</a></li>
+        <li><a href="#fixcharset-server">Changing the server encoding</a><ol>
+            <li><a href="#fixcharset-server-php">PHP header() function</a></li>
+            <li><a href="#fixcharset-server-phpini">PHP ini directive</a></li>
+            <li><a href="#fixcharset-server-nophp">Non-PHP</a></li>
+            <li><a href="#fixcharset-server-htaccess">.htaccess</a></li>
+            <li><a href="#fixcharset-server-ext">File extensions</a></li>
+        </ol></li>
+        <li><a href="#fixcharset-xml">XML</a></li>
+        <li><a href="#fixcharset-internals">Inside the process</a></li>
+    </ol></li>
+    <li><a href="#whyutf8">Why UTF-8?</a><ol>
+        <li><a href="#whyutf8-i18n">Internationalization</a></li>
+        <li><a href="#whyutf8-user">User-friendly</a></li>
+        <li><a href="#whyutf8-forms">Forms</a><ol>
+            <li><a href="#whyutf8-forms-urlencoded">application/x-www-form-urlencoded</a></li>
+            <li><a href="#whyutf8-forms-multipart">multipart/form-data</a></li>
+        </ol></li>
+        <li><a href="#whyutf8-support">Well supported</a></li>
+        <li><a href="#whyutf8-htmlpurifier">HTML Purifiers</a></li>
+    </ol></li>
+    <li><a href="#migrate">Migrate to UTF-8</a><ol>
+        <li><a href="#migrate-db">Configuring your database</a><ol>
+            <li><a href="#migrate-db-legit">Legit method</a></li>
+            <li><a href="#migrate-db-binary">Binary</a></li>
+        </ol></li>
+        <li><a href="#migrate-editor">Text editor</a></li>
+        <li><a href="#migrate-bom">Byte Order Mark (headers already sent!)</a></li>
+        <li><a href="#migrate-fonts">Fonts</a><ol>
+            <li><a href="#migrate-fonts-obscure">Obscure scripts</a></li>
+            <li><a href="#migrate-fonts-occasional">Occasional use</a></li>
+        </ol></li>
+        <li><a href="#migrate-variablewidth">Dealing with variable width in functions</a></li>
+    </ol></li>
+    <li><a href="#externallinks">Further Reading</a></li>
+</ol>
+
+<h2 id="findcharset">Finding the real encoding</h2>
+
+<p>In the beginning, there was ASCII, and things were simple. But they
+weren't good, for no one could write in Cyrillic or Thai. So there
+exploded a proliferation of character encodings to remedy the problem
+by extending the characters ASCII could express. This ridiculously
+simplified version of the history of character encodings shows us that
+there are now many character encodings floating around.</p>
+
+<blockquote class="aside">
+    <p>A <strong>character encoding</strong> tells the computer how to
+    interpret raw zeroes and ones into real characters. It
+    usually does this by pairing numbers with characters.</p>
+    <p>There are many different types of character encodings floating
+    around, but the ones we deal most frequently with are ASCII,
+    8-bit encodings, and Unicode-based encodings.</p>
+    <ul>
+        <li><strong>ASCII</strong> is a 7-bit encoding based on the
+            English alphabet.</li>
+        <li><strong>8-bit encodings</strong> are extensions to ASCII
+            that add a potpourri of useful, non-standard characters
+            like &eacute; and &aelig;. They can only add 127 characters,
+            so usually only support one script at a time. When you
+            see a page on the web, chances are it's encoded in one
+            of these encodings.</li>
+        <li><strong>Unicode-based encodings</strong> implement the
+            Unicode standard and include UTF-8, UTF-16 and UTF-32/UCS-4.
+            They go beyond 8-bits and support almost
+            every language in the world. UTF-8 is gaining traction
+            as the dominant international encoding of the web.</li>
+    </ul>
+</blockquote>
+
+<p>The first step of our journey is to find out what the encoding of
+your website is. The most reliable way is to ask your
+browser:</p>
+
+<dl>
+    <dt>Mozilla Firefox</dt>
+    <dd>Tools &gt; Page Info: Encoding</dd>
+    <dt>Internet Explorer</dt>
+    <dd>View &gt; Encoding: bulleted item is unofficial name</dd>
+</dl>
+
+<p>Internet Explorer won't give you the MIME (i.e. useful/real) name of the
+character encoding, so you'll have to look it up using their description.
+Some common ones:</p>
+
+<table class="table">
+    <thead><tr>
+        <th>IE's Description</th>
+        <th>Mime Name</th>
+    </tr></thead>
+    <tbody>
+        <tr><th colspan="2">Windows</th></tr>
+        <tr><td>Arabic (Windows)</td><td>Windows-1256</td></tr>
+        <tr><td>Baltic (Windows)</td><td>Windows-1257</td></tr>
+        <tr><td>Central European (Windows)</td><td>Windows-1250</td></tr>
+        <tr><td>Cyrillic (Windows)</td><td>Windows-1251</td></tr>
+        <tr><td>Greek (Windows)</td><td>Windows-1253</td></tr>
+        <tr><td>Hebrew (Windows)</td><td>Windows-1255</td></tr>
+        <tr><td>Thai (Windows)</td><td>TIS-620</td></tr>
+        <tr><td>Turkish (Windows)</td><td>Windows-1254</td></tr>
+        <tr><td>Vietnamese (Windows)</td><td>Windows-1258</td></tr>
+        <tr><td>Western European (Windows)</td><td>Windows-1252</td></tr>
+    </tbody>
+    <tbody>
+        <tr><th colspan="2">ISO</th></tr>
+        <tr><td>Arabic (ISO)</td><td>ISO-8859-6</td></tr>
+        <tr><td>Baltic (ISO)</td><td>ISO-8859-4</td></tr>
+        <tr><td>Central European (ISO)</td><td>ISO-8859-2</td></tr>
+        <tr><td>Cyrillic (ISO)</td><td>ISO-8859-5</td></tr>
+        <tr class="minor"><td>Estonian (ISO)</td><td>ISO-8859-13</td></tr>
+        <tr class="minor"><td>Greek (ISO)</td><td>ISO-8859-7</td></tr>
+        <tr><td>Hebrew (ISO-Logical)</td><td>ISO-8859-8-l</td></tr>
+        <tr><td>Hebrew (ISO-Visual)</td><td>ISO-8859-8</td></tr>
+        <tr class="minor"><td>Latin 9 (ISO)</td><td>ISO-8859-15</td></tr>
+        <tr class="minor"><td>Turkish (ISO)</td><td>ISO-8859-9</td></tr>
+        <tr><td>Western European (ISO)</td><td>ISO-8859-1</td></tr>
+    </tbody>
+    <tbody>
+        <tr><th colspan="2">Other</th></tr>
+        <tr><td>Chinese Simplified (GB18030)</td><td>GB18030</td></tr>
+        <tr><td>Chinese Simplified (GB2312)</td><td>GB2312</td></tr>
+        <tr><td>Chinese Simplified (HZ)</td><td>HZ</td></tr>
+        <tr><td>Chinese Traditional (Big5)</td><td>Big5</td></tr>
+        <tr><td>Japanese (Shift-JIS)</td><td>Shift_JIS</td></tr>
+        <tr><td>Japanese (EUC)</td><td>EUC-JP</td></tr>
+        <tr><td>Korean</td><td>EUC-KR</td></tr>
+        <tr><td>Unicode (UTF-8)</td><td>UTF-8</td></tr>
+    </tbody>
+</table>
+
+<p>Internet Explorer does not recognize some of the more obscure
+character encodings, and having to lookup the real names with a table
+is a pain, so I recommend using Mozilla Firefox to find out your
+character encoding.</p>
+
+<h2 id="findmetacharset">Finding the embedded encoding</h2>
+
+<p>At this point, you may be asking, &quot;Didn't we already find out our
+encoding?&quot; Well, as it turns out, there are multiple places where
+a web developer can specify a character encoding, and one such place
+is in a <code>META</code> tag:</p>
+
+<pre>&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=UTF-8&quot; /&gt;</pre>
+
+<p>You'll find this in the <code>HEAD</code> section of an HTML document.
+The text to the right of <code>charset=</code> is the &quot;claimed&quot;
+encoding: the HTML claims to be this encoding, but whether or not this
+is actually the case depends on other factors. For now, take note
+if your <code>META</code> tag claims that either:</p>
+
+<ol>
+    <li>The character encoding is the same as the one reported by the
+        browser,</li>
+    <li>The character encoding is different from the browser's, or</li>
+    <li>There is no <code>META</code> tag at all! (horror, horror!)</li>
+</ol>
+
+<h2 id="fixcharset">Fixing the encoding</h2>
+
+<p class="aside">The advice given here is for pages being served as
+vanilla <code>text/html</code>.  Different practices must be used
+for <code>application/xml</code> or <code>application/xml+xhtml</code>, see
+<a href="http://www.w3.org/TR/2002/NOTE-xhtml-media-types-20020430/">W3C's
+document on XHTML media types</a> for more information.</p>
+
+<p>If your <code>META</code> encoding and your real encoding match,
+savvy! You can skip this section. If they don't...</p>
+
+<h3 id="fixcharset-none">No embedded encoding</h3>
+
+<p>If this is the case, you'll want to add in the appropriate
+<code>META</code> tag to your website. It's as simple as copy-pasting
+the code snippet above and replacing UTF-8 with whatever is the mime name
+of your real encoding.</p>
+
+<blockquote class="aside">
+    <p>For all those skeptics out there, there is a very good reason
+    why the character encoding should be explicitly stated. When the
+    browser isn't told what the character encoding of a text is, it
+    has to guess: and sometimes the guess is wrong. Hackers can manipulate
+    this guess in order to slip XSS past filters and then fool the
+    browser into executing it as active code. A great example of this
+    is the <a href="http://shiflett.org/archive/177">Google UTF-7
+    exploit</a>.</p>
+    <p>You might be able to get away with not specifying a character
+    encoding with the <code>META</code> tag as long as your webserver
+    sends the right Content-Type header, but why risk it? Besides, if
+    the user downloads the HTML file, there is no longer any webserver
+    to define the character encoding.</p>
+</blockquote>
+
+<h3 id="fixcharset-diff">Embedded encoding disagrees</h3>
+
+<p>This is an extremely common mistake: another source is telling
+the browser what the
+character encoding is and is overriding the embedded encoding. This
+source usually is the Content-Type HTTP header that the webserver (i.e.
+Apache) sends. A usual Content-Type header sent with a page might
+look like this:</p>
+
+<pre>Content-Type: text/html; charset=ISO-8859-1</pre>
+
+<p>Notice how there is a charset parameter: this is the webserver's
+way of telling a browser what the character encoding is, much like
+the <code>META</code> tags we touched upon previously.</p>
+
+<blockquote class="aside"><p>In fact, the <code>META</code> tag is
+designed as a substitute for the HTTP header for contexts where
+sending headers is impossible (such as locally stored files without
+a webserver). Thus the name <code>http-equiv</code> (HTTP equivalent).
+</p></blockquote>
+
+<p>There are two ways to go about fixing this: changing the <code>META</code>
+tag to match the HTTP header, or changing the HTTP header to match
+the <code>META</code> tag. How do we know which to do? It depends
+on the website's content: after all, headers and tags are only ways of
+describing the actual characters on the web page.</p>
+
+<p>If your website:</p>
+
+<dl>
+    <dt>...only uses ASCII characters,</dt>
+    <dd>Either way is fine, but I recommend switching both to
+        UTF-8 (more on this later).</dd>
+    <dt>...uses special characters, and they display
+        properly,</dt>
+    <dd>Change the embedded encoding to the server encoding.</dd>
+    <dt>...uses special characters, but users often complain that
+        they come out garbled,</dt>
+    <dd>Change the server encoding to the embedded encoding.</dd>
+</dl>
+
+<p>Changing a META tag is easy: just swap out the old encoding
+for the new. Changing the server (HTTP header) encoding, however,
+is slightly more difficult.</p>
+
+<h3 id="fixcharset-server">Changing the server encoding</h3>
+
+<h4 id="fixcharset-server-php">PHP header() function</h4>
+
+<p>The simplest way to handle this problem is to send the encoding
+yourself, via your programming language. Since you're using HTML
+Purifier, I'll assume PHP, although it's not too difficult to do
+similar things in
+<a href="http://www.w3.org/International/O-HTTP-charset#scripting">other
+languages</a>. The appropriate code is:</p>
+
+<pre><a href="http://php.net/function.header">header</a>('Content-Type:text/html; charset=UTF-8');</pre>
+
+<p>...replacing UTF-8 with whatever your embedded encoding is.
+This code must come before any output, so be careful about
+stray whitespace in your application (i.e., any whitespace before
+output excluding whitespace within &lt;?php ?&gt; tags).</p>
+
+<h4 id="fixcharset-server-phpini">PHP ini directive</h4>
+
+<p>PHP also has a neat little ini directive that can save you a
+header call: <code><a href="http://php.net/ini.core#ini.default-charset">default_charset</a></code>. Using this code:</p>
+
+<pre><a href="http://php.net/function.ini_set">ini_set</a>('default_charset', 'UTF-8');</pre>
+
+<p>...will also do the trick. If PHP is running as an Apache module (and
+not as FastCGI, consult
+<a href="http://php.net/phpinfo">phpinfo</a>() for details), you can even use htaccess to apply this property
+across many PHP files:</p>
+
+<pre><a href="http://php.net/configuration.changes#configuration.changes.apache">php_value</a> default_charset &quot;UTF-8&quot;</pre>
+
+<blockquote class="aside"><p>As with all INI directives, this can
+also go in your php.ini file. Some hosting providers allow you to customize
+your own php.ini file, ask your support for details. Use:</p>
+<pre>default_charset = &quot;utf-8&quot;</pre></blockquote>
+
+<h4 id="fixcharset-server-nophp">Non-PHP</h4>
+
+<p>You may, for whatever reason, need to set the character encoding
+on non-PHP files, usually plain ol' HTML files. Doing this
+is more of a hit-or-miss process: depending on the software being
+used as a webserver and the configuration of that software, certain
+techniques may work, or may not work.</p>
+
+<h4 id="fixcharset-server-htaccess">.htaccess</h4>
+
+<p>On Apache, you can use an .htaccess file to change the character
+encoding. I'll defer to
+<a href="http://www.w3.org/International/questions/qa-htaccess-charset">W3C</a>
+for the in-depth explanation, but it boils down to creating a file
+named .htaccess with the contents:</p>
+
+<pre><a href="http://httpd.apache.org/docs/1.3/mod/mod_mime.html#addcharset">AddCharset</a> UTF-8 .html</pre>
+
+<p>Where UTF-8 is replaced with the character encoding you want to
+use and .html is a file extension that this will be applied to. This
+character encoding will then be set for any file directly in
+or in the subdirectories of directory you place this file in.</p>
+
+<p>If you're feeling particularly courageous, you can use:</p>
+
+<pre><a href="http://httpd.apache.org/docs/1.3/mod/core.html#adddefaultcharset">AddDefaultCharset</a> UTF-8</pre>
+
+<p>...which changes the character set Apache adds to any document that
+doesn't have any Content-Type parameters. This directive, which the
+default configuration file sets to iso-8859-1 for security
+reasons, is probably why your headers mismatch
+with the <code>META</code> tag. If you would prefer Apache not to be
+butting in on your character encodings, you can tell it not
+to send anything at all:</p>
+
+<pre><a href="http://httpd.apache.org/docs/1.3/mod/core.html#adddefaultcharset">AddDefaultCharset</a> Off</pre>
+
+<p>...making your internal charset declaration (usually the <code>META</code> tags)
+the sole source of character encoding
+information. In these cases, it is <em>especially</em> important to make
+sure you have valid <code>META</code> tags on your pages and all the
+text before them is ASCII.</p>
+
+<blockquote class="aside"><p>These directives can also be
+placed in httpd.conf file for Apache, but
+in most shared hosting situations you won't be able to edit this file.
+</p></blockquote>
+
+<h4 id="fixcharset-server-ext">File extensions</h4>
+
+<p>If you're not allowed to use .htaccess files, you can often
+piggy-back off of Apache's default AddCharset declarations to get
+your files in the proper extension. Here are Apache's default
+character set declarations:</p>
+
+<table class="table">
+    <thead><tr>
+        <th>Charset</th>
+        <th>File extension(s)</th>
+    </tr></thead>
+    <tbody>
+        <tr><td>ISO-8859-1</td><td>.iso8859-1 .latin1</td></tr>
+        <tr><td>ISO-8859-2</td><td>.iso8859-2 .latin2 .cen</td></tr>
+        <tr><td>ISO-8859-3</td><td>.iso8859-3 .latin3</td></tr>
+        <tr><td>ISO-8859-4</td><td>.iso8859-4 .latin4</td></tr>
+        <tr><td>ISO-8859-5</td><td>.iso8859-5 .latin5 .cyr .iso-ru</td></tr>
+        <tr><td>ISO-8859-6</td><td>.iso8859-6 .latin6 .arb</td></tr>
+        <tr><td>ISO-8859-7</td><td>.iso8859-7 .latin7 .grk</td></tr>
+        <tr><td>ISO-8859-8</td><td>.iso8859-8 .latin8 .heb</td></tr>
+        <tr><td>ISO-8859-9</td><td>.iso8859-9 .latin9 .trk</td></tr>
+        <tr><td>ISO-2022-JP</td><td>.iso2022-jp .jis</td></tr>
+        <tr><td>ISO-2022-KR</td><td>.iso2022-kr .kis</td></tr>
+        <tr><td>ISO-2022-CN</td><td>.iso2022-cn .cis</td></tr>
+        <tr><td>Big5</td><td>.Big5 .big5 .b5</td></tr>
+        <tr><td>WINDOWS-1251</td><td>.cp-1251 .win-1251</td></tr>
+        <tr><td>CP866</td><td>.cp866</td></tr>
+        <tr><td>KOI8-r</td><td>.koi8-r .koi8-ru</td></tr>
+        <tr><td>KOI8-ru</td><td>.koi8-uk .ua</td></tr>
+        <tr><td>ISO-10646-UCS-2</td><td>.ucs2</td></tr>
+        <tr><td>ISO-10646-UCS-4</td><td>.ucs4</td></tr>
+        <tr><td>UTF-8</td><td>.utf8</td></tr>
+        <tr><td>GB2312</td><td>.gb2312 .gb </td></tr>
+        <tr><td>utf-7</td><td>.utf7</td></tr>
+        <tr><td>EUC-TW</td><td>.euc-tw</td></tr>
+        <tr><td>EUC-JP</td><td>.euc-jp</td></tr>
+        <tr><td>EUC-KR</td><td>.euc-kr</td></tr>
+        <tr><td>shift_jis</td><td>.sjis</td></tr>
+    </tbody>
+</table>
+
+<p>So, for example, a file named <code>page.utf8.html</code> or
+<code>page.html.utf8</code> will probably be sent with the UTF-8 charset
+attached, the difference being that if there is an
+<code>AddCharset charset .html</code> declaration, it will override
+the .utf8 extension in <code>page.utf8.html</code> (precedence moves
+from right to left). By default, Apache has no such declaration.</p>
+
+<h4 id="fixcharset-server-iis">Microsoft IIS</h4>
+
+<p>If anyone can contribute information on how to configure Microsoft
+IIS to change character encodings, I'd be grateful.</p>
+
+<h3 id="fixcharset-xml">XML</h3>
+
+<p><code>META</code> tags are the most common source of embedded
+encodings, but they can also come from somewhere else: XML
+Declarations. They look like:</p>
+
+<pre>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</pre>
+
+<p>...and are most often found in XML documents (including XHTML).</p>
+
+<p>For XHTML, this XML Declaration theoretically
+overrides the <code>META</code> tag. In reality, this happens only when the
+XHTML is actually served as legit XML and not HTML, which is almost always
+never due to Internet Explorer's lack of support for
+<code>application/xhtml+xml</code> (even though doing so is often
+argued to be <a href="http://www.hixie.ch/advocacy/xhtml">good
+practice</a> and is required by the XHTML 1.1 specification).</p>
+
+<p>For XML, however, this XML Declaration is extremely important.
+Since most webservers are not configured to send charsets for .xml files,
+this is the only thing a parser has to go on. Furthermore, the default
+for XML files is UTF-8, which often butts heads with more common
+ISO-8859-1 encoding (you see this in garbled RSS feeds).</p>
+
+<p>In short, if you use XHTML and have gone through the
+trouble of adding the XML Declaration, make sure it jives
+with your <code>META</code> tags (which should only be present
+if served in text/html) and HTTP headers.</p>
+
+<h3 id="fixcharset-internals">Inside the process</h3>
+
+<p>This section is not required reading,
+but may answer some of your questions on what's going on in all
+this character encoding hocus pocus. If you're interested in
+moving on to the next phase, skip this section.</p>
+
+<p>A logical question that follows all of our wheeling and dealing
+with multiple sources of character encodings is &quot;Why are there
+so many options?&quot; To answer this question, we have to turn
+back our definition of character encodings: they allow a program
+to interpret bytes into human-readable characters.</p>
+
+<p>Thus, a chicken-egg problem: a character encoding
+is necessary to interpret the
+text of a document. A <code>META</code> tag is in the text of a document.
+The <code>META</code> tag gives the character encoding. How can we
+determine the contents of a <code>META</code> tag, inside the text,
+if we don't know it's character encoding? And how do we figure out
+the character encoding, if we don't know the contents of the
+<code>META</code> tag?</p>
+
+<p>Fortunately for us, the characters we need to write the
+<code>META</code> are in ASCII, which is pretty much universal
+over every character encoding that is in common use today. So,
+all the web-browser has to do is parse all the way down until
+it gets to the Content-Type tag, extract the character encoding
+tag, then re-parse the document according to this new information.</p>
+
+<p>Obviously this is complicated, so browsers prefer the simpler
+and more efficient solution: get the character encoding from a
+somewhere other than the document itself, i.e. the HTTP headers,
+much to the chagrin of HTML authors who can't set these headers.</p>
+
+<h2 id="whyutf8">Why UTF-8?</h2>
+
+<p>So, you've gone through all the trouble of ensuring that your
+server and embedded characters all line up properly and are
+present.  Good job: at
+this point, you could quit and rest easy knowing that your pages
+are not vulnerable to character encoding style XSS attacks.
+However, just as having a character encoding is better than
+having no character encoding at all, having UTF-8 as your
+character encoding is better than having some other random
+character encoding, and the next step is to convert to UTF-8.
+But why?</p>
+
+<h3 id="whyutf8-i18n">Internationalization</h3>
+
+<p>Many software projects, at one point or another, suddenly realize
+that they should be supporting more than one language. Even regular
+usage in one language sometimes requires the occasional special character
+that, without surprise, is not available in your character set. Sometimes
+developers get around this by adding support for multiple encodings: when
+using Chinese, use Big5, when using Japanese, use Shift-JIS, when
+using Greek, etc. Other times, they use character references with great
+zeal.</p>
+
+<p>UTF-8, however, obviates the need for any of these complicated
+measures. After getting the system to use UTF-8 and adjusting for
+sources that are outside the hand of the browser (more on this later),
+UTF-8 just works. You can use it for any language, even many languages
+at once, you don't have to worry about managing multiple encodings,
+you don't have to use those user-unfriendly entities.</p>
+
+<h3 id="whyutf8-user">User-friendly</h3>
+
+<p>Websites encoded in Latin-1 (ISO-8859-1) which occasionally need
+a special character outside of their scope often will use a character
+entity reference to achieve the desired effect. For instance, &theta; can be
+written <code>&amp;theta;</code>, regardless of the character encoding's
+support of Greek letters.</p>
+
+<p>This works nicely for limited use of special characters, but
+say you wanted this sentence of Chinese text: &#28608;&#20809;,
+&#36889;&#20841;&#20491;&#23383;&#26159;&#29978;&#40636;&#24847;&#24605;.
+The ampersand encoded version would look like this:</p>
+
+<pre>&amp;#28608;&amp;#20809;, &amp;#36889;&amp;#20841;&amp;#20491;&amp;#23383;&amp;#26159;&amp;#29978;&amp;#40636;&amp;#24847;&amp;#24605;</pre>
+
+<p>Extremely inconvenient for those of us who actually know what
+character entities are, totally unintelligible to poor users who don't!
+Even the slightly more user-friendly, &quot;intelligible&quot; character
+entities like <code>&amp;theta;</code> will leave users who are
+uninterested in learning HTML scratching their heads. On the other
+hand, if they see &theta; in an edit box, they'll know that it's a
+special character, and treat it accordingly, even if they don't know
+how to write that character themselves.</p>
+
+<blockquote class="aside"><p>Wikipedia is a great case study for
+an application that originally used ISO-8859-1 but switched to UTF-8
+when it became far to cumbersome to support foreign languages. Bots
+will now actually go through articles and convert character entities
+to their corresponding real characters for the sake of user-friendliness
+and searchability. See
+<a href="http://meta.wikimedia.org/wiki/Help:Special_characters">Meta's
+page on special characters</a> for more details.
+</p></blockquote>
+
+<h3 id="whyutf8-forms">Forms</h3>
+
+<p>While we're on the tack of users, how do non-UTF-8 web forms deal
+with characters that are outside of their character set? Rather than
+discuss what UTF-8 does right, we're going to show what could go wrong
+if you didn't use UTF-8 and people tried to use characters outside
+of your character encoding.</p>
+
+<p>The troubles are large, extensive, and extremely difficult to fix (or,
+at least, difficult enough that if you had the time and resources to invest
+in doing the fix, you would be probably better off migrating to UTF-8).
+There are two types of form submission: <code>application/x-www-form-urlencoded</code>
+which is used for GET and by default for POST, and <code>multipart/form-data</code>
+which may be used by POST, and is required when you want to upload
+files.</p>
+
+<p>The following is a summarization of notes from
+<a href="http://web.archive.org/web/20060427015200/ppewww.ph.gla.ac.uk/~flavell/charset/form-i18n.html">
+<code>FORM</code> submission and i18n</a>. That document contains lots
+of useful information, but is written in a rambly manner, so
+here I try to get right to the point. (Note: the original has
+disappeared off the web, so I am linking to the Web Archive copy.)</p>
+
+<h4 id="whyutf8-forms-urlencoded"><code>application/x-www-form-urlencoded</code></h4>
+
+<p>This is the Content-Type that GET requests must use, and POST requests
+use by default. It involves the ubiquitous percent encoding format that
+looks something like: <code>%C3%86</code>. There is no official way of
+determining the character encoding of such a request, since the percent
+encoding operates on a byte level, so it is usually assumed that it
+is the same as the encoding the page containing the form was submitted
+in. (<a href="http://tools.ietf.org/html/rfc3986#section-2.5">RFC 3986</a>
+recommends that textual identifiers be translated to UTF-8; however, browser
+compliance is spotty.) You'll run into very few problems
+if you only use characters in the character encoding you chose.</p>
+
+<p>However, once you start adding characters outside of your encoding
+(and this is a lot more common than you may think: take curly
+&quot;smart&quot; quotes from Microsoft as an example),
+a whole manner of strange things start to happen. Depending on the
+browser you're using, they might:</p>
+
+<ul>
+    <li>Replace the unsupported characters with useless question marks,</li>
+    <li>Attempt to fix the characters (example: smart quotes to regular quotes),</li>
+    <li>Replace the character with a character entity reference, or</li>
+    <li>Send it anyway as a different character encoding mixed in
+        with the original encoding (usually Windows-1252 rather than
+        iso-8859-1 or UTF-8 interspersed in 8-bit)</li>
+</ul>
+
+<p>To properly guard against these behaviors, you'd have to sniff out
+the browser agent, compile a database of different behaviors, and
+take appropriate conversion action against the string (disregarding
+a spate of extremely mysterious, random and devastating bugs Internet
+Explorer manifests every once in a while). Or you could
+use UTF-8 and rest easy knowing that none of this could possibly happen
+since UTF-8 supports every character.</p>
+
+<h4 id="whyutf8-forms-multipart"><code>multipart/form-data</code></h4>
+
+<p>Multipart form submission takes away a lot of the ambiguity
+that percent-encoding had: the server now can explicitly ask for
+certain encodings, and the client can explicitly tell the server
+during the form submission what encoding the fields are in.</p>
+
+<p>There are two ways you go with this functionality: leave it
+unset and have the browser send in the same encoding as the page,
+or set it to UTF-8 and then do another conversion server-side.
+Each method has deficiencies, especially the former.</p>
+
+<p>If you tell the browser to send the form in the same encoding as
+the page, you still have the trouble of what to do with characters
+that are outside of the character encoding's range. The behavior, once
+again, varies: Firefox 2.0 converts them to character entity references
+while Internet Explorer 7.0 mangles them beyond intelligibility. For
+serious internationalization purposes, this is not an option.</p>
+
+<p>The other possibility is to set Accept-Encoding to UTF-8, which
+begs the question: Why aren't you using UTF-8 for everything then?
+This route is more palatable, but there's a notable caveat: your data
+will come in as UTF-8, so you will have to explicitly convert it into
+your favored local character encoding.</p>
+
+<p>I object to this approach on idealogical grounds: you're
+digging yourself deeper into
+the hole when you could have been converting to UTF-8
+instead. And, of course, you can't use this method for GET requests.</p>
+
+<h3 id="whyutf8-support">Well supported</h3>
+
+<p>Almost every modern browser in the wild today has full UTF-8 and Unicode
+support: the number of troublesome cases can be counted with the
+fingers of one hand, and these browsers usually have trouble with
+other character encodings too. Problems users usually encounter stem
+from the lack of appropriate fonts to display the characters (once
+again, this applies to all character encodings and HTML entities) or
+Internet Explorer's lack of intelligent font picking (which can be
+worked around).</p>
+
+<p>We will go into more detail about how to deal with edge cases in
+the browser world in the Migration section, but rest assured that
+converting to UTF-8, if done correctly, will not result in users
+hounding you about broken pages.</p>
+
+<h3 id="whyutf8-htmlpurifier">HTML Purifier</h3>
+
+<p>And finally, we get to HTML Purifier.  HTML Purifier is built to
+deal with UTF-8: any indications otherwise are the result of an
+encoder that converts text from your preferred encoding to UTF-8, and
+back again.  HTML Purifier never touches anything else, and leaves
+it up to the module iconv to do the dirty work.</p>
+
+<p>This approach, however, is not perfect. iconv is blithely unaware
+of HTML character entities. HTML Purifier, in order to
+protect against sophisticated escaping schemes, normalizes all character
+and numeric entity references before processing the text. This leads to
+one important ramification:</p>
+
+<p><strong>Any character that is not supported by the target character
+set, regardless of whether or not it is in the form of a character
+entity reference or a raw character, will be silently ignored.</strong></p>
+
+<p>Example of this principle at work: say you have <code>&amp;theta;</code>
+in your HTML, but the output is in Latin-1 (which, understandably,
+does not understand Greek), the following process will occur (assuming you've
+set the encoding correctly using %Core.Encoding):</p>
+
+<ul>
+    <li>The <code>Encoder</code> will transform the text from ISO 8859-1 to UTF-8
+        (note that theta is preserved here since it doesn't actually use
+        any non-ASCII characters): <code>&amp;theta;</code></li>
+    <li>The <code>EntityParser</code> will transform all named and numeric
+        character entities to their corresponding raw UTF-8 equivalents:
+        <code>&theta;</code></li>
+    <li>HTML Purifier processes the code: <code>&theta;</code></li>
+    <li>The <code>Encoder</code> now transforms the text back from UTF-8
+        to ISO 8859-1. Since Greek is not supported by ISO 8859-1, it
+        will be either ignored or replaced with a question mark:
+        <code>?</code></li>
+</ul>
+
+<p>This behaviour is quite unsatisfactory. It is a deal-breaker for
+international applications, and it can be mildly annoying for the provincial
+soul who occasionally needs a special character. Since 1.4.0, HTML
+Purifier has provided a slightly more palatable workaround using
+%Core.EscapeNonASCIICharacters. The process now looks like:</p>
+
+<ul>
+    <li>The <code>Encoder</code> transforms encoding to UTF-8: <code>&amp;theta;</code></li>
+    <li>The <code>EntityParser</code> transforms entities: <code>&theta;</code></li>
+    <li>HTML Purifier processes the code: <code>&theta;</code></li>
+    <li>The <code>Encoder</code> replaces all non-ASCII characters
+        with numeric entity reference: <code>&amp;#952;</code></li>
+    <li>For good measure, <code>Encoder</code> transforms encoding back to
+        original (which is strictly unnecessary for 99% of encodings
+        out there): <code>&amp;#952;</code> (remember, it's all ASCII!)</li>
+</ul>
+
+<p>...which means that this is only good for an occasional foray into
+the land of Unicode characters, and is totally unacceptable for Chinese
+or Japanese texts. The even bigger kicker is that, supposing the
+input encoding was actually ISO-8859-7, which <em>does</em> support
+theta, the character would get converted into a character entity reference
+anyway! (The Encoder does not discriminate).</p>
+
+<p>The current functionality is about where HTML Purifier will be for
+the rest of eternity. HTML Purifier could attempt to preserve the original
+form of the character references so that they could be substituted back in, only the
+DOM extension kills them off irreversibly. HTML Purifier could also attempt
+to be smart and only convert non-ASCII characters that weren't supported
+by the target encoding, but that would require reimplementing iconv
+with HTML awareness, something I will not do.</p>
+
+<p>So there: either it's UTF-8 or crippled international support. Your pick! (and I'm
+not being sarcastic here: some people could care less about other languages).</p>
+
+<h2 id="migrate">Migrate to UTF-8</h2>
+
+<p>So, you've decided to bite the bullet, and want to migrate to UTF-8.
+Note that this is not for the faint-hearted, and you should expect
+the process to take longer than you think it will take.</p>
+
+<p>The general idea is that you convert all existing text to UTF-8,
+and then you set all the headers and META tags we discussed earlier
+to UTF-8. There are many ways going about doing this: you could
+write a conversion script that runs through the database and re-encodes
+everything as UTF-8 or you could do the conversion on the fly when someone
+reads the page. The details depend on your system, but I will cover
+some of the more subtle points of migration that may trip you up.</p>
+
+<h3 id="migrate-db">Configuring your database</h3>
+
+<p>Most modern databases, the most prominent open-source ones being MySQL
+4.1+ and PostgreSQL, support character encodings. If you're switching
+to UTF-8, logically speaking, you'd want to make sure your database
+knows about the change too. There are some caveats though:</p>
+
+<h4 id="migrate-db-legit">Legit method</h4>
+
+<p>Standardization in terms of SQL syntax for specifying character
+encodings is notoriously spotty. Refer to your respective database's
+documentation on how to do this properly.</p>
+
+<p>For <a href="http://dev.mysql.com/doc/refman/5.0/en/charset-conversion.html">MySQL</a>, <code>ALTER</code> will magically perform the
+character encoding conversion for you. However, you have
+to make sure that the text inside the column is what is says it is:
+if you had put Shift-JIS in an ISO 8859-1 column, MySQL will irreversibly mangle
+the text when you try to convert it to UTF-8. You'll have to convert
+it to a binary field, convert it to a Shift-JIS field (the real encoding),
+and then finally to UTF-8. Many a website had pages irreversibly mangled
+because they didn't realize that they'd been deluding themselves about
+the character encoding all along; don't become the next victim.</p>
+
+<p>For <a href="http://www.postgresql.org/docs/8.2/static/multibyte.html">PostgreSQL</a>, there appears to be no direct way to change the
+encoding of a database (as of 8.2). You will have to dump the data, and then reimport
+it into a new table. Make sure that your client encoding is set properly:
+this is how PostgreSQL knows to perform an encoding conversion.</p>
+
+<p>Many times, you will be also asked about the &quot;collation&quot; of
+the new column. Collation is how a DBMS sorts text, like ordering
+B, C and A into A, B and C (the problem gets surprisingly complicated
+when you get to languages like Thai and Japanese). If in doubt,
+going with the default setting is usually a safe bet.</p>
+
+<p>Once the conversion is all said and done, you still have to remember
+to set the client encoding (your encoding) properly on each database
+connection using <code>SET NAMES</code> (which is standard SQL and is
+usually supported).</p>
+
+<h4 id="migrate-db-binary">Binary</h4>
+
+<p>Due to the aforementioned compatibility issues, a more interoperable
+way of storing UTF-8 text is to stuff it in a binary datatype.
+<code>CHAR</code> becomes <code>BINARY</code>, <code>VARCHAR</code> becomes
+<code>VARBINARY</code> and <code>TEXT</code> becomes <code>BLOB</code>.
+Doing so can save you some huge headaches:</p>
+
+<ul>
+    <li>The syntax for binary data types is very portable,</li>
+    <li>MySQL 4.0 has <em>no</em> support for character encodings, so
+        if you want to support it you <em>have</em> to use binary,</li>
+    <li>MySQL, as of 5.1, has no support for four byte UTF-8 characters,
+        which represent characters beyond the basic multilingual
+        plane, and</li>
+    <li>You will never have to worry about your DBMS being too smart
+        and attempting to convert your text when you don't want it to.</li>
+</ul>
+
+<p>MediaWiki, a very prominent international application, uses binary fields
+for storing their data because of point three.</p>
+
+<p>There are drawbacks, of course:</p>
+
+<ul>
+    <li>Database tools like PHPMyAdmin won't be able to offer you inline
+        text editing, since it is declared as binary,</li>
+    <li>It's not semantically correct: it's really text not binary
+        (lying to the database),</li>
+    <li>Unless you use the not-very-portable wizardry mentioned above,
+        you have to change the encoding yourself (usually, you'd do
+        it on the fly), and</li>
+    <li>You will not have collation.</li>
+</ul>
+
+<p>Choose based on your circumstances.</p>
+
+<h3 id="migrate-editor">Text editor</h3>
+
+<p>For more flat-file oriented systems, you will often be tasked with
+converting reams of existing text and HTML files into UTF-8, as well as
+making sure that all new files uploaded are properly encoded. Once again,
+I can only point vaguely in the right direction for converting your
+existing files: make sure you backup, make sure you use
+<a href="http://php.net/ref.iconv">iconv</a>(), and
+make sure you know what the original character encoding of the files
+is (or are, depending on the tidiness of your system).</p>
+
+<p>However, I can proffer more specific advice on the subject of
+text editors. Many text editors have notoriously spotty Unicode support.
+To find out how your editor is doing, you can check out <a
+href="http://www.alanwood.net/unicode/utilities_editors.html">this list</a>
+or <a href="http://en.wikipedia.org/wiki/Comparison_of_text_editors#Encoding_support">Wikipedia's list.</a>
+I personally use Notepad++, which works like a charm when it comes to UTF-8.
+Usually, you will have to <strong>explicitly</strong> tell the editor through some dialogue
+(usually Save as or Format) what encoding you want it to use. An editor
+will often offer &quot;Unicode&quot; as a method of saving, which is
+ambiguous. Make sure you know whether or not they really mean UTF-8
+or UTF-16 (which is another flavor of Unicode).</p>
+
+<p>The two things to look out for are whether or not the editor
+supports <strong>font mixing</strong> (multiple
+fonts in one document) and whether or not it adds a <strong>BOM</strong>.
+Font mixing is important because fonts rarely have support for every
+language known to mankind: in order to be flexible, an editor must
+be able to take a little from here and a little from there, otherwise
+all your Chinese characters will come as nice boxes. We'll discuss
+BOM below.</p>
+
+<h3 id="migrate-bom">Byte Order Mark (headers already sent!)</h3>
+
+<p>The BOM, or <a href="http://en.wikipedia.org/wiki/Byte_Order_Mark">Byte
+Order Mark</a>, is a magical, invisible character placed at
+the beginning of UTF-8 files to tell people what the encoding is and
+what the endianness of the text is. It is also unnecessary.</p>
+
+<p>Because it's invisible, it often
+catches people by surprise when it starts doing things it shouldn't
+be doing. For example, this PHP file:</p>
+
+<pre><strong>BOM</strong>&lt;?php
+header('Location: index.php');
+?&gt;</pre>
+
+<p>...will fail with the all too familiar <strong>Headers already sent</strong>
+PHP error. And because the BOM is invisible, this culprit will go unnoticed.
+My suggestion is to only use ASCII in PHP pages, but if you must, make
+sure the page is saved WITHOUT the BOM.</p>
+
+<blockquote class="aside">
+    <p>The headers the error is referring to are <strong>HTTP headers</strong>,
+       which are sent to the browser before any HTML to tell it various
+       information. The moment any regular text (and yes, a BOM counts as
+       ordinary text) is output, the headers must be sent, and you are
+       not allowed to send anymore. Thus, the error.</p>
+</blockquote>
+
+<p>If you are reading in text files to insert into the middle of another
+page, it is strongly advised (but not strictly necessary) that you replace out the UTF-8 byte
+sequence for BOM <code>&quot;\xEF\xBB\xBF&quot;</code> before inserting it in,
+via:</p>
+
+<pre>$text = str_replace(&quot;\xEF\xBB\xBF&quot;, '', $text);</pre>
+
+<h3 id="migrate-fonts">Fonts</h3>
+
+<p>Generally speaking, people who are having trouble with fonts fall
+into two categories:</p>
+
+<ul>
+<li>Those who want to
+use an extremely obscure language for which there is very little
+support even among native speakers of the language, and</li>
+<li>Those where the primary language of the text is
+well-supported but there are occasional characters
+that aren't supported.</li>
+</ul>
+
+<p>Yes, there's always a chance where an English user happens across
+a Sinhalese website and doesn't have the right font. But an English user
+who happens not to have the right fonts probably has no business reading Sinhalese
+anyway. So we'll deal with the other two edge cases.</p>
+
+<h4 id="migrate-fonts-obscure">Obscure scripts</h4>
+
+<p>If you run a Bengali website, you may get comments from users who
+would like to read your website but get heaps of question marks or
+other meaningless characters. Fixing this problem requires the
+installation of a font or language pack which is often highly
+dependent on what the language is. <a href="http://bn.wikipedia.org/wiki/%E0%A6%89%E0%A6%87%E0%A6%95%E0%A6%BF%E0%A6%AA%E0%A7%87%E0%A6%A1%E0%A6%BF%E0%A6%AF%E0%A6%BC%E0%A6%BE:Bangla_script_display_and_input_help">Here is an example</a>
+of such a help file for the Bengali language; I am sure there are
+others out there too. You just have to point users to the appropriate
+help file.</p>
+
+<h4 id="migrate-fonts-occasional">Occasional use</h4>
+
+<p>A prime example of when you'll see some very obscure Unicode
+characters embedded in what otherwise would be very bland ASCII are
+letters of the
+<a href="http://en.wikipedia.org/wiki/International_Phonetic_Alphabet">International
+Phonetic Alphabet (IPA)</a>, use to designate pronunciations in a very standard
+manner (you probably see them all the time in your dictionary). Your
+average font probably won't have support for all of the IPA characters
+like &#664; (bilabial click) or &#658; (voiced postalveolar fricative).
+So what's a poor browser to do? Font mix! Smart browsers like Mozilla Firefox
+and Internet Explorer 7 will borrow glyphs from other fonts in order
+to make sure that all the characters display properly.</p>
+
+<p>But what happens when the browser isn't smart and happens to be the
+most widely used browser in the entire world? Microsoft IE 6
+is not smart enough to borrow from other fonts when a character isn't
+present, so more often than not you'll be slapped with a nice big &#65533;.
+To get things to work, MSIE 6 needs a little nudge. You could configure it
+to use a different font to render the text, but you can achieve the same
+effect by selectively changing the font for blocks of special characters
+to known good Unicode fonts.</p>
+
+<p>Fortunately, the folks over at Wikipedia have already done all the
+heavy lifting for you. Get the CSS from the horses mouth here:
+<a href="http://en.wikipedia.org/wiki/MediaWiki:Common.css">Common.css</a>,
+and search for &quot;.IPA&quot; There are also a smattering of
+other classes you can use for other purposes, check out
+<a href="http://meta.wikimedia.org/wiki/Help:Special_characters#Displaying_Special_Characters">this page</a>
+for more details. For you lazy ones, this should work:</p>
+
+<pre>.Unicode {
+        font-family: Code2000, &quot;TITUS Cyberbit Basic&quot;, &quot;Doulos SIL&quot;,
+            &quot;Chrysanthi Unicode&quot;, &quot;Bitstream Cyberbit&quot;,
+            &quot;Bitstream CyberBase&quot;, Thryomanes, Gentium, GentiumAlt,
+            &quot;Lucida Grande&quot;, &quot;Arial Unicode MS&quot;, &quot;Microsoft Sans Serif&quot;,
+            &quot;Lucida Sans Unicode&quot;;
+        font-family /**/:inherit; /* resets fonts for everyone but IE6 */
+}</pre>
+
+<p>The standard usage goes along the lines of <code>&lt;span class=&quot;Unicode&quot;&gt;Crazy
+Unicode stuff here&lt;/span&gt;</code>. Characters in the
+<a href="http://en.wikipedia.org/wiki/Windows_Glyph_List_4">Windows Glyph List</a>
+usually don't need to be fixed, but for anything else you probably
+want to play it safe. Unless, of course, you don't care about IE6
+users.</p>
+
+<h3 id="migrate-variablewidth">Dealing with variable width in functions</h3>
+
+<p>When people claim that PHP6 will solve all our Unicode problems, they're
+misinformed. It will not fix any of the aforementioned troubles. It will,
+however, fix the problem we are about to discuss: processing UTF-8 text
+in PHP.</p>
+
+<p>PHP (as of PHP5) is blithely unaware of the existence of UTF-8 (with a few
+notable exceptions). Sometimes, this will cause problems, other times,
+this won't. So far, we've avoided discussing the architecture of
+UTF-8, so, we must first ask, what is UTF-8? Yes, it supports Unicode,
+and yes, it is variable width. Other traits:</p>
+
+<ul>
+    <li>Every character's byte sequence is unique and will never be found
+        inside the byte sequence of another character,</li>
+    <li>UTF-8 may use up to four bytes to encode a character,</li>
+    <li>UTF-8 text must be checked for well-formedness,</li>
+    <li>Pure ASCII is also valid UTF-8, and</li>
+    <li>Binary sorting will sort UTF-8 in the same order as Unicode.</li>
+</ul>
+
+<p>Each of these traits affect different domains of text processing
+in different ways. It is beyond the scope of this document to explain
+what precisely these implications are. PHPWact provides
+a very good <a href="http://www.phpwact.org/php/i18n/utf-8">reference document</a>
+on what to expect from each function, although coverage is spotty in
+some areas. Their more general notes on
+<a href="http://www.phpwact.org/php/i18n/charsets">character sets</a>
+are also worth looking at for information on UTF-8. Some rules of thumb
+when dealing with Unicode text:</p>
+
+<ul>
+    <li>Do not EVER use functions that:<ul>
+        <li>...convert case (strtolower, strtoupper, ucfirst, ucwords)</li>
+        <li>...claim to be case-insensitive (str_ireplace, stristr, strcasecmp)</li>
+    </ul></li>
+    <li>Think twice before using functions that:<ul>
+        <li>...count characters (strlen will return bytes, not characters;
+            str_split and word_wrap may corrupt)</li>
+        <li>...convert characters to entity references (UTF-8 doesn't need entities)</li>
+        <li>...do very complex string processing (*printf)</li>
+    </ul></li>
+</ul>
+
+<p>Note: this list applies to UTF-8 encoded text only: if you have
+a string that you are 100% sure is ASCII, be my guest and use
+<code>strtolower</code> (HTML Purifier uses this function.)</p>
+
+<p>Regardless, always think in bytes, not characters. If you use strpos()
+to find the position of a character, it will be in bytes, but this
+usually won't matter since substr() also operates with byte indices!</p>
+
+<p>You'll also need to make sure your UTF-8 is well-formed and will
+probably need replacements for some of these functions. I recommend
+using Harry Fuecks' <a href="http://phputf8.sourceforge.net/">PHP
+UTF-8</a> library, rather than use mb_string directly. HTML Purifier
+also defines a few useful UTF-8 compatible functions: check out
+<code>Encoder.php</code> in the <code>/library/HTMLPurifier/</code>
+directory.</p>
+
+<h2 id="externallinks">Further Reading</h2>
+
+<p>Well, that's it. Hopefully this document has served as a very
+practical springboard into knowledge of how UTF-8 works.  You may have
+decided that you don't want to migrate yet: that's fine, just know
+what will happen to your output and what bug reports you may receive.</p>
+
+<p>Many other developers have already discussed the subject of Unicode,
+UTF-8 and internationalization, and I would like to defer to them for
+a more in-depth look into character sets and encodings.</p>
+
+<ul>
+    <li><a href="http://www.joelonsoftware.com/articles/Unicode.html">
+        The Absolute Minimum Every Software Developer Absolutely,
+        Positively Must Know About Unicode and Character Sets
+        (No Excuses!)</a> by Joel Spolsky, provides a <em>very</em>
+        good high-level look at Unicode and character sets in general.</li>
+    <li><a href="http://en.wikipedia.org/wiki/UTF-8">UTF-8 on Wikipedia</a>,
+        provides a lot of useful details into the innards of UTF-8, although
+        it may be a little off-putting to people who don't know much
+        about Unicode to begin with.</li>
+</ul>
+
+</body>
+</html>
+
+<!-- vim: et sw=4 sts=4
+-->

--- libraries/htmlpurifier/docs/enduser-youtube.html ---
@@ -0,0 +1,153 @@
+<?xml version="1.0" encoding="UTF-8"?>
+<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
+    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
+<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"><head>
+<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
+<meta name="description" content="Explains how to safely allow the embedding of flash from trusted sites in HTML Purifier." />
+<link rel="stylesheet" type="text/css" href="./style.css" />
+
+<title>Embedding YouTube Videos - HTML Purifier</title>
+
+</head><body>
+
+<h1 class="subtitled">Embedding YouTube Videos</h1>
+<div class="subtitle">...as well as other dangerous active content</div>
+
+<div id="filing">Filed under End-User</div>
+<div id="index">Return to the <a href="index.html">index</a>.</div>
+<div id="home"><a href="http://htmlpurifier.org/">HTML Purifier</a> End-User Documentation</div>
+
+<p>Clients like their YouTube videos. It gives them a warm fuzzy feeling when
+they see a neat little embedded video player on their websites that can play
+the latest clips from their documentary &quot;Fido and the Bones of Spring&quot;.
+All joking aside, the ability to embed YouTube videos or other active
+content in their pages is something that a lot of people like.</p>
+
+<p>This is a <em>bad</em> idea. The moment you embed anything untrusted,
+you will definitely be slammed by a manner of nasties that can be
+embedded in things from your run of the mill Flash movie to
+<a href="http://blog.spywareguide.com/2006/12/myspace_phish_attack_leads_use.html">Quicktime movies</a>.
+Even <code>img</code> tags, which HTML Purifier allows by default, can be
+dangerous. Be distrustful of anything that tells a browser to load content
+from another website automatically.</p>
+
+<p>Luckily for us, however, whitelisting saves the day. Sure, letting users
+include any old random flash file could be dangerous, but if it's
+from a specific website, it probably is okay. If no amount of pleading will
+convince the people upstairs that they should just settle with just linking
+to their movies, you may find this technique very useful.</p>
+
+<h2>Looking in</h2>
+
+<p>Below is custom code that allows users to embed
+YouTube videos. This is not favoritism: this trick can easily be adapted for
+other forms of embeddable content.</p>
+
+<p>Usually, websites like YouTube give us boilerplate code that you can insert
+into your documents. YouTube's code goes like this:</p>
+
+<pre>
+&lt;object width=&quot;425&quot; height=&quot;350&quot;&gt;
+  &lt;param name=&quot;movie&quot; value=&quot;http://www.youtube.com/v/AyPzM5WK8ys&quot; /&gt;
+  &lt;param name=&quot;wmode&quot; value=&quot;transparent&quot; /&gt;
+  &lt;embed src=&quot;http://www.youtube.com/v/AyPzM5WK8ys&quot;
+         type=&quot;application/x-shockwave-flash&quot;
+         wmode=&quot;transparent&quot; width=&quot;425&quot; height=&quot;350&quot; /&gt;
+&lt;/object&gt;
+</pre>
+
+<p>There are two things to note about this code:</p>
+
+<ol>
+    <li><code>&lt;embed&gt;</code> is not recognized by W3C, so if you want
+        standards-compliant code, you'll have to get rid of it.</li>
+    <li>The code is exactly the same for all instances, except for the
+        identifier <tt>AyPzM5WK8ys</tt> which tells us which movie file
+        to retrieve.</li>
+</ol>
+
+<p>What point 2 means is that if we have code like <code>&lt;span
+class=&quot;youtube-embed&quot;&gt;AyPzM5WK8ys&lt;/span&gt;</code> your
+application can reconstruct the full object from this small snippet that
+passes through HTML Purifier <em>unharmed</em>.
+<a href="http://repo.or.cz/w/htmlpurifier.git?a=blob;hb=HEAD;f=library/HTMLPurifier/Filter/YouTube.php">Show me the code!</a></p>
+
+<p>And the corresponding usage:</p>
+
+<pre>&lt;?php
+    $config-&gt;set('Filter.YouTube', true);
+?&gt;</pre>
+
+<p>There is a bit going in the two code snippets, so let's explain.</p>
+
+<ol>
+    <li>This is a Filter object, which intercepts the HTML that is
+        coming into and out of the purifier. You can add as many
+        filter objects as you like. <code>preFilter()</code>
+        processes the code before it gets purified, and <code>postFilter()</code>
+        processes the code afterwards. So, we'll use <code>preFilter()</code> to
+        replace the object tag with a <code>span</code>, and <code>postFilter()</code>
+        to restore it.</li>
+    <li>The first preg_replace call replaces any YouTube code users may have
+        embedded into the benign span tag. Span is used because it is inline,
+        and objects are inline too. We are very careful to be extremely
+        restrictive on what goes inside the span tag, as if an errant code
+        gets in there it could get messy.</li>
+    <li>The HTML is then purified as usual.</li>
+    <li>Then, another preg_replace replaces the span tag with a fully fledged
+        object. Note that the embed is removed, and, in its place, a data
+        attribute was added to the object. This makes the tag standards
+        compliant! It also breaks Internet Explorer, so we add in a bit of
+        conditional comments with the old embed code to make it work again.
+        It's all quite convoluted but works.</li>
+</ol>
+
+<h2>Warning</h2>
+
+<p>There are a number of possible problems with the code above, depending
+on how you look at it.</p>
+
+<h3>Cannot change width and height</h3>
+
+<p>The width and height of the final YouTube movie cannot be adjusted. This
+is because I am lazy. If you really insist on letting users change the size
+of the movie, what you need to do is package up the attributes inside the
+span tag (along with the movie ID). It gets complicated though: a malicious
+user can specify an outrageously large height and width and attempt to crash
+the user's operating system/browser. You need to either cap it by limiting
+the amount of digits allowed in the regex or using a callback to check the
+number.</p>
+
+<h3>Trusts media's host's security</h3>
+
+<p>By allowing this code onto our website, we are trusting that YouTube has
+tech-savvy enough people not to allow their users to inject malicious
+code into the Flash files.  An exploit on YouTube means an exploit on your
+site.  Even though YouTube is run by the reputable Google, it
+<a href="http://ha.ckers.org/blog/20061213/google-xss-vuln/">doesn't</a>
+mean they are
+<a href="http://ha.ckers.org/blog/20061208/xss-in-googles-orkut/">invulnerable.</a>
+You're putting a certain measure of the job on an external provider (just as
+you have by entrusting your user input to HTML Purifier), and
+it is important that you are cognizant of the risk.</p>
+
+<h3>Poorly written adaptations compromise security</h3>
+
+<p>This should go without saying, but if you're going to adapt this code
+for Google Video or the like, make sure you do it <em>right</em>. It's
+extremely easy to allow a character too many in <code>postFilter()</code> and
+suddenly you're introducing XSS into HTML Purifier's XSS free output. HTML
+Purifier may be well written, but it cannot guard against vulnerabilities
+introduced after it has finished.</p>
+
+<h2>Help out!</h2>
+
+<p>If you write a filter for your favorite video destination (or anything
+like that, for that matter), send it over and it might get included
+with the core!</p>
+
+</body>
+</html>
+
+<!-- vim: et sw=4 sts=4
+-->


--- dockerfile ---
@@ -162,9 +162,7 @@ RUN rm -f /etc/nginx/sites-enabled/default && \
         location /rss/ { \
             rewrite ^/rss/([a-zA-Z0-9].+)$ /rss.php?mode=$1&$query_string last; \
         } \
-        location /list/ { \
-            rewrite ^/list/([0-9]+)/(.*)?$ /view_playlist.php?list_id=$1 last; \
-        } \
+
         location ~ /rss$ { \
             try_files $uri /rss.php; \
         } \

--- upload/.htaccess ---
@@ -85,7 +85,6 @@ RewriteRule ^rss/([a-zA-Z0-9].+)$                   rss.php?mode=$1&%{QUERY_STRI
 
 ########## End - Rewrite rules For SEO urls ######################
 RewriteRule	^([a-zA-Z0-9-]+)/?$ 	                view_channel.php?uid=$1&seo_diret=yes [NS]
-RewriteRule	^list/([0-9]+)/(.*)?$ 	                view_playlist.php?list_id=$1 [NS]
 
 #Error Pages
 ErrorDocument 404 /404.php

--- upload/admin_area/manage_playlist.php ---
@@ -121,20 +121,6 @@
             $cbvid->action->edit_playlist();
         }
 
-
-        if (isset($_POST['upload_playlist_cover'])) {
-            $cover = $_FILES['playlist_cover'];
-            $cover['playlist_id'] = $pid;
-
-            if (playlist_upload_cover($cover)) {
-                e(lang('Playlist cover has been uploaded'), 'm');
-            }
-
-            if (file_exists($cover['tmp_name'])) {
-                unlink($cover['tmp_name']);
-            }
-        }
-
         //Deleting Item
         if (!empty($_GET['delete_item'])) {
             $delid = mysql_clean($_GET['delete_item']);

--- upload/cb_install/sql/5.5.1/M00239.php ---
@@ -0,0 +1,20 @@
+<?php
+
+namespace V5_5_1;
+require_once \DirPath::get('classes') . DIRECTORY_SEPARATOR . 'migration' . DIRECTORY_SEPARATOR . 'migration.class.php';
+
+class M00239 extends \Migration
+{
+    /**
+     * @throws \Exception
+     */
+    public function start()
+    {
+        self::generateTranslation('no_vid_in_playlist', [
+            'fr' => 'Aucune vidéo trouvée dans cette playlist !',
+            'en' => 'No video found in this playlist!',
+            'de' => 'Kein Video in dieser Wiedergabeliste gefunden!',
+            'pt-BR' => 'Nenhum vídeo encontrado nesta lista de reprodução!'
+        ]);
+    }
+}
\ No newline at end of file

--- upload/cb_install/sql/language_DEU.sql ---
@@ -1717,3 +1717,5 @@ INSERT INTO `{tbl_prefix}languages_translations` (`language_id`, `id_language_ke
 VALUES (@language_id, (SELECT id_language_key FROM `{tbl_prefix}languages_keys` WHERE language_key = 'photo_tags'), 'Foto-Tags');
 INSERT INTO `{tbl_prefix}languages_translations` (`language_id`, `id_language_key`, `translation`)
 VALUES (@language_id, (SELECT id_language_key FROM `{tbl_prefix}languages_keys` WHERE language_key = 'collection_is'), 'Sammlung ist %s');
+INSERT INTO `{tbl_prefix}languages_translations` (`language_id`, `id_language_key`, `translation`)
+VALUES (@language_id, (SELECT id_language_key FROM `{tbl_prefix}languages_keys` WHERE language_key = 'no_vid_in_playlist'), 'Kein Video in dieser Wiedergabeliste gefunden!');

--- upload/cb_install/sql/language_ENG.sql ---
@@ -2773,4 +2773,5 @@ INSERT INTO `{tbl_prefix}languages_translations` (`id_language_key`, `translatio
 VALUES ((SELECT id_language_key FROM `{tbl_prefix}languages_keys` WHERE `language_key` = 'option_nsfw'), 'NSFW', @language_id);
 INSERT INTO `{tbl_prefix}languages_translations` (`id_language_key`, `translation`, `language_id`)
 VALUES ((SELECT id_language_key FROM `{tbl_prefix}languages_keys` WHERE `language_key` = 'option_nudity_nsfw'), 'Nudity + NSFW', @language_id);
-
+INSERT INTO `{tbl_prefix}languages_translations` (`id_language_key`, `translation`, `language_id`)
+VALUES ((SELECT id_language_key FROM `{tbl_prefix}languages_keys` WHERE `language_key` = 'no_vid_in_playlist'), 'No video found in this playlist!', @language_id);

--- upload/cb_install/sql/language_FRA.sql ---
@@ -1969,3 +1969,5 @@ INSERT INTO `{tbl_prefix}languages_translations` (`id_language_key`, `translatio
 VALUES ((SELECT id_language_key FROM `{tbl_prefix}languages_keys` WHERE `language_key` = 'option_nsfw'), 'Contenu mature', @language_id);
 INSERT INTO `{tbl_prefix}languages_translations` (`id_language_key`, `translation`, `language_id`)
 VALUES ((SELECT id_language_key FROM `{tbl_prefix}languages_keys` WHERE `language_key` = 'option_nudity_nsfw'), 'Nudité + contenu mature', @language_id);
+INSERT INTO `{tbl_prefix}languages_translations` (`id_language_key`, `translation`, `language_id`)
+VALUES ((SELECT id_language_key FROM `{tbl_prefix}languages_keys` WHERE `language_key` = 'no_vid_in_playlist'), 'Aucune vidéo trouvée dans cette playlist !', @language_id);

--- upload/cb_install/sql/language_POR.sql ---
@@ -2116,4 +2116,6 @@ VALUES ((SELECT id_language_key FROM `{tbl_prefix}languages_keys` WHERE `languag
 INSERT INTO `{tbl_prefix}languages_translations` (`id_language_key`, `translation`, `language_id`)
 VALUES ((SELECT id_language_key FROM `{tbl_prefix}languages_keys` WHERE `language_key` = 'update_category'), 'Atualizar Categoria', @language_id);
 INSERT INTO `{tbl_prefix}languages_translations` (`id_language_key`, `translation`, `language_id`)
-VALUES ((SELECT id_language_key FROM `{tbl_prefix}languages_keys` WHERE `language_key` = 'add_new_category'), 'Adicionar Nova Categoria', @language_id);
\ No newline at end of file
+VALUES ((SELECT id_language_key FROM `{tbl_prefix}languages_keys` WHERE `language_key` = 'add_new_category'), 'Adicionar Nova Categoria', @language_id);
+INSERT INTO `{tbl_prefix}languages_translations` (`id_language_key`, `translation`, `language_id`)
+VALUES ((SELECT id_language_key FROM `{tbl_prefix}languages_keys` WHERE `language_key` = 'no_vid_in_playlist'), 'Nenhum vídeo encontrado nesta lista de reprodução!', @language_id);

--- upload/cb_install/sql/languages.sql ---
@@ -1386,4 +1386,5 @@ VALUES ('admin_setting'),
        ('option_nsfw_check_model'),
        ('option_nudity'),
        ('option_nsfw'),
-       ('option_nudity_nsfw');
+       ('option_nudity_nsfw'),
+       ('no_vid_in_playlist');

--- upload/changelog/551.json ---
@@ -1,6 +1,6 @@
 {
   "version":"5.5.1",
-  "revision":"238",
+  "revision":"239",
   "status":"dev",
   "detail":[
     {
@@ -217,6 +217,7 @@
         ,"Fix video title overflow"
         ,"Fix possible arbitrary file deletion (Thanks @kawing-ho !)"
         ,"Fix possible unauthenticated template change (Thanks @kawing-ho !)"
+        ,"Fix possible remote code execution (Thanks @kawing-ho !)"
       ]
     },
     {

--- upload/includes/classes/actions.class.php ---
@@ -487,28 +487,33 @@ function load_playlist_fields($array = null): array
      */
     function create_playlist($params)
     {
-        if (User::getInstance()->hasPermission('allow_create_playlist')) {
-            $name = mysql_clean($params['name']);
-            if (!user_id()) {
-                e(lang('please_login_create_playlist'));
-            } elseif (empty($name)) {
-                e(lang('please_enter_playlist_name'));
-            } elseif ($this->playlist_exists($name, user_id(), $this->type)) {
-                e(lang('play_list_with_this_name_arlready_exists', $name));
-            } else {
-                $fields = ['playlist_name', 'userid', 'date_added', 'playlist_type', 'description', 'tags'];
-                $values = [$name, user_id(), now(), $this->type, '', ''];
+        if( !User::getInstance()->hasPermission('allow_create_playlist') ){
+            e(lang('insufficient_privileges'));
+            return false;
+        }
+
+        if (!user_id()) {
+            e(lang('please_login_create_playlist'));
+            return false;
+        }
+        if (empty($params['name'])) {
+            e(lang('please_enter_playlist_name'));
+            return false;
+        }
+        if ($this->playlist_exists($params['name'], user_id(), $this->type)) {
+            e(lang('play_list_with_this_name_arlready_exists', display_clean($params['name'])));
+            return false;
+        }
 
-                Clipbucket_db::getInstance()->insert(tbl($this->playlist_tbl), $fields, $values);
+        $fields = ['playlist_name', 'userid', 'date_added', 'playlist_type', 'description', 'tags'];
+        $values = [$params['name'], user_id(), now(), $this->type, '', ''];
 
-                $pid = Clipbucket_db::getInstance()->insert_id();
-                e(lang('new_playlist_created'), 'm');
+        Clipbucket_db::getInstance()->insert(tbl($this->playlist_tbl), $fields, $values);
 
-                return $pid;
-            }
-        }
-        e(lang('insufficient_privileges'));
-        return false;
+        $pid = Clipbucket_db::getInstance()->insert_id();
+        e(lang('new_playlist_created'), 'm');
+
+        return $pid;
     }
 
     /**

--- upload/includes/common.php ---
@@ -285,16 +285,10 @@
 require DirPath::get('includes') . 'active.php';
 
 Assign('NEED_UPDATE', NEED_UPDATE);
-
 Assign('js', DirPath::getUrl('js'));
 Assign('title', TITLE);
-
 Assign('PLUG_URL', DirPath::getUrl('plugins'));
 
-if (!file_exists(DirPath::get('playlist_covers'))) {
-    mkdir(DirPath::get('playlist_covers'), 0777);
-}
-
 ClipBucket::getInstance()->upload_opt_list = [];
 
 if (config('enable_video_file_upload') == 'yes') {

--- upload/includes/constants.php ---
@@ -50,7 +50,6 @@ public static function get(string $dir_name, $get_url = false): string
 
             case 'collection_thumbs':
             case 'icons':
-            case 'playlist_covers':
                 $path = $root_directory . DIRECTORY_SEPARATOR . 'images' . DIRECTORY_SEPARATOR . $dir_name;
                 $url = 'images/' . $dir_name;
                 break;

--- upload/includes/functions_playlist.php ---
@@ -37,22 +37,6 @@ function get_playlist_items($list_id, $limit = -1, $order = "playlist_items.play
     return $cbvid->get_playlist_items($list_id, $order, $limit);
 }
 
-function get_playlist_cover($playlist, $return_default = false)
-{
-    $cover = $playlist['cover'];
-    $playlist_dir = DirPath::get('playlist_covers');
-
-    if (empty($cover)) {
-        return $return_default ? get_playlist_default_thumb() : false;
-    }
-
-    if (file_exists($playlist_dir . $cover)) {
-        return DirPath::getUrl('playlist_covers') . $cover;
-    }
-
-    return $return_default ? get_playlist_default_thumb() : false;
-}
-
 /**
  * @throws Exception
  */
@@ -77,9 +61,7 @@ function get_playlist_thumb($playlist, $size = false)
         }
     }
 
-    $thumb = get_playlist_cover($playlist);
-
-    return ($thumb ? $thumb : get_playlist_default_thumb());
+    return get_playlist_default_thumb();
 }
 
 function get_playlist_default_thumb(): string
@@ -97,72 +79,6 @@ function get_playlist_default_thumb(): string
     return $url;
 }
 
-function view_playlist($playlist_id)
-{
-    $playlist_link = get_server_url();
-
-    if (is_array($playlist_id) and isset($playlist_id['playlist_id'])) {
-        $playlist = $playlist_id;
-    } else {
-        $playlist = Playlist::getInstance()->getOne($playlist_id);
-    }
-
-    if (empty($playlist)) {
-        return get_server_url();
-    }
-
-    $is_seo = SEO;
-
-
-    $data = cb_do_action('view_playlist_link', ['playlist' => $playlist, 'seo_enabled' => $is_seo]);
-
-    if ($is_seo) {
-        $playlist_link .= '/list/' . $playlist['playlist_id'] . '/' . SEO($playlist['playlist_name']);
-    } else {
-        $playlist_link .= '/view_playlist.php?list=' . $playlist_id;
-    }
-
-
-    $data = cb_do_action('view_playlist_link', [
-        'playlist'      => $playlist,
-        'seo_enabled'   => $is_seo,
-        'playlist_link' => $playlist_link
-    ]);
-
-    if ($data) {
-        return $data;
-    }
-
-    return $playlist_link;
-}
-
-/**
- * @throws Exception
- */
-function playlist_upload_cover($args): bool
-{
-    $filename = $args['playlist_id'];
-    $extension = getExt($args['name']);
-    $folder = create_dated_folder(DirPath::get('playlist_covers'));
-    $uploaded_file = DirPath::get('playlist_covers') . $folder . '/' . $filename . '.' . $extension;
-
-    if (!empty($filename)) {
-        if (move_uploaded_file($args['tmp_name'], $uploaded_file)) {
-            $cover_name = $filename . '.' . $extension;
-
-            $resizer = new CB_Resizer($uploaded_file);
-            $resizer->target = $uploaded_file;
-            $resizer->resize(1280, 800);
-            $resizer->save();
-
-            Clipbucket_db::getInstance()->update(tbl('playlists'), ['cover'], [$folder . '/' . $cover_name], " playlist_id = '" . $filename . "' ");
-            return true;
-        }
-    }
-
-    return false;
-}
-
 /**
  * @throws Exception
  */
@@ -180,7 +96,7 @@ function increment_playlist_played($args = [])
 /**
  * Get playlists that have at least 1 item
  * @param : { array } { $playlists } { array of all playlists fetched from database }
- * @return : { array } { $playlists } { playlists with items only }
+ * @return array|void : { array } { $playlists } { playlists with items only }
  * @author : Saqib Razzaq
  *
  * @since : May 11th, 2016 ClipBucket 2.8.1

--- upload/manage_playlists.php ---
@@ -75,7 +75,7 @@
 
                 if (!error()) {
                     errorhandler::getInstance()->flush();
-                    e(lang('playlist_items_have_been_removed'), "m");
+                    e(lang('playlist_items_have_been_removed'), 'm');
                 } else {
                     errorhandler::getInstance()->flush();
                     e(lang('playlist_item_doesnt_exist'));
@@ -93,19 +93,6 @@
             $cbvid->action->edit_playlist();
         }
 
-        if (isset($_POST['upload_playlist_cover'])) {
-            $cover = $_FILES['playlist_cover'];
-            $cover['playlist_id'] = $pid;
-
-            if (playlist_upload_cover($cover)) {
-                e(lang('Playlist cover has been uploaded'), 'm');
-            }
-
-            if (file_exists($cover['tmp_name'])) {
-                unlink($cover['tmp_name']);
-            }
-        }
-
         //Deleting Item
         if (!empty($_GET['delete_item'])) {
             $delid = mysql_clean($_GET['delete_item']);

--- upload/view_playlist.php ---
@@ -1,34 +0,0 @@
-<?php
-define('THIS_PAGE', 'view_playlist');
-define('PARENT_PAGE', 'videos');
-
-require 'includes/config.inc.php';
-
-$pages->page_redir();
-
-$list_id = mysql_clean($_GET['list_id']);
-
-$playlist = Playlist::getInstance()->getOne($list_id);
-
-if (is_playlist_viewable($playlist) and isset($playlist)) {
-
-    $items = get_playlist_items($list_id);
-
-    if (!empty($items)) {
-        $playlist['videos'] = $items;
-    }
-
-    cb_do_action('view_playlist', [
-        'playlist' => $playlist
-    ]);
-
-    assign('playlist', $playlist);
-
-    subtitle($playlist['playlist_name']);
-} else {
-    ClipBucket::getInstance()->show_page = false;
-}
-
-//Displaying The Template
-template_files('view_playlist.html');
-display_it();
\ No newline at end of file

--- utils/install_debian-ubuntu.sh ---
@@ -466,10 +466,6 @@ server {
         rewrite ^/rss/([a-zA-Z0-9].+)$ /rss.php?mode=$1&$query_string last;
     }
 
-    location /list/ {
-        rewrite ^/list/([0-9]+)/(.*)?$ /view_playlist.php?list_id=$1 last;
-    }
-
     location ~ /rss$ {
         try_files $uri /rss.php;
     }

--- utils/install_windows.bat ---
@@ -425,10 +425,6 @@ echo 		location /rss/ {>> %NGINX_CONF%
 echo 			rewrite ^^/rss/([a-zA-Z0-9].+)$ /rss.php?mode=$1^&$query_string last;>> %NGINX_CONF%
 echo 		}>> %NGINX_CONF%
 echo. >> %NGINX_CONF%
-echo 		location /list/ {>> %NGINX_CONF%
-echo 			rewrite ^^/list/([0-9]+)/(.*)?$ /view_playlist.php?list_id=$1 last;>> %NGINX_CONF%
-echo 		}>> %NGINX_CONF%
-echo. >> %NGINX_CONF%
 echo 		location ~ /rss$ {>> %NGINX_CONF%
 echo 			try_files $uri /rss.php;>> %NGINX_CONF%
 echo 		}>> %NGINX_CONF%


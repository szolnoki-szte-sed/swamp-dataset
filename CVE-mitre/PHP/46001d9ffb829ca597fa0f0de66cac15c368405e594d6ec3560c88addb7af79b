--- editor/elfinder/php/connector.php ---
@@ -39,7 +39,7 @@
 $rootpath = $_REQUEST['uploadDir'];
 $rooturl = $_REQUEST['uploadURL'];
 
-if (strpos($rootpath, 'USER-FILES') === false || strpos($rooturl, 'USER-FILES') === false)
+if (strpos($rootpath, 'USER-FILES') === false  || strpos($rootpath, '../') !== false || strpos($rooturl, 'USER-FILES') === false)
 {
     die("Invalid upload location");
 }

--- editor/uploadImage.php ---
@@ -72,7 +72,7 @@ function sanitizeName($file, &$response)
 }
 
 // Check upload path, should contain USER-FILES
-if (strpos($_REQUEST['uploadURL'], 'USER-FILES') === false)
+if (strpos($_REQUEST['uploadPath'], 'USER-FILES') === false || strpos($_REQUEST['uploadPath'], '../') !== false || strpos($_REQUEST['uploadURL'], 'USER-FILES') === false)
 {
     // Invalid folder, reject!
     $response->uploaded = 0;

--- modules/decision/engine/upload.php ---
@@ -96,7 +96,7 @@
     $pass = false;
 if (strpos($_FILES['Filedata']['name'], '...') !== false)
     $pass = false;
-if (strpos($_GET['path'], 'USER-FILES') === false)
+if (strpos($_GET['path'], 'USER-FILES') === false || strpos($_GET['path'], '../') !== false)
     $pass = false;
 
 if ($pass === false) {

--- modules/site/engine/upload.php ---
@@ -79,7 +79,7 @@
     $pass = false;
 if (strpos($_FILES['Filedata']['name'], '...') !== false)
     $pass = false;
-if (strpos($_GET['path'], 'USER-FILES') === false)
+if (strpos($_GET['path'], 'USER-FILES') === false || strpos($_GET['path'], '../') !== false)
     $pass = false;
 
 if ($pass === false) {

--- website_code/php/import/fileupload.php ---
@@ -55,7 +55,7 @@ function convertToBytes(string $from): ?int {
     _debug("Session is invalid or expired");
     die("Session is invalid or expired");
 }
-if (strpos($_POST['mediapath'], 'USER-FILES') === false)
+if (strpos($_POST['mediapath'], 'USER-FILES') === false || strpos($_POST['mediapath'], '../') !== false)
 {
     // Invalid upload path
     _debug("Invalid or illegal mediapath");


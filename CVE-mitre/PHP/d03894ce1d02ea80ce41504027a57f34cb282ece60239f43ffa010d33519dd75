--- hphp/runtime/ext/mbstring/ext_mbstring.cpp ---
@@ -908,7 +908,7 @@ static bool php_mb_parse_encoding(const Variant& encoding,
   }
   if (!ret) {
     if (return_list && *return_list) {
-      free(*return_list);
+      req::free(*return_list);
       *return_list = nullptr;
     }
     return_size = 0;

--- hphp/test/slow/ext_mb/mb_detect_order_t54638796.php ---
@@ -0,0 +1,7 @@
+<?hh
+// Copyright 2004-present Facebook. All Rights Reserved.
+
+<<__EntryPoint>>
+function main() {
+  var_dump(mb_detect_order("UTF-8,\x2c"));
+}

--- hphp/test/slow/ext_mb/mb_detect_order_t54638796.php.expect ---
@@ -0,0 +1 @@
+bool(false)


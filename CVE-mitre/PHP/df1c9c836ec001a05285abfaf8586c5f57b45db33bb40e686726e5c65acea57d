--- www/include/common/javascript/autologoutXMLresponse.php ---
@@ -53,7 +53,7 @@
 	if (isset($_SESSION['centreon'])) {
 	    $oreon = $_SESSION['centreon'];
     	$currentTime = $oreon->CentreonGMT->getDate(_("Y/m/d G:i"), time(), $oreon->user->getMyGMT());
-    	$DBRESULT = $pearDB->query("SELECT user_id FROM session WHERE session_id = '" . htmlentities($_GET['sid'], ENT_QUOTES, "UTF-8") . "'");
+    	$DBRESULT = $pearDB->query("SELECT user_id FROM session WHERE session_id = '" . $pearDB->escape($_GET['sid']) . "'");
     	if ($DBRESULT->numRows()) {
     		$buffer->writeElement("state", "ok");
     	} else {
@@ -70,4 +70,4 @@
 	header('Expires: 0');
 	header('Cache-Control: no-cache, must-revalidate');
 	$buffer->output();
-?>
\ No newline at end of file
+?>

--- www/include/common/javascript/commandGetArgs/cmdGetExample.php ---
@@ -55,11 +55,11 @@ function myDecodeService($arg)	{
 	$pearDB = new CentreonDB();
 
 	if (isset($_POST["index"])){
-		$DBRESULT = $pearDB->query("SELECT `command_example` FROM `command` WHERE `command_id` = '". $_POST["index"] ."'");
+		$DBRESULT = $pearDB->query("SELECT `command_example` FROM `command` WHERE `command_id` = '". $pearDB->escape($_POST["index"]) ."'");
 		while ($arg = $DBRESULT->fetchRow())
 			echo myDecodeService($arg["command_example"]);
 		unset($arg);
 		unset($DBRESULT);
 		$pearDB->disconnect();
 	}
-?>
\ No newline at end of file
+?>

--- www/include/reporting/dashboard/xmlInformations/GetXmlHost.php ---
@@ -50,7 +50,7 @@
 	$pearDB 	= new CentreonDB();
 	$pearDBO 	= new CentreonDB("centstorage");
 
-	$DBRESULT = $pearDB->query("SELECT * FROM session WHERE session_id = '" . htmlentities($_GET['session'], ENT_QUOTES, "UTF-8") . "'");
+	$DBRESULT = $pearDB->query("SELECT * FROM session WHERE session_id = '" . $pearDB->escape($_GET['session']) . "'");
 	if (!$DBRESULT->numRows())
 		exit();
 
@@ -67,7 +67,7 @@
 			$color[$key] = htmlentities($value, ENT_QUOTES, "UTF-8");
 		}
 		
-		$DBRESULT = $pearDBO->query("SELECT  * FROM `log_archive_host` WHERE host_id = " . $_GET["id"] . " order by date_start desc");
+		$DBRESULT = $pearDBO->query("SELECT  * FROM `log_archive_host` WHERE host_id = " . $pearDBO->escape($_GET["id"]) . " order by date_start desc");
 		while ($row = $DBRESULT->fetchRow()) {
 			fillBuffer($statesTab, $row, $color);
 		}
@@ -78,4 +78,4 @@
 	$buffer->endElement();	
 	header('Content-Type: text/xml');
 	$buffer->output();
-?>
\ No newline at end of file
+?>

--- www/include/reporting/dashboard/xmlInformations/GetXmlHostGroup.php ---
@@ -51,7 +51,7 @@
 	$pearDB 	= new CentreonDB();
 	$pearDBO 	= new CentreonDB("centstorage");
 
-	$DBRESULT = $pearDB->query("SELECT * FROM session WHERE session_id = '" . htmlentities($_GET['session'], ENT_QUOTES, "UTF-8") . "'");
+	$DBRESULT = $pearDB->query("SELECT * FROM session WHERE session_id = '" . $pearDB->escape($_GET['session']) . "'");
 	if (!$DBRESULT->numRows())
 		exit();
 	
@@ -93,4 +93,4 @@
 	
 	header('Content-Type: text/xml');
 	$buffer->output();
-?>
\ No newline at end of file
+?>

--- www/include/reporting/dashboard/xmlInformations/GetXmlService.php ---
@@ -50,7 +50,7 @@
 	$pearDB 	= new CentreonDB();
 	$pearDBO 	= new CentreonDB("centstorage");
 
-	$DBRESULT = $pearDB->query("SELECT * FROM session WHERE session_id = '" . htmlentities($_GET['session'], ENT_QUOTES, "UTF-8") . "'");
+	$DBRESULT = $pearDB->query("SELECT * FROM session WHERE session_id = '" . $pearDB->escape($_GET['session']) . "'");
 	if (!$DBRESULT->numRows())
 		exit();
 	
@@ -68,7 +68,7 @@
 			$color[$key] = htmlentities($value, ENT_QUOTES, "UTF-8");
 		}
 	
-		$DBRESULT = $pearDBO->query("SELECT  * FROM `log_archive_service` WHERE host_id = '".$_GET["host_id"]."' AND service_id = ".$_GET["id"]." ORDER BY `date_start` DESC");
+		$DBRESULT = $pearDBO->query("SELECT  * FROM `log_archive_service` WHERE host_id = '".$pearDBO->escape($_GET["host_id"])."' AND service_id = ".$pearDBO->escape($_GET["id"])." ORDER BY `date_start` DESC");
 		while ($row = $DBRESULT->fetchRow()) {
 			fillBuffer($statesTab, $row, $color);
 		}
@@ -81,4 +81,4 @@
 	
 	header('Content-Type: text/xml');
 	$buffer->output();
-?>
\ No newline at end of file
+?>

--- www/include/reporting/dashboard/xmlInformations/GetXmlServiceGroup.php ---
@@ -51,7 +51,7 @@
 	$pearDB 	= new CentreonDB();
 	$pearDBO 	= new CentreonDB("centstorage");
 
-	$DBRESULT = $pearDB->query("SELECT * FROM session WHERE session_id = '" . htmlentities($_GET['session'], ENT_QUOTES, "UTF-8") . "'");
+	$DBRESULT = $pearDB->query("SELECT * FROM session WHERE session_id = '" . $pearDB->escape($_GET['session']) . "'");
 	if (!$DBRESULT->numRows())
 		exit();
 	
@@ -99,4 +99,4 @@
 
 	header('Content-Type: text/xml');
 	$buffer->output();
-?>
\ No newline at end of file
+?>

--- www/menu/userMenuPreferences.php ---
@@ -51,7 +51,7 @@
 	/*
 	 * Check session id
 	 */
-	$session = $pearDB->query("SELECT user_id FROM `session` WHERE session_id = '".htmlentities(session_id(), ENT_QUOTES, "UTF-8")."' AND user_id = '".htmlentities($_GET['uid'], ENT_QUOTES, "UTF-8")."'");
+	$session = $pearDB->query("SELECT user_id FROM `session` WHERE session_id = '".$pearDB->escape(session_id())."' AND user_id = '".$pearDB->escape($_GET['uid'])."'");
 	if (!$session->numRows()){
 		exit;
 	}
@@ -67,4 +67,4 @@
 			$_SESSION['_Div_' . $my_div] = 1;
 		}
 	}
-?>
\ No newline at end of file
+?>

--- www/menu/xml/menuXML.php ---
@@ -60,7 +60,7 @@
 	/*
 	 * Check Session existence
 	 */
-	$session = $pearDB->query("SELECT user_id FROM `session` WHERE session_id = '".htmlentities($_GET["sid"], ENT_QUOTES, "UTF-8")."'");
+	$session = $pearDB->query("SELECT user_id FROM `session` WHERE session_id = '".$pearDB->escape($_GET["sid"])."'");
 	if (!$session->numRows()){
 		$buffer = new CentreonXML();
 		$buffer->startElement("root");
@@ -95,7 +95,7 @@
 	/*
 	 * Get CSS
 	 */
-	$DBRESULT2 = $pearDB->query("SELECT css_name FROM `css_color_menu` WHERE menu_nb = '".htmlentities($_GET["menu"], ENT_QUOTES, "UTF-8")."' LIMIT 1");
+	$DBRESULT2 = $pearDB->query("SELECT css_name FROM `css_color_menu` WHERE menu_nb = '".$pearDB->escape($_GET["menu"])."' LIMIT 1");
 	$menu_style = $DBRESULT2->fetchRow();
 
 	ob_start();
@@ -154,4 +154,4 @@
 	header('Content-Type: text/xml');
 	header('Cache-Control: no-cache');
 	$buffer->output();
-?>
\ No newline at end of file
+?>


--- Changes ---
@@ -7,6 +7,17 @@ RSS feed: https://exiftool.org/rss.xml
 Note: The most recent production release is Version 12.30. (Other versions are
 considered development releases, and are not uploaded to MetaCPAN.)
 
+Dec. 20, 2021 - Version 12.38
+
+  - Decode a number of new tags for the Nikon Z9 (thanks Warren Hatch)
+  - Patched incorrect decoding of AEBShotCount for the Canon EOS 90D
+  - Patched EXR reader to support long tag names
+  - Patched security issue (thanks Joe Lothan)
+  - Fixed an incorrect tag ID for a new Nikon MakerNote tag (github #108)
+  - Fixed XMP-exif:GPSMeasureMode conversions to match EXIF
+  - Fixed problem where some namespaces may be undeclared in the -X output when
+    using the -struct option
+
 Dec. 8, 2021 - Version 12.37
 
   - Decode timed GPS from Vantrue S1 dashcam MP4 videos

--- META.json ---
@@ -47,6 +47,6 @@
       }
    },
    "release_status" : "stable",
-   "version" : "12.37",
+   "version" : "12.38",
    "x_serialization_backend" : "JSON::PP version 4.02"
 }

--- META.yml ---
@@ -28,5 +28,5 @@ recommends:
   Time::HiRes: 0
 requires:
   perl: 5.004
-version: 12.37
+version: 12.38
 x_serialization_backend: 'JSON::PP version 4.02'

--- README ---
@@ -107,8 +107,8 @@ your home directory, then you would type the following commands in a
 terminal window to extract and run ExifTool:
 
   cd ~/Desktop
-  gzip -dc Image-ExifTool-12.37.tar.gz | tar -xf -
-  cd Image-ExifTool-12.37
+  gzip -dc Image-ExifTool-12.38.tar.gz | tar -xf -
+  cd Image-ExifTool-12.38
   ./exiftool t/images/ExifTool.jpg
 
 Note:  These commands extract meta information from one of the test images. 

--- exiftool ---
@@ -10,7 +10,7 @@
 use strict;
 require 5.004;
 
-my $version = '12.37';
+my $version = '12.38';
 
 # add our 'lib' directory to the include list BEFORE 'use Image::ExifTool'
 BEGIN {
@@ -1969,6 +1969,7 @@ sub GetImageInfo($$)
             } else {
                 $pipe = qq{bzip2 -dc "$file" |};
             }
+            $$et{TRUST_PIPE} = 1;
         }
     }
     # evaluate -if expression for conditional processing
@@ -2239,12 +2240,13 @@ sub GetImageInfo($$)
                         next unless defined $forcePrint;
                         $grp0 = $grp1 = 'Unknown';
                     }
+                    # add groups from structure fields
+                    AddGroups($$info{$tag}, $grp0, \%groups, \@groups) if ref $$info{$tag};
                     next if $groups{$grp1};
                     # include family 0 and 1 groups in URI except for internal tags
                     # (this will put internal tags in the "XML" group on readback)
                     $groups{$grp1} = $grp0;
                     push @groups, $grp1;
-                    AddGroups($$info{$tag}, $grp0, \%groups, \@groups) if ref $$info{$tag};
                 }
                 foreach $grp1 (@groups) {
                     my $grp = $groups{$grp1};
@@ -5434,7 +5436,7 @@ with this command:
 
 produces output like this:
 
-    -- Generated by ExifTool 12.37 --
+    -- Generated by ExifTool 12.38 --
     File: a.jpg - 2003:10:31 15:44:19
     (f/5.6, 1/60s, ISO 100)
     File: b.jpg - 2006:05:23 11:57:38
@@ -5716,7 +5718,7 @@ example, the following pairs of commands give the same result:
 4) Adding the B<-v> option to B<-W> sends a list of the tags and output file
 names to the console instead of giving a verbose dump of the entire file. 
 (Unless appending all output to one file for each source file by using
-B<-W+> with an output file I<FMT> that does not contain %t, $g, %s or %o.)
+B<-W+> with an output file I<FMT> that does not contain %t, %g, %s or %o.)
 
 5) Individual list items are stored in separate files when B<-W> is combined
 with B<-b>, but note that for separate files to be created %c or %C must be

--- html/TagNames/CanonCustom.html ---
@@ -1352,12 +1352,17 @@ <h2><a name='Functions2'>CanonCustom Functions2 Tags</a></h2>
 <td>AEBShotCount
   <br>AEBShotCount</td>
 <td class=c>int32s<br>int32s[2]</td>
-<td><span class=s><span class=n>(one value for some models...)</span>
+<td><span class=s><span class=n>(EOS 90D)</span>
+  <br>2 = 2 shots
+  <br>3 = 3 shots
+  <br>5 = 5 shots
+  <br>7 = 7 shots
+  <br><span class=n>(other models storing a single value)</span>
   <br>0 = 3 shots
   <br>1 = 2 shots
   <br>2 = 5 shots
   <br>3 = 7 shots
-  <br><span class=n>(two values for others)</span>
+  <br><span class=n>(models storing two values)</span>
   <br>&#39;2 1&#39; = 2 shots
   <br>&#39;3 0&#39; = 3 shots
   <br>&#39;5 2&#39; = 5 shots
@@ -2213,7 +2218,7 @@ <h2><a name='Functions2'>CanonCustom Functions2 Tags</a></h2>
 
 <hr>
 (This document generated automatically by Image::ExifTool::BuildTagLookup)
-<br><i>Last revised Feb 3, 2021</i>
+<br><i>Last revised Dec 20, 2021</i>
 <p class=lf><a href='index.html'>&lt;-- ExifTool Tag Names</a></p>
 </body>
 </html>

--- html/TagNames/Nikon.html ---
@@ -431,9 +431,10 @@ <h2 class=top>Nikon Tags</h2>
   <br>ShotInfoD6
   <br>ShotInfoD610
   <br>ShotInfoZ7_2
+  <br>ShotInfoZ9
   <br>ShotInfo02xx
   <br>ShotInfoUnknown</td>
-<td class=c>-<br>-<br>-<br>-<br>-<br>-<br>-<br>-<br>-<br>-<br>-<br>-<br>-<br>-<br>-<br>-<br>-<br>-<br>-<br>-<br>-<br>-<br>-<br>-<br>-<br>-<br>-</td>
+<td class=c>-<br>-<br>-<br>-<br>-<br>-<br>-<br>-<br>-<br>-<br>-<br>-<br>-<br>-<br>-<br>-<br>-<br>-<br>-<br>-<br>-<br>-<br>-<br>-<br>-<br>-<br>-<br>-</td>
 <td>--&gt; <a href='Nikon.html#ShotInfoD40'>Nikon ShotInfoD40 Tags</a>
   <br>--&gt; <a href='Nikon.html#ShotInfoD80'>Nikon ShotInfoD80 Tags</a>
   <br>--&gt; <a href='Nikon.html#ShotInfoD90'>Nikon ShotInfoD90 Tags</a>
@@ -459,6 +460,7 @@ <h2 class=top>Nikon Tags</h2>
   <br>--&gt; <a href='Nikon.html#ShotInfoD6'>Nikon ShotInfoD6 Tags</a>
   <br>--&gt; <a href='Nikon.html#ShotInfoD610'>Nikon ShotInfoD610 Tags</a>
   <br>--&gt; <a href='Nikon.html#ShotInfoZ7_2'>Nikon ShotInfoZ7_2 Tags</a>
+  <br>--&gt; <a href='Nikon.html#ShotInfoZ9'>Nikon ShotInfoZ9 Tags</a>
   <br>--&gt; <a href='Nikon.html#ShotInfo'>Nikon ShotInfo Tags</a>
   <br>--&gt; <a href='Nikon.html#ShotInfo'>Nikon ShotInfo Tags</a></td></tr>
 <tr>
@@ -470,18 +472,7 @@ <h2 class=top>Nikon Tags</h2>
 <td title='0x0093 = 147'>0x0093</td>
 <td>NEFCompression</td>
 <td class=c>int16u</td>
-<td><table class=cols><tr>
-  <td>1 = Lossy (type 1)
-  <br>2 = Uncompressed
-  <br>3 = Lossless
-  <br>4 = Lossy (type 2)
-  <br>5 = Striped packed 12 bits
-  <br>6 = Uncompressed (reduced to 12 bit)
-  <br>7 = Unpacked 12 bits
-  <br>8 = Small
-  <br>9 = Packed 12 bits
-  <br>10 = Packed 14 bits</td></tr></table>
-</td></tr>
+<td>--&gt; <a href='Nikon.html#NEFCompression'>Nikon NEFCompression Values</a></td></tr>
 <tr>
 <td title='0x0094 = 148'>0x0094</td>
 <td>SaturationAdj</td>
@@ -815,6 +806,25 @@ <h2 class=top>Nikon Tags</h2>
   <br>&#39;16 16 16 0&#39; = 16 x 3</span></td></tr>
 </table></td></tr></table></blockquote>
 
+<h2><a name='NEFCompression'>Nikon NEFCompression Values</a></h2>
+<blockquote>
+<table class=frame><tr><td>
+<table class='inner sep' cellspacing=1>
+<tr class=h><th>Value</th><th>NEFCompression</th><th>Value</th><th>NEFCompression</th></tr>
+<tr><td class=r>1</td><td>= Lossy (type 1)</td>
+<td class='r b'>7</td><td class=b>= Unpacked 12 bits</td>
+</tr><tr><td class=r>2</td><td>= Uncompressed</td>
+<td class='r b'>8</td><td class=b>= Small</td>
+</tr><tr><td class=r>3</td><td>= Lossless</td>
+<td class='r b'>9</td><td class=b>= Packed 12 bits</td>
+</tr><tr><td class=r>4</td><td>= Lossy (type 2)</td>
+<td class='r b'>10</td><td class=b>= Packed 14 bits</td>
+</tr><tr><td class=r>5</td><td>= Striped packed 12 bits</td>
+<td class='r b'>13</td><td class=b>= High Efficiency</td>
+</tr><tr><td class=r>6</td><td>= Uncompressed (reduced to 12 bit)</td>
+<td class='r b'>14</td><td class=b>= High Efficiency*</td>
+</tr></table></td></tr></table></blockquote>
+
 <h2><a name='PreviewIFD'>Nikon PreviewIFD Tags</a></h2>
 <blockquote>
 <table class=frame><tr><td>
@@ -1703,6 +1713,24 @@ <h2><a name='LocationInfo'>Nikon LocationInfo Tags</a></h2>
 <td>&nbsp;</td></tr>
 </table></td></tr></table></blockquote>
 
+<h2><a name='MakerNotes0x51'>Nikon MakerNotes0x51 Tags</a></h2>
+<blockquote>
+<table class=frame><tr><td>
+<table class=inner cellspacing=1>
+<tr class=h><th>Index1</th><th>Tag Name</th>
+<th>Writable</th><th>Values / <span class=n>Notes</span></th></tr>
+<tr>
+<td class=r title='0 = 0x0'>0</td>
+<td>FirmwareVersion</td>
+<td class=c>no</td>
+<td>&nbsp;</td></tr>
+<tr class=b>
+<td class=r title='10 = 0xa'>10</td>
+<td>NEFCompression</td>
+<td class=c>int16u[0.5]</td>
+<td>--&gt; <a href='Nikon.html#NEFCompression'>Nikon NEFCompression Values</a></td></tr>
+</table></td></tr></table></blockquote>
+
 <h2><a name='AFInfo'>Nikon AFInfo Tags</a></h2>
 <blockquote>
 <table class=frame><tr><td>
@@ -3996,44 +4024,78 @@ <h2><a name='ZMenuSettings'>Nikon ZMenuSettings Tags</a></h2>
 <td><span class=s>0 = No
   <br>1 = Yes</span></td></tr>
 <tr class=b>
+<td class=r title='577 = 0x241'>577</td>
+<td>MovieDiffractionCompensation?</td>
+<td class=c>int8u</td>
+<td><span class=s>0 = Off
+  <br>1 = On</span></td></tr>
+<tr>
 <td class=r title='578 = 0x242'>578</td>
 <td>MovieAutoDistortionControl?</td>
 <td class=c>int8u</td>
 <td><span class=s>0 = Off
   <br>1 = On</span></td></tr>
-<tr>
+<tr class=b>
 <td class=r title='584 = 0x248'>584</td>
 <td>MovieFocusMode?</td>
 <td class=c>int8u</td>
 <td><span class=s>0 = Manual
   <br>1 = AF-S
   <br>2 = AF-C
   <br>4 = AF-F</span></td></tr>
-<tr class=b>
+<tr>
 <td class=r title='590 = 0x24e'>590</td>
 <td>MovieVibrationReduction?</td>
 <td class=c>int8u</td>
 <td><span class=s>0 = Off
   <br>1 = On (Normal)
   <br>2 = On (Sport)</span></td></tr>
-<tr>
+<tr class=b>
 <td class=r title='591 = 0x24f'>591</td>
 <td>MovieVibrationReductionSameAsPhoto?</td>
 <td class=c>int8u</td>
 <td><span class=s>0 = No
   <br>1 = Yes</span></td></tr>
-<tr class=b>
+<tr>
 <td class=r title='858 = 0x35a'>858</td>
 <td>HDMIOutputN-Log?</td>
 <td class=c>int8u</td>
 <td><span class=s>0 = Off
   <br>1 = On</span></td></tr>
+</table></td></tr></table></blockquote>
+
+<h2><a name='ShotInfoZ9'>Nikon ShotInfoZ9 Tags</a></h2>
+<p>These tags are extracted from encrypted data in images from the Z9.</p>
+<blockquote>
+<table class=frame><tr><td>
+<table class=inner cellspacing=1>
+<tr class=h><th>Index</th><th>Tag Name</th>
+<th>Writable</th><th>Values / <span class=n>Notes</span></th></tr>
 <tr>
-<td class=r title='5771 = 0x168b'>5771</td>
-<td>MovieDiffrationCompensation?</td>
-<td class=c>int8u</td>
-<td><span class=s>0 = Off
-  <br>1 = On</span></td></tr>
+<td class=r title='0 = 0x0'>0</td>
+<td>ShotInfoVersion</td>
+<td class=c>no</td>
+<td>&nbsp;</td></tr>
+<tr class=b>
+<td class=r title='4 = 0x4'>4</td>
+<td>FirmwareVersion</td>
+<td class=c>no</td>
+<td>&nbsp;</td></tr>
+<tr>
+<td class=r title='60139 = 0xeaeb'>60139</td>
+<td>RollAngle</td>
+<td class=c>fixed32u</td>
+<td><span class=s><span class=n>(converted to degrees of clockwise camera roll)</span></span></td></tr>
+<tr class=b>
+<td class=r title='60143 = 0xeaef'>60143</td>
+<td>PitchAngle</td>
+<td class=c>fixed32u</td>
+<td><span class=s><span class=n>(converted to degrees of upward camera tilt)</span></span></td></tr>
+<tr>
+<td class=r title='60147 = 0xeaf3'>60147</td>
+<td>YawAngle</td>
+<td class=c>fixed32u</td>
+<td><span class=s><span class=n>(the camera yaw angle when shooting in portrait orientation)</span></span></td></tr>
 </table></td></tr></table></blockquote>
 
 <h2><a name='ShotInfo'>Nikon ShotInfo Tags</a></h2>
@@ -7949,7 +8011,7 @@ <h2><a name='LensID'>Nikon LensID Values</a></h2>
 
 <hr>
 (This document generated automatically by Image::ExifTool::BuildTagLookup)
-<br><i>Last revised Dec 8, 2021</i>
+<br><i>Last revised Dec 20, 2021</i>
 <p class=lf><a href='index.html'>&lt;-- ExifTool Tag Names</a></p>
 </body>
 </html>

--- html/TagNames/XMP.html ---
@@ -11722,8 +11722,8 @@ <h2><a name='exif'>XMP exif Tags</a></h2>
 <tr class=b>
 <td>GPSMeasureMode</td>
 <td class=c>integer</td>
-<td><span class=s>2 = 2-Dimensional
-  <br>3 = 3-Dimensional</span></td></tr>
+<td><span class=s>2 = 2-Dimensional Measurement
+  <br>3 = 3-Dimensional Measurement</span></td></tr>
 <tr>
 <td>GPSProcessingMethod</td>
 <td class=c>string</td>
@@ -19419,7 +19419,7 @@ <h2><a name='Licensor'>XMP Licensor Struct</a></h2>
 
 <hr>
 (This document generated automatically by Image::ExifTool::BuildTagLookup)
-<br><i>Last revised Dec 8, 2021</i>
+<br><i>Last revised Dec 20, 2021</i>
 <p class=lf><a href='index.html'>&lt;-- ExifTool Tag Names</a></p>
 </body>
 </html>

--- html/TagNames/index.html ---
@@ -10,7 +10,7 @@
 <h2 class=top>ExifTool Tag Names</h2>
 <p>
 The tables listed below give the names of all tags recognized by ExifTool.
-They contain a total of 25513 tags, with 16386 unique tag names.
+They contain a total of 25521 tags, with 16386 unique tag names.
 </p>
 <blockquote>
 <table width='100%' class=frame><tr><td>
@@ -237,7 +237,7 @@ <h2 class=top>ExifTool Tag Names</h2>
 <hr>
 (This document generated automatically by Image::ExifTool::BuildTagLookup)
 <br><i>Created Feb 15, 2005</i>
-<br><i>Last revised Dec 8, 2021</i>
+<br><i>Last revised Dec 20, 2021</i>
 <p class=lf><a href='../index.html'>&lt;-- Back to ExifTool home page</a></p>
 </body>
 </html>

--- html/exiftool_pod.html ---
@@ -688,7 +688,7 @@ <h3 id="Input-output-text-formatting">Input-output text formatting</h3>
 
 <p>produces output like this:</p>
 
-<pre><code>    -- Generated by ExifTool 12.37 --
+<pre><code>    -- Generated by ExifTool 12.38 --
     File: a.jpg - 2003:10:31 15:44:19
     (f/5.6, 1/60s, ISO 100)
     File: b.jpg - 2006:05:23 11:57:38
@@ -873,7 +873,7 @@ <h3 id="Input-output-text-formatting">Input-output text formatting</h3>
     exiftool test.jpg &gt;&gt; out.txt    # shell redirection
     exiftool test.jpg -W+ out.txt   # equivalent -W option</code></pre>
 
-<p>4) Adding the <b>-v</b> option to <b>-W</b> sends a list of the tags and output file names to the console instead of giving a verbose dump of the entire file. (Unless appending all output to one file for each source file by using <b>-W+</b> with an output file <i>FMT</i> that does not contain %t, $g, %s or %o.)</p>
+<p>4) Adding the <b>-v</b> option to <b>-W</b> sends a list of the tags and output file names to the console instead of giving a verbose dump of the entire file. (Unless appending all output to one file for each source file by using <b>-W+</b> with an output file <i>FMT</i> that does not contain %t, %g, %s or %o.)</p>
 
 <p>5) Individual list items are stored in separate files when <b>-W</b> is combined with <b>-b</b>, but note that for separate files to be created %c or %C must be used in <i>FMT</i> to give the files unique names.</p>
 

--- html/history.html ---
@@ -17,6 +17,18 @@ <h1 class='up'>ExifTool Version History</h1>
 <!-- Use line width of 80 -->
 <!-- *********************************************************************** -->
 
+<a name='v12.38'><b>Dec. 20, 2021 - Version 12.38</b></a>
+<ul>
+<li>Decode a number of new tags for the Nikon Z9 (thanks Warren Hatch)
+<li>Patched incorrect decoding of AEBShotCount for the Canon EOS 90D
+<li>Patched EXR reader to support long tag names
+<li>Patched security issue (thanks Joe Lothan)
+<li>Fixed an incorrect tag ID for a new Nikon MakerNote tag (github #108)
+<li>Fixed XMP-exif:GPSMeasureMode conversions to match EXIF
+<li>Fixed problem where some namespaces may be undeclared in the -X output when
+    using the -struct option
+</ul>
+
 <a name='v12.37'><b>Dec. 8, 2021 - Version 12.37</b></a>
 <ul>
 <li>Decode timed GPS from Vantrue S1 dashcam MP4 videos
@@ -25,12 +37,12 @@ <h1 class='up'>ExifTool Version History</h1>
 <li>Extract TransparentColor from GIF images
 <li>Improved parsing of input time values for GPSTimeStamp to properly handle a
     "." separator
-<li>Improved warning when incorrectly using "<" instead of "=" to write FileName
-    or Directory with a format string
+<li>Improved warning when incorrectly using "<" instead of "=" to assign a tag
+    value
 <li>Shortened a few of the new obscenely-long XMP-crs tag names 
 <li>Avoid writing XMP-dwc:EventID and XMP-tiff:NativeDigest
 <li>Avoid printing same structure twice in -j and -X output when -l is used
-<li>Fixed typo in a QuickTime tag name
+<li>Fixed typo in a QuickTime tag name (thanks Hubert)
 <li>Fixed two XMP-crs tag names and typo in a NikonSettings value (thanks Herb)
 <li>Fixed patch of version 12.25 to avoid writing XMP which contains an
     undefined namespace

--- html/index.html ---
@@ -91,9 +91,9 @@ <h2 class='tight red'><b>Read</b>, <b>Write</b> and <b>Edit</b> Meta Information
 </div>
 
 <blockquote><table class='dl lg'><tr><td><b>
-<a href="http://sourceforge.net/projects/exiftool/files/Image-ExifTool-12.37.tar.gz/download">
-Download        Version 12.37</a> (4.8 MB) -
-<a href="history.html">Dec. 8, 2021</a></b></td></tr></table></blockquote>
+<a href="http://sourceforge.net/projects/exiftool/files/Image-ExifTool-12.38.tar.gz/download">
+Download        Version 12.38</a> (4.8 MB) -
+<a href="history.html">Dec. 20, 2021</a></b></td></tr></table></blockquote>
 
 <p><b>ExifTool is a platform-independent <a href="ExifTool.html">Perl
 library</a> plus a <a href="exiftool_pod.html">command-line application</a> for
@@ -146,8 +146,8 @@ <h2 class='tight red'><b>Read</b>, <b>Write</b> and <b>Edit</b> Meta Information
 
 <blockquote><table class='dl lg'><tr><td><b>
 <a name="alone">Windows Executable:</a>
-<a href="http://sourceforge.net/projects/exiftool/files/exiftool-12.37.zip/download">
-         exiftool-12.37.zip</a> (6.4 MB)</b></td></tr></table></blockquote>
+<a href="http://sourceforge.net/projects/exiftool/files/exiftool-12.38.zip/download">
+         exiftool-12.38.zip</a> (6.4 MB)</b></td></tr></table></blockquote>
 
 <p><b>The stand-alone Windows executable</b> does not require Perl. Just
 download and un-zip the archive then double-click on
@@ -165,7 +165,7 @@ <h2 class='tight red'><b>Read</b>, <b>Write</b> and <b>Edit</b> Meta Information
 <blockquote><table class='dl lg'><tr><td><b>
 MacOS Package:
 <a href="http://sourceforge.net/projects/exiftool/files/ExifTool-9.70.dmg/download">
-         ExifTool-12.37.dmg</a> (3.0 MB)</b></td></tr></table></blockquote>
+         ExifTool-12.38.dmg</a> (3.1 MB)</b></td></tr></table></blockquote>
 
 <p><b>The MacOS package</b> installs the ExifTool command-line application and
 libraries in /usr/local/bin. After installing, type "<code>exiftool</code>" in a

--- html/install.html ---
@@ -52,10 +52,10 @@ <h2><a name="Windows">Windows</a></h2>
 <h3>Stand-Alone Executable</h3>
 <ol>
 <li><b>Download</b> the <b>Windows Executable</b> from the <a href="index.html">ExifTool home page</a>.
-<br><span class=lt>(The file you download should be named "<code>exiftool-12.37.zip</code>".)</span></li>
+<br><span class=lt>(The file you download should be named "<code>exiftool-12.38.zip</code>".)</span></li>
 <li><b>Extract "<code>exiftool(-k).exe</code>"</b> from the
 "<code>.zip</code>" file, and place it <b>on your Desktop</b>.
-<br><span class=lt>(Double-click on "<code>exiftool-12.37.zip</code>" to open
+<br><span class=lt>(Double-click on "<code>exiftool-12.38.zip</code>" to open
 the archive, then drag "<code>exiftool(-k).exe</code>" to your Desktop.)</span></li>
 </ol>
 <p>You can now double-click on "<code>exiftool(-k).exe</code>" to read the
@@ -109,7 +109,7 @@ <h3>Full Perl Distribution</h3>
 <a href="http://www.activestate.com/activeperl/">activeperl.com</a>.)</p>
 <ol>
 <li><b>Download</b> the <b>Image-ExifTool distribution</b> from the <a href="index.html">ExifTool home page</a>
-<br><span class=lt>(The file you download should be named "<code>Image-ExifTool-12.37.tar.gz</code>".)</span></li>
+<br><span class=lt>(The file you download should be named "<code>Image-ExifTool-12.38.tar.gz</code>".)</span></li>
 <li><b>Extract the ExifTool files</b> from the archive.
 <br><span class=lt>(The archive is a gzipped tar file, and can be opened with
 various Windows utilities, including WinZip.)</span></li>
@@ -151,7 +151,7 @@ <h2><a name="MacOS"></a><a name="OSX">MacOS</a></h2>
 <h3>MacOS Package</h3>
 <ol>
 <li><b>Download</b> the <b>ExifTool MacOS Package</b> from the <a href="index.html">ExifTool home page</a>.
-<br><span class=lt>(The file you download should be named "<code>ExifTool-12.37.dmg</code>".)</span></li>
+<br><span class=lt>(The file you download should be named "<code>ExifTool-12.38.dmg</code>".)</span></li>
 <li><b>Install</b> as a normal <b>MacOS package</b>.
 <br><span class=lt>(Open the disk image, double-click on the install package, and follow the instructions.
 See the second item in the Notes section below if you are stopped with an "unidentified developer" message.)
@@ -167,12 +167,12 @@ <h3>Full Perl Distribution</h3>
 <ol>
 <li><b>Download</b> the <b>Image-ExifTool distribution</b> from the <a href="index.html">ExifTool home page</a>
 to your Desktop.
-<br><span class=lt>(The file you download should be named "<code>Image-ExifTool-12.37.tar.gz</code>".)</span></li>
+<br><span class=lt>(The file you download should be named "<code>Image-ExifTool-12.38.tar.gz</code>".)</span></li>
 <li><b>Launch</b> the <b>Terminal</b> application from the Utilities folder in your Applications folder.</li>
 <li>In the Terminal window, <b>type the following</b>:
 <pre class='code'>    cd ~/Desktop
-    tar -xzf Image-ExifTool-12.37.tar.gz
-    cd Image-ExifTool-12.37
+    tar -xzf Image-ExifTool-12.38.tar.gz
+    cd Image-ExifTool-12.38
     sudo cp -r exiftool lib /usr/local/bin
 </pre>
 <span class=lt>(Note: The last step above will require you to enter your
@@ -188,7 +188,7 @@ <h3>Full Perl Distribution</h3>
 precedence for exiftool, but /Library/Perl/#.#.# is the default for any other
 Perl scripts.</li>
 <li>In MacOS 10.8 or later, you may see this message when you try to open the install package:
-<blockquote class=red>"ExifTool-12.37.pkg" can't be opened because it is from an
+<blockquote class=red>"ExifTool-12.38.pkg" can't be opened because it is from an
 unidentified developer.</blockquote> The solution is to control-click on the pkg
 then select "Open" from the pop-up menu instead of just double-clicking.  An alternative
 is to lower the security settings by changing "Allow applications downloaded from" to
@@ -215,11 +215,11 @@ <h2><a name="Unix">Unix Platforms</a></h2>
 
 <ol>
 <li><b>Download</b> the <b>Image-ExifTool distribution</b> from the <a href="index.html">ExifTool home page</a>
-<br><span class=lt>(The file you download should be named "<code>Image-ExifTool-12.37.tar.gz</code>".)</span></li>
+<br><span class=lt>(The file you download should be named "<code>Image-ExifTool-12.38.tar.gz</code>".)</span></li>
 <li><b>Unpack the distribution</b> and <b>make it your current directory</b> by typing:
 <pre class='code'>    cd <i>&lt;your download directory&gt;</i>
-    gzip -dc Image-ExifTool-12.37.tar.gz | tar -xf -
-    cd Image-ExifTool-12.37
+    gzip -dc Image-ExifTool-12.38.tar.gz | tar -xf -
+    cd Image-ExifTool-12.38
 </pre>
 <span class=lt>(At this point you may run exiftool by typing
 "<code>./exiftool <i>&lt;image file name&gt;</i></code>".)</span></li>

--- lib/Image/ExifTool.pm ---
@@ -29,7 +29,7 @@ use vars qw($VERSION $RELEASE @ISA @EXPORT_OK %EXPORT_TAGS $AUTOLOAD @fileTypes
             %jpegMarker %specialTags %fileTypeLookup $testLen $exeDir
             %static_vars);
 
-$VERSION = '12.37';
+$VERSION = '12.38';
 $RELEASE = '';
 @ISA = qw(Exporter);
 %EXPORT_TAGS = (
@@ -4088,8 +4088,9 @@ sub Open($*$;$)
     my ($self, $fh, $file, $mode) = @_;
 
     $file =~ s/^([\s&])/.\/$1/; # protect leading whitespace or ampersand
-    # default to read mode ('<') unless input is a pipe
-    $mode = ($file =~ /\|$/ ? '' : '<') unless $mode;
+    # default to read mode ('<') unless input is a trusted pipe
+    $mode = (($file =~ /\|$/ and $$self{TRUST_PIPE}) ? '' : '<') unless $mode;
+    undef $$self{TRUST_PIPE};
     if ($mode) {
         if ($self->EncodeFileName($file)) {
             # handle Windows Unicode file name

--- lib/Image/ExifTool/CanonCustom.pm ---
@@ -1290,9 +1290,19 @@ my %convPFn = ( PrintConv => \&ConvertPfn, PrintConvInv => \&ConvertPfnInv );
         },
     },
     0x0106 => [{
+        Name => 'AEBShotCount',
+        Condition => '$$self{Model} =~ /\b90D\b/',
+        Notes => 'EOS 90D', # (and who knows what others?)
+        PrintConv => {
+            2 => '2 shots',
+            3 => '3 shots',
+            5 => '5 shots',
+            7 => '7 shots',
+        },
+    },{
         Name => 'AEBShotCount',
         Condition => '$count == 1',
-        Notes => 'one value for some models...',
+        Notes => 'other models storing a single value',
         PrintConv => {
             0 => '3 shots',
             1 => '2 shots',
@@ -1302,7 +1312,7 @@ my %convPFn = ( PrintConv => \&ConvertPfn, PrintConvInv => \&ConvertPfnInv );
     },{
         Name => 'AEBShotCount',
         Count => 2,
-        Notes => 'two values for others',
+        Notes => 'models storing two values',
         PrintConv => {
             '3 0' => '3 shots',
             '2 1' => '2 shots',

--- lib/Image/ExifTool/Nikon.pm ---
@@ -62,7 +62,7 @@ use Image::ExifTool qw(:DataAccess :Utils);
 use Image::ExifTool::Exif;
 use Image::ExifTool::GPS;
 
-$VERSION = '4.02';
+$VERSION = '4.03';
 
 sub LensIDConv($$$);
 sub ProcessNikonAVI($$$);
@@ -1067,6 +1067,21 @@ my %flashGroupOptionsMode = (
     3 => 'Off',
 );
 
+my %nefCompression = (   #28 relocated to MakerNotes_0x51 at offset x'0a (Z9)
+    1 => 'Lossy (type 1)', # (older models)
+    2 => 'Uncompressed', #JD - D100 (even though TIFF compression is set!)
+    3 => 'Lossless',
+    4 => 'Lossy (type 2)',
+    5 => 'Striped packed 12 bits', #IB
+    6 => 'Uncompressed (reduced to 12 bit)', #IB
+    7 => 'Unpacked 12 bits', #IB (padded to 16)
+    8 => 'Small', #IB
+    9 => 'Packed 12 bits', #IB (2 pixels in 3 bytes)
+    10 => 'Packed 14 bits', #28 (4 pixels in 7 bytes, eg. D6 uncompressed 14 bit)
+    13 => 'High Efficiency', #28
+    14 => 'High Efficiency*', #28
+);
+
 my %noYes = ( 0 => 'No' , 1 => 'Yes', );
 my %offOn = ( 0 => 'Off', 1 => 'On' );
 my %onOff = ( 0 => 'On',  1 => 'Off' );
@@ -1476,6 +1491,14 @@ my %binaryDataAttrs = (
         Name => 'ColorTemperatureAuto',
         Writable => 'int16u',
     },
+    0x0051 => { #28 (Z9)
+        Name => 'MakerNotes0x51',
+        Writable => 'undef',
+        Hidden => 1,
+        Permanent => 0,
+        Flags => [ 'Binary', 'Protected' ],
+        SubDirectory => { TagTable => 'Image::ExifTool::Nikon::MakerNotes0x51' },
+    },
     #0x0053 #28 possibly a secondary DistortionControl block (in addition to DistortInfo)?  Certainly offset 0x04 within block contains tag AutoDistortionControl for Z72 and D6  (1=>On; 2=> Off)
     #0x005e #28 possibly DiffractionCompensation block?  Certainly offset 0x04 within block contains tag DiffractionCompensation
     0x0080 => { Name => 'ImageAdjustment',  Writable => 'string' },
@@ -1900,6 +1923,16 @@ my %binaryDataAttrs = (
                 ByteOrder => 'LittleEndian',
             },
         },
+        { # (Z9 firmware version 1.00 ref 28)
+            Condition => '$$valPt =~ /^0805/',
+            Name => 'ShotInfoZ9',
+            SubDirectory => {
+                TagTable => 'Image::ExifTool::Nikon::ShotInfoZ9',
+                DecryptStart => 4,
+                DecryptLen => 0xeb5b + 1050,   # thru decoded parts of Offset27
+                ByteOrder => 'LittleEndian',
+            },
+        },
         { # D7100=0227, Z6/Z7=0800
             Condition => '$$valPt =~ /^0[28]/',
             Name => 'ShotInfo02xx',
@@ -1929,18 +1962,8 @@ my %binaryDataAttrs = (
     0x0093 => { #21
         Name => 'NEFCompression',
         Writable => 'int16u',
-        PrintConv => {
-            1 => 'Lossy (type 1)', # (older models)
-            2 => 'Uncompressed', #JD - D100 (even though TIFF compression is set!)
-            3 => 'Lossless',
-            4 => 'Lossy (type 2)',
-            5 => 'Striped packed 12 bits', #IB
-            6 => 'Uncompressed (reduced to 12 bit)', #IB
-            7 => 'Unpacked 12 bits', #IB (padded to 16)
-            8 => 'Small', #IB
-            9 => 'Packed 12 bits', #IB (2 pixels in 3 bytes)
-            10 => 'Packed 14 bits', #28 (4 pixels in 7 bytes, eg. D6 uncompressed 14 bit)
-        },
+        SeparateTable => 'NEFCompression',
+        PrintConv => \%nefCompression,
     },
     0x0094 => { Name => 'SaturationAdj',    Writable => 'int16s' },
     0x0095 => { Name => 'NoiseReduction',   Writable => 'string' }, # ("Off" or "FPNR"=long exposure NR)
@@ -7756,6 +7779,97 @@ my %nikonFocalConversions = (
     # note: DecryptLen currently set to 0xcea6 + 1050
 );
 
+# shot information for the Z9 firmware 1.00 (encrypted) - ref 28
+%Image::ExifTool::Nikon::ShotInfoZ9 = (
+    PROCESS_PROC => \&Image::ExifTool::Nikon::ProcessNikonEncrypted,
+    WRITE_PROC => \&Image::ExifTool::Nikon::ProcessNikonEncrypted,
+    CHECK_PROC => \&Image::ExifTool::CheckBinaryData,
+    VARS => { ID_LABEL => 'Index' },
+    DATAMEMBER => [ 0x04, 0x0e, 0x18, 0x84, 0xeaea],
+    WRITABLE => 1,
+    FIRST_ENTRY => 0,
+    GROUPS => { 0 => 'MakerNotes', 2 => 'Camera' },
+    NOTES => 'These tags are extracted from encrypted data in images from the Z9.',
+    0x00 => {
+        Name => 'ShotInfoVersion',
+        Format => 'string[4]',
+        Writable => 0,
+    },
+    0x04 => {
+        Name => 'FirmwareVersion',
+        DataMember => 'FirmwareVersion',
+        Format => 'string[8]',
+        Writable => 0,
+        RawConv => '$$self{FirmwareVersion} = $val',
+    },
+    0x0e => {
+        Name => 'FirmwareVersion2',
+        Format => 'string[8]',
+        Writable => 0,
+        RawConv => '$$self{FirmwareVersion2} = $val',
+        Hidden => 1,
+    },
+    0x18 => {
+        Name => 'FirmwareVersion3',
+        Format => 'string[8]',
+        Writable => 0,
+        RawConv => '$$self{FirmwareVersion3} = $val',
+        Hidden => 1,
+    },
+    0x24 => {
+        Name => 'NumberOffsets', # number of entries in offset table.  offsets are from start of ShotInfo data.
+        DataMember => 'NumberOffsets',
+        Format => 'int32u',
+        Writable => 0,
+        Hidden => 1,
+    },
+    0x84 => {
+        Name => 'OrientationOffset',   #offset24 - length 108
+        DataMember => 'OrientationOffset',
+        Format => 'int32u',
+        Writable => 0,
+        Hidden => 1,
+        RawConv => '$$self{OrientationOffset} = $val || 0x10000000; undef', # (ignore if 0)
+    },
+    ### 0xce32 - OrientationInfo start (Z9 firmware 1.00)
+    0xeaea => {
+        Name => 'Hook1',
+        Hidden => 1,
+        RawConv => 'undef',
+        # account for variable location of OrientationInfo data
+        Hook => '$varSize = $$self{OrientationOffset} - 0xeaeb',
+    },
+
+    0xeaeb => {
+        Name => 'RollAngle',
+        Format => 'fixed32u',
+        Notes => 'converted to degrees of clockwise camera roll',
+        ValueConv => '$val <= 180 ? $val : $val - 360',
+        ValueConvInv => '$val >= 0 ? $val : $val + 360',
+        PrintConv => 'sprintf("%.1f", $val)',
+        PrintConvInv => '$val',
+    },
+    0xeaef => {
+        Name => 'PitchAngle',
+        Format => 'fixed32u',
+        Notes => 'converted to degrees of upward camera tilt',
+        ValueConv => '$val <= 180 ? $val : $val - 360',
+        ValueConvInv => '$val >= 0 ? $val : $val + 360',
+        PrintConv => 'sprintf("%.1f", $val)',
+        PrintConvInv => '$val',
+    },
+    0xeaf3 => {
+        Name => 'YawAngle',
+        Format => 'fixed32u',
+        Notes => 'the camera yaw angle when shooting in portrait orientation',
+        ValueConv => '$val <= 180 ? $val : $val - 360',
+        ValueConvInv => '$val >= 0 ? $val : $val + 360',
+        PrintConv => 'sprintf("%.1f", $val)',
+        PrintConvInv => '$val',
+    },
+    # note: DecryptLen currently set to 0xeb5b + 1050
+);
+
 %Image::ExifTool::Nikon::ZMenuSettings  = (
     %binaryDataAttrs,
     GROUPS => { 0 => 'MakerNotes', 2 => 'Camera' },
@@ -8040,8 +8154,8 @@ my %nikonFocalConversions = (
         Unknown => 1,
         PrintConv => \%noYes
     },
-    5771 => {
-        Name => 'MovieDiffrationCompensation',
+    577 => {
+        Name => 'MovieDiffractionCompensation',
         Unknown => 1,
         PrintConv => \%offOn
     },
@@ -9466,6 +9580,25 @@ my %nikonFocalConversions = (
     },
 );
 
+# MakerNotes0x51 - compression info for Z9
+%Image::ExifTool::Nikon::MakerNotes0x51 = (
+    %binaryDataAttrs,
+    DATAMEMBER => [ 0 ],
+    GROUPS => { 0 => 'MakerNotes' },
+    0 => {
+        Name => 'FirmwareVersion',
+        Format => 'string[8]',
+        Writable => 0,
+        RawConv => '$$self{FirmwareVersion} = $val',
+    },
+    10 => {
+        Name => 'NEFCompression',
+        Writable => 'int16u',
+        SeparateTable => 'NEFCompression',
+        PrintConv => \%nefCompression,
+    },
+);
+
 # extra info found in IFD0 of NEF files (ref PH, Z6/Z7)
 %Image::ExifTool::Nikon::NEFInfo = (
     GROUPS => { 0 => 'MakerNotes', 2 => 'Camera' },

--- lib/Image/ExifTool/OpenEXR.pm ---
@@ -15,7 +15,7 @@ use vars qw($VERSION);
 use Image::ExifTool qw(:DataAccess :Utils);
 use Image::ExifTool::GPS;
 
-$VERSION = '1.02';
+$VERSION = '1.03';
 
 # supported EXR value format types (other types are extracted as undef binary data)
 my %formatType = (
@@ -172,12 +172,13 @@ sub ProcessEXR($$)
     my $ver = unpack('x4V', $buff);
     $et->HandleTag($tagTablePtr, '_ver', $ver & 0xff);
     $et->HandleTag($tagTablePtr, '_lay', $ver & 0x200);
+    my $maxLen = ($ver & 0x400) ? 255 : 31;
 
     # extract attributes
     for (;;) {
         $raf->Read($buff, 68) or last;
         last if $buff =~ /^\0/;
-        unless ($buff =~ /^([^\0]{1,31})\0([^\0]{1,31})\0(.{4})/sg) {
+        unless ($buff =~ /^([^\0]{1,$maxLen})\0([^\0]{1,$maxLen})\0(.{4})/sg) {
             $et->Warn('EXR format error');
             last;
         }
@@ -189,6 +190,7 @@ sub ProcessEXR($$)
         my $tagInfo = $et->GetTagInfo($tagTablePtr, $tag);
         unless ($tagInfo) {
             my $name = ucfirst $tag;
+            $name =~ s/([^a-zA-Z])([a-z])/$1\U$2/g; # capitalize first letter of each word
             $name =~ tr/-_a-zA-Z0-9//dc;
             if (length $name <= 1) {
                 if (length $name) {

--- lib/Image/ExifTool/TagNames.pod ---
@@ -12,7 +12,7 @@ meta information extracted from or written to a file.
 =head1 TAG TABLES
 
 The tables listed below give the names of all tags recognized by ExifTool.
-They contain a total of 25513 tags, with 16386 unique tag names.
+They contain a total of 25521 tags, with 16386 unique tag names.
 
 B<Tag ID>, B<Index#> or B<Sequence> is given in the first column of each
 table.  A B<Tag ID> is the computer-readable equivalent of a tag name, and
@@ -13498,6 +13498,7 @@ DiMAGE X and Xt.
            ShotInfoD6                           Nikon ShotInfoD6
            ShotInfoD610                         Nikon ShotInfoD610
            ShotInfoZ7_2                         Nikon ShotInfoZ7_2
+           ShotInfoZ9                           Nikon ShotInfoZ9
            ShotInfo02xx                         Nikon ShotInfo
            ShotInfoUnknown                      Nikon ShotInfo
   0x0092   HueAdjustment                        int16s
@@ -13782,6 +13783,13 @@ Tags written by some Nikon GPS-equipped cameras like the AW100.
       8    POILevel                             int8u
       9    Location                             undef[70]
 
+=head3 Nikon MakerNotes0x51 Tags
+
+  Index1   Tag Name                             Writable
+  ------   --------                             --------
+      0    FirmwareVersion                      no
+     10    NEFCompression                       int16u[0.5]
+
 =head3 Nikon AFInfo Tags
 
   Index1   Tag Name                             Writable
@@ -14195,12 +14203,24 @@ These tags are used by the Z5 Z6 Z7  Z6II Z7II Z50 Zfc
     572    MovieHighISONoiseReduction?          int8u
     574    MovieVignetteControl?                int8u
     576    MovieVignetteControlSameAsPhoto?     int8u
+    577    MovieDiffractionCompensation?        int8u
     578    MovieAutoDistortionControl?          int8u
     584    MovieFocusMode?                      int8u
     590    MovieVibrationReduction?             int8u
     591    MovieVibrationReductionSameAsPhoto?  int8u
     858    HDMIOutputN-Log?                     int8u
-   5771    MovieDiffrationCompensation?         int8u
+
+=head3 Nikon ShotInfoZ9 Tags
+
+These tags are extracted from encrypted data in images from the Z9.
+
+   Index   Tag Name                             Writable
+   -----   --------                             --------
+      0    ShotInfoVersion                      no
+      4    FirmwareVersion                      no
+  60139    RollAngle                            fixed32u
+  60143    PitchAngle                           fixed32u
+  60147    YawAngle                             fixed32u
 
 =head3 Nikon ShotInfo Tags
 

--- lib/Image/ExifTool/XMP.pm ---
@@ -50,7 +50,7 @@ use Image::ExifTool::Exif;
 use Image::ExifTool::GPS;
 require Exporter;
 
-$VERSION = '3.49';
+$VERSION = '3.50';
 @ISA = qw(Exporter);
 @EXPORT_OK = qw(EscapeXML UnescapeXML);
 
@@ -2134,8 +2134,8 @@ my %sPantryItem = (
         Groups => { 2 => 'Location' },
         Writable => 'integer',
         PrintConv => {
-            2 => '2-Dimensional',
-            3 => '3-Dimensional',
+            2 => '2-Dimensional Measurement',
+            3 => '3-Dimensional Measurement',
         },
     },
     GPSDOP => { Groups => { 2 => 'Location' }, Writable => 'rational' },

--- perl-Image-ExifTool.spec ---
@@ -1,6 +1,6 @@
 Summary: perl module for image data extraction
 Name: perl-Image-ExifTool
-Version: 12.37
+Version: 12.38
 Release: 1
 License: Artistic/GPL
 Group: Development/Libraries/Perl

--- pp_build_exe.args ---
@@ -21,10 +21,10 @@
 #           10) Copy zip archive to web servers.
 #           11) Update zip file version in link and text of html/index.html.
 #------------------------------------------------------------------------------
--T exiftool-12.37
-#--info=FileVersion=12.3.7.0
-#--info=ProductVersion=12.3.7.0
-##"--info=Build Date=2021:12:08 08:27:04-05:00"
+-T exiftool-12.38
+#--info=FileVersion=12.3.8.0
+#--info=ProductVersion=12.3.8.0
+##"--info=Build Date=2021:12:20 08:55:06-05:00"
 ##"--info=Bundled Perl Version=ActivePerl 5.24.0"
 ##"--info=LegalCopyright=Copyright (c) 2003-2021, Phil Harvey"
 ##"--info=ProductName=ExifTool"

--- windows_exiftool ---
@@ -10,7 +10,7 @@
 use strict;
 require 5.004;
 
-my $version = '12.37';
+my $version = '12.38';
 
 # add our 'lib' directory to the include list BEFORE 'use Image::ExifTool'
 my $exePath;
@@ -1967,6 +1967,7 @@ sub GetImageInfo($$)
             } else {
                 $pipe = qq{bzip2 -dc "$file" |};
             }
+            $$et{TRUST_PIPE} = 1;
         }
     }
     # evaluate -if expression for conditional processing
@@ -2237,12 +2238,13 @@ sub GetImageInfo($$)
                         next unless defined $forcePrint;
                         $grp0 = $grp1 = 'Unknown';
                     }
+                    # add groups from structure fields
+                    AddGroups($$info{$tag}, $grp0, \%groups, \@groups) if ref $$info{$tag};
                     next if $groups{$grp1};
                     # include family 0 and 1 groups in URI except for internal tags
                     # (this will put internal tags in the "XML" group on readback)
                     $groups{$grp1} = $grp0;
                     push @groups, $grp1;
-                    AddGroups($$info{$tag}, $grp0, \%groups, \@groups) if ref $$info{$tag};
                 }
                 foreach $grp1 (@groups) {
                     my $grp = $groups{$grp1};
@@ -5459,7 +5461,7 @@ OPTIONS
 
          produces output like this:
 
-             -- Generated by ExifTool 12.37 --
+             -- Generated by ExifTool 12.38 --
              File: a.jpg - 2003:10:31 15:44:19
              (f/5.6, 1/60s, ISO 100)
              File: b.jpg - 2006:05:23 11:57:38
@@ -5746,7 +5748,7 @@ OPTIONS
          file names to the console instead of giving a verbose dump of the
          entire file. (Unless appending all output to one file for each
          source file by using -W+ with an output file *FMT* that does not
-         contain %t, $g, %s or %o.)
+         contain %t, %g, %s or %o.)
 
          5) Individual list items are stored in separate files when -W is
          combined with -b, but note that for separate files to be created %c


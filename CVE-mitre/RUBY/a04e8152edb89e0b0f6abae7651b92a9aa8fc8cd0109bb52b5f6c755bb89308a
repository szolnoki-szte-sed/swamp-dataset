--- app/models/common.rb ---
@@ -31,6 +31,10 @@ class Common < ActiveRecord::Base
   validates :email,
     format: {with: /\A([a-zA-Z0-9_\-\.]+)@([a-zA-Z0-9_\-\.]+)\.([a-zA-Z]{2,})\z/i,
              message: "Only valid emails"}, allow_blank: true
+  validates :invoicing_address, format: { without: /<(.*)>.*?|<(.*) \/>/,
+    message: "wrong format" }
+  validates :shipping_address, format: { without: /<(.*)>.*?|<(.*) \/>/,
+    message: "wrong format" }
 
   # Events
   after_save :purge_items

--- app/models/customer.rb ---
@@ -11,6 +11,10 @@ class Customer < ActiveRecord::Base
   # Validation
   validate :valid_customer_identification
   validates_uniqueness_of :name,  scope: :identification
+  validates :invoicing_address, format: { without: /<(.*)>.*?|<(.*) \/>/,
+    message: "Wrong address format" }
+  validates :shipping_address, format: { without: /<(.*)>.*?|<(.*) \/>/,
+    message: "Wrong address format" }
 
   # Behaviors
   acts_as_taggable

--- config/environments/production.rb ---
@@ -47,7 +47,7 @@
   # config.action_cable.allowed_request_origins = [ 'http://example.com', /http:\/\/example.*/ ]
 
   # Force all access to the app over SSL, use Strict-Transport-Security, and use secure cookies.
-  # config.force_ssl = true
+  config.force_ssl = ENV['NO_FORCE_SSL'].present? ? false : true
 
   # Use the lowest log level to ensure availability of diagnostic information
   # when problems arise.

--- db/migrate/20160907152236_default_for_enabled.rb ---
@@ -1,4 +1,4 @@
-class DefaultForEnabled < ActiveRecord::Migration
+class DefaultForEnabled < ActiveRecord::Migration[4.2]
   def change
     change_column_default(:commons, :enabled, true)
     change_column_default(:commons, :draft, false)

--- db/migrate/20160908093323_add_indexes_on_deleted_column.rb ---
@@ -1,4 +1,4 @@
-class AddIndexesOnDeletedColumn < ActiveRecord::Migration
+class AddIndexesOnDeletedColumn < ActiveRecord::Migration[4.2]
   def change
     add_index :commons, :deleted_at
     add_index :customers, :deleted_at

--- db/migrate/20160913081503_remove_status_from_commons.rb ---
@@ -1,4 +1,4 @@
-class RemoveStatusFromCommons < ActiveRecord::Migration
+class RemoveStatusFromCommons < ActiveRecord::Migration[4.2]
   def change
     remove_column :commons, :status
   end

--- db/migrate/20160915000824_add_active_to_customer.rb ---
@@ -1,4 +1,4 @@
-class AddActiveToCustomer < ActiveRecord::Migration
+class AddActiveToCustomer < ActiveRecord::Migration[4.2]
   def up
     add_column :customers, :active, :boolean, default: true
     Customer.update_all ["active = ?", true]

--- db/migrate/20160915094942_add_failed_to_commons.rb ---
@@ -1,4 +1,4 @@
-class AddFailedToCommons < ActiveRecord::Migration
+class AddFailedToCommons < ActiveRecord::Migration[4.2]
   def change
     add_column :commons, :failed, :boolean, default: false
   end

--- db/migrate/20160923100618_series_first_number.rb ---
@@ -1,4 +1,4 @@
-class SeriesFirstNumber < ActiveRecord::Migration
+class SeriesFirstNumber < ActiveRecord::Migration[4.2]
   def change
   	add_column :series, :first_number, :integer, default: 1
   	remove_column :series, :next_number

--- db/migrate/20160929124104_email_and_print_template_to_common.rb ---
@@ -1,4 +1,4 @@
-class EmailAndPrintTemplateToCommon < ActiveRecord::Migration
+class EmailAndPrintTemplateToCommon < ActiveRecord::Migration[4.2]
   def change
   	rename_column :commons, :template_id, :print_template_id
   	add_column :commons, :email_template_id, :integer

--- db/migrate/20160929133954_email_and_print_default_templates_to_template.rb ---
@@ -1,4 +1,4 @@
-class EmailAndPrintDefaultTemplatesToTemplate < ActiveRecord::Migration
+class EmailAndPrintDefaultTemplatesToTemplate < ActiveRecord::Migration[4.2]
   def change
   	rename_column :templates, :default, :print_default
   	add_column :templates, :email_default, :boolean, default: false

--- db/migrate/20161025134552_change_customer_index.rb ---
@@ -1,4 +1,4 @@
-class ChangeCustomerIndex < ActiveRecord::Migration
+class ChangeCustomerIndex < ActiveRecord::Migration[4.2]
   def change
   	remove_index "customers", name: "cstm_idx"
   	add_index "customers", ["name", "identification"], name: "cstm_idx", unique: true, using: :btree

--- db/migrate/20161026092553_add_template_subject.rb ---
@@ -1,4 +1,4 @@
-class AddTemplateSubject < ActiveRecord::Migration
+class AddTemplateSubject < ActiveRecord::Migration[4.2]
   def change
   	add_column :templates, :subject, :string, limit: 200
   end

--- db/migrate/20161028103504_add_invoice_number_unique_number.rb ---
@@ -1,4 +1,4 @@
-class AddInvoiceNumberUniqueNumber < ActiveRecord::Migration
+class AddInvoiceNumberUniqueNumber < ActiveRecord::Migration[4.2]
   def change
   	add_index "commons", ["number", "series_id"], name: "common_unique_number_idx", unique: true, using: :btree
   end

--- db/migrate/20161207184222_remove_tax_amount.rb ---
@@ -1,4 +1,4 @@
-class RemoveTaxAmount < ActiveRecord::Migration
+class RemoveTaxAmount < ActiveRecord::Migration[4.2]
   def change
     remove_column :commons, :tax_amount
   end

--- db/migrate/20161208171651_remove_commons_amounts.rb ---
@@ -1,4 +1,4 @@
-class RemoveCommonsAmounts < ActiveRecord::Migration
+class RemoveCommonsAmounts < ActiveRecord::Migration[4.2]
   def change
     remove_column :commons, :discount_amount
     remove_column :commons, :base_amount

--- db/migrate/20170112115658_remove_invoice_unique_number.rb ---
@@ -1,4 +1,4 @@
-class RemoveInvoiceUniqueNumber < ActiveRecord::Migration
+class RemoveInvoiceUniqueNumber < ActiveRecord::Migration[4.2]
   def change
     remove_index "commons", name: "common_unique_number_idx"
   end

--- db/migrate/20170209101048_remove_customers_unique_name.rb ---
@@ -1,4 +1,4 @@
-class RemoveCustomersUniqueName < ActiveRecord::Migration
+class RemoveCustomersUniqueName < ActiveRecord::Migration[4.2]
   def change
     remove_index "customers", name: "cstm_idx"
   end

--- db/migrate/20170216122053_add_unique_index_to_invoice_series_and_number.rb ---
@@ -1,4 +1,4 @@
-class AddUniqueIndexToInvoiceSeriesAndNumber < ActiveRecord::Migration
+class AddUniqueIndexToInvoiceSeriesAndNumber < ActiveRecord::Migration[4.2]
   def change
     add_index "commons", ["series_id", "number"], name: "common_unique_number_idx", unique: true, using: :btree
   end

--- db/migrate/20170217120023_add_deleted_number_to_commons.rb ---
@@ -1,4 +1,4 @@
-class AddDeletedNumberToCommons < ActiveRecord::Migration
+class AddDeletedNumberToCommons < ActiveRecord::Migration[4.2]
   def change
     add_column :commons, :deleted_number, :integer, default: nil
     add_index "commons", ["series_id", "deleted_number"], name: "common_deleted_number_idx", using: :btree

--- db/migrate/20170223101022_add_commons_customer_id_not_null.rb ---
@@ -1,4 +1,4 @@
-class AddCommonsCustomerIdNotNull < ActiveRecord::Migration
+class AddCommonsCustomerIdNotNull < ActiveRecord::Migration[4.2]
   def change
       change_column :commons, :customer_id, :integer, :null => false
   end

--- db/migrate/20170608155530_add_currency_to_commons.rb ---
@@ -1,4 +1,4 @@
-class AddCurrencyToCommons < ActiveRecord::Migration
+class AddCurrencyToCommons < ActiveRecord::Migration[4.2]
   def up
     add_column :commons, :currency, :string, limit: 3
     currency = Settings.currency


--- upload/404.php ---
@@ -6,9 +6,6 @@
     template_files('404.html');
 } else {
     $data = '404_error';
-    if (User::getInstance()->hasAdminAccess()) {
-        e(lang('err_warning', ['404', 'http://docs.clip-bucket.com/?p=154']), 'w');
-    }
     e(lang($data));
 }
 

--- upload/admin_area/styles/cb_2014/layout/templates.html ---
@@ -40,15 +40,13 @@ <h2>Available Templates</h2>
                     <div class="row">
                         <div class="col-md-10 col-md-offset-1">
                             <div class="alignCenter well">
-                                <img src="{$cbtpl->get_preview_thumb($curtpl.dir)}" class="img-thumbnail" >
+                                <img src="{$cbtpl->get_preview_thumb($curtpl.dir)}" class="img-thumbnail">
                                 <h3>{$template.name}</h3>
                                 <em>
                                     {$template.name} <br /><em>by <strong>{$template.author}</strong></em>
                                 </em>
                                 <p>Website : <a href="{$template.website.link}">{$template.website.title}</a></p>
                                 <a href="templates.php?change={$template.dir}">Activate This Template</a>
-                                <a href="/?template={$template.dir}" target="_blank">Preview</a>
-                                <a href="/?template={$template.dir}&amp;set_template=yes" target="_blank">Preview &amp; Activate</a>
                             </div>
                         </div>
                     </div>

--- upload/changelog/551.json ---
@@ -1,6 +1,6 @@
 {
   "version":"5.5.1",
-  "revision":"237",
+  "revision":"238",
   "status":"dev",
   "detail":[
     {
@@ -216,6 +216,7 @@
         ,"Fix collection creation on photo upload form"
         ,"Fix video title overflow"
         ,"Fix possible arbitrary file deletion (Thanks @kawing-ho !)"
+        ,"Fix possible unauthenticated template change (Thanks @kawing-ho !)"
       ]
     },
     {

--- upload/includes/classes/ClipBucket.class.php ---
@@ -595,18 +595,11 @@ function show_page($val = true)
     /**
      * Function used to set template (Frontend)
      *
-     * @param bool $ctemplate
-     *
      * @return bool|mixed|string
      * @throws Exception
      */
-    function set_the_template($ctemplate = false)
+    function set_the_template()
     {
-        global $cbtpl, $myquery;
-        if ($ctemplate) {
-            $_GET['template'] = $ctemplate;
-        }
-
         if( is_dir(DirPath::get('styles') . $this->template) ){
             $template = $this->template;
         } else {
@@ -615,36 +608,17 @@ function set_the_template($ctemplate = false)
         }
         require_once DirPath::get('styles') . $template . DIRECTORY_SEPARATOR . 'header.php';
 
-        if (isset($_SESSION['the_template']) && $cbtpl->is_template($_SESSION['the_template'])) {
-            $template = $_SESSION['the_template'];
-        }
-
-        if (isset($_GET['template'])) { //@todo : add permission
-            if (is_dir(DirPath::get('styles') . $_GET['template']) && $_GET['template']) {
-                $template = $_GET['template'];
-            }
-        }
-        if (isset($_GET['set_the_template']) && $cbtpl->is_template($_GET['set_the_template'])) {
-            $template = $_SESSION['the_template'] = $_GET['set_the_template'];
-        }
-
-        if (!is_dir(DirPath::get('styles') . $template) || !$template) {
-            $template = $cbtpl->get_any_template();
-        }
-
         if (!is_dir(DirPath::get('styles') . $template) || !$template) {
-            exit("Unable to find any template, please goto <a href='http://clip-bucket.com/no-template-found'><strong>ClipBucket Support!</strong></a>");
+            $template = CBTemplate::getInstance()->get_any_template();
         }
 
-        if (isset($_GET['set_template'])) {
-            $myquery->set_template($template);
+        if( isset($_GET['set_template']) && User::getInstance()->hasAdminAccess() ){
+            myquery::getInstance()->set_template($template);
         }
 
         //$this->smarty_version
-        $template_details = $cbtpl->get_template_details($template);
-        $cbtpl->smarty_version = $template_details['smarty_version'];
-
-        define('SMARTY_VERSION', $cbtpl->smarty_version);
+        $template_details = CBTemplate::getInstance()->get_template_details($template);
+        CBTemplate::getInstance()->smarty_version = $template_details['smarty_version'];
 
         return $this->template = $template;
     }

--- upload/includes/classes/template.class.php ---
@@ -2,6 +2,11 @@
 
 class CBTemplate
 {
+    public static function getInstance(){
+        global $cbtpl;
+        return $cbtpl;
+    }
+
     /**
      * Function used to set Smarty Functions
      */


--- system/controllers/messages/actions/write.php ---
@@ -12,6 +12,11 @@ public function run($contact_id) {
             return cmsCore::error404();
         }
 
+        // Самому себе нельзя
+        if ($this->cms_user->id == $contact_id) {
+            return cmsCore::error404();
+        }
+
         $contact_exists_id = $this->model->isContactExists($this->cms_user->id, $contact_id);
 
         if (!$contact_exists_id) {

--- system/controllers/messages/frontend.php ---
@@ -99,7 +99,16 @@ public function clearRecipients() {
     public function sendMessage($content) {
 
         // Создаем контакты получателям
-        foreach ($this->recipients as $contact_id) {
+        foreach ($this->recipients as $key => $contact_id) {
+
+            // Контакт сам с собой невозможен
+            if ($contact_id == $this->sender_id) {
+
+                unset($this->recipients[$key]);
+
+                continue;
+            }
+
             if (!$this->model->isContactExists($contact_id, $this->sender_id)) {
                 $this->model->addContact($contact_id, $this->sender_id);
             }

--- wysiwyg/redactor/files/redactor.js ---
@@ -765,6 +765,8 @@
 		setEditor: function(html, strip)
 		{
 
+            html = this.sanitizeHTML(html);
+
 			if (strip !== false)
 			{
 				html = this.cleanSavePreCode(html);
@@ -778,9 +780,7 @@
 			}
 
 			html = html.replace(/&amp;#36;/g, '$');
-
-			html = this.cleanEmpty(html);
-			html = this.sanitizeHTML(html);
+            html = this.cleanEmpty(html);
 
 			this.$editor.html(html);
 
@@ -791,6 +791,9 @@
 		},
         sanitizeHTML:  function(htmlStr)
 		{
+            if(htmlStr.length === 0){
+                return htmlStr;
+            }
             function stringToHTML () {
                 let parser = new DOMParser();
                 let doc = parser.parseFromString(htmlStr, 'text/html');
@@ -849,6 +852,7 @@
 		},
 		setFullpageOnInit: function(html)
 		{
+            html = this.sanitizeHTML(html);
 			this.fullpageDoctype = html.match(/^<\!doctype[^>]*>/i);
 			if (this.fullpageDoctype && this.fullpageDoctype.length == 1)
 			{
@@ -858,7 +862,6 @@
 			html = this.cleanSavePreCode(html, true);
 			html = this.cleanConverters(html);
 			html = this.cleanEmpty(html);
-            html = this.sanitizeHTML(html);
 
 			this.$editor.html(html);
 
@@ -7835,4 +7838,4 @@
 		}
 	};
 
-})(jQuery);
+})(jQuery);
\ No newline at end of file


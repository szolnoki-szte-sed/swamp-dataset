--- src/receive.c ---
@@ -229,7 +229,14 @@ static void handle_socket_receive(
 	} else if (is_data_packet(packet_type)) {
 		if (!backoff_unknown(remote_addr)) {
 			pr_debug("unexpectedly received payload data from %I", remote_addr);
-			conf.protocol->handshake_init(sock, local_addr, remote_addr, NULL, FLAG_INITIAL);
+
+			/* In theory, PACKET_DATA_COMPAT could also be a valid first byte for
+			 * a future L2TPv3 extension, but as no such extensions exist and
+			 * Linux is unlikely to just enable such extensions by default in
+			 * the L2TP kernel implementation, we assume that suchs packets must
+			 * be generated by a pre-v22 fastd version without L2TP support. */
+			unsigned flags = packet_type == PACKET_DATA_COMPAT ? 0 : FLAG_L2TP_SUPPORT;
+			conf.protocol->handshake_init(sock, local_addr, remote_addr, NULL, flags);
 		}
 	} else {
 		pr_debug("received packet with invalid type from %I", remote_addr);


--- web/plugin/feature/schedule/config.php ---
@@ -6,7 +6,7 @@
 $menu_config[$menutab][] = array(
 	"index.php?app=main&inc=feature_schedule&op=list",
 	_('Schedule messages'),
-	1 
+	1
 );
 
 // plugin config
@@ -15,7 +15,7 @@
 	_('Annually') => 1,
 	_('Monthly') => 2,
 	_('Weekly') => 3,
-	_('Daily') => 4 
+	_('Daily') => 4
 );
 
 $plugin_config['schedule']['rules_display'] = array_flip($plugin_config['schedule']['rules']);

--- web/plugin/feature/schedule/docs/CHANGELOG ---
@@ -1,2 +1,8 @@
 Version 1.0
 - changelog started
+
+Version 1.1
+- format codes
+- remove error suppression from dba_*()
+- strip tags inputs with core_sanitize_string()
+- strip tags data with core_display_text() before displaying on web and export

--- web/plugin/feature/schedule/docs/README ---
@@ -1,4 +1,4 @@
 Plugin	: Schedule send SMS for playSMS sponsored by JFG @ Mobile Enterprises
 Author	: Anton Raharja
-Release	: 150214
+Release	: 240611
 License	: GPLv3

--- web/plugin/feature/schedule/docs/VERSION ---
@@ -1 +1 @@
-1.0
\ No newline at end of file
+1.1
\ No newline at end of file

--- web/plugin/feature/schedule/docs/info.xml ---
@@ -3,8 +3,8 @@
 	<name>schedule</name>
 	<alias>SMS Schedule</alias>
 	<description>SMS Schedule</description>
-	<release>1.0</release>
-	<date>2015-02-14</date>
+	<release>1.1</release>
+	<date>2024-06-11</date>
 	<author>Anton Raharja</author>
 	<language_file>1</language_file>
 	<sql_file>0</sql_file>

--- web/plugin/feature/schedule/edit.php ---
@@ -24,12 +24,12 @@
 
 switch (_OP_) {
 	case "list":
-		$id = $_REQUEST['id'];
+		$id = (int) $_REQUEST['id'];
 		$db_query = "SELECT * FROM " . _DB_PREF_ . "_featureSchedule WHERE uid='" . $user_config['uid'] . "' AND id='$id' AND flag_deleted='0'";
 		$db_result = dba_query($db_query);
 		$db_row = dba_fetch_array($db_result);
-		$name = $db_row['name'];
-		$message = $db_row['message'];
+		$name = core_display_text($db_row['name']);
+		$message = core_display_text($db_row['message']);
 		$schedule_rule = $db_row['schedule_rule'];
 		if ($id && $name && $message) {
 			$content = _dialog() . "
@@ -60,18 +60,18 @@
 		}
 		_p($content);
 		break;
-	
+
 	case "edit_yes":
-		$id = $_POST['id'];
-		$name = $_POST['name'];
-		$message = $_POST['message'];
+		$id = (int) $_POST['id'];
+		$name = core_sanitize_string($_POST['name']);
+		$message = core_sanitize_string($_POST['message']);
 		$schedule_rule = (int) $_POST['schedule_rule'];
 		if ($id && $name && $message) {
 			$db_query = "
 				UPDATE " . _DB_PREF_ . "_featureSchedule
 				SET c_timestamp='" . time() . "',name='$name',message='$message', schedule_rule='$schedule_rule'
 				WHERE uid='" . $user_config['uid'] . "' AND id='$id' AND flag_deleted='0'";
-			if (@dba_affected_rows($db_query)) {
+			if (dba_affected_rows($db_query)) {
 				$_SESSION['dialog']['info'][] = _('SMS schedule been saved');
 			} else {
 				$_SESSION['dialog']['info'][] = _('Fail to edit SMS schedule');
@@ -81,5 +81,4 @@
 		}
 		header("Location: " . _u('index.php?app=main&inc=feature_schedule&route=edit&op=list&id=' . $id));
 		exit();
-		break;
 }

--- web/plugin/feature/schedule/export.php ---
@@ -19,13 +19,13 @@
 defined('_SECURE_') or die('Forbidden');
 
 // Schedule ID
-$schedule_id = $_REQUEST['schedule_id'];
+$schedule_id = (int) $_REQUEST['schedule_id'];
 
 // validate, if not exists the block
 $conditions = array(
 	'uid' => $user_config['uid'],
 	'id' => $schedule_id,
-	'flag_deleted' => 0 
+	'flag_deleted' => 0
 );
 if (!dba_isexists(_DB_PREF_ . '_featureSchedule', $conditions)) {
 	auth_block();
@@ -34,26 +34,26 @@
 switch (_OP_) {
 	case "list":
 		$extras = array(
-			'ORDER BY' => 'schedule, name, destination' 
+			'ORDER BY' => 'schedule, name, destination'
 		);
 		$conditions = array(
-			'schedule_id' => $schedule_id 
+			'schedule_id' => $schedule_id
 		);
-		$list = dba_search(_DB_PREF_ . '_featureSchedule_dst', '*', $conditions, '', $extras);
+		$list = dba_search(_DB_PREF_ . '_featureSchedule_dst', '*', $conditions, [], $extras);
 		$data[0] = array(
 			_('Name'),
 			_('Destination'),
-			_('Schedule') 
+			_('Schedule')
 		);
 		for ($i = 0; $i < count($list); $i++) {
 			$j = $i + 1;
 			if ($j > $plugin_config['schedule']['export_row_limit']) {
 				break;
 			}
 			$data[$j] = array(
-				$list[$i]['name'],
-				$list[$i]['destination'],
-				core_display_datetime($list[$i]['schedule']) 
+				core_display_text($list[$i]['name']),
+				core_display_text($list[$i]['destination']),
+				core_display_datetime($list[$i]['schedule'])
 			);
 		}
 		$content = core_csv_format($data);

--- web/plugin/feature/schedule/fn.php ---
@@ -18,71 +18,71 @@
  */
 defined('_SECURE_') or die('Forbidden');
 
-function schedule_hook_playsmsd() {
+function schedule_hook_playsmsd()
+{
 	global $core_config;
-	
+
 	// fetch every minutes
 	if (!core_playsmsd_timer(60)) {
 		return;
 	}
-	
+
 	// mark a start
 	//_log('start scheduler', 2, 'schedule_hook_playsmsd');
-	
+
 
 	// get current server time
 	$current_datetime = core_display_datetime(core_get_datetime());
 	$current_timestamp = strtotime($current_datetime);
-	
+
 	// collect active schedules
 	$conditions = array(
 		'flag_active' => 1,
-		'flag_deleted' => 0 
+		'flag_deleted' => 0
 	);
 	$schedules = dba_search(_DB_PREF_ . '_featureSchedule', '*', $conditions);
-	foreach ($schedules as $sch) {
+	foreach ( $schedules as $sch ) {
 		$schedule_id = $sch['id'];
 		$uid = $sch['uid'];
-		$schedule_name = $sch['name'];
 		$schedule_rule = (int) $sch['schedule_rule'];
-		
+
 		// collect destinations
 		$conditions = array(
-			'schedule_id' => $schedule_id 
+			'schedule_id' => $schedule_id
 		);
-		$destinations = dba_search(_DB_PREF_ . '_featureSchedule_dst', '*', $conditions, '', $extras);
-		foreach ($destinations as $dst) {
+		$destinations = dba_search(_DB_PREF_ . '_featureSchedule_dst', '*', $conditions, [], []);
+		foreach ( $destinations as $dst ) {
 			$id = $dst['id'];
-			$name = $dst['name'];
-			$schedule_message = str_ireplace('#NAME#', $name, $sch['message']);
+			$name = core_display_text($dst['name']);
+			$schedule_message = core_display_text(str_ireplace('#NAME#', $name, $sch['message']));
 			$destination = $dst['destination'];
 			$schedule = ($dst['schedule'] ? core_display_datetime($dst['schedule']) : '0000-00-00 00:00:00');
 			$scheduled = ($dst['scheduled'] ? core_display_datetime($dst['scheduled']) : '0000-00-00 00:00:00');
 			if (!$scheduled || $scheduled == '0000-00-00 00:00:00') {
 				$scheduled = $schedule;
 			}
 			$scheduled_timestamp = strtotime($scheduled);
-			
+
 			//_log('uid:' . $uid . ' schedule_id:' . $schedule_id . ' id:' . $id . ' rule:' . $schedule_rule . ' current:[' . $current_datetime . '] schedule:[' . $schedule . '] scheduled:[' . $scheduled . ']', 2, 'schedule_hook_playsmsd');			
-			
+
 
 			$continue = FALSE;
-			
+
 			if ($current_timestamp >= $scheduled_timestamp) {
 				switch ($schedule_rule) {
 					// once
-					case '0':
+					case 0:
 						//$scheduled = '2038-01-19 10:14:07';
 						$scheduled = '2030-01-19 10:14:07';
 						$scheduled = core_adjust_datetime($scheduled);
 						$scheduled_timestamp = strtotime($current_datetime);
 						$scheduled_display = $current_datetime;
-						
+
 						$continue = TRUE;
 						break;
-					
+
 					// Annually
-					case '1':
+					case 1:
 						$current_schedule = date('Y', $current_timestamp) . '-' . date('m-d H:i:s', strtotime($schedule));
 						$next = '';
 						if ($current_timestamp > strtotime($current_schedule)) {
@@ -92,12 +92,12 @@ function schedule_hook_playsmsd() {
 						$scheduled = core_adjust_datetime($scheduled);
 						$scheduled_timestamp = strtotime($scheduled);
 						$scheduled_display = core_display_datetime($scheduled);
-						
+
 						$continue = TRUE;
 						break;
-					
+
 					// Monthly
-					case '2':
+					case 2:
 						$current_schedule = date('Y-m', $current_timestamp) . '-' . date('d H:i:s', strtotime($schedule));
 						$next = '';
 						if ($current_timestamp > strtotime($current_schedule)) {
@@ -107,12 +107,12 @@ function schedule_hook_playsmsd() {
 						$scheduled = core_adjust_datetime($scheduled);
 						$scheduled_timestamp = strtotime($scheduled);
 						$scheduled_display = core_display_datetime($scheduled);
-						
+
 						$continue = TRUE;
 						break;
-					
+
 					// Weekly
-					case '3':
+					case 3:
 						$current_schedule = date('Y-m-d', $current_timestamp) . ' ' . date('H:i:s', strtotime($schedule));
 						$current_day = date('l', strtotime($current_schedule));
 						$next = '';
@@ -123,12 +123,12 @@ function schedule_hook_playsmsd() {
 						$scheduled = core_adjust_datetime($scheduled);
 						$scheduled_timestamp = strtotime($scheduled);
 						$scheduled_display = core_display_datetime($scheduled);
-						
+
 						$continue = TRUE;
 						break;
-					
+
 					// Daily
-					case '4':
+					case 4:
 						$current_schedule = date('Y-m-d', $current_timestamp) . ' ' . date('H:i:s', strtotime($schedule));
 						$next = '';
 						if ($current_timestamp > strtotime($current_schedule)) {
@@ -138,29 +138,29 @@ function schedule_hook_playsmsd() {
 						$scheduled = core_adjust_datetime($scheduled);
 						$scheduled_timestamp = strtotime($scheduled);
 						$scheduled_display = core_display_datetime($scheduled);
-						
+
 						$continue = TRUE;
 						break;
 				}
 			}
-			
+
 			if ($continue) {
 				// set scheduled to next time
 				$items = array(
 					'c_timestamp' => time(),
-					'scheduled' => $scheduled 
+					'scheduled' => $scheduled
 				);
 				$conditions = array(
 					'schedule_id' => $schedule_id,
-					'id' => $id 
+					'id' => $id
 				);
 				if (dba_update(_DB_PREF_ . '_featureSchedule_dst', $items, $conditions, 'AND')) {
 					// if the interval is under an hour then go ahead, otherwise expired
 					$interval = $current_timestamp - $scheduled_timestamp;
 					if ($interval <= 3600) {
 						_log('sendsms uid:' . $uid . ' schedule_id:' . $schedule_id . ' id:' . $id . ' rule:' . $schedule_rule . ' schedule:[' . $schedule . '] scheduled:[' . $scheduled_display . ']', 2, 'schedule_hook_playsmsd');
 						$username = user_uid2username($uid);
-						sendsms_helper($username, $destination, $schedule_message, 'text', $unicode);
+						sendsms_helper($username, $destination, $schedule_message, 'text');
 					} else {
 						_log('expired uid:' . $uid . ' schedule_id:' . $schedule_id . ' id:' . $id . ' rule:' . $schedule_rule . ' schedule:[' . $schedule . '] scheduled:[' . $scheduled_display . '] interval:' . $interval, 2, 'schedule_hook_playsmsd');
 					}
@@ -170,7 +170,7 @@ function schedule_hook_playsmsd() {
 			}
 		}
 	}
-	
+
 	// mark an end
 	//_log('end scheduler', 2, 'schedule_hook_playsmsd');
 }

--- web/plugin/feature/schedule/import.php ---
@@ -23,13 +23,13 @@
 }
 
 // Schedule ID
-$schedule_id = $_REQUEST['schedule_id'];
+$schedule_id = (int) $_REQUEST['schedule_id'];
 
 // validate, if not exists the block
 $conditions = array(
 	'uid' => $user_config['uid'],
 	'id' => $schedule_id,
-	'flag_deleted' => 0 
+	'flag_deleted' => 0
 );
 if (!dba_isexists(_DB_PREF_ . '_featureSchedule', $conditions)) {
 	auth_block();
@@ -86,7 +86,7 @@
 			</tr></thead><tbody>";
 
 		if ($continue && file_exists($fnpb_tmpname)) {
-			
+
 			ini_set('auto_detect_line_endings', TRUE);
 			if (($fp = fopen($fnpb_tmpname, "r")) !== FALSE) {
 				$i = 0;
@@ -103,13 +103,13 @@
 				$session_import = 'schedule_' . _PID_;
 				$_SESSION['tmp'][$session_import] = array();
 				$i = 0;
-				foreach ($entries as $entry) {
-					
+				foreach ( $entries as $entry ) {
+
 					// fixme anton - https://www.exploit-database.net/?id=92915
 					$entry[0] = core_sanitize_string($entry[0]);
 					$entry[1] = core_sanitize_string($entry[1]);
 					$entry[2] = core_sanitize_string($entry[2]);
-					
+
 					if ($entry[0] && $entry[1] && $entry[2]) {
 						$i++;
 						$content .= "
@@ -125,7 +125,7 @@
 				}
 			}
 			ini_set('auto_detect_line_endings', FALSE);
-			
+
 			$content .= "
 				</tbody></table>
 				</div>
@@ -148,29 +148,31 @@
 	case "import_yes":
 		@set_time_limit(0);
 		$num = $_POST['number_of_row'];
-		$session_import = $_POST['session_import'];
+		$session_import = core_sanitize_string($_POST['session_import']);
 		$data = $_SESSION['tmp'][$session_import];
-		foreach ($data as $d) {
-			$name = trim($d[0]);
-			$destination = trim($d[1]);
+		foreach ( $data as $d ) {
+			$name = core_sanitize_string(trim($d[0]));
+			$destination = core_sanitize_string(trim($d[1]));
 			$schedule = trim($d[2]);
 			if ($name && $destination && $schedule) {
 				$schedule = core_adjust_datetime($schedule);
 				// add destiantions, replace existing entry with the same name
-				if (dba_isexists(_DB_PREF_ . '_featureSchedule_dst', array(
-					'schedule_id' => $schedule_id,
-					'name' => $name 
-				), 'AND')) {
+				if (
+					dba_isexists(_DB_PREF_ . '_featureSchedule_dst', array(
+						'schedule_id' => $schedule_id,
+						'name' => $name
+					), 'AND')
+				) {
 					// update
 					$items = array(
 						'c_timestamp' => time(),
 						'schedule' => $schedule,
-						'scheduled' => '0000-00-00 00:00:00' 
+						'scheduled' => '0000-00-00 00:00:00'
 					);
 					$conditions = array(
 						'schedule_id' => $schedule_id,
 						'name' => $name,
-						'destination' => $destination 
+						'destination' => $destination
 					);
 					dba_update(_DB_PREF_ . '_featureSchedule_dst', $items, $conditions);
 				} else {
@@ -180,7 +182,7 @@
 						'schedule' => $schedule,
 						'scheduled' => '0000-00-00 00:00:00',
 						'name' => $name,
-						'destination' => $destination 
+						'destination' => $destination
 					);
 					dba_add(_DB_PREF_ . '_featureSchedule_dst', $items);
 				}
@@ -189,5 +191,4 @@
 		$_SESSION['dialog']['info'][] = _('Entries in CSV file have been imported');
 		header("Location: " . _u('index.php?app=main&inc=feature_schedule&route=import&op=list&schedule_id=' . $schedule_id));
 		exit();
-		break;
 }

--- web/plugin/feature/schedule/manage.php ---
@@ -24,12 +24,12 @@
 
 switch (_OP_) {
 	case "list":
-		$id = $_REQUEST['id'];
+		$id = (int) $_REQUEST['id'];
 		$db_query = "SELECT * FROM " . _DB_PREF_ . "_featureSchedule WHERE uid='" . $user_config['uid'] . "' AND id='$id' AND flag_deleted='0'";
 		$db_result = dba_query($db_query);
 		$db_row = dba_fetch_array($db_result);
-		$name = $db_row['name'];
-		$message = $db_row['message'];
+		$name = core_display_text($db_row['name']);
+		$message = core_display_text($db_row['message']);
 		$schedule_rule = $db_row['schedule_rule'];
 		if ($id && $name && $message) {
 			$content = _dialog() . "
@@ -51,32 +51,32 @@
 					<td>" . _('Schedule rule') . "</td><td>" . $plugin_config['schedule']['rules_display'][$schedule_rule] . "</td>
 				</tr>
 				</table>";
-			
+
 			// list of destinations
-			
+
 
 			$search_category = array(
 				_('Schedule') => 'schedule',
 				_('Name') => 'name',
-				_('Destination') => 'destination' 
+				_('Destination') => 'destination'
 			);
 			$base_url = 'index.php?app=main&inc=feature_schedule&route=manage&op=list&id=' . $id;
 			$search = themes_search($search_category, $base_url);
-			
+
 			$fields = '*';
 			$conditions = array(
-				'schedule_id' => $id 
+				'schedule_id' => $id
 			);
 			$keywords = $search['dba_keywords'];
 			$count = dba_count(_DB_PREF_ . '_featureSchedule_dst', $conditions, $keywords);
 			$nav = themes_nav($count, $search['url']);
 			$extras = array(
 				'ORDER BY' => 'schedule, name, destination',
 				'LIMIT' => $nav['limit'],
-				'OFFSET' => $nav['offset'] 
+				'OFFSET' => $nav['offset']
 			);
 			$list = dba_search(_DB_PREF_ . '_featureSchedule_dst', $fields, $conditions, $keywords, $extras);
-			
+
 			$content .= "
 				<h3>" . _('List of destinations') . "</h3>
 				<form name=fm_schedule_dst_list id=fm_schedule_dst_list action='" . $base_url . "' method=post>
@@ -94,14 +94,14 @@
 					<th width=10%>" . _('Action') . "</th>
 				</tr></thead>
 				<tbody>";
-			foreach ($list as $db_row) {
+			foreach ( $list as $db_row ) {
 				$action = "<a href=\"" . _u('index.php?app=main&inc=feature_schedule&route=manage&op=dst_edit&schedule_id=' . $id . '&id=' . $db_row['id']) . "\">" . $icon_config['edit'] . "</a>&nbsp;";
-				$action .= "<a href=\"javascript: ConfirmURL('" . _('Are you sure you want to remove this number from SMS schedule ?') . " (" . $db_row['name'] . " " . $db_row['destination'] . ")','" . _u('index.php?app=main&inc=feature_schedule&route=manage&op=dst_del&schedule_id=' . $id . '&id=' . $db_row['id']) . "')\">" . $icon_config['delete'] . "</a>";
+				$action .= "<a href=\"javascript: ConfirmURL('" . _('Are you sure you want to remove this number from SMS schedule ?') . " (" . core_display_text($db_row['name']) . " " . core_display_text($db_row['destination']) . ")','" . _u('index.php?app=main&inc=feature_schedule&route=manage&op=dst_del&schedule_id=' . $id . '&id=' . $db_row['id']) . "')\">" . $icon_config['delete'] . "</a>";
 				$i++;
 				$content .= "
 					<tr>
-						<td>" . $db_row['name'] . "</td>
-						<td>" . $db_row['destination'] . "</td>
+						<td>" . core_display_text($db_row['name']) . "</td>
+						<td>" . core_display_text($db_row['destination']) . "</td>
 						<td>" . core_display_datetime($db_row['schedule']) . "</td>
 						<td>" . $action . "</td>
 					</tr>";
@@ -112,21 +112,21 @@
 				</div>
 				<div class=pull-right>" . $nav['form'] . "</div>
 				</form>";
-			
+
 			$content .= "<p>" . _back('index.php?app=main&inc=feature_schedule&op=list');
 		} else {
 			auth_block();
 		}
 		_p($content);
 		break;
-	
+
 	case "dst_add":
-		$schedule_id = $_REQUEST['schedule_id'];
+		$schedule_id = (int) $_REQUEST['schedule_id'];
 		$db_query = "SELECT * FROM " . _DB_PREF_ . "_featureSchedule WHERE uid='" . $user_config['uid'] . "' AND id='$schedule_id' AND flag_deleted='0'";
 		$db_result = dba_query($db_query);
 		$db_row = dba_fetch_array($db_result);
-		$schedule_name = $db_row['name'];
-		$schedule_message = $db_row['message'];
+		$schedule_name = core_display_text($db_row['name']);
+		$schedule_message = core_display_text($db_row['message']);
 		if ($schedule_id && $schedule_name && $schedule_message) {
 			$content = _dialog() . "
 				<h2>" . _('Schedule messages') . "</h2>
@@ -160,24 +160,24 @@
 		}
 		_p($content);
 		break;
-	
+
 	case "dst_add_yes":
-		$schedule_id = $_REQUEST['schedule_id'];
+		$schedule_id = (int) $_REQUEST['schedule_id'];
 		$db_query = "SELECT * FROM " . _DB_PREF_ . "_featureSchedule WHERE uid='" . $user_config['uid'] . "' AND id='$schedule_id' AND flag_deleted='0'";
 		$db_result = dba_query($db_query);
 		$db_row = dba_fetch_array($db_result);
-		$schedule_name = $db_row['name'];
-		$schedule_message = $db_row['message'];
+		$schedule_name = core_display_text($db_row['name']);
+		$schedule_message = core_display_text($db_row['message']);
 		if ($schedule_id && $schedule_name && $schedule_message) {
-			$name = $_POST['name'];
-			$destination = $_POST['destination'];
+			$name = core_sanitize_string($_POST['name']);
+			$destination = core_sanitize_string($_POST['destination']);
 			$schedule = trim($_POST['schedule']);
 			if ($name && $destination && $schedule) {
 				$schedule = ($schedule ? core_adjust_datetime($schedule) : '0000-00-00 00:00:00');
 				$db_query = "
 				INSERT INTO " . _DB_PREF_ . "_featureSchedule_dst (schedule_id,schedule,name,destination)
 				VALUES ('$schedule_id','$schedule','$name','$destination')";
-				if ($new_uid = @dba_insert_id($db_query)) {
+				if ($new_uid = dba_insert_id($db_query)) {
 					$_SESSION['dialog']['info'][] = _('New destination has been added');
 				} else {
 					$_SESSION['dialog']['info'][] = _('Fail to add new destination');
@@ -191,16 +191,18 @@
 			auth_block();
 		}
 		break;
-	
+
 	case "dst_del":
-		$id = $_REQUEST['id']; // destination ID
-		$schedule_id = $_REQUEST['schedule_id']; // schedule ID
-		if ($id && $schedule_id && dba_isexists(_DB_PREF_ . "_featureSchedule", array(
-			'uid' => $user_config['uid'],
-			'id' => $schedule_id 
-		), 'AND')) {
+		$id = (int) $_REQUEST['id']; // destination ID
+		$schedule_id = (int) $_REQUEST['schedule_id']; // schedule ID
+		if (
+			$id && $schedule_id && dba_isexists(_DB_PREF_ . "_featureSchedule", array(
+				'uid' => $user_config['uid'],
+				'id' => $schedule_id
+			), 'AND')
+		) {
 			$db_query = "DELETE FROM " . _DB_PREF_ . "_featureSchedule_dst WHERE schedule_id='$schedule_id' AND id='$id'";
-			if (@dba_affected_rows($db_query)) {
+			if (dba_affected_rows($db_query)) {
 				$_SESSION['dialog']['info'][] = _('Destination has been deleted');
 			} else {
 				$_SESSION['dialog']['info'][] = _('Fail to delete destination');
@@ -210,25 +212,24 @@
 		}
 		header("Location: " . _u('index.php?app=main&inc=feature_schedule&route=manage&op=list&id=' . $schedule_id));
 		exit();
-		break;
-	
+
 	case "dst_edit":
-		$id = $_REQUEST['id']; // destination ID
-		$schedule_id = $_REQUEST['schedule_id']; // schedule ID
+		$id = (int) $_REQUEST['id']; // destination ID
+		$schedule_id = (int) $_REQUEST['schedule_id']; // schedule ID
 		$db_query = "SELECT * FROM " . _DB_PREF_ . "_featureSchedule WHERE uid='" . $user_config['uid'] . "' AND id='$schedule_id' AND flag_deleted='0'";
 		$db_result = dba_query($db_query);
 		$db_row = dba_fetch_array($db_result);
-		$schedule_name = $db_row['name'];
-		$schedule_message = $db_row['message'];
+		$schedule_name = core_display_text($db_row['name']);
+		$schedule_message = core_display_text($db_row['message']);
 		if ($id && $schedule_id && $schedule_name && $schedule_message) {
 			$db_query = "SELECT * FROM " . _DB_PREF_ . "_featureSchedule_dst WHERE schedule_id='$schedule_id' AND id='$id'";
 			$db_result = dba_query($db_query);
 			$db_row = dba_fetch_array($db_result);
 			$schedule = $db_row['schedule'];
 			$schedule = ($schedule ? core_display_datetime($schedule) : '0000-00-00 00:00:00');
-			$name = $db_row['name'];
-			$destination = $db_row['destination'];
-			
+			$name = core_display_text($db_row['name']);
+			$destination = core_display_text($db_row['destination']);
+
 			$content = _dialog() . "
 				<h2>" . _('Schedule messages') . "</h2>
 				<h3>" . _('Manage schedule') . "</h3>
@@ -262,26 +263,26 @@
 		}
 		_p($content);
 		break;
-	
+
 	case "dst_edit_yes":
-		$id = $_REQUEST['id']; // destination ID
-		$schedule_id = $_REQUEST['schedule_id']; // schedule ID
+		$id = (int) $_REQUEST['id']; // destination ID
+		$schedule_id = (int) $_REQUEST['schedule_id']; // schedule ID
 		$db_query = "SELECT * FROM " . _DB_PREF_ . "_featureSchedule WHERE uid='" . $user_config['uid'] . "' AND id='$schedule_id' AND flag_deleted='0'";
 		$db_result = dba_query($db_query);
 		$db_row = dba_fetch_array($db_result);
-		$schedule_name = $db_row['name'];
-		$schedule_message = $db_row['message'];
+		$schedule_name = core_display_text($db_row['name']);
+		$schedule_message = core_display_text($db_row['message']);
 		if ($id && $schedule_id && $schedule_name && $schedule_message) {
-			$name = $_POST['name'];
-			$destination = $_POST['destination'];
+			$name = core_sanitize_string($_POST['name']);
+			$destination = core_sanitize_string($_POST['destination']);
 			$schedule = trim($_POST['schedule']);
 			if ($name && $destination && $schedule) {
 				$schedule = ($schedule ? core_adjust_datetime($schedule) : '0000-00-00 00:00:00');
 				$db_query = "
 					UPDATE " . _DB_PREF_ . "_featureSchedule_dst
 					SET c_timestamp='" . time() . "',name='$name',destination='$destination',schedule='$schedule',scheduled='0000-00-00 00:00:00'
 					WHERE schedule_id='$schedule_id' AND id='$id'";
-				if (@dba_affected_rows($db_query)) {
+				if (dba_affected_rows($db_query)) {
 					$_SESSION['dialog']['info'][] = _('Destination has been edited');
 				} else {
 					$_SESSION['dialog']['info'][] = _('Fail to edit destination');

--- web/plugin/feature/schedule/schedule.php ---
@@ -51,8 +51,8 @@
 			$content .= "
 					<tr>
 						<td>" . $db_row['id'] . "</td>
-						<td>" . $db_row['name'] . "</td>
-						<td>" . $db_row['message'] . "</td>
+						<td>" . core_display_text($db_row['name']) . "</td>
+						<td>" . core_display_text($db_row['message']) . "</td>
 						<td>" . $status . "</td>
 						<td>" . $action . "</td>
 					</tr>";
@@ -64,7 +64,7 @@
 			" . _button('index.php?app=main&inc=feature_schedule&op=add', _('Add SMS schedule'));
 		_p($content);
 		break;
-	
+
 	case "add":
 		$content = _dialog() . "
 			<h2>" . _('Schedule messages') . "</h2>
@@ -87,18 +87,18 @@
 			" . _back('index.php?app=main&inc=feature_schedule&op=list');
 		_p($content);
 		break;
-	
+
 	case "add_yes":
-		$name = $_POST['name'];
-		$message = $_POST['message'];
+		$name = core_sanitize_string($_POST['name']);
+		$message = core_sanitize_string($_POST['message']);
 		$schedule_rule = (int) $_POST['schedule_rule'];
 		if ($name && $message) {
 			// flag_active  : 1 active, 2 inactive, 0 considered inactive
 			// flag_deleted : 1 deleted, other values considered non-deleted
 			$db_query = "
 				INSERT INTO " . _DB_PREF_ . "_featureSchedule (c_timestamp,uid,name,message,schedule_rule,flag_active,flag_deleted)
 				VALUES (" . time() . ",'" . $user_config['uid'] . "','$name','$message','$schedule_rule','2','0')";
-			if ($new_uid = @dba_insert_id($db_query)) {
+			if ($new_uid = dba_insert_id($db_query)) {
 				$_SESSION['dialog']['info'][] = _('New SMS schedule been added');
 			} else {
 				$_SESSION['dialog']['info'][] = _('Fail to add new SMS schedule');
@@ -108,18 +108,19 @@
 		}
 		header("Location: " . _u('index.php?app=main&inc=feature_schedule&op=add'));
 		exit();
-		break;
-	
+
 	case "status":
 		$id = $_REQUEST['id'];
-		if ($id && dba_isexists(_DB_PREF_ . "_featureSchedule", array(
-			'uid' => $user_config['uid'],
-			'id' => $id,
-			'flag_deleted' => '0' 
-		), 'AND')) {
+		if (
+			$id && dba_isexists(_DB_PREF_ . "_featureSchedule", array(
+				'uid' => $user_config['uid'],
+				'id' => $id,
+				'flag_deleted' => '0'
+			), 'AND')
+		) {
 			$status = ($_REQUEST['status'] == 1 ? 1 : 2);
 			$db_query = "UPDATE " . _DB_PREF_ . "_featureSchedule SET c_timestamp='" . time() . "', flag_active='$status' WHERE uid='" . $user_config['uid'] . "' AND id='$id'";
-			if (@dba_affected_rows($db_query)) {
+			if (dba_affected_rows($db_query)) {
 				if ($status == 1) {
 					$_SESSION['dialog']['info'][] = _('SMS schedule has been enabled');
 				} else {
@@ -129,16 +130,17 @@
 		}
 		header("Location: " . _u('index.php?app=main&inc=feature_schedule&op=list'));
 		exit();
-		break;
-	
+
 	case "del":
 		$id = $_REQUEST['id'];
-		if ($id && dba_isexists(_DB_PREF_ . "_featureSchedule", array(
-			'uid' => $user_config['uid'],
-			'id' => $id 
-		), 'AND')) {
+		if (
+			$id && dba_isexists(_DB_PREF_ . "_featureSchedule", array(
+				'uid' => $user_config['uid'],
+				'id' => $id
+			), 'AND')
+		) {
 			$db_query = "UPDATE " . _DB_PREF_ . "_featureSchedule SET c_timestamp='" . time() . "', flag_active='2', flag_deleted='1' WHERE uid='" . $user_config['uid'] . "' AND id='$id'";
-			if (@dba_affected_rows($db_query)) {
+			if (dba_affected_rows($db_query)) {
 				$_SESSION['dialog']['info'][] = _('SMS schedule has been deleted');
 			} else {
 				$_SESSION['dialog']['info'][] = _('Fail to delete SMS schedule');
@@ -148,5 +150,4 @@
 		}
 		header("Location: " . _u('index.php?app=main&inc=feature_schedule&op=list'));
 		exit();
-		break;
 }


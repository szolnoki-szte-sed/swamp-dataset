--- hphp/runtime/ext/json/JSON_parser.cpp ---
@@ -342,8 +342,8 @@ struct SimpleParser {
                        JSONContainerType container_type, bool is_tsimplejson) {
     SimpleParser parser(inp, length, buf, container_type, is_tsimplejson);
     bool ok = parser.parseValue();
-    parser.skipSpace();
-    if (!ok || parser.p != inp + length) {
+    if (!ok ||
+        (parser.skipSpace(), parser.p != inp + length)) {
       // Unsupported, malformed, or trailing garbage. Release entire stack.
       tvDecRefRange(buf, parser.top);
       return false;

--- hphp/test/slow/ext_json/decode_crash.php ---
@@ -1,3 +1,4 @@
 <?hh
 
 var_dump(json_decode('"a"', false, 0, 0));
+var_dump(json_decode('"abc', true, 1000, 0));

--- hphp/test/slow/ext_json/decode_crash.php.expect ---
@@ -1 +1,2 @@
 NULL
+NULL

